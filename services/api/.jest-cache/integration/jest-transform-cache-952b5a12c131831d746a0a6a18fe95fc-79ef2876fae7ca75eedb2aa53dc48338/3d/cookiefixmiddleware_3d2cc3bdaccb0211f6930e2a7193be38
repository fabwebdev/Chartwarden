7844b4fa99efa518f5993e02dc3eb18a
/* istanbul ignore next */
function cov_1407bcwfyt() {
  var path = "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/middleware/cookie-fix.middleware.js";
  var hash = "b25c00a0165aa131adb5f003bc8eba20cde5454a";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/middleware/cookie-fix.middleware.js",
    statementMap: {
      "0": {
        start: {
          line: 6,
          column: 28
        },
        end: {
          line: 42,
          column: 1
        }
      },
      "1": {
        start: {
          line: 8,
          column: 28
        },
        end: {
          line: 8,
          column: 55
        }
      },
      "2": {
        start: {
          line: 11,
          column: 2
        },
        end: {
          line: 21,
          column: 4
        }
      },
      "3": {
        start: {
          line: 13,
          column: 25
        },
        end: {
          line: 17,
          column: 5
        }
      },
      "4": {
        start: {
          line: 20,
          column: 4
        },
        end: {
          line: 20,
          column: 56
        }
      },
      "5": {
        start: {
          line: 24,
          column: 25
        },
        end: {
          line: 24,
          column: 49
        }
      },
      "6": {
        start: {
          line: 25,
          column: 2
        },
        end: {
          line: 41,
          column: 4
        }
      },
      "7": {
        start: {
          line: 26,
          column: 4
        },
        end: {
          line: 37,
          column: 5
        }
      },
      "8": {
        start: {
          line: 28,
          column: 22
        },
        end: {
          line: 28,
          column: 60
        }
      },
      "9": {
        start: {
          line: 31,
          column: 30
        },
        end: {
          line: 33,
          column: 8
        }
      },
      "10": {
        start: {
          line: 32,
          column: 8
        },
        end: {
          line: 32,
          column: 41
        }
      },
      "11": {
        start: {
          line: 36,
          column: 6
        },
        end: {
          line: 36,
          column: 51
        }
      },
      "12": {
        start: {
          line: 40,
          column: 4
        },
        end: {
          line: 40,
          column: 39
        }
      },
      "13": {
        start: {
          line: 49,
          column: 2
        },
        end: {
          line: 55,
          column: 3
        }
      },
      "14": {
        start: {
          line: 51,
          column: 4
        },
        end: {
          line: 53,
          column: 5
        }
      },
      "15": {
        start: {
          line: 52,
          column: 6
        },
        end: {
          line: 52,
          column: 27
        }
      },
      "16": {
        start: {
          line: 54,
          column: 4
        },
        end: {
          line: 54,
          column: 18
        }
      },
      "17": {
        start: {
          line: 58,
          column: 17
        },
        end: {
          line: 62,
          column: 50
        }
      },
      "18": {
        start: {
          line: 65,
          column: 2
        },
        end: {
          line: 77,
          column: 3
        }
      },
      "19": {
        start: {
          line: 67,
          column: 4
        },
        end: {
          line: 76,
          column: 5
        }
      },
      "20": {
        start: {
          line: 68,
          column: 6
        },
        end: {
          line: 68,
          column: 73
        }
      },
      "21": {
        start: {
          line: 69,
          column: 11
        },
        end: {
          line: 76,
          column: 5
        }
      },
      "22": {
        start: {
          line: 70,
          column: 6
        },
        end: {
          line: 70,
          column: 69
        }
      },
      "23": {
        start: {
          line: 73,
          column: 6
        },
        end: {
          line: 73,
          column: 36
        }
      },
      "24": {
        start: {
          line: 75,
          column: 6
        },
        end: {
          line: 75,
          column: 29
        }
      },
      "25": {
        start: {
          line: 80,
          column: 2
        },
        end: {
          line: 82,
          column: 3
        }
      },
      "26": {
        start: {
          line: 81,
          column: 4
        },
        end: {
          line: 81,
          column: 27
        }
      },
      "27": {
        start: {
          line: 84,
          column: 2
        },
        end: {
          line: 84,
          column: 18
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 6,
            column: 28
          },
          end: {
            line: 6,
            column: 29
          }
        },
        loc: {
          start: {
            line: 6,
            column: 54
          },
          end: {
            line: 42,
            column: 1
          }
        },
        line: 6
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 11,
            column: 20
          },
          end: {
            line: 11,
            column: 21
          }
        },
        loc: {
          start: {
            line: 11,
            column: 56
          },
          end: {
            line: 21,
            column: 3
          }
        },
        line: 11
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 25,
            column: 17
          },
          end: {
            line: 25,
            column: 18
          }
        },
        loc: {
          start: {
            line: 25,
            column: 39
          },
          end: {
            line: 41,
            column: 3
          }
        },
        line: 25
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 31,
            column: 42
          },
          end: {
            line: 31,
            column: 43
          }
        },
        loc: {
          start: {
            line: 31,
            column: 52
          },
          end: {
            line: 33,
            column: 7
          }
        },
        line: 31
      },
      "4": {
        name: "fixCookieSameSite",
        decl: {
          start: {
            line: 47,
            column: 9
          },
          end: {
            line: 47,
            column: 26
          }
        },
        loc: {
          start: {
            line: 47,
            column: 35
          },
          end: {
            line: 85,
            column: 1
          }
        },
        line: 47
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 11,
            column: 42
          },
          end: {
            line: 11,
            column: 54
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 11,
            column: 52
          },
          end: {
            line: 11,
            column: 54
          }
        }],
        line: 11
      },
      "1": {
        loc: {
          start: {
            line: 26,
            column: 4
          },
          end: {
            line: 37,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 26,
            column: 4
          },
          end: {
            line: 37,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 26
      },
      "2": {
        loc: {
          start: {
            line: 28,
            column: 22
          },
          end: {
            line: 28,
            column: 60
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 28,
            column: 45
          },
          end: {
            line: 28,
            column: 50
          }
        }, {
          start: {
            line: 28,
            column: 53
          },
          end: {
            line: 28,
            column: 60
          }
        }],
        line: 28
      },
      "3": {
        loc: {
          start: {
            line: 49,
            column: 2
          },
          end: {
            line: 55,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 49,
            column: 2
          },
          end: {
            line: 55,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 49
      },
      "4": {
        loc: {
          start: {
            line: 49,
            column: 6
          },
          end: {
            line: 49,
            column: 74
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 49,
            column: 6
          },
          end: {
            line: 49,
            column: 38
          }
        }, {
          start: {
            line: 49,
            column: 42
          },
          end: {
            line: 49,
            column: 74
          }
        }],
        line: 49
      },
      "5": {
        loc: {
          start: {
            line: 51,
            column: 4
          },
          end: {
            line: 53,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 51,
            column: 4
          },
          end: {
            line: 53,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 51
      },
      "6": {
        loc: {
          start: {
            line: 65,
            column: 2
          },
          end: {
            line: 77,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 65,
            column: 2
          },
          end: {
            line: 77,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 65
      },
      "7": {
        loc: {
          start: {
            line: 67,
            column: 4
          },
          end: {
            line: 76,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 67,
            column: 4
          },
          end: {
            line: 76,
            column: 5
          }
        }, {
          start: {
            line: 69,
            column: 11
          },
          end: {
            line: 76,
            column: 5
          }
        }],
        line: 67
      },
      "8": {
        loc: {
          start: {
            line: 69,
            column: 11
          },
          end: {
            line: 76,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 69,
            column: 11
          },
          end: {
            line: 76,
            column: 5
          }
        }, {
          start: {
            line: 71,
            column: 11
          },
          end: {
            line: 76,
            column: 5
          }
        }],
        line: 69
      },
      "9": {
        loc: {
          start: {
            line: 80,
            column: 2
          },
          end: {
            line: 82,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 80,
            column: 2
          },
          end: {
            line: 82,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 80
      },
      "10": {
        loc: {
          start: {
            line: 80,
            column: 6
          },
          end: {
            line: 80,
            column: 72
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 80,
            column: 6
          },
          end: {
            line: 80,
            column: 40
          }
        }, {
          start: {
            line: 80,
            column: 44
          },
          end: {
            line: 80,
            column: 72
          }
        }],
        line: 80
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0
    },
    b: {
      "0": [0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0]
    },
    inputSourceMap: null,
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "b25c00a0165aa131adb5f003bc8eba20cde5454a"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_1407bcwfyt = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_1407bcwfyt();
cov_1407bcwfyt().s[0]++;
/**
 * Middleware to fix cookie SameSite attribute for cross-origin requests
 * Better Auth may not respect the cookie configuration, so we intercept
 * Set-Cookie headers and modify them to use SameSite=None
 */
const cookieFixMiddleware = async (request, reply) => {
  /* istanbul ignore next */
  cov_1407bcwfyt().f[0]++;
  // Store original setCookie function
  const originalSetCookie =
  /* istanbul ignore next */
  (cov_1407bcwfyt().s[1]++, reply.setCookie.bind(reply));

  // Override setCookie to fix SameSite attribute
  /* istanbul ignore next */
  cov_1407bcwfyt().s[2]++;
  reply.setCookie = function (name, value, options =
  /* istanbul ignore next */
  (cov_1407bcwfyt().b[0][0]++, {})) {
    /* istanbul ignore next */
    cov_1407bcwfyt().f[1]++;
    // Force SameSite=None and Secure for cross-origin
    const fixedOptions =
    /* istanbul ignore next */
    (cov_1407bcwfyt().s[3]++, {
      ...options,
      sameSite: 'none',
      secure: true
    });

    // Call original setCookie function with fixed options
    /* istanbul ignore next */
    cov_1407bcwfyt().s[4]++;
    return originalSetCookie(name, value, fixedOptions);
  };

  // Also intercept header setting for Set-Cookie
  const originalHeader =
  /* istanbul ignore next */
  (cov_1407bcwfyt().s[5]++, reply.header.bind(reply));
  /* istanbul ignore next */
  cov_1407bcwfyt().s[6]++;
  reply.header = function (name, value) {
    /* istanbul ignore next */
    cov_1407bcwfyt().f[2]++;
    cov_1407bcwfyt().s[7]++;
    if (name.toLowerCase() === 'set-cookie') {
      /* istanbul ignore next */
      cov_1407bcwfyt().b[1][0]++;
      // Handle array of cookie strings
      const cookies =
      /* istanbul ignore next */
      (cov_1407bcwfyt().s[8]++, Array.isArray(value) ?
      /* istanbul ignore next */
      (cov_1407bcwfyt().b[2][0]++, value) :
      /* istanbul ignore next */
      (cov_1407bcwfyt().b[2][1]++, [value]));

      // Modify each cookie to use SameSite=None
      const modifiedCookies =
      /* istanbul ignore next */
      (cov_1407bcwfyt().s[9]++, cookies.map(cookie => {
        /* istanbul ignore next */
        cov_1407bcwfyt().f[3]++;
        cov_1407bcwfyt().s[10]++;
        return fixCookieSameSite(cookie);
      }));

      // Call original header with modified cookies
      /* istanbul ignore next */
      cov_1407bcwfyt().s[11]++;
      return originalHeader(name, modifiedCookies);
    } else
    /* istanbul ignore next */
    {
      cov_1407bcwfyt().b[1][1]++;
    }

    // For all other headers, call original header
    cov_1407bcwfyt().s[12]++;
    return originalHeader(name, value);
  };
};

/**
 * Fix cookie SameSite attribute to None for cross-origin support
 */
function fixCookieSameSite(cookie) {
  /* istanbul ignore next */
  cov_1407bcwfyt().f[4]++;
  cov_1407bcwfyt().s[13]++;
  // If cookie already has SameSite=None, leave it
  if (
  /* istanbul ignore next */
  (cov_1407bcwfyt().b[4][0]++, cookie.includes('SameSite=None')) ||
  /* istanbul ignore next */
  (cov_1407bcwfyt().b[4][1]++, cookie.includes('SameSite=none'))) {
    /* istanbul ignore next */
    cov_1407bcwfyt().b[3][0]++;
    cov_1407bcwfyt().s[14]++;
    // Ensure Secure is present
    if (!cookie.includes('Secure')) {
      /* istanbul ignore next */
      cov_1407bcwfyt().b[5][0]++;
      cov_1407bcwfyt().s[15]++;
      cookie += '; Secure';
    } else
    /* istanbul ignore next */
    {
      cov_1407bcwfyt().b[5][1]++;
    }
    cov_1407bcwfyt().s[16]++;
    return cookie;
  } else
  /* istanbul ignore next */
  {
    cov_1407bcwfyt().b[3][1]++;
  }

  // Replace SameSite=Lax or SameSite=Strict with SameSite=None
  let modified =
  /* istanbul ignore next */
  (cov_1407bcwfyt().s[17]++, cookie.replace(/SameSite=Lax/gi, 'SameSite=None').replace(/SameSite=Strict/gi, 'SameSite=None').replace(/SameSite=lax/gi, 'SameSite=None').replace(/SameSite=strict/gi, 'SameSite=None'));

  // If no SameSite attribute exists, add it
  /* istanbul ignore next */
  cov_1407bcwfyt().s[18]++;
  if (!modified.includes('SameSite')) {
    /* istanbul ignore next */
    cov_1407bcwfyt().b[6][0]++;
    cov_1407bcwfyt().s[19]++;
    // Insert SameSite=None before Secure or at the end
    if (modified.includes('; Secure')) {
      /* istanbul ignore next */
      cov_1407bcwfyt().b[7][0]++;
      cov_1407bcwfyt().s[20]++;
      modified = modified.replace('; Secure', '; SameSite=None; Secure');
    } else {
      /* istanbul ignore next */
      cov_1407bcwfyt().b[7][1]++;
      cov_1407bcwfyt().s[21]++;
      if (modified.includes('Secure')) {
        /* istanbul ignore next */
        cov_1407bcwfyt().b[8][0]++;
        cov_1407bcwfyt().s[22]++;
        modified = modified.replace('Secure', 'SameSite=None; Secure');
      } else {
        /* istanbul ignore next */
        cov_1407bcwfyt().b[8][1]++;
        cov_1407bcwfyt().s[23]++;
        // Add at the end
        modified += '; SameSite=None';
        // Ensure Secure is also present for SameSite=None
        /* istanbul ignore next */
        cov_1407bcwfyt().s[24]++;
        modified += '; Secure';
      }
    }
  } else
  /* istanbul ignore next */
  {
    cov_1407bcwfyt().b[6][1]++;
  }

  // Ensure Secure is present when SameSite=None
  cov_1407bcwfyt().s[25]++;
  if (
  /* istanbul ignore next */
  (cov_1407bcwfyt().b[10][0]++, modified.includes('SameSite=None')) &&
  /* istanbul ignore next */
  (cov_1407bcwfyt().b[10][1]++, !modified.includes('Secure'))) {
    /* istanbul ignore next */
    cov_1407bcwfyt().b[9][0]++;
    cov_1407bcwfyt().s[26]++;
    modified += '; Secure';
  } else
  /* istanbul ignore next */
  {
    cov_1407bcwfyt().b[9][1]++;
  }
  cov_1407bcwfyt().s[27]++;
  return modified;
}
export default cookieFixMiddleware;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMTQwN2Jjd2Z5dCIsImFjdHVhbENvdmVyYWdlIiwicyIsImNvb2tpZUZpeE1pZGRsZXdhcmUiLCJyZXF1ZXN0IiwicmVwbHkiLCJmIiwib3JpZ2luYWxTZXRDb29raWUiLCJzZXRDb29raWUiLCJiaW5kIiwibmFtZSIsInZhbHVlIiwib3B0aW9ucyIsImIiLCJmaXhlZE9wdGlvbnMiLCJzYW1lU2l0ZSIsInNlY3VyZSIsIm9yaWdpbmFsSGVhZGVyIiwiaGVhZGVyIiwidG9Mb3dlckNhc2UiLCJjb29raWVzIiwiQXJyYXkiLCJpc0FycmF5IiwibW9kaWZpZWRDb29raWVzIiwibWFwIiwiY29va2llIiwiZml4Q29va2llU2FtZVNpdGUiLCJpbmNsdWRlcyIsIm1vZGlmaWVkIiwicmVwbGFjZSJdLCJzb3VyY2VzIjpbImNvb2tpZS1maXgubWlkZGxld2FyZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1pZGRsZXdhcmUgdG8gZml4IGNvb2tpZSBTYW1lU2l0ZSBhdHRyaWJ1dGUgZm9yIGNyb3NzLW9yaWdpbiByZXF1ZXN0c1xuICogQmV0dGVyIEF1dGggbWF5IG5vdCByZXNwZWN0IHRoZSBjb29raWUgY29uZmlndXJhdGlvbiwgc28gd2UgaW50ZXJjZXB0XG4gKiBTZXQtQ29va2llIGhlYWRlcnMgYW5kIG1vZGlmeSB0aGVtIHRvIHVzZSBTYW1lU2l0ZT1Ob25lXG4gKi9cbmNvbnN0IGNvb2tpZUZpeE1pZGRsZXdhcmUgPSBhc3luYyAocmVxdWVzdCwgcmVwbHkpID0+IHtcbiAgLy8gU3RvcmUgb3JpZ2luYWwgc2V0Q29va2llIGZ1bmN0aW9uXG4gIGNvbnN0IG9yaWdpbmFsU2V0Q29va2llID0gcmVwbHkuc2V0Q29va2llLmJpbmQocmVwbHkpO1xuICBcbiAgLy8gT3ZlcnJpZGUgc2V0Q29va2llIHRvIGZpeCBTYW1lU2l0ZSBhdHRyaWJ1dGVcbiAgcmVwbHkuc2V0Q29va2llID0gZnVuY3Rpb24obmFtZSwgdmFsdWUsIG9wdGlvbnMgPSB7fSkge1xuICAgIC8vIEZvcmNlIFNhbWVTaXRlPU5vbmUgYW5kIFNlY3VyZSBmb3IgY3Jvc3Mtb3JpZ2luXG4gICAgY29uc3QgZml4ZWRPcHRpb25zID0ge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIHNhbWVTaXRlOiAnbm9uZScsXG4gICAgICBzZWN1cmU6IHRydWUsXG4gICAgfTtcbiAgICBcbiAgICAvLyBDYWxsIG9yaWdpbmFsIHNldENvb2tpZSBmdW5jdGlvbiB3aXRoIGZpeGVkIG9wdGlvbnNcbiAgICByZXR1cm4gb3JpZ2luYWxTZXRDb29raWUobmFtZSwgdmFsdWUsIGZpeGVkT3B0aW9ucyk7XG4gIH07XG4gIFxuICAvLyBBbHNvIGludGVyY2VwdCBoZWFkZXIgc2V0dGluZyBmb3IgU2V0LUNvb2tpZVxuICBjb25zdCBvcmlnaW5hbEhlYWRlciA9IHJlcGx5LmhlYWRlci5iaW5kKHJlcGx5KTtcbiAgcmVwbHkuaGVhZGVyID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICBpZiAobmFtZS50b0xvd2VyQ2FzZSgpID09PSAnc2V0LWNvb2tpZScpIHtcbiAgICAgIC8vIEhhbmRsZSBhcnJheSBvZiBjb29raWUgc3RyaW5nc1xuICAgICAgY29uc3QgY29va2llcyA9IEFycmF5LmlzQXJyYXkodmFsdWUpID8gdmFsdWUgOiBbdmFsdWVdO1xuICAgICAgXG4gICAgICAvLyBNb2RpZnkgZWFjaCBjb29raWUgdG8gdXNlIFNhbWVTaXRlPU5vbmVcbiAgICAgIGNvbnN0IG1vZGlmaWVkQ29va2llcyA9IGNvb2tpZXMubWFwKGNvb2tpZSA9PiB7XG4gICAgICAgIHJldHVybiBmaXhDb29raWVTYW1lU2l0ZShjb29raWUpO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIENhbGwgb3JpZ2luYWwgaGVhZGVyIHdpdGggbW9kaWZpZWQgY29va2llc1xuICAgICAgcmV0dXJuIG9yaWdpbmFsSGVhZGVyKG5hbWUsIG1vZGlmaWVkQ29va2llcyk7XG4gICAgfVxuICAgIFxuICAgIC8vIEZvciBhbGwgb3RoZXIgaGVhZGVycywgY2FsbCBvcmlnaW5hbCBoZWFkZXJcbiAgICByZXR1cm4gb3JpZ2luYWxIZWFkZXIobmFtZSwgdmFsdWUpO1xuICB9O1xufTtcblxuLyoqXG4gKiBGaXggY29va2llIFNhbWVTaXRlIGF0dHJpYnV0ZSB0byBOb25lIGZvciBjcm9zcy1vcmlnaW4gc3VwcG9ydFxuICovXG5mdW5jdGlvbiBmaXhDb29raWVTYW1lU2l0ZShjb29raWUpIHtcbiAgLy8gSWYgY29va2llIGFscmVhZHkgaGFzIFNhbWVTaXRlPU5vbmUsIGxlYXZlIGl0XG4gIGlmIChjb29raWUuaW5jbHVkZXMoJ1NhbWVTaXRlPU5vbmUnKSB8fCBjb29raWUuaW5jbHVkZXMoJ1NhbWVTaXRlPW5vbmUnKSkge1xuICAgIC8vIEVuc3VyZSBTZWN1cmUgaXMgcHJlc2VudFxuICAgIGlmICghY29va2llLmluY2x1ZGVzKCdTZWN1cmUnKSkge1xuICAgICAgY29va2llICs9ICc7IFNlY3VyZSc7XG4gICAgfVxuICAgIHJldHVybiBjb29raWU7XG4gIH1cbiAgXG4gIC8vIFJlcGxhY2UgU2FtZVNpdGU9TGF4IG9yIFNhbWVTaXRlPVN0cmljdCB3aXRoIFNhbWVTaXRlPU5vbmVcbiAgbGV0IG1vZGlmaWVkID0gY29va2llXG4gICAgLnJlcGxhY2UoL1NhbWVTaXRlPUxheC9naSwgJ1NhbWVTaXRlPU5vbmUnKVxuICAgIC5yZXBsYWNlKC9TYW1lU2l0ZT1TdHJpY3QvZ2ksICdTYW1lU2l0ZT1Ob25lJylcbiAgICAucmVwbGFjZSgvU2FtZVNpdGU9bGF4L2dpLCAnU2FtZVNpdGU9Tm9uZScpXG4gICAgLnJlcGxhY2UoL1NhbWVTaXRlPXN0cmljdC9naSwgJ1NhbWVTaXRlPU5vbmUnKTtcbiAgXG4gIC8vIElmIG5vIFNhbWVTaXRlIGF0dHJpYnV0ZSBleGlzdHMsIGFkZCBpdFxuICBpZiAoIW1vZGlmaWVkLmluY2x1ZGVzKCdTYW1lU2l0ZScpKSB7XG4gICAgLy8gSW5zZXJ0IFNhbWVTaXRlPU5vbmUgYmVmb3JlIFNlY3VyZSBvciBhdCB0aGUgZW5kXG4gICAgaWYgKG1vZGlmaWVkLmluY2x1ZGVzKCc7IFNlY3VyZScpKSB7XG4gICAgICBtb2RpZmllZCA9IG1vZGlmaWVkLnJlcGxhY2UoJzsgU2VjdXJlJywgJzsgU2FtZVNpdGU9Tm9uZTsgU2VjdXJlJyk7XG4gICAgfSBlbHNlIGlmIChtb2RpZmllZC5pbmNsdWRlcygnU2VjdXJlJykpIHtcbiAgICAgIG1vZGlmaWVkID0gbW9kaWZpZWQucmVwbGFjZSgnU2VjdXJlJywgJ1NhbWVTaXRlPU5vbmU7IFNlY3VyZScpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBBZGQgYXQgdGhlIGVuZFxuICAgICAgbW9kaWZpZWQgKz0gJzsgU2FtZVNpdGU9Tm9uZSc7XG4gICAgICAvLyBFbnN1cmUgU2VjdXJlIGlzIGFsc28gcHJlc2VudCBmb3IgU2FtZVNpdGU9Tm9uZVxuICAgICAgbW9kaWZpZWQgKz0gJzsgU2VjdXJlJztcbiAgICB9XG4gIH1cbiAgXG4gIC8vIEVuc3VyZSBTZWN1cmUgaXMgcHJlc2VudCB3aGVuIFNhbWVTaXRlPU5vbmVcbiAgaWYgKG1vZGlmaWVkLmluY2x1ZGVzKCdTYW1lU2l0ZT1Ob25lJykgJiYgIW1vZGlmaWVkLmluY2x1ZGVzKCdTZWN1cmUnKSkge1xuICAgIG1vZGlmaWVkICs9ICc7IFNlY3VyZSc7XG4gIH1cbiAgXG4gIHJldHVybiBtb2RpZmllZDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY29va2llRml4TWlkZGxld2FyZTtcblxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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