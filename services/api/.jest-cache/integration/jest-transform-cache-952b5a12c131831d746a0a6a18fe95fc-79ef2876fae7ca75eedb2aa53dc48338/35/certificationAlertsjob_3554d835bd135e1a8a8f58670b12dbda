67294b5bd652b399ae4d4bc1fb5f7b2c
/* istanbul ignore next */
function cov_wfryx7yjp() {
  var path = "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/jobs/certificationAlerts.job.js";
  var hash = "814d06363c526042907f790b2bfe839885b6f394";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/jobs/certificationAlerts.job.js",
    statementMap: {
      "0": {
        start: {
          line: 14,
          column: 2
        },
        end: {
          line: 14,
          column: 63
        }
      },
      "1": {
        start: {
          line: 16,
          column: 2
        },
        end: {
          line: 100,
          column: 3
        }
      },
      "2": {
        start: {
          line: 17,
          column: 16
        },
        end: {
          line: 17,
          column: 26
        }
      },
      "3": {
        start: {
          line: 20,
          column: 26
        },
        end: {
          line: 33,
          column: 50
        }
      },
      "4": {
        start: {
          line: 35,
          column: 4
        },
        end: {
          line: 35,
          column: 74
        }
      },
      "5": {
        start: {
          line: 37,
          column: 20
        },
        end: {
          line: 37,
          column: 21
        }
      },
      "6": {
        start: {
          line: 38,
          column: 22
        },
        end: {
          line: 38,
          column: 23
        }
      },
      "7": {
        start: {
          line: 40,
          column: 4
        },
        end: {
          line: 88,
          column: 5
        }
      },
      "8": {
        start: {
          line: 41,
          column: 6
        },
        end: {
          line: 87,
          column: 7
        }
      },
      "9": {
        start: {
          line: 42,
          column: 50
        },
        end: {
          line: 42,
          column: 54
        }
      },
      "10": {
        start: {
          line: 45,
          column: 24
        },
        end: {
          line: 45,
          column: 83
        }
      },
      "11": {
        start: {
          line: 46,
          column: 24
        },
        end: {
          line: 46,
          column: 89
        }
      },
      "12": {
        start: {
          line: 49,
          column: 27
        },
        end: {
          line: 49,
          column: 120
        }
      },
      "13": {
        start: {
          line: 52,
          column: 8
        },
        end: {
          line: 59,
          column: 9
        }
      },
      "14": {
        start: {
          line: 53,
          column: 10
        },
        end: {
          line: 58,
          column: 13
        }
      },
      "15": {
        start: {
          line: 62,
          column: 8
        },
        end: {
          line: 68,
          column: 56
        }
      },
      "16": {
        start: {
          line: 70,
          column: 8
        },
        end: {
          line: 70,
          column: 20
        }
      },
      "17": {
        start: {
          line: 72,
          column: 8
        },
        end: {
          line: 72,
          column: 69
        }
      },
      "18": {
        start: {
          line: 75,
          column: 8
        },
        end: {
          line: 84,
          column: 61
        }
      },
      "19": {
        start: {
          line: 86,
          column: 8
        },
        end: {
          line: 86,
          column: 22
        }
      },
      "20": {
        start: {
          line: 90,
          column: 4
        },
        end: {
          line: 90,
          column: 103
        }
      },
      "21": {
        start: {
          line: 92,
          column: 4
        },
        end: {
          line: 96,
          column: 6
        }
      },
      "22": {
        start: {
          line: 98,
          column: 4
        },
        end: {
          line: 98,
          column: 71
        }
      },
      "23": {
        start: {
          line: 99,
          column: 4
        },
        end: {
          line: 99,
          column: 16
        }
      },
      "24": {
        start: {
          line: 107,
          column: 22
        },
        end: {
          line: 107,
          column: 66
        }
      },
      "25": {
        start: {
          line: 108,
          column: 14
        },
        end: {
          line: 108,
          column: 43
        }
      },
      "26": {
        start: {
          line: 110,
          column: 16
        },
        end: {
          line: 110,
          column: 41
        }
      },
      "27": {
        start: {
          line: 111,
          column: 2
        },
        end: {
          line: 111,
          column: 55
        }
      },
      "28": {
        start: {
          line: 112,
          column: 2
        },
        end: {
          line: 112,
          column: 77
        }
      },
      "29": {
        start: {
          line: 113,
          column: 2
        },
        end: {
          line: 113,
          column: 57
        }
      },
      "30": {
        start: {
          line: 115,
          column: 2
        },
        end: {
          line: 132,
          column: 3
        }
      },
      "31": {
        start: {
          line: 117,
          column: 6
        },
        end: {
          line: 117,
          column: 82
        }
      },
      "32": {
        start: {
          line: 118,
          column: 6
        },
        end: {
          line: 118,
          column: 107
        }
      },
      "33": {
        start: {
          line: 119,
          column: 6
        },
        end: {
          line: 119,
          column: 12
        }
      },
      "34": {
        start: {
          line: 121,
          column: 6
        },
        end: {
          line: 121,
          column: 86
        }
      },
      "35": {
        start: {
          line: 122,
          column: 6
        },
        end: {
          line: 122,
          column: 92
        }
      },
      "36": {
        start: {
          line: 123,
          column: 6
        },
        end: {
          line: 123,
          column: 12
        }
      },
      "37": {
        start: {
          line: 125,
          column: 6
        },
        end: {
          line: 125,
          column: 97
        }
      },
      "38": {
        start: {
          line: 126,
          column: 6
        },
        end: {
          line: 126,
          column: 94
        }
      },
      "39": {
        start: {
          line: 127,
          column: 6
        },
        end: {
          line: 127,
          column: 12
        }
      },
      "40": {
        start: {
          line: 129,
          column: 6
        },
        end: {
          line: 129,
          column: 67
        }
      },
      "41": {
        start: {
          line: 130,
          column: 6
        },
        end: {
          line: 130,
          column: 68
        }
      },
      "42": {
        start: {
          line: 131,
          column: 6
        },
        end: {
          line: 131,
          column: 12
        }
      },
      "43": {
        start: {
          line: 134,
          column: 2
        },
        end: {
          line: 134,
          column: 80
        }
      },
      "44": {
        start: {
          line: 136,
          column: 2
        },
        end: {
          line: 136,
          column: 17
        }
      },
      "45": {
        start: {
          line: 143,
          column: 22
        },
        end: {
          line: 143,
          column: 66
        }
      },
      "46": {
        start: {
          line: 144,
          column: 14
        },
        end: {
          line: 144,
          column: 43
        }
      },
      "47": {
        start: {
          line: 145,
          column: 19
        },
        end: {
          line: 145,
          column: 116
        }
      },
      "48": {
        start: {
          line: 147,
          column: 2
        },
        end: {
          line: 173,
          column: 4
        }
      },
      "49": {
        start: {
          line: 182,
          column: 2
        },
        end: {
          line: 182,
          column: 55
        }
      },
      "50": {
        start: {
          line: 184,
          column: 2
        },
        end: {
          line: 239,
          column: 3
        }
      },
      "51": {
        start: {
          line: 185,
          column: 18
        },
        end: {
          line: 185,
          column: 56
        }
      },
      "52": {
        start: {
          line: 188,
          column: 25
        },
        end: {
          line: 195,
          column: 8
        }
      },
      "53": {
        start: {
          line: 197,
          column: 4
        },
        end: {
          line: 197,
          column: 70
        }
      },
      "54": {
        start: {
          line: 199,
          column: 24
        },
        end: {
          line: 199,
          column: 25
        }
      },
      "55": {
        start: {
          line: 201,
          column: 4
        },
        end: {
          line: 227,
          column: 5
        }
      },
      "56": {
        start: {
          line: 203,
          column: 28
        },
        end: {
          line: 210,
          column: 17
        }
      },
      "57": {
        start: {
          line: 212,
          column: 6
        },
        end: {
          line: 226,
          column: 7
        }
      },
      "58": {
        start: {
          line: 214,
          column: 8
        },
        end: {
          line: 223,
          column: 11
        }
      },
      "59": {
        start: {
          line: 225,
          column: 8
        },
        end: {
          line: 225,
          column: 24
        }
      },
      "60": {
        start: {
          line: 229,
          column: 4
        },
        end: {
          line: 229,
          column: 72
        }
      },
      "61": {
        start: {
          line: 231,
          column: 4
        },
        end: {
          line: 235,
          column: 6
        }
      },
      "62": {
        start: {
          line: 237,
          column: 4
        },
        end: {
          line: 237,
          column: 65
        }
      },
      "63": {
        start: {
          line: 238,
          column: 4
        },
        end: {
          line: 238,
          column: 16
        }
      }
    },
    fnMap: {
      "0": {
        name: "processCertificationAlerts",
        decl: {
          start: {
            line: 13,
            column: 22
          },
          end: {
            line: 13,
            column: 48
          }
        },
        loc: {
          start: {
            line: 13,
            column: 51
          },
          end: {
            line: 101,
            column: 1
          }
        },
        line: 13
      },
      "1": {
        name: "buildAlertMessage",
        decl: {
          start: {
            line: 106,
            column: 9
          },
          end: {
            line: 106,
            column: 26
          }
        },
        loc: {
          start: {
            line: 106,
            column: 58
          },
          end: {
            line: 137,
            column: 1
          }
        },
        line: 106
      },
      "2": {
        name: "buildAlertHtml",
        decl: {
          start: {
            line: 142,
            column: 9
          },
          end: {
            line: 142,
            column: 23
          }
        },
        loc: {
          start: {
            line: 142,
            column: 55
          },
          end: {
            line: 174,
            column: 1
          }
        },
        line: 142
      },
      "3": {
        name: "checkOverdueCertifications",
        decl: {
          start: {
            line: 181,
            column: 22
          },
          end: {
            line: 181,
            column: 48
          }
        },
        loc: {
          start: {
            line: 181,
            column: 51
          },
          end: {
            line: 240,
            column: 1
          }
        },
        line: 181
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 45,
            column: 24
          },
          end: {
            line: 45,
            column: 83
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 45,
            column: 24
          },
          end: {
            line: 45,
            column: 37
          }
        }, {
          start: {
            line: 45,
            column: 41
          },
          end: {
            line: 45,
            column: 83
          }
        }],
        line: 45
      },
      "1": {
        loc: {
          start: {
            line: 46,
            column: 24
          },
          end: {
            line: 46,
            column: 89
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 46,
            column: 24
          },
          end: {
            line: 46,
            column: 37
          }
        }, {
          start: {
            line: 46,
            column: 41
          },
          end: {
            line: 46,
            column: 89
          }
        }],
        line: 46
      },
      "2": {
        loc: {
          start: {
            line: 49,
            column: 27
          },
          end: {
            line: 49,
            column: 120
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 49,
            column: 27
          },
          end: {
            line: 49,
            column: 43
          }
        }, {
          start: {
            line: 49,
            column: 47
          },
          end: {
            line: 49,
            column: 120
          }
        }],
        line: 49
      },
      "3": {
        loc: {
          start: {
            line: 49,
            column: 48
          },
          end: {
            line: 49,
            column: 119
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 49,
            column: 48
          },
          end: {
            line: 49,
            column: 85
          }
        }, {
          start: {
            line: 49,
            column: 89
          },
          end: {
            line: 49,
            column: 119
          }
        }],
        line: 49
      },
      "4": {
        loc: {
          start: {
            line: 115,
            column: 2
          },
          end: {
            line: 132,
            column: 3
          }
        },
        type: "switch",
        locations: [{
          start: {
            line: 116,
            column: 4
          },
          end: {
            line: 119,
            column: 12
          }
        }, {
          start: {
            line: 120,
            column: 4
          },
          end: {
            line: 123,
            column: 12
          }
        }, {
          start: {
            line: 124,
            column: 4
          },
          end: {
            line: 127,
            column: 12
          }
        }, {
          start: {
            line: 128,
            column: 4
          },
          end: {
            line: 131,
            column: 12
          }
        }],
        line: 115
      },
      "5": {
        loc: {
          start: {
            line: 145,
            column: 19
          },
          end: {
            line: 145,
            column: 116
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 145,
            column: 57
          },
          end: {
            line: 145,
            column: 62
          }
        }, {
          start: {
            line: 145,
            column: 65
          },
          end: {
            line: 145,
            column: 116
          }
        }],
        line: 145
      },
      "6": {
        loc: {
          start: {
            line: 145,
            column: 65
          },
          end: {
            line: 145,
            column: 116
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 145,
            column: 99
          },
          end: {
            line: 145,
            column: 107
          }
        }, {
          start: {
            line: 145,
            column: 110
          },
          end: {
            line: 145,
            column: 116
          }
        }],
        line: 145
      },
      "7": {
        loc: {
          start: {
            line: 212,
            column: 6
          },
          end: {
            line: 226,
            column: 7
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 212,
            column: 6
          },
          end: {
            line: 226,
            column: 7
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 212
      },
      "8": {
        loc: {
          start: {
            line: 222,
            column: 23
          },
          end: {
            line: 222,
            column: 94
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 222,
            column: 23
          },
          end: {
            line: 222,
            column: 60
          }
        }, {
          start: {
            line: 222,
            column: 64
          },
          end: {
            line: 222,
            column: 94
          }
        }],
        line: 222
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0,
      "61": 0,
      "62": 0,
      "63": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0, 0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0]
    },
    inputSourceMap: null,
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "814d06363c526042907f790b2bfe839885b6f394"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_wfryx7yjp = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_wfryx7yjp();
import { db } from '../config/db.drizzle.js';
import { certification_alerts, certifications, patients } from '../db/schemas/index.js';
import { eq, and, lte, sql, isNull } from 'drizzle-orm';
import MailService from '../services/MailService.js';
import { logger } from '../utils/logger.js';
/**
 * Certification Alert Processing Job
 * Sends alerts for upcoming and overdue certifications
 * Schedule: Hourly
 * Cron: 0 * * * *
 */
export async function processCertificationAlerts() {
  /* istanbul ignore next */
  cov_wfryx7yjp().f[0]++;
  cov_wfryx7yjp().s[0]++;
  logger.info('Starting certification alert processing job...');
  /* istanbul ignore next */
  cov_wfryx7yjp().s[1]++;
  try {
    const now =
    /* istanbul ignore next */
    (cov_wfryx7yjp().s[2]++, new Date());

    // Get pending alerts that are due
    const pendingAlerts =
    /* istanbul ignore next */
    (cov_wfryx7yjp().s[3]++, await db.select({
      alert: certification_alerts,
      certification: certifications,
      patient: patients
    }).from(certification_alerts).innerJoin(certifications, eq(certification_alerts.certification_id, certifications.id)).innerJoin(patients, eq(certification_alerts.patient_id, patients.id)).where(and(eq(certification_alerts.alert_status, 'PENDING'), lte(certification_alerts.scheduled_for, now))).orderBy(certification_alerts.scheduled_for));
    /* istanbul ignore next */
    cov_wfryx7yjp().s[4]++;
    logger.info(`Found ${pendingAlerts.length} pending alerts to process`);
    let sentCount =
    /* istanbul ignore next */
    (cov_wfryx7yjp().s[5]++, 0);
    let failedCount =
    /* istanbul ignore next */
    (cov_wfryx7yjp().s[6]++, 0);
    /* istanbul ignore next */
    cov_wfryx7yjp().s[7]++;
    for (const item of pendingAlerts) {
      /* istanbul ignore next */
      cov_wfryx7yjp().s[8]++;
      try {
        const {
          alert,
          certification,
          patient
        } =
        /* istanbul ignore next */
        (cov_wfryx7yjp().s[9]++, item);

        // Build email content
        const subject =
        /* istanbul ignore next */
        (cov_wfryx7yjp().s[10]++,
        /* istanbul ignore next */
        (cov_wfryx7yjp().b[0][0]++, alert.subject) ||
        /* istanbul ignore next */
        (cov_wfryx7yjp().b[0][1]++, `Certification Alert: ${alert.alert_type}`));
        const message =
        /* istanbul ignore next */
        (cov_wfryx7yjp().s[11]++,
        /* istanbul ignore next */
        (cov_wfryx7yjp().b[1][0]++, alert.message) ||
        /* istanbul ignore next */
        (cov_wfryx7yjp().b[1][1]++, buildAlertMessage(alert, certification, patient)));

        // Determine recipients
        const recipients =
        /* istanbul ignore next */
        (cov_wfryx7yjp().s[12]++,
        /* istanbul ignore next */
        (cov_wfryx7yjp().b[2][0]++, alert.recipients) ||
        /* istanbul ignore next */
        (cov_wfryx7yjp().b[2][1]++, [
        /* istanbul ignore next */
        (cov_wfryx7yjp().b[3][0]++, process.env.CERTIFICATION_ALERT_EMAIL) ||
        /* istanbul ignore next */
        (cov_wfryx7yjp().b[3][1]++, 'clinical@hospice.example.com')]));

        // Send email
        /* istanbul ignore next */
        cov_wfryx7yjp().s[13]++;
        for (const recipient of recipients) {
          /* istanbul ignore next */
          cov_wfryx7yjp().s[14]++;
          await MailService.sendMail({
            to: recipient,
            subject: subject,
            text: message,
            html: buildAlertHtml(alert, certification, patient)
          });
        }

        // Mark alert as sent
        /* istanbul ignore next */
        cov_wfryx7yjp().s[15]++;
        await db.update(certification_alerts).set({
          alert_status: 'SENT',
          sent_at: new Date()
        }).where(eq(certification_alerts.id, alert.id));
        /* istanbul ignore next */
        cov_wfryx7yjp().s[16]++;
        sentCount++;
      } catch (error) {
        /* istanbul ignore next */
        cov_wfryx7yjp().s[17]++;
        logger.error(`Failed to send alert ${item.alert.id}:`, error);

        // Mark alert as failed
        /* istanbul ignore next */
        cov_wfryx7yjp().s[18]++;
        await db.update(certification_alerts).set({
          alert_status: 'FAILED',
          metadata: {
            error: error.message,
            failed_at: new Date().toISOString()
          }
        }).where(eq(certification_alerts.id, item.alert.id));
        /* istanbul ignore next */
        cov_wfryx7yjp().s[19]++;
        failedCount++;
      }
    }
    /* istanbul ignore next */
    cov_wfryx7yjp().s[20]++;
    logger.info(`Certification alert processing completed. Sent: ${sentCount}, Failed: ${failedCount}`);
    /* istanbul ignore next */
    cov_wfryx7yjp().s[21]++;
    return {
      success: true,
      sent: sentCount,
      failed: failedCount
    };
  } catch (error) {
    /* istanbul ignore next */
    cov_wfryx7yjp().s[22]++;
    logger.error('Error in certification alert processing job:', error);
    /* istanbul ignore next */
    cov_wfryx7yjp().s[23]++;
    throw error;
  }
}

/**
 * Build alert message text
 */
function buildAlertMessage(alert, certification, patient) {
  /* istanbul ignore next */
  cov_wfryx7yjp().f[1]++;
  const patientName =
  /* istanbul ignore next */
  (cov_wfryx7yjp().s[24]++, `${patient.first_name} ${patient.last_name}`);
  const mrn =
  /* istanbul ignore next */
  (cov_wfryx7yjp().s[25]++, patient.medical_record_number);
  let message =
  /* istanbul ignore next */
  (cov_wfryx7yjp().s[26]++, `Certification Alert\n\n`);
  /* istanbul ignore next */
  cov_wfryx7yjp().s[27]++;
  message += `Patient: ${patientName} (MRN: ${mrn})\n`;
  /* istanbul ignore next */
  cov_wfryx7yjp().s[28]++;
  message += `Certification Period: ${certification.certification_period}\n`;
  /* istanbul ignore next */
  cov_wfryx7yjp().s[29]++;
  message += `Start Date: ${certification.start_date}\n`;
  /* istanbul ignore next */
  cov_wfryx7yjp().s[30]++;
  switch (alert.alert_type) {
    case 'UPCOMING_CERT':
      /* istanbul ignore next */
      cov_wfryx7yjp().b[4][0]++;
      cov_wfryx7yjp().s[31]++;
      message += `\nCertification Due: ${certification.certification_due_date}\n`;
      /* istanbul ignore next */
      cov_wfryx7yjp().s[32]++;
      message += `\nPhysician certification is required within 2 days of the benefit period start date.\n`;
      /* istanbul ignore next */
      cov_wfryx7yjp().s[33]++;
      break;
    case 'OVERDUE_CERT':
      /* istanbul ignore next */
      cov_wfryx7yjp().b[4][1]++;
      cov_wfryx7yjp().s[34]++;
      message += `\nCertification was due: ${certification.certification_due_date}\n`;
      /* istanbul ignore next */
      cov_wfryx7yjp().s[35]++;
      message += `\nWARNING: This certification is overdue. Please complete immediately.\n`;
      /* istanbul ignore next */
      cov_wfryx7yjp().s[36]++;
      break;
    case 'F2F_REQUIRED':
      /* istanbul ignore next */
      cov_wfryx7yjp().b[4][2]++;
      cov_wfryx7yjp().s[37]++;
      message += `\nFace-to-Face encounter is required within 30 days before recertification.\n`;
      /* istanbul ignore next */
      cov_wfryx7yjp().s[38]++;
      message += `\nThis is the 3rd or subsequent benefit period, requiring F2F encounter.\n`;
      /* istanbul ignore next */
      cov_wfryx7yjp().s[39]++;
      break;
    case 'F2F_OVERDUE':
      /* istanbul ignore next */
      cov_wfryx7yjp().b[4][3]++;
      cov_wfryx7yjp().s[40]++;
      message += `\nWARNING: Face-to-Face encounter is overdue.\n`;
      /* istanbul ignore next */
      cov_wfryx7yjp().s[41]++;
      message += `\nThis is required for Medicare reimbursement.\n`;
      /* istanbul ignore next */
      cov_wfryx7yjp().s[42]++;
      break;
  }
  /* istanbul ignore next */
  cov_wfryx7yjp().s[43]++;
  message += `\nThis is an automated notification from the Hospice EHR system.`;
  /* istanbul ignore next */
  cov_wfryx7yjp().s[44]++;
  return message;
}

/**
 * Build alert HTML
 */
function buildAlertHtml(alert, certification, patient) {
  /* istanbul ignore next */
  cov_wfryx7yjp().f[2]++;
  const patientName =
  /* istanbul ignore next */
  (cov_wfryx7yjp().s[45]++, `${patient.first_name} ${patient.last_name}`);
  const mrn =
  /* istanbul ignore next */
  (cov_wfryx7yjp().s[46]++, patient.medical_record_number);
  const priority =
  /* istanbul ignore next */
  (cov_wfryx7yjp().s[47]++, alert.alert_priority === 'CRITICAL' ?
  /* istanbul ignore next */
  (cov_wfryx7yjp().b[5][0]++, 'red') :
  /* istanbul ignore next */
  (cov_wfryx7yjp().b[5][1]++, alert.alert_priority === 'HIGH' ?
  /* istanbul ignore next */
  (cov_wfryx7yjp().b[6][0]++, 'orange') :
  /* istanbul ignore next */
  (cov_wfryx7yjp().b[6][1]++, 'blue')));
  /* istanbul ignore next */
  cov_wfryx7yjp().s[48]++;
  return `
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
      <div style="background-color: ${priority}; color: white; padding: 20px;">
        <h2 style="margin: 0;">Certification Alert</h2>
        <p style="margin: 5px 0 0 0;">Priority: ${alert.alert_priority}</p>
      </div>

      <div style="padding: 20px; background-color: #f5f5f5;">
        <h3>Patient Information</h3>
        <p><strong>Name:</strong> ${patientName}</p>
        <p><strong>MRN:</strong> ${mrn}</p>

        <h3>Certification Details</h3>
        <p><strong>Period:</strong> ${certification.certification_period}</p>
        <p><strong>Start Date:</strong> ${certification.start_date}</p>
        <p><strong>Due Date:</strong> ${certification.certification_due_date}</p>

        <div style="margin-top: 20px; padding: 15px; background-color: white; border-left: 4px solid ${priority};">
          <p style="margin: 0;">${alert.message}</p>
        </div>

        <p style="margin-top: 20px; font-size: 12px; color: #666;">
          This is an automated notification from the Hospice EHR system.
        </p>
      </div>
    </div>
  `;
}

/**
 * Check for overdue certifications and create alerts
 * Schedule: Daily at 8:00 AM
 * Cron: 0 8 * * *
 */
export async function checkOverdueCertifications() {
  /* istanbul ignore next */
  cov_wfryx7yjp().f[3]++;
  cov_wfryx7yjp().s[49]++;
  logger.info('Checking for overdue certifications...');
  /* istanbul ignore next */
  cov_wfryx7yjp().s[50]++;
  try {
    const today =
    /* istanbul ignore next */
    (cov_wfryx7yjp().s[51]++, new Date().toISOString().split('T')[0]);

    // Find certifications that are overdue and don't have overdue alerts
    const overdueCerts =
    /* istanbul ignore next */
    (cov_wfryx7yjp().s[52]++, await db.select().from(certifications).where(and(eq(certifications.certification_status, 'PENDING'), lte(certifications.certification_due_date, today), isNull(certifications.deleted_at))));
    /* istanbul ignore next */
    cov_wfryx7yjp().s[53]++;
    logger.info(`Found ${overdueCerts.length} overdue certifications`);
    let alertsCreated =
    /* istanbul ignore next */
    (cov_wfryx7yjp().s[54]++, 0);
    /* istanbul ignore next */
    cov_wfryx7yjp().s[55]++;
    for (const cert of overdueCerts) {
      // Check if overdue alert already exists
      const existingAlert =
      /* istanbul ignore next */
      (cov_wfryx7yjp().s[56]++, await db.select().from(certification_alerts).where(and(eq(certification_alerts.certification_id, cert.id), eq(certification_alerts.alert_type, 'OVERDUE_CERT'))).limit(1));
      /* istanbul ignore next */
      cov_wfryx7yjp().s[57]++;
      if (!existingAlert[0]) {
        /* istanbul ignore next */
        cov_wfryx7yjp().b[7][0]++;
        cov_wfryx7yjp().s[58]++;
        // Create overdue alert
        await db.insert(certification_alerts).values({
          certification_id: cert.id,
          patient_id: cert.patient_id,
          alert_type: 'OVERDUE_CERT',
          alert_priority: 'CRITICAL',
          scheduled_for: new Date(),
          subject: `OVERDUE: Certification Required for Patient`,
          message: `Certification was due on ${cert.certification_due_date}. Please complete immediately.`,
          recipients: [
          /* istanbul ignore next */
          (cov_wfryx7yjp().b[8][0]++, process.env.CERTIFICATION_ALERT_EMAIL) ||
          /* istanbul ignore next */
          (cov_wfryx7yjp().b[8][1]++, 'clinical@hospice.example.com')]
        });
        /* istanbul ignore next */
        cov_wfryx7yjp().s[59]++;
        alertsCreated++;
      } else
      /* istanbul ignore next */
      {
        cov_wfryx7yjp().b[7][1]++;
      }
    }
    /* istanbul ignore next */
    cov_wfryx7yjp().s[60]++;
    logger.info(`Created ${alertsCreated} overdue certification alerts`);
    /* istanbul ignore next */
    cov_wfryx7yjp().s[61]++;
    return {
      success: true,
      overdue_count: overdueCerts.length,
      alerts_created: alertsCreated
    };
  } catch (error) {
    /* istanbul ignore next */
    cov_wfryx7yjp().s[62]++;
    logger.error('Error checking overdue certifications:', error);
    /* istanbul ignore next */
    cov_wfryx7yjp().s[63]++;
    throw error;
  }
}
export default processCertificationAlerts;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3Zfd2ZyeXg3eWpwIiwiYWN0dWFsQ292ZXJhZ2UiLCJkYiIsImNlcnRpZmljYXRpb25fYWxlcnRzIiwiY2VydGlmaWNhdGlvbnMiLCJwYXRpZW50cyIsImVxIiwiYW5kIiwibHRlIiwic3FsIiwiaXNOdWxsIiwiTWFpbFNlcnZpY2UiLCJsb2dnZXIiLCJwcm9jZXNzQ2VydGlmaWNhdGlvbkFsZXJ0cyIsImYiLCJzIiwiaW5mbyIsIm5vdyIsIkRhdGUiLCJwZW5kaW5nQWxlcnRzIiwic2VsZWN0IiwiYWxlcnQiLCJjZXJ0aWZpY2F0aW9uIiwicGF0aWVudCIsImZyb20iLCJpbm5lckpvaW4iLCJjZXJ0aWZpY2F0aW9uX2lkIiwiaWQiLCJwYXRpZW50X2lkIiwid2hlcmUiLCJhbGVydF9zdGF0dXMiLCJzY2hlZHVsZWRfZm9yIiwib3JkZXJCeSIsImxlbmd0aCIsInNlbnRDb3VudCIsImZhaWxlZENvdW50IiwiaXRlbSIsInN1YmplY3QiLCJiIiwiYWxlcnRfdHlwZSIsIm1lc3NhZ2UiLCJidWlsZEFsZXJ0TWVzc2FnZSIsInJlY2lwaWVudHMiLCJwcm9jZXNzIiwiZW52IiwiQ0VSVElGSUNBVElPTl9BTEVSVF9FTUFJTCIsInJlY2lwaWVudCIsInNlbmRNYWlsIiwidG8iLCJ0ZXh0IiwiaHRtbCIsImJ1aWxkQWxlcnRIdG1sIiwidXBkYXRlIiwic2V0Iiwic2VudF9hdCIsImVycm9yIiwibWV0YWRhdGEiLCJmYWlsZWRfYXQiLCJ0b0lTT1N0cmluZyIsInN1Y2Nlc3MiLCJzZW50IiwiZmFpbGVkIiwicGF0aWVudE5hbWUiLCJmaXJzdF9uYW1lIiwibGFzdF9uYW1lIiwibXJuIiwibWVkaWNhbF9yZWNvcmRfbnVtYmVyIiwiY2VydGlmaWNhdGlvbl9wZXJpb2QiLCJzdGFydF9kYXRlIiwiY2VydGlmaWNhdGlvbl9kdWVfZGF0ZSIsInByaW9yaXR5IiwiYWxlcnRfcHJpb3JpdHkiLCJjaGVja092ZXJkdWVDZXJ0aWZpY2F0aW9ucyIsInRvZGF5Iiwic3BsaXQiLCJvdmVyZHVlQ2VydHMiLCJjZXJ0aWZpY2F0aW9uX3N0YXR1cyIsImRlbGV0ZWRfYXQiLCJhbGVydHNDcmVhdGVkIiwiY2VydCIsImV4aXN0aW5nQWxlcnQiLCJsaW1pdCIsImluc2VydCIsInZhbHVlcyIsIm92ZXJkdWVfY291bnQiLCJhbGVydHNfY3JlYXRlZCJdLCJzb3VyY2VzIjpbImNlcnRpZmljYXRpb25BbGVydHMuam9iLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRiIH0gZnJvbSAnLi4vY29uZmlnL2RiLmRyaXp6bGUuanMnO1xuaW1wb3J0IHsgY2VydGlmaWNhdGlvbl9hbGVydHMsIGNlcnRpZmljYXRpb25zLCBwYXRpZW50cyB9IGZyb20gJy4uL2RiL3NjaGVtYXMvaW5kZXguanMnO1xuaW1wb3J0IHsgZXEsIGFuZCwgbHRlLCBzcWwsIGlzTnVsbCB9IGZyb20gJ2RyaXp6bGUtb3JtJztcbmltcG9ydCBNYWlsU2VydmljZSBmcm9tICcuLi9zZXJ2aWNlcy9NYWlsU2VydmljZS5qcyc7XG5cbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZ2dlci5qcyc7XG4vKipcbiAqIENlcnRpZmljYXRpb24gQWxlcnQgUHJvY2Vzc2luZyBKb2JcbiAqIFNlbmRzIGFsZXJ0cyBmb3IgdXBjb21pbmcgYW5kIG92ZXJkdWUgY2VydGlmaWNhdGlvbnNcbiAqIFNjaGVkdWxlOiBIb3VybHlcbiAqIENyb246IDAgKiAqICogKlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc0NlcnRpZmljYXRpb25BbGVydHMoKSB7XG4gIGxvZ2dlci5pbmZvKCdTdGFydGluZyBjZXJ0aWZpY2F0aW9uIGFsZXJ0IHByb2Nlc3Npbmcgam9iLi4uJylcblxuICB0cnkge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICAvLyBHZXQgcGVuZGluZyBhbGVydHMgdGhhdCBhcmUgZHVlXG4gICAgY29uc3QgcGVuZGluZ0FsZXJ0cyA9IGF3YWl0IGRiXG4gICAgICAuc2VsZWN0KHtcbiAgICAgICAgYWxlcnQ6IGNlcnRpZmljYXRpb25fYWxlcnRzLFxuICAgICAgICBjZXJ0aWZpY2F0aW9uOiBjZXJ0aWZpY2F0aW9ucyxcbiAgICAgICAgcGF0aWVudDogcGF0aWVudHNcbiAgICAgIH0pXG4gICAgICAuZnJvbShjZXJ0aWZpY2F0aW9uX2FsZXJ0cylcbiAgICAgIC5pbm5lckpvaW4oY2VydGlmaWNhdGlvbnMsIGVxKGNlcnRpZmljYXRpb25fYWxlcnRzLmNlcnRpZmljYXRpb25faWQsIGNlcnRpZmljYXRpb25zLmlkKSlcbiAgICAgIC5pbm5lckpvaW4ocGF0aWVudHMsIGVxKGNlcnRpZmljYXRpb25fYWxlcnRzLnBhdGllbnRfaWQsIHBhdGllbnRzLmlkKSlcbiAgICAgIC53aGVyZShhbmQoXG4gICAgICAgIGVxKGNlcnRpZmljYXRpb25fYWxlcnRzLmFsZXJ0X3N0YXR1cywgJ1BFTkRJTkcnKSxcbiAgICAgICAgbHRlKGNlcnRpZmljYXRpb25fYWxlcnRzLnNjaGVkdWxlZF9mb3IsIG5vdylcbiAgICAgICkpXG4gICAgICAub3JkZXJCeShjZXJ0aWZpY2F0aW9uX2FsZXJ0cy5zY2hlZHVsZWRfZm9yKTtcblxuICAgIGxvZ2dlci5pbmZvKGBGb3VuZCAke3BlbmRpbmdBbGVydHMubGVuZ3RofSBwZW5kaW5nIGFsZXJ0cyB0byBwcm9jZXNzYClcblxuICAgIGxldCBzZW50Q291bnQgPSAwO1xuICAgIGxldCBmYWlsZWRDb3VudCA9IDA7XG5cbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgcGVuZGluZ0FsZXJ0cykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBhbGVydCwgY2VydGlmaWNhdGlvbiwgcGF0aWVudCB9ID0gaXRlbTtcblxuICAgICAgICAvLyBCdWlsZCBlbWFpbCBjb250ZW50XG4gICAgICAgIGNvbnN0IHN1YmplY3QgPSBhbGVydC5zdWJqZWN0IHx8IGBDZXJ0aWZpY2F0aW9uIEFsZXJ0OiAke2FsZXJ0LmFsZXJ0X3R5cGV9YDtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGFsZXJ0Lm1lc3NhZ2UgfHwgYnVpbGRBbGVydE1lc3NhZ2UoYWxlcnQsIGNlcnRpZmljYXRpb24sIHBhdGllbnQpO1xuXG4gICAgICAgIC8vIERldGVybWluZSByZWNpcGllbnRzXG4gICAgICAgIGNvbnN0IHJlY2lwaWVudHMgPSBhbGVydC5yZWNpcGllbnRzIHx8IFtwcm9jZXNzLmVudi5DRVJUSUZJQ0FUSU9OX0FMRVJUX0VNQUlMIHx8ICdjbGluaWNhbEBob3NwaWNlLmV4YW1wbGUuY29tJ107XG5cbiAgICAgICAgLy8gU2VuZCBlbWFpbFxuICAgICAgICBmb3IgKGNvbnN0IHJlY2lwaWVudCBvZiByZWNpcGllbnRzKSB7XG4gICAgICAgICAgYXdhaXQgTWFpbFNlcnZpY2Uuc2VuZE1haWwoe1xuICAgICAgICAgICAgdG86IHJlY2lwaWVudCxcbiAgICAgICAgICAgIHN1YmplY3Q6IHN1YmplY3QsXG4gICAgICAgICAgICB0ZXh0OiBtZXNzYWdlLFxuICAgICAgICAgICAgaHRtbDogYnVpbGRBbGVydEh0bWwoYWxlcnQsIGNlcnRpZmljYXRpb24sIHBhdGllbnQpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBNYXJrIGFsZXJ0IGFzIHNlbnRcbiAgICAgICAgYXdhaXQgZGJcbiAgICAgICAgICAudXBkYXRlKGNlcnRpZmljYXRpb25fYWxlcnRzKVxuICAgICAgICAgIC5zZXQoe1xuICAgICAgICAgICAgYWxlcnRfc3RhdHVzOiAnU0VOVCcsXG4gICAgICAgICAgICBzZW50X2F0OiBuZXcgRGF0ZSgpXG4gICAgICAgICAgfSlcbiAgICAgICAgICAud2hlcmUoZXEoY2VydGlmaWNhdGlvbl9hbGVydHMuaWQsIGFsZXJ0LmlkKSk7XG5cbiAgICAgICAgc2VudENvdW50Kys7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBsb2dnZXIuZXJyb3IoYEZhaWxlZCB0byBzZW5kIGFsZXJ0ICR7aXRlbS5hbGVydC5pZH06YCwgZXJyb3IpXG5cbiAgICAgICAgLy8gTWFyayBhbGVydCBhcyBmYWlsZWRcbiAgICAgICAgYXdhaXQgZGJcbiAgICAgICAgICAudXBkYXRlKGNlcnRpZmljYXRpb25fYWxlcnRzKVxuICAgICAgICAgIC5zZXQoe1xuICAgICAgICAgICAgYWxlcnRfc3RhdHVzOiAnRkFJTEVEJyxcbiAgICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgICAgICBmYWlsZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLndoZXJlKGVxKGNlcnRpZmljYXRpb25fYWxlcnRzLmlkLCBpdGVtLmFsZXJ0LmlkKSk7XG5cbiAgICAgICAgZmFpbGVkQ291bnQrKztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsb2dnZXIuaW5mbyhgQ2VydGlmaWNhdGlvbiBhbGVydCBwcm9jZXNzaW5nIGNvbXBsZXRlZC4gU2VudDogJHtzZW50Q291bnR9LCBGYWlsZWQ6ICR7ZmFpbGVkQ291bnR9YClcblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgc2VudDogc2VudENvdW50LFxuICAgICAgZmFpbGVkOiBmYWlsZWRDb3VudFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdFcnJvciBpbiBjZXJ0aWZpY2F0aW9uIGFsZXJ0IHByb2Nlc3Npbmcgam9iOicsIGVycm9yKVxuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogQnVpbGQgYWxlcnQgbWVzc2FnZSB0ZXh0XG4gKi9cbmZ1bmN0aW9uIGJ1aWxkQWxlcnRNZXNzYWdlKGFsZXJ0LCBjZXJ0aWZpY2F0aW9uLCBwYXRpZW50KSB7XG4gIGNvbnN0IHBhdGllbnROYW1lID0gYCR7cGF0aWVudC5maXJzdF9uYW1lfSAke3BhdGllbnQubGFzdF9uYW1lfWA7XG4gIGNvbnN0IG1ybiA9IHBhdGllbnQubWVkaWNhbF9yZWNvcmRfbnVtYmVyO1xuXG4gIGxldCBtZXNzYWdlID0gYENlcnRpZmljYXRpb24gQWxlcnRcXG5cXG5gO1xuICBtZXNzYWdlICs9IGBQYXRpZW50OiAke3BhdGllbnROYW1lfSAoTVJOOiAke21ybn0pXFxuYDtcbiAgbWVzc2FnZSArPSBgQ2VydGlmaWNhdGlvbiBQZXJpb2Q6ICR7Y2VydGlmaWNhdGlvbi5jZXJ0aWZpY2F0aW9uX3BlcmlvZH1cXG5gO1xuICBtZXNzYWdlICs9IGBTdGFydCBEYXRlOiAke2NlcnRpZmljYXRpb24uc3RhcnRfZGF0ZX1cXG5gO1xuXG4gIHN3aXRjaCAoYWxlcnQuYWxlcnRfdHlwZSkge1xuICAgIGNhc2UgJ1VQQ09NSU5HX0NFUlQnOlxuICAgICAgbWVzc2FnZSArPSBgXFxuQ2VydGlmaWNhdGlvbiBEdWU6ICR7Y2VydGlmaWNhdGlvbi5jZXJ0aWZpY2F0aW9uX2R1ZV9kYXRlfVxcbmA7XG4gICAgICBtZXNzYWdlICs9IGBcXG5QaHlzaWNpYW4gY2VydGlmaWNhdGlvbiBpcyByZXF1aXJlZCB3aXRoaW4gMiBkYXlzIG9mIHRoZSBiZW5lZml0IHBlcmlvZCBzdGFydCBkYXRlLlxcbmA7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdPVkVSRFVFX0NFUlQnOlxuICAgICAgbWVzc2FnZSArPSBgXFxuQ2VydGlmaWNhdGlvbiB3YXMgZHVlOiAke2NlcnRpZmljYXRpb24uY2VydGlmaWNhdGlvbl9kdWVfZGF0ZX1cXG5gO1xuICAgICAgbWVzc2FnZSArPSBgXFxuV0FSTklORzogVGhpcyBjZXJ0aWZpY2F0aW9uIGlzIG92ZXJkdWUuIFBsZWFzZSBjb21wbGV0ZSBpbW1lZGlhdGVseS5cXG5gO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnRjJGX1JFUVVJUkVEJzpcbiAgICAgIG1lc3NhZ2UgKz0gYFxcbkZhY2UtdG8tRmFjZSBlbmNvdW50ZXIgaXMgcmVxdWlyZWQgd2l0aGluIDMwIGRheXMgYmVmb3JlIHJlY2VydGlmaWNhdGlvbi5cXG5gO1xuICAgICAgbWVzc2FnZSArPSBgXFxuVGhpcyBpcyB0aGUgM3JkIG9yIHN1YnNlcXVlbnQgYmVuZWZpdCBwZXJpb2QsIHJlcXVpcmluZyBGMkYgZW5jb3VudGVyLlxcbmA7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdGMkZfT1ZFUkRVRSc6XG4gICAgICBtZXNzYWdlICs9IGBcXG5XQVJOSU5HOiBGYWNlLXRvLUZhY2UgZW5jb3VudGVyIGlzIG92ZXJkdWUuXFxuYDtcbiAgICAgIG1lc3NhZ2UgKz0gYFxcblRoaXMgaXMgcmVxdWlyZWQgZm9yIE1lZGljYXJlIHJlaW1idXJzZW1lbnQuXFxuYDtcbiAgICAgIGJyZWFrO1xuICB9XG5cbiAgbWVzc2FnZSArPSBgXFxuVGhpcyBpcyBhbiBhdXRvbWF0ZWQgbm90aWZpY2F0aW9uIGZyb20gdGhlIEhvc3BpY2UgRUhSIHN5c3RlbS5gO1xuXG4gIHJldHVybiBtZXNzYWdlO1xufVxuXG4vKipcbiAqIEJ1aWxkIGFsZXJ0IEhUTUxcbiAqL1xuZnVuY3Rpb24gYnVpbGRBbGVydEh0bWwoYWxlcnQsIGNlcnRpZmljYXRpb24sIHBhdGllbnQpIHtcbiAgY29uc3QgcGF0aWVudE5hbWUgPSBgJHtwYXRpZW50LmZpcnN0X25hbWV9ICR7cGF0aWVudC5sYXN0X25hbWV9YDtcbiAgY29uc3QgbXJuID0gcGF0aWVudC5tZWRpY2FsX3JlY29yZF9udW1iZXI7XG4gIGNvbnN0IHByaW9yaXR5ID0gYWxlcnQuYWxlcnRfcHJpb3JpdHkgPT09ICdDUklUSUNBTCcgPyAncmVkJyA6IGFsZXJ0LmFsZXJ0X3ByaW9yaXR5ID09PSAnSElHSCcgPyAnb3JhbmdlJyA6ICdibHVlJztcblxuICByZXR1cm4gYFxuICAgIDxkaXYgc3R5bGU9XCJmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7IG1heC13aWR0aDogNjAwcHg7IG1hcmdpbjogMCBhdXRvO1wiPlxuICAgICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6ICR7cHJpb3JpdHl9OyBjb2xvcjogd2hpdGU7IHBhZGRpbmc6IDIwcHg7XCI+XG4gICAgICAgIDxoMiBzdHlsZT1cIm1hcmdpbjogMDtcIj5DZXJ0aWZpY2F0aW9uIEFsZXJ0PC9oMj5cbiAgICAgICAgPHAgc3R5bGU9XCJtYXJnaW46IDVweCAwIDAgMDtcIj5Qcmlvcml0eTogJHthbGVydC5hbGVydF9wcmlvcml0eX08L3A+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGRpdiBzdHlsZT1cInBhZGRpbmc6IDIwcHg7IGJhY2tncm91bmQtY29sb3I6ICNmNWY1ZjU7XCI+XG4gICAgICAgIDxoMz5QYXRpZW50IEluZm9ybWF0aW9uPC9oMz5cbiAgICAgICAgPHA+PHN0cm9uZz5OYW1lOjwvc3Ryb25nPiAke3BhdGllbnROYW1lfTwvcD5cbiAgICAgICAgPHA+PHN0cm9uZz5NUk46PC9zdHJvbmc+ICR7bXJufTwvcD5cblxuICAgICAgICA8aDM+Q2VydGlmaWNhdGlvbiBEZXRhaWxzPC9oMz5cbiAgICAgICAgPHA+PHN0cm9uZz5QZXJpb2Q6PC9zdHJvbmc+ICR7Y2VydGlmaWNhdGlvbi5jZXJ0aWZpY2F0aW9uX3BlcmlvZH08L3A+XG4gICAgICAgIDxwPjxzdHJvbmc+U3RhcnQgRGF0ZTo8L3N0cm9uZz4gJHtjZXJ0aWZpY2F0aW9uLnN0YXJ0X2RhdGV9PC9wPlxuICAgICAgICA8cD48c3Ryb25nPkR1ZSBEYXRlOjwvc3Ryb25nPiAke2NlcnRpZmljYXRpb24uY2VydGlmaWNhdGlvbl9kdWVfZGF0ZX08L3A+XG5cbiAgICAgICAgPGRpdiBzdHlsZT1cIm1hcmdpbi10b3A6IDIwcHg7IHBhZGRpbmc6IDE1cHg7IGJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBib3JkZXItbGVmdDogNHB4IHNvbGlkICR7cHJpb3JpdHl9O1wiPlxuICAgICAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiAwO1wiPiR7YWxlcnQubWVzc2FnZX08L3A+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxwIHN0eWxlPVwibWFyZ2luLXRvcDogMjBweDsgZm9udC1zaXplOiAxMnB4OyBjb2xvcjogIzY2NjtcIj5cbiAgICAgICAgICBUaGlzIGlzIGFuIGF1dG9tYXRlZCBub3RpZmljYXRpb24gZnJvbSB0aGUgSG9zcGljZSBFSFIgc3lzdGVtLlxuICAgICAgICA8L3A+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgYDtcbn1cblxuLyoqXG4gKiBDaGVjayBmb3Igb3ZlcmR1ZSBjZXJ0aWZpY2F0aW9ucyBhbmQgY3JlYXRlIGFsZXJ0c1xuICogU2NoZWR1bGU6IERhaWx5IGF0IDg6MDAgQU1cbiAqIENyb246IDAgOCAqICogKlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2hlY2tPdmVyZHVlQ2VydGlmaWNhdGlvbnMoKSB7XG4gIGxvZ2dlci5pbmZvKCdDaGVja2luZyBmb3Igb3ZlcmR1ZSBjZXJ0aWZpY2F0aW9ucy4uLicpXG5cbiAgdHJ5IHtcbiAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO1xuXG4gICAgLy8gRmluZCBjZXJ0aWZpY2F0aW9ucyB0aGF0IGFyZSBvdmVyZHVlIGFuZCBkb24ndCBoYXZlIG92ZXJkdWUgYWxlcnRzXG4gICAgY29uc3Qgb3ZlcmR1ZUNlcnRzID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLmZyb20oY2VydGlmaWNhdGlvbnMpXG4gICAgICAud2hlcmUoYW5kKFxuICAgICAgICBlcShjZXJ0aWZpY2F0aW9ucy5jZXJ0aWZpY2F0aW9uX3N0YXR1cywgJ1BFTkRJTkcnKSxcbiAgICAgICAgbHRlKGNlcnRpZmljYXRpb25zLmNlcnRpZmljYXRpb25fZHVlX2RhdGUsIHRvZGF5KSxcbiAgICAgICAgaXNOdWxsKGNlcnRpZmljYXRpb25zLmRlbGV0ZWRfYXQpXG4gICAgICApKTtcblxuICAgIGxvZ2dlci5pbmZvKGBGb3VuZCAke292ZXJkdWVDZXJ0cy5sZW5ndGh9IG92ZXJkdWUgY2VydGlmaWNhdGlvbnNgKVxuXG4gICAgbGV0IGFsZXJ0c0NyZWF0ZWQgPSAwO1xuXG4gICAgZm9yIChjb25zdCBjZXJ0IG9mIG92ZXJkdWVDZXJ0cykge1xuICAgICAgLy8gQ2hlY2sgaWYgb3ZlcmR1ZSBhbGVydCBhbHJlYWR5IGV4aXN0c1xuICAgICAgY29uc3QgZXhpc3RpbmdBbGVydCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShjZXJ0aWZpY2F0aW9uX2FsZXJ0cylcbiAgICAgICAgLndoZXJlKGFuZChcbiAgICAgICAgICBlcShjZXJ0aWZpY2F0aW9uX2FsZXJ0cy5jZXJ0aWZpY2F0aW9uX2lkLCBjZXJ0LmlkKSxcbiAgICAgICAgICBlcShjZXJ0aWZpY2F0aW9uX2FsZXJ0cy5hbGVydF90eXBlLCAnT1ZFUkRVRV9DRVJUJylcbiAgICAgICAgKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBpZiAoIWV4aXN0aW5nQWxlcnRbMF0pIHtcbiAgICAgICAgLy8gQ3JlYXRlIG92ZXJkdWUgYWxlcnRcbiAgICAgICAgYXdhaXQgZGIuaW5zZXJ0KGNlcnRpZmljYXRpb25fYWxlcnRzKS52YWx1ZXMoe1xuICAgICAgICAgIGNlcnRpZmljYXRpb25faWQ6IGNlcnQuaWQsXG4gICAgICAgICAgcGF0aWVudF9pZDogY2VydC5wYXRpZW50X2lkLFxuICAgICAgICAgIGFsZXJ0X3R5cGU6ICdPVkVSRFVFX0NFUlQnLFxuICAgICAgICAgIGFsZXJ0X3ByaW9yaXR5OiAnQ1JJVElDQUwnLFxuICAgICAgICAgIHNjaGVkdWxlZF9mb3I6IG5ldyBEYXRlKCksXG4gICAgICAgICAgc3ViamVjdDogYE9WRVJEVUU6IENlcnRpZmljYXRpb24gUmVxdWlyZWQgZm9yIFBhdGllbnRgLFxuICAgICAgICAgIG1lc3NhZ2U6IGBDZXJ0aWZpY2F0aW9uIHdhcyBkdWUgb24gJHtjZXJ0LmNlcnRpZmljYXRpb25fZHVlX2RhdGV9LiBQbGVhc2UgY29tcGxldGUgaW1tZWRpYXRlbHkuYCxcbiAgICAgICAgICByZWNpcGllbnRzOiBbcHJvY2Vzcy5lbnYuQ0VSVElGSUNBVElPTl9BTEVSVF9FTUFJTCB8fCAnY2xpbmljYWxAaG9zcGljZS5leGFtcGxlLmNvbSddXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGFsZXJ0c0NyZWF0ZWQrKztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsb2dnZXIuaW5mbyhgQ3JlYXRlZCAke2FsZXJ0c0NyZWF0ZWR9IG92ZXJkdWUgY2VydGlmaWNhdGlvbiBhbGVydHNgKVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBvdmVyZHVlX2NvdW50OiBvdmVyZHVlQ2VydHMubGVuZ3RoLFxuICAgICAgYWxlcnRzX2NyZWF0ZWQ6IGFsZXJ0c0NyZWF0ZWRcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignRXJyb3IgY2hlY2tpbmcgb3ZlcmR1ZSBjZXJ0aWZpY2F0aW9uczonLCBlcnJvcilcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBwcm9jZXNzQ2VydGlmaWNhdGlvbkFsZXJ0cztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBZVk7SUFBQUEsYUFBQSxZQUFBQSxDQUFBO01BQUEsT0FBQUMsY0FBQTtJQUFBO0VBQUE7RUFBQSxPQUFBQSxjQUFBO0FBQUE7QUFBQUQsYUFBQTtBQWZaLFNBQVNFLEVBQUUsUUFBUSx5QkFBeUI7QUFDNUMsU0FBU0Msb0JBQW9CLEVBQUVDLGNBQWMsRUFBRUMsUUFB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