{"version":3,"names":["cov_i4i0b4dic","actualCoverage","pgTable","bigint","varchar","text","timestamp","boolean","jsonb","integer","date","numeric","uniqueIndex","patients","users","certifications","cap_tracking","s","id","mode","primaryKey","generatedByDefaultAsIdentity","patient_id","references","f","notNull","cap_year","cap_year_start_date","cap_year_end_date","cap_amount_cents","total_payments_cents","default","remaining_cap_cents","utilization_percentage","precision","scale","cap_exceeded","cap_exceeded_date","cap_exceeded_amount_cents","alert_80_triggered","alert_80_date","alert_90_triggered","alert_90_date","alert_95_triggered","alert_95_date","last_calculated_at","calculation_status","length","notes","metadata","created_by_id","updated_by_id","deleted_at","createdAt","defaultNow","updatedAt","table","uniquePatientYear","on","certification_alerts","certification_id","alert_type","alert_priority","scheduled_for","sent_at","alert_status","recipients","subject","message"],"sources":["capTracking.schema.js"],"sourcesContent":["import { pgTable, bigint, varchar, text, timestamp, boolean, jsonb, integer, date, numeric, uniqueIndex } from 'drizzle-orm/pg-core';\nimport { patients } from './patient.schema.js';\nimport { users } from './user.schema.js';\nimport { certifications } from './certifications.schema.js';\n\n/**\n * Cap Tracking Table\n * Tracks Medicare hospice cap amount per beneficiary per cap year\n * CMS Requirement: Cap year runs Oct 1 - Sep 30\n * FY 2025 Cap: $34,465.34 per beneficiary\n */\nexport const cap_tracking = pgTable('cap_tracking', {\n  id: bigint('id', { mode: 'number' }).primaryKey().generatedByDefaultAsIdentity(),\n  patient_id: bigint('patient_id', { mode: 'number' }).references(() => patients.id).notNull(),\n\n  // Cap year (Oct 1 - Sep 30)\n  cap_year: integer('cap_year').notNull(), // e.g., 2025 for cap year 2024-2025\n  cap_year_start_date: date('cap_year_start_date').notNull(), // Oct 1\n  cap_year_end_date: date('cap_year_end_date').notNull(), // Sep 30\n\n  // Cap amount (in cents for precision)\n  cap_amount_cents: integer('cap_amount_cents').notNull(), // $34,465.34 = 3446534 cents\n  total_payments_cents: integer('total_payments_cents').default(0).notNull(), // Total payments applied in cap year\n  remaining_cap_cents: integer('remaining_cap_cents').notNull(), // Remaining cap amount\n\n  // Cap utilization percentage (for easier querying)\n  utilization_percentage: numeric('utilization_percentage', { precision: 5, scale: 2 }).default('0'), // e.g., 85.50 for 85.5%\n\n  // Cap exceeded tracking\n  cap_exceeded: boolean('cap_exceeded').default(false).notNull(),\n  cap_exceeded_date: date('cap_exceeded_date'),\n  cap_exceeded_amount_cents: integer('cap_exceeded_amount_cents'), // Amount over cap\n\n  // Alert thresholds tracking\n  alert_80_triggered: boolean('alert_80_triggered').default(false),\n  alert_80_date: timestamp('alert_80_date'),\n  alert_90_triggered: boolean('alert_90_triggered').default(false),\n  alert_90_date: timestamp('alert_90_date'),\n  alert_95_triggered: boolean('alert_95_triggered').default(false),\n  alert_95_date: timestamp('alert_95_date'),\n\n  // Calculation tracking\n  last_calculated_at: timestamp('last_calculated_at'),\n  calculation_status: varchar('calculation_status', { length: 50 }).default('CURRENT'), // CURRENT, PENDING_RECALC, ERROR\n\n  // Notes and metadata\n  notes: text('notes'),\n  metadata: jsonb('metadata'),\n\n  // Audit fields\n  created_by_id: text('created_by_id').references(() => users.id),\n  updated_by_id: text('updated_by_id').references(() => users.id),\n  deleted_at: timestamp('deleted_at'),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull()\n}, (table) => ({\n  // Unique constraint: one record per patient per cap year\n  uniquePatientYear: uniqueIndex('unique_patient_cap_year').on(table.patient_id, table.cap_year)\n}));\n\n/**\n * Certification Alerts Table\n * Tracks alerts sent for upcoming certifications and face-to-face requirements\n * Requirement: Alert 5 days before benefit period start\n */\nexport const certification_alerts = pgTable('certification_alerts', {\n  id: bigint('id', { mode: 'number' }).primaryKey().generatedByDefaultAsIdentity(),\n  certification_id: bigint('certification_id', { mode: 'number' }).references(() => certifications.id).notNull(),\n  patient_id: bigint('patient_id', { mode: 'number' }).references(() => patients.id).notNull(),\n\n  // Alert details\n  alert_type: varchar('alert_type', { length: 50 }).notNull(), // UPCOMING_CERT, OVERDUE_CERT, F2F_REQUIRED, F2F_OVERDUE\n  alert_priority: varchar('alert_priority', { length: 50 }).default('NORMAL'), // NORMAL, HIGH, CRITICAL\n\n  // Timing\n  scheduled_for: timestamp('scheduled_for').notNull(),\n  sent_at: timestamp('sent_at'),\n  alert_status: varchar('alert_status', { length: 50 }).default('PENDING'), // PENDING, SENT, FAILED, DISMISSED\n\n  // Recipients\n  recipients: jsonb('recipients'), // Array of user IDs or email addresses\n\n  // Alert content\n  subject: varchar('subject', { length: 255 }),\n  message: text('message'),\n  metadata: jsonb('metadata'),\n\n  // Audit fields\n  created_by_id: text('created_by_id').references(() => users.id),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull()\n});\n"],"mappings":"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","ignoreList":[]}