{"version":3,"names":["cov_131kqasyl7","actualCoverage","index","store","show","update","destroy","autoSave","admissionAutoSave","admissionShow","admissionIndex","admissionInformationRoutes","benefitPeriodRoutes","cardiacAssessmentRoutes","dischargeRoutes","endocrineAssessmentRoutes","hematologicalAssessmentRoutes","hisPdfRoutes","integumentaryAssessmentRoutes","livingArrangementsRoutes","nutritionRoutes","patientIdentifiersRoutes","patientPharmacyRoutes","payerInformationRoutes","primaryDiagnosisRoutes","prognosisRoutes","raceEthnicityRoutes","selectRoutes","signatureRoutes","spiritualPreferenceRoutes","visitInformationRoutes","addressRoutes","verifyToken","requireRole","requirePermission","requireAnyPermission","ROLES","PERMISSIONS","logger","patientRoutes","fastify","options","f","s","get","request","reply","message","path","url","user","preHandler","info","method","role","userRole","b","PATIENT","hasPermission","VIEW_PATIENT","ADMIN","DOCTOR","NURSE","code","send","status","error","post","CREATE_PATIENT","register","prefix","put","UPDATE_PATIENT","delete"],"sources":["Patient.routes.js"],"sourcesContent":["import {\n  index,\n  store,\n  show,\n  update,\n  destroy,\n} from \"../../controllers/patient/Patient.controller.js\";\nimport {\n  autoSave as admissionAutoSave,\n  show as admissionShow,\n  index as admissionIndex,\n} from \"../../controllers/patient/AdmissionInformation.controller.js\";\nimport admissionInformationRoutes from \"./AdmissionInformation.routes.js\";\nimport benefitPeriodRoutes from \"./BenefitPeriod.routes.js\";\nimport cardiacAssessmentRoutes from \"./CardiacAssessment.routes.js\";\nimport dischargeRoutes from \"./Discharge.routes.js\";\nimport endocrineAssessmentRoutes from \"./EndocrineAssessment.routes.js\";\nimport hematologicalAssessmentRoutes from \"./HematologicalAssessment.routes.js\";\nimport hisPdfRoutes from \"./HisPdf.routes.js\";\nimport integumentaryAssessmentRoutes from \"./IntegumentaryAssessment.routes.js\";\nimport livingArrangementsRoutes from \"./LivingArrangements.routes.js\";\nimport nutritionRoutes from \"./Nutrition.routes.js\";\nimport patientIdentifiersRoutes from \"./PatientIdentifiers.routes.js\";\nimport patientPharmacyRoutes from \"./PatientPharmacy.routes.js\";\nimport payerInformationRoutes from \"./PayerInformation.routes.js\";\nimport primaryDiagnosisRoutes from \"./PrimaryDiagnosis.routes.js\";\nimport prognosisRoutes from \"./Prognosis.routes.js\";\nimport raceEthnicityRoutes from \"./RaceEthnicity.routes.js\";\nimport selectRoutes from \"./Select.routes.js\";\nimport signatureRoutes from \"./Signature.routes.js\";\nimport spiritualPreferenceRoutes from \"./SpiritualPreference.routes.js\";\nimport visitInformationRoutes from \"./VisitInformation.routes.js\";\nimport addressRoutes from \"./Address.routes.js\";\nimport { verifyToken } from \"../../middleware/betterAuth.middleware.js\";\nimport {\n  requireRole,\n  requirePermission,\n  requireAnyPermission,\n} from \"../../middleware/rbac.middleware.js\";\nimport { ROLES, PERMISSIONS } from \"../../config/rbac.js\";\n\nimport { logger } from '../../utils/logger.js';\n// Fastify plugin for patient routes\nasync function patientRoutes(fastify, options) {\n  // Patient Routes with RBAC\n  // Note: Authentication is already handled by api.routes.js middleware\n\n  // Test route without permission check to verify routing\n  fastify.get(\"/test\", async (request, reply) => {\n    return {\n      message: \"Patient routes are working!\",\n      path: request.url,\n      user: request.user,\n    };\n  });\n\n  // Only doctors, nurses, and admins can view all patients\n  // IMPORTANT: This route must come BEFORE all sub-routes to avoid conflicts\n  fastify.get(\n    \"/\",\n    {\n      preHandler: [\n        async (request, reply) => {\n          logger.info(\"ðŸ” Patient GET / route hit:\", request.url, request.method, request.user?.role)\n        },\n        async (request, reply) => {\n          try {\n            // Check permission\n            const userRole = request.user?.role || ROLES.PATIENT;\n            const hasPermission = PERMISSIONS.VIEW_PATIENT &&\n              (userRole === ROLES.ADMIN ||\n                userRole === ROLES.DOCTOR ||\n                userRole === ROLES.NURSE ||\n                userRole === ROLES.PATIENT); // Patients can view their own\n\n            if (!hasPermission) {\n              return reply.code(403).send({\n                status: 403,\n                message: 'Access denied. Insufficient permissions.'\n              });\n            }\n          } catch (error) {\n            logger.error(\"Permission check error:\", error)\n            return reply.code(500).send({\n              status: 500,\n              message: \"Error checking permissions\"\n            });\n          }\n        },\n      ],\n    },\n    index\n  );\n\n  // Only doctors and admins can create new patients\n  fastify.post(\n    \"/\",\n    {\n      preHandler: [requireAnyPermission(PERMISSIONS.CREATE_PATIENT)],\n    },\n    store\n  );\n\n  // Sub-routes (mounted BEFORE :id route to avoid conflicts with route names)\n  // Admission Information Routes\n  await fastify.register(admissionInformationRoutes, { prefix: \"/admission\" });\n\n  // Benefit Period Routes (mounted with prefix to avoid route conflicts)\n  await fastify.register(benefitPeriodRoutes, { prefix: \"/benefit-period\" });\n\n  // Cardiac Assessment Routes\n  await fastify.register(cardiacAssessmentRoutes);\n\n  // Discharge Routes\n  await fastify.register(dischargeRoutes);\n\n  // Endocrine Assessment Routes\n  await fastify.register(endocrineAssessmentRoutes);\n\n  // Hematological Assessment Routes\n  await fastify.register(hematologicalAssessmentRoutes);\n\n  // HisPdf Routes\n  await fastify.register(hisPdfRoutes);\n\n  // Integumentary Assessment Routes\n  await fastify.register(integumentaryAssessmentRoutes);\n\n  // Living Arrangements Routes\n  await fastify.register(livingArrangementsRoutes);\n\n  // Nutrition Routes\n  await fastify.register(nutritionRoutes);\n\n  // Patient Identifiers Routes\n  await fastify.register(patientIdentifiersRoutes);\n\n  // Patient Pharmacy Routes\n  await fastify.register(patientPharmacyRoutes);\n\n  // Payer Information Routes\n  await fastify.register(payerInformationRoutes);\n\n  // Primary Diagnosis Routes\n  await fastify.register(primaryDiagnosisRoutes);\n\n  // Prognosis Routes\n  await fastify.register(prognosisRoutes);\n\n  // Race Ethnicity Routes\n  await fastify.register(raceEthnicityRoutes);\n\n  // Select Routes\n  await fastify.register(selectRoutes);\n\n  // Signature Routes\n  await fastify.register(signatureRoutes);\n\n  // Spiritual Preference Routes\n  await fastify.register(spiritualPreferenceRoutes);\n\n  // Visit Information Routes\n  await fastify.register(visitInformationRoutes);\n\n  // Address Routes\n  await fastify.register(addressRoutes);\n\n  // Patients can view their own info, others need permission\n  // IMPORTANT: This :id route must come AFTER all sub-routes to avoid conflicts\n  fastify.get(\n    \"/:id\",\n    {\n      preHandler: [requireAnyPermission(PERMISSIONS.VIEW_PATIENT)],\n    },\n    show\n  );\n\n  // Only doctors and admins can update patient info\n  fastify.put(\n    \"/:id\",\n    {\n      preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_PATIENT)],\n    },\n    update\n  );\n\n  // Only admins can delete patients\n  fastify.delete(\n    \"/:id\",\n    {\n      preHandler: [requireRole(ROLES.ADMIN)],\n    },\n    destroy\n  );\n}\n\nexport default patientRoutes;\n"],"mappings":"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","ignoreList":[]}