{"version":3,"names":["cov_2h9acjh6qp","actualCoverage","Prognosis","logger","s","getAllPrognosis","request","reply","f","prognosis","findAll","error","code","status","message","createPrognosis","validatedData","body","findOne","where","patient_id","b","updateData","prognosis_patient_is_imminent","prognosis_patient_id","Array","isArray","join","prognosis_caregiver_id","prognosis_imminence_id","update","createData","create","data","getPrognosisByPatientId","id","params","prognosisValidation"],"sources":["Prognosis.controller.js"],"sourcesContent":["import Prognosis from \"../models/Prognosis.model.js\";\nimport { logger } from '../utils/logger.js';\n// Note: express-validator replaced with Fastify schema validation\n\n// Get all prognosis records\nexport const getAllPrognosis = async (request, reply) => {\n  try {\n    const prognosis = await Prognosis.findAll();\n    return prognosis;\n  } catch (error) {\n    logger.error(\"Error fetching prognosis:\", error)\n    reply.code(500);\n    return {\n      status: 500,\n      message: \"Server error while fetching prognosis\",\n    };\n  }\n};\n\n// Create or update prognosis record\nexport const createPrognosis = async (request, reply) => {\n  try {\n    // Note: Validation should be done in route definition using Fastify schema\n    const validatedData = request.body;\n\n    // Check if prognosis already exists for this patient\n    let prognosis = await Prognosis.findOne({\n      where: { patient_id: validatedData.patient_id },\n    });\n\n    if (prognosis) {\n      // Update existing prognosis\n      const updateData = {\n        prognosis_patient_is_imminent:\n          validatedData.prognosis_patient_is_imminent,\n      };\n\n      // Add non-empty fields\n      if (validatedData.prognosis_patient_id) {\n        updateData.prognosis_patient_id = Array.isArray(\n          validatedData.prognosis_patient_id\n        )\n          ? validatedData.prognosis_patient_id.join(\",\")\n          : validatedData.prognosis_patient_id;\n      }\n\n      if (validatedData.prognosis_caregiver_id) {\n        updateData.prognosis_caregiver_id = Array.isArray(\n          validatedData.prognosis_caregiver_id\n        )\n          ? validatedData.prognosis_caregiver_id.join(\",\")\n          : validatedData.prognosis_caregiver_id;\n      }\n\n      if (validatedData.prognosis_imminence_id) {\n        updateData.prognosis_imminence_id = Array.isArray(\n          validatedData.prognosis_imminence_id\n        )\n          ? validatedData.prognosis_imminence_id.join(\",\")\n          : validatedData.prognosis_imminence_id;\n      }\n\n      await prognosis.update(updateData);\n    } else {\n      // Create new prognosis\n      const createData = {\n        patient_id: validatedData.patient_id,\n        prognosis_patient_is_imminent:\n          validatedData.prognosis_patient_is_imminent,\n      };\n\n      // Add non-empty fields\n      if (validatedData.prognosis_patient_id) {\n        createData.prognosis_patient_id = Array.isArray(\n          validatedData.prognosis_patient_id\n        )\n          ? validatedData.prognosis_patient_id.join(\",\")\n          : validatedData.prognosis_patient_id;\n      }\n\n      if (validatedData.prognosis_caregiver_id) {\n        createData.prognosis_caregiver_id = Array.isArray(\n          validatedData.prognosis_caregiver_id\n        )\n          ? validatedData.prognosis_caregiver_id.join(\",\")\n          : validatedData.prognosis_caregiver_id;\n      }\n\n      if (validatedData.prognosis_imminence_id) {\n        createData.prognosis_imminence_id = Array.isArray(\n          validatedData.prognosis_imminence_id\n        )\n          ? validatedData.prognosis_imminence_id.join(\",\")\n          : validatedData.prognosis_imminence_id;\n      }\n\n      prognosis = await Prognosis.create(createData);\n    }\n\n    reply.code(201);\n    return {\n      message: \"Prognosis created or updated successfully.\",\n      data: prognosis,\n    };\n  } catch (error) {\n    logger.error(\"Error creating/updating prognosis:\", error)\n    reply.code(500);\n    return {\n      status: 500,\n      message: \"Server error while creating/updating prognosis\",\n    };\n  }\n};\n\n// Get prognosis by patient ID\nexport const getPrognosisByPatientId = async (request, reply) => {\n  try {\n    const { id } = request.params;\n\n    const prognosis = await Prognosis.findOne({\n      where: { patient_id: id },\n    });\n\n    if (!prognosis) {\n      reply.code(404);\n      return {\n        status: 404,\n        message: \"No prognosis found for this patient\",\n      };\n    }\n\n    return prognosis;\n  } catch (error) {\n    logger.error(\"Error fetching prognosis:\", error)\n    reply.code(500);\n    return {\n      status: 500,\n      message: \"Server error while fetching prognosis\",\n    };\n  }\n};\n\n// Validation rules\n// Note: In Fastify, validation should be done using schema in route definitions\nexport const prognosisValidation = async (request, reply) => {\n  // Basic validation - should be done in route schema\n  // This is kept for compatibility\n};\n"],"mappings":"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","ignoreList":[]}