c923cd99c8f37d2514510efeb7337064
/* istanbul ignore next */
function cov_17rbmedawu() {
  var path = "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/routes/casl-demo.routes.js";
  var hash = "b341edf61b975ccae24b6f8123141068e9dff243";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/routes/casl-demo.routes.js",
    statementMap: {
      "0": {
        start: {
          line: 13,
          column: 2
        },
        end: {
          line: 13,
          column: 45
        }
      },
      "1": {
        start: {
          line: 16,
          column: 2
        },
        end: {
          line: 16,
          column: 50
        }
      },
      "2": {
        start: {
          line: 19,
          column: 2
        },
        end: {
          line: 27,
          column: 5
        }
      },
      "3": {
        start: {
          line: 20,
          column: 20
        },
        end: {
          line: 20,
          column: 71
        }
      },
      "4": {
        start: {
          line: 21,
          column: 4
        },
        end: {
          line: 26,
          column: 6
        }
      },
      "5": {
        start: {
          line: 30,
          column: 2
        },
        end: {
          line: 38,
          column: 5
        }
      },
      "6": {
        start: {
          line: 31,
          column: 22
        },
        end: {
          line: 31,
          column: 75
        }
      },
      "7": {
        start: {
          line: 32,
          column: 4
        },
        end: {
          line: 37,
          column: 6
        }
      },
      "8": {
        start: {
          line: 41,
          column: 2
        },
        end: {
          line: 53,
          column: 4
        }
      },
      "9": {
        start: {
          line: 47,
          column: 6
        },
        end: {
          line: 51,
          column: 8
        }
      },
      "10": {
        start: {
          line: 56,
          column: 2
        },
        end: {
          line: 68,
          column: 4
        }
      },
      "11": {
        start: {
          line: 62,
          column: 6
        },
        end: {
          line: 66,
          column: 8
        }
      },
      "12": {
        start: {
          line: 71,
          column: 2
        },
        end: {
          line: 88,
          column: 4
        }
      },
      "13": {
        start: {
          line: 82,
          column: 6
        },
        end: {
          line: 86,
          column: 8
        }
      },
      "14": {
        start: {
          line: 91,
          column: 2
        },
        end: {
          line: 106,
          column: 4
        }
      },
      "15": {
        start: {
          line: 99,
          column: 6
        },
        end: {
          line: 104,
          column: 8
        }
      },
      "16": {
        start: {
          line: 109,
          column: 2
        },
        end: {
          line: 124,
          column: 5
        }
      },
      "17": {
        start: {
          line: 110,
          column: 28
        },
        end: {
          line: 110,
          column: 81
        }
      },
      "18": {
        start: {
          line: 111,
          column: 30
        },
        end: {
          line: 111,
          column: 85
        }
      },
      "19": {
        start: {
          line: 112,
          column: 30
        },
        end: {
          line: 112,
          column: 85
        }
      },
      "20": {
        start: {
          line: 114,
          column: 4
        },
        end: {
          line: 123,
          column: 6
        }
      },
      "21": {
        start: {
          line: 127,
          column: 2
        },
        end: {
          line: 139,
          column: 4
        }
      },
      "22": {
        start: {
          line: 133,
          column: 6
        },
        end: {
          line: 137,
          column: 8
        }
      }
    },
    fnMap: {
      "0": {
        name: "caslDemoRoutes",
        decl: {
          start: {
            line: 11,
            column: 15
          },
          end: {
            line: 11,
            column: 29
          }
        },
        loc: {
          start: {
            line: 11,
            column: 48
          },
          end: {
            line: 140,
            column: 1
          }
        },
        line: 11
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 19,
            column: 36
          },
          end: {
            line: 19,
            column: 37
          }
        },
        loc: {
          start: {
            line: 19,
            column: 62
          },
          end: {
            line: 27,
            column: 3
          }
        },
        line: 19
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 30,
            column: 38
          },
          end: {
            line: 30,
            column: 39
          }
        },
        loc: {
          start: {
            line: 30,
            column: 64
          },
          end: {
            line: 38,
            column: 3
          }
        },
        line: 30
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 46,
            column: 4
          },
          end: {
            line: 46,
            column: 5
          }
        },
        loc: {
          start: {
            line: 46,
            column: 30
          },
          end: {
            line: 52,
            column: 5
          }
        },
        line: 46
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 61,
            column: 4
          },
          end: {
            line: 61,
            column: 5
          }
        },
        loc: {
          start: {
            line: 61,
            column: 30
          },
          end: {
            line: 67,
            column: 5
          }
        },
        line: 61
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 81,
            column: 4
          },
          end: {
            line: 81,
            column: 5
          }
        },
        loc: {
          start: {
            line: 81,
            column: 30
          },
          end: {
            line: 87,
            column: 5
          }
        },
        line: 81
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 98,
            column: 4
          },
          end: {
            line: 98,
            column: 5
          }
        },
        loc: {
          start: {
            line: 98,
            column: 30
          },
          end: {
            line: 105,
            column: 5
          }
        },
        line: 98
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 109,
            column: 31
          },
          end: {
            line: 109,
            column: 32
          }
        },
        loc: {
          start: {
            line: 109,
            column: 57
          },
          end: {
            line: 124,
            column: 3
          }
        },
        line: 109
      },
      "8": {
        name: "(anonymous_8)",
        decl: {
          start: {
            line: 132,
            column: 4
          },
          end: {
            line: 132,
            column: 5
          }
        },
        loc: {
          start: {
            line: 132,
            column: 30
          },
          end: {
            line: 138,
            column: 5
          }
        },
        line: 132
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 23,
            column: 23
          },
          end: {
            line: 23,
            column: 49
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 23,
            column: 33
          },
          end: {
            line: 23,
            column: 38
          }
        }, {
          start: {
            line: 23,
            column: 41
          },
          end: {
            line: 23,
            column: 49
          }
        }],
        line: 23
      },
      "1": {
        loc: {
          start: {
            line: 34,
            column: 23
          },
          end: {
            line: 34,
            column: 51
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 34,
            column: 35
          },
          end: {
            line: 34,
            column: 40
          }
        }, {
          start: {
            line: 34,
            column: 43
          },
          end: {
            line: 34,
            column: 51
          }
        }],
        line: 34
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0]
    },
    inputSourceMap: null,
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "b341edf61b975ccae24b6f8123141068e9dff243"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_17rbmedawu = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_17rbmedawu();
import { authenticate } from "../middleware/betterAuth.middleware.js";
import { injectCaslAbility, requireCaslAbility, requireAnyCaslAbility, requireAllCaslAbilities } from "../middleware/casl.middleware.js";
import { ACTIONS, SUBJECTS, canUser } from "../config/casl.js";

// Fastify plugin for CASL demo routes
async function caslDemoRoutes(fastify, options) {
  /* istanbul ignore next */
  cov_17rbmedawu().f[0]++;
  cov_17rbmedawu().s[0]++;
  // Apply authentication middleware to all routes in this plugin
  fastify.addHook("onRequest", authenticate);

  // Inject CASL abilities into the request object
  /* istanbul ignore next */
  cov_17rbmedawu().s[1]++;
  fastify.addHook("onRequest", injectCaslAbility);

  // Demo route showing CASL ability check - Check if user can view patients
  /* istanbul ignore next */
  cov_17rbmedawu().s[2]++;
  fastify.get("/can-view-patients", async (request, reply) => {
    /* istanbul ignore next */
    cov_17rbmedawu().f[1]++;
    const canView =
    /* istanbul ignore next */
    (cov_17rbmedawu().s[3]++, request.ability.can(ACTIONS.VIEW, SUBJECTS.PATIENT));
    /* istanbul ignore next */
    cov_17rbmedawu().s[4]++;
    return {
      status: 200,
      message: `User ${canView ?
      /* istanbul ignore next */
      (cov_17rbmedawu().b[0][0]++, "can") :
      /* istanbul ignore next */
      (cov_17rbmedawu().b[0][1]++, "cannot")} view patients`,
      user: request.user,
      canView
    };
  });

  // Demo route showing CASL ability check - Check if user can create patients
  /* istanbul ignore next */
  cov_17rbmedawu().s[5]++;
  fastify.get("/can-create-patients", async (request, reply) => {
    /* istanbul ignore next */
    cov_17rbmedawu().f[2]++;
    const canCreate =
    /* istanbul ignore next */
    (cov_17rbmedawu().s[6]++, request.ability.can(ACTIONS.CREATE, SUBJECTS.PATIENT));
    /* istanbul ignore next */
    cov_17rbmedawu().s[7]++;
    return {
      status: 200,
      message: `User ${canCreate ?
      /* istanbul ignore next */
      (cov_17rbmedawu().b[1][0]++, "can") :
      /* istanbul ignore next */
      (cov_17rbmedawu().b[1][1]++, "cannot")} create patients`,
      user: request.user,
      canCreate
    };
  });

  // Demo route showing CASL middleware - Require ability to view patients
  /* istanbul ignore next */
  cov_17rbmedawu().s[8]++;
  fastify.get("/require-view-patients", {
    preHandler: [requireCaslAbility(ACTIONS.VIEW, SUBJECTS.PATIENT)]
  }, async (request, reply) => {
    /* istanbul ignore next */
    cov_17rbmedawu().f[3]++;
    cov_17rbmedawu().s[9]++;
    return {
      status: 200,
      message: "CASL Middleware: User can view patients",
      user: request.user
    };
  });

  // Demo route showing CASL middleware - Require ability to create patients
  /* istanbul ignore next */
  cov_17rbmedawu().s[10]++;
  fastify.get("/require-create-patients", {
    preHandler: [requireCaslAbility(ACTIONS.CREATE, SUBJECTS.PATIENT)]
  }, async (request, reply) => {
    /* istanbul ignore next */
    cov_17rbmedawu().f[4]++;
    cov_17rbmedawu().s[11]++;
    return {
      status: 200,
      message: "CASL Middleware: User can create patients",
      user: request.user
    };
  });

  // Demo route showing CASL middleware - Require any of the specified abilities
  /* istanbul ignore next */
  cov_17rbmedawu().s[12]++;
  fastify.get("/require-any-patient-abilities", {
    preHandler: [requireAnyCaslAbility([ACTIONS.VIEW, ACTIONS.CREATE, ACTIONS.UPDATE], SUBJECTS.PATIENT)]
  }, async (request, reply) => {
    /* istanbul ignore next */
    cov_17rbmedawu().f[5]++;
    cov_17rbmedawu().s[13]++;
    return {
      status: 200,
      message: "CASL Middleware: User has at least one patient-related ability",
      user: request.user
    };
  });

  // Demo route showing CASL middleware - Require all of the specified abilities
  /* istanbul ignore next */
  cov_17rbmedawu().s[14]++;
  fastify.get("/require-all-patient-abilities", {
    preHandler: [requireAllCaslAbilities([ACTIONS.VIEW, ACTIONS.CREATE], SUBJECTS.PATIENT)]
  }, async (request, reply) => {
    /* istanbul ignore next */
    cov_17rbmedawu().f[6]++;
    cov_17rbmedawu().s[15]++;
    return {
      status: 200,
      message: "CASL Middleware: User has all required patient-related abilities",
      user: request.user
    };
  });

  // Demo route showing manual CASL check
  /* istanbul ignore next */
  cov_17rbmedawu().s[16]++;
  fastify.get("/manual-check", async (request, reply) => {
    /* istanbul ignore next */
    cov_17rbmedawu().f[7]++;
    const canViewPatients =
    /* istanbul ignore next */
    (cov_17rbmedawu().s[17]++, canUser(request.user, ACTIONS.VIEW, SUBJECTS.PATIENT));
    const canCreatePatients =
    /* istanbul ignore next */
    (cov_17rbmedawu().s[18]++, canUser(request.user, ACTIONS.CREATE, SUBJECTS.PATIENT));
    const canDeletePatients =
    /* istanbul ignore next */
    (cov_17rbmedawu().s[19]++, canUser(request.user, ACTIONS.DELETE, SUBJECTS.PATIENT));
    /* istanbul ignore next */
    cov_17rbmedawu().s[20]++;
    return {
      status: 200,
      message: "Manual CASL ability checks",
      user: request.user,
      abilities: {
        canViewPatients,
        canCreatePatients,
        canDeletePatients
      }
    };
  });

  // Demo route showing admin-only access with CASL
  /* istanbul ignore next */
  cov_17rbmedawu().s[21]++;
  fastify.get("/admin-only", {
    preHandler: [requireCaslAbility(ACTIONS.MANAGE, SUBJECTS.ALL)]
  }, async (request, reply) => {
    /* istanbul ignore next */
    cov_17rbmedawu().f[8]++;
    cov_17rbmedawu().s[22]++;
    return {
      status: 200,
      message: "CASL Middleware: Admin-only access granted",
      user: request.user
    };
  });
}
export default caslDemoRoutes;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMTdyYm1lZGF3dSIsImFjdHVhbENvdmVyYWdlIiwiYXV0aGVudGljYXRlIiwiaW5qZWN0Q2FzbEFiaWxpdHkiLCJyZXF1aXJlQ2FzbEFiaWxpdHkiLCJyZXF1aXJlQW55Q2FzbEFiaWxpdHkiLCJyZXF1aXJlQWxsQ2FzbEFiaWxpdGllcyIsIkFDVElPTlMiLCJTVUJKRUNUUyIsImNhblVzZXIiLCJjYXNsRGVtb1JvdXRlcyIsImZhc3RpZnkiLCJvcHRpb25zIiwiZiIsInMiLCJhZGRIb29rIiwiZ2V0IiwicmVxdWVzdCIsInJlcGx5IiwiY2FuVmlldyIsImFiaWxpdHkiLCJjYW4iLCJWSUVXIiwiUEFUSUVOVCIsInN0YXR1cyIsIm1lc3NhZ2UiLCJiIiwidXNlciIsImNhbkNyZWF0ZSIsIkNSRUFURSIsInByZUhhbmRsZXIiLCJVUERBVEUiLCJjYW5WaWV3UGF0aWVudHMiLCJjYW5DcmVhdGVQYXRpZW50cyIsImNhbkRlbGV0ZVBhdGllbnRzIiwiREVMRVRFIiwiYWJpbGl0aWVzIiwiTUFOQUdFIiwiQUxMIl0sInNvdXJjZXMiOlsiY2FzbC1kZW1vLnJvdXRlcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhdXRoZW50aWNhdGUgfSBmcm9tIFwiLi4vbWlkZGxld2FyZS9iZXR0ZXJBdXRoLm1pZGRsZXdhcmUuanNcIjtcbmltcG9ydCB7XG4gIGluamVjdENhc2xBYmlsaXR5LFxuICByZXF1aXJlQ2FzbEFiaWxpdHksXG4gIHJlcXVpcmVBbnlDYXNsQWJpbGl0eSxcbiAgcmVxdWlyZUFsbENhc2xBYmlsaXRpZXMsXG59IGZyb20gXCIuLi9taWRkbGV3YXJlL2Nhc2wubWlkZGxld2FyZS5qc1wiO1xuaW1wb3J0IHsgQUNUSU9OUywgU1VCSkVDVFMsIGNhblVzZXIgfSBmcm9tIFwiLi4vY29uZmlnL2Nhc2wuanNcIjtcblxuLy8gRmFzdGlmeSBwbHVnaW4gZm9yIENBU0wgZGVtbyByb3V0ZXNcbmFzeW5jIGZ1bmN0aW9uIGNhc2xEZW1vUm91dGVzKGZhc3RpZnksIG9wdGlvbnMpIHtcbiAgLy8gQXBwbHkgYXV0aGVudGljYXRpb24gbWlkZGxld2FyZSB0byBhbGwgcm91dGVzIGluIHRoaXMgcGx1Z2luXG4gIGZhc3RpZnkuYWRkSG9vayhcIm9uUmVxdWVzdFwiLCBhdXRoZW50aWNhdGUpO1xuICBcbiAgLy8gSW5qZWN0IENBU0wgYWJpbGl0aWVzIGludG8gdGhlIHJlcXVlc3Qgb2JqZWN0XG4gIGZhc3RpZnkuYWRkSG9vayhcIm9uUmVxdWVzdFwiLCBpbmplY3RDYXNsQWJpbGl0eSk7XG5cbiAgLy8gRGVtbyByb3V0ZSBzaG93aW5nIENBU0wgYWJpbGl0eSBjaGVjayAtIENoZWNrIGlmIHVzZXIgY2FuIHZpZXcgcGF0aWVudHNcbiAgZmFzdGlmeS5nZXQoXCIvY2FuLXZpZXctcGF0aWVudHNcIiwgYXN5bmMgKHJlcXVlc3QsIHJlcGx5KSA9PiB7XG4gICAgY29uc3QgY2FuVmlldyA9IHJlcXVlc3QuYWJpbGl0eS5jYW4oQUNUSU9OUy5WSUVXLCBTVUJKRUNUUy5QQVRJRU5UKTtcbiAgICByZXR1cm4ge1xuICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICBtZXNzYWdlOiBgVXNlciAke2NhblZpZXcgPyBcImNhblwiIDogXCJjYW5ub3RcIn0gdmlldyBwYXRpZW50c2AsXG4gICAgICB1c2VyOiByZXF1ZXN0LnVzZXIsXG4gICAgICBjYW5WaWV3LFxuICAgIH07XG4gIH0pO1xuXG4gIC8vIERlbW8gcm91dGUgc2hvd2luZyBDQVNMIGFiaWxpdHkgY2hlY2sgLSBDaGVjayBpZiB1c2VyIGNhbiBjcmVhdGUgcGF0aWVudHNcbiAgZmFzdGlmeS5nZXQoXCIvY2FuLWNyZWF0ZS1wYXRpZW50c1wiLCBhc3luYyAocmVxdWVzdCwgcmVwbHkpID0+IHtcbiAgICBjb25zdCBjYW5DcmVhdGUgPSByZXF1ZXN0LmFiaWxpdHkuY2FuKEFDVElPTlMuQ1JFQVRFLCBTVUJKRUNUUy5QQVRJRU5UKTtcbiAgICByZXR1cm4ge1xuICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICBtZXNzYWdlOiBgVXNlciAke2NhbkNyZWF0ZSA/IFwiY2FuXCIgOiBcImNhbm5vdFwifSBjcmVhdGUgcGF0aWVudHNgLFxuICAgICAgdXNlcjogcmVxdWVzdC51c2VyLFxuICAgICAgY2FuQ3JlYXRlLFxuICAgIH07XG4gIH0pO1xuXG4gIC8vIERlbW8gcm91dGUgc2hvd2luZyBDQVNMIG1pZGRsZXdhcmUgLSBSZXF1aXJlIGFiaWxpdHkgdG8gdmlldyBwYXRpZW50c1xuICBmYXN0aWZ5LmdldChcbiAgICBcIi9yZXF1aXJlLXZpZXctcGF0aWVudHNcIixcbiAgICB7XG4gICAgICBwcmVIYW5kbGVyOiBbcmVxdWlyZUNhc2xBYmlsaXR5KEFDVElPTlMuVklFVywgU1VCSkVDVFMuUEFUSUVOVCldLFxuICAgIH0sXG4gICAgYXN5bmMgKHJlcXVlc3QsIHJlcGx5KSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXM6IDIwMCxcbiAgICAgICAgbWVzc2FnZTogXCJDQVNMIE1pZGRsZXdhcmU6IFVzZXIgY2FuIHZpZXcgcGF0aWVudHNcIixcbiAgICAgICAgdXNlcjogcmVxdWVzdC51c2VyLFxuICAgICAgfTtcbiAgICB9XG4gICk7XG5cbiAgLy8gRGVtbyByb3V0ZSBzaG93aW5nIENBU0wgbWlkZGxld2FyZSAtIFJlcXVpcmUgYWJpbGl0eSB0byBjcmVhdGUgcGF0aWVudHNcbiAgZmFzdGlmeS5nZXQoXG4gICAgXCIvcmVxdWlyZS1jcmVhdGUtcGF0aWVudHNcIixcbiAgICB7XG4gICAgICBwcmVIYW5kbGVyOiBbcmVxdWlyZUNhc2xBYmlsaXR5KEFDVElPTlMuQ1JFQVRFLCBTVUJKRUNUUy5QQVRJRU5UKV0sXG4gICAgfSxcbiAgICBhc3luYyAocmVxdWVzdCwgcmVwbHkpID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICBtZXNzYWdlOiBcIkNBU0wgTWlkZGxld2FyZTogVXNlciBjYW4gY3JlYXRlIHBhdGllbnRzXCIsXG4gICAgICAgIHVzZXI6IHJlcXVlc3QudXNlcixcbiAgICAgIH07XG4gICAgfVxuICApO1xuXG4gIC8vIERlbW8gcm91dGUgc2hvd2luZyBDQVNMIG1pZGRsZXdhcmUgLSBSZXF1aXJlIGFueSBvZiB0aGUgc3BlY2lmaWVkIGFiaWxpdGllc1xuICBmYXN0aWZ5LmdldChcbiAgICBcIi9yZXF1aXJlLWFueS1wYXRpZW50LWFiaWxpdGllc1wiLFxuICAgIHtcbiAgICAgIHByZUhhbmRsZXI6IFtcbiAgICAgICAgcmVxdWlyZUFueUNhc2xBYmlsaXR5KFxuICAgICAgICAgIFtBQ1RJT05TLlZJRVcsIEFDVElPTlMuQ1JFQVRFLCBBQ1RJT05TLlVQREFURV0sXG4gICAgICAgICAgU1VCSkVDVFMuUEFUSUVOVFxuICAgICAgICApLFxuICAgICAgXSxcbiAgICB9LFxuICAgIGFzeW5jIChyZXF1ZXN0LCByZXBseSkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgIG1lc3NhZ2U6IFwiQ0FTTCBNaWRkbGV3YXJlOiBVc2VyIGhhcyBhdCBsZWFzdCBvbmUgcGF0aWVudC1yZWxhdGVkIGFiaWxpdHlcIixcbiAgICAgICAgdXNlcjogcmVxdWVzdC51c2VyLFxuICAgICAgfTtcbiAgICB9XG4gICk7XG5cbiAgLy8gRGVtbyByb3V0ZSBzaG93aW5nIENBU0wgbWlkZGxld2FyZSAtIFJlcXVpcmUgYWxsIG9mIHRoZSBzcGVjaWZpZWQgYWJpbGl0aWVzXG4gIGZhc3RpZnkuZ2V0KFxuICAgIFwiL3JlcXVpcmUtYWxsLXBhdGllbnQtYWJpbGl0aWVzXCIsXG4gICAge1xuICAgICAgcHJlSGFuZGxlcjogW1xuICAgICAgICByZXF1aXJlQWxsQ2FzbEFiaWxpdGllcyhbQUNUSU9OUy5WSUVXLCBBQ1RJT05TLkNSRUFURV0sIFNVQkpFQ1RTLlBBVElFTlQpLFxuICAgICAgXSxcbiAgICB9LFxuICAgIGFzeW5jIChyZXF1ZXN0LCByZXBseSkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgIG1lc3NhZ2U6XG4gICAgICAgICAgXCJDQVNMIE1pZGRsZXdhcmU6IFVzZXIgaGFzIGFsbCByZXF1aXJlZCBwYXRpZW50LXJlbGF0ZWQgYWJpbGl0aWVzXCIsXG4gICAgICAgIHVzZXI6IHJlcXVlc3QudXNlcixcbiAgICAgIH07XG4gICAgfVxuICApO1xuXG4gIC8vIERlbW8gcm91dGUgc2hvd2luZyBtYW51YWwgQ0FTTCBjaGVja1xuICBmYXN0aWZ5LmdldChcIi9tYW51YWwtY2hlY2tcIiwgYXN5bmMgKHJlcXVlc3QsIHJlcGx5KSA9PiB7XG4gICAgY29uc3QgY2FuVmlld1BhdGllbnRzID0gY2FuVXNlcihyZXF1ZXN0LnVzZXIsIEFDVElPTlMuVklFVywgU1VCSkVDVFMuUEFUSUVOVCk7XG4gICAgY29uc3QgY2FuQ3JlYXRlUGF0aWVudHMgPSBjYW5Vc2VyKHJlcXVlc3QudXNlciwgQUNUSU9OUy5DUkVBVEUsIFNVQkpFQ1RTLlBBVElFTlQpO1xuICAgIGNvbnN0IGNhbkRlbGV0ZVBhdGllbnRzID0gY2FuVXNlcihyZXF1ZXN0LnVzZXIsIEFDVElPTlMuREVMRVRFLCBTVUJKRUNUUy5QQVRJRU5UKTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdGF0dXM6IDIwMCxcbiAgICAgIG1lc3NhZ2U6IFwiTWFudWFsIENBU0wgYWJpbGl0eSBjaGVja3NcIixcbiAgICAgIHVzZXI6IHJlcXVlc3QudXNlcixcbiAgICAgIGFiaWxpdGllczoge1xuICAgICAgICBjYW5WaWV3UGF0aWVudHMsXG4gICAgICAgIGNhbkNyZWF0ZVBhdGllbnRzLFxuICAgICAgICBjYW5EZWxldGVQYXRpZW50cyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfSk7XG5cbiAgLy8gRGVtbyByb3V0ZSBzaG93aW5nIGFkbWluLW9ubHkgYWNjZXNzIHdpdGggQ0FTTFxuICBmYXN0aWZ5LmdldChcbiAgICBcIi9hZG1pbi1vbmx5XCIsXG4gICAge1xuICAgICAgcHJlSGFuZGxlcjogW3JlcXVpcmVDYXNsQWJpbGl0eShBQ1RJT05TLk1BTkFHRSwgU1VCSkVDVFMuQUxMKV0sXG4gICAgfSxcbiAgICBhc3luYyAocmVxdWVzdCwgcmVwbHkpID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICBtZXNzYWdlOiBcIkNBU0wgTWlkZGxld2FyZTogQWRtaW4tb25seSBhY2Nlc3MgZ3JhbnRlZFwiLFxuICAgICAgICB1c2VyOiByZXF1ZXN0LnVzZXIsXG4gICAgICB9O1xuICAgIH1cbiAgKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2FzbERlbW9Sb3V0ZXM7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQWVZO0lBQUFBLGNBQUEsWUFBQUEsQ0FBQTtNQUFBLE9B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