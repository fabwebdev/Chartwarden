{"version":3,"names":["cov_17rbmedawu","actualCoverage","authenticate","injectCaslAbility","requireCaslAbility","requireAnyCaslAbility","requireAllCaslAbilities","ACTIONS","SUBJECTS","canUser","caslDemoRoutes","fastify","options","f","s","addHook","get","request","reply","canView","ability","can","VIEW","PATIENT","status","message","b","user","canCreate","CREATE","preHandler","UPDATE","canViewPatients","canCreatePatients","canDeletePatients","DELETE","abilities","MANAGE","ALL"],"sources":["casl-demo.routes.js"],"sourcesContent":["import { authenticate } from \"../middleware/betterAuth.middleware.js\";\nimport {\n  injectCaslAbility,\n  requireCaslAbility,\n  requireAnyCaslAbility,\n  requireAllCaslAbilities,\n} from \"../middleware/casl.middleware.js\";\nimport { ACTIONS, SUBJECTS, canUser } from \"../config/casl.js\";\n\n// Fastify plugin for CASL demo routes\nasync function caslDemoRoutes(fastify, options) {\n  // Apply authentication middleware to all routes in this plugin\n  fastify.addHook(\"onRequest\", authenticate);\n  \n  // Inject CASL abilities into the request object\n  fastify.addHook(\"onRequest\", injectCaslAbility);\n\n  // Demo route showing CASL ability check - Check if user can view patients\n  fastify.get(\"/can-view-patients\", async (request, reply) => {\n    const canView = request.ability.can(ACTIONS.VIEW, SUBJECTS.PATIENT);\n    return {\n      status: 200,\n      message: `User ${canView ? \"can\" : \"cannot\"} view patients`,\n      user: request.user,\n      canView,\n    };\n  });\n\n  // Demo route showing CASL ability check - Check if user can create patients\n  fastify.get(\"/can-create-patients\", async (request, reply) => {\n    const canCreate = request.ability.can(ACTIONS.CREATE, SUBJECTS.PATIENT);\n    return {\n      status: 200,\n      message: `User ${canCreate ? \"can\" : \"cannot\"} create patients`,\n      user: request.user,\n      canCreate,\n    };\n  });\n\n  // Demo route showing CASL middleware - Require ability to view patients\n  fastify.get(\n    \"/require-view-patients\",\n    {\n      preHandler: [requireCaslAbility(ACTIONS.VIEW, SUBJECTS.PATIENT)],\n    },\n    async (request, reply) => {\n      return {\n        status: 200,\n        message: \"CASL Middleware: User can view patients\",\n        user: request.user,\n      };\n    }\n  );\n\n  // Demo route showing CASL middleware - Require ability to create patients\n  fastify.get(\n    \"/require-create-patients\",\n    {\n      preHandler: [requireCaslAbility(ACTIONS.CREATE, SUBJECTS.PATIENT)],\n    },\n    async (request, reply) => {\n      return {\n        status: 200,\n        message: \"CASL Middleware: User can create patients\",\n        user: request.user,\n      };\n    }\n  );\n\n  // Demo route showing CASL middleware - Require any of the specified abilities\n  fastify.get(\n    \"/require-any-patient-abilities\",\n    {\n      preHandler: [\n        requireAnyCaslAbility(\n          [ACTIONS.VIEW, ACTIONS.CREATE, ACTIONS.UPDATE],\n          SUBJECTS.PATIENT\n        ),\n      ],\n    },\n    async (request, reply) => {\n      return {\n        status: 200,\n        message: \"CASL Middleware: User has at least one patient-related ability\",\n        user: request.user,\n      };\n    }\n  );\n\n  // Demo route showing CASL middleware - Require all of the specified abilities\n  fastify.get(\n    \"/require-all-patient-abilities\",\n    {\n      preHandler: [\n        requireAllCaslAbilities([ACTIONS.VIEW, ACTIONS.CREATE], SUBJECTS.PATIENT),\n      ],\n    },\n    async (request, reply) => {\n      return {\n        status: 200,\n        message:\n          \"CASL Middleware: User has all required patient-related abilities\",\n        user: request.user,\n      };\n    }\n  );\n\n  // Demo route showing manual CASL check\n  fastify.get(\"/manual-check\", async (request, reply) => {\n    const canViewPatients = canUser(request.user, ACTIONS.VIEW, SUBJECTS.PATIENT);\n    const canCreatePatients = canUser(request.user, ACTIONS.CREATE, SUBJECTS.PATIENT);\n    const canDeletePatients = canUser(request.user, ACTIONS.DELETE, SUBJECTS.PATIENT);\n\n    return {\n      status: 200,\n      message: \"Manual CASL ability checks\",\n      user: request.user,\n      abilities: {\n        canViewPatients,\n        canCreatePatients,\n        canDeletePatients,\n      },\n    };\n  });\n\n  // Demo route showing admin-only access with CASL\n  fastify.get(\n    \"/admin-only\",\n    {\n      preHandler: [requireCaslAbility(ACTIONS.MANAGE, SUBJECTS.ALL)],\n    },\n    async (request, reply) => {\n      return {\n        status: 200,\n        message: \"CASL Middleware: Admin-only access granted\",\n        user: request.user,\n      };\n    }\n  );\n}\n\nexport default caslDemoRoutes;\n"],"mappings":"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","ignoreList":[]}