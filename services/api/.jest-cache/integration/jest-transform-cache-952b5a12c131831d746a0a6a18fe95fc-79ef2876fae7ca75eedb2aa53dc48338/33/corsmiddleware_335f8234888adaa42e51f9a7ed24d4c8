45dca3a423d39745f6de48ff984c9f3a
/* istanbul ignore next */
function cov_tmikkfwnz() {
  var path = "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/middleware/cors.middleware.js";
  var hash = "927e5fc920e31140ab88f0582df3f4f0822634bb";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/middleware/cors.middleware.js",
    statementMap: {
      "0": {
        start: {
          line: 6,
          column: 23
        },
        end: {
          line: 78,
          column: 1
        }
      },
      "1": {
        start: {
          line: 8,
          column: 17
        },
        end: {
          line: 8,
          column: 39
        }
      },
      "2": {
        start: {
          line: 11,
          column: 18
        },
        end: {
          line: 11,
          column: 23
        }
      },
      "3": {
        start: {
          line: 13,
          column: 2
        },
        end: {
          line: 26,
          column: 3
        }
      },
      "4": {
        start: {
          line: 14,
          column: 4
        },
        end: {
          line: 14,
          column: 21
        }
      },
      "5": {
        start: {
          line: 15,
          column: 9
        },
        end: {
          line: 26,
          column: 3
        }
      },
      "6": {
        start: {
          line: 16,
          column: 4
        },
        end: {
          line: 16,
          column: 21
        }
      },
      "7": {
        start: {
          line: 19,
          column: 4
        },
        end: {
          line: 25,
          column: 5
        }
      },
      "8": {
        start: {
          line: 20,
          column: 20
        },
        end: {
          line: 20,
          column: 39
        }
      },
      "9": {
        start: {
          line: 21,
          column: 6
        },
        end: {
          line: 24,
          column: 7
        }
      },
      "10": {
        start: {
          line: 22,
          column: 8
        },
        end: {
          line: 22,
          column: 25
        }
      },
      "11": {
        start: {
          line: 23,
          column: 8
        },
        end: {
          line: 23,
          column: 14
        }
      },
      "12": {
        start: {
          line: 28,
          column: 2
        },
        end: {
          line: 38,
          column: 3
        }
      },
      "13": {
        start: {
          line: 29,
          column: 4
        },
        end: {
          line: 29,
          column: 56
        }
      },
      "14": {
        start: {
          line: 30,
          column: 9
        },
        end: {
          line: 38,
          column: 3
        }
      },
      "15": {
        start: {
          line: 33,
          column: 4
        },
        end: {
          line: 37,
          column: 5
        }
      },
      "16": {
        start: {
          line: 34,
          column: 6
        },
        end: {
          line: 34,
          column: 58
        }
      },
      "17": {
        start: {
          line: 36,
          column: 6
        },
        end: {
          line: 36,
          column: 65
        }
      },
      "18": {
        start: {
          line: 41,
          column: 2
        },
        end: {
          line: 44,
          column: 4
        }
      },
      "19": {
        start: {
          line: 45,
          column: 2
        },
        end: {
          line: 48,
          column: 4
        }
      },
      "20": {
        start: {
          line: 51,
          column: 2
        },
        end: {
          line: 77,
          column: 3
        }
      },
      "21": {
        start: {
          line: 52,
          column: 4
        },
        end: {
          line: 61,
          column: 5
        }
      },
      "22": {
        start: {
          line: 53,
          column: 6
        },
        end: {
          line: 53,
          column: 58
        }
      },
      "23": {
        start: {
          line: 54,
          column: 11
        },
        end: {
          line: 61,
          column: 5
        }
      },
      "24": {
        start: {
          line: 56,
          column: 6
        },
        end: {
          line: 60,
          column: 7
        }
      },
      "25": {
        start: {
          line: 57,
          column: 8
        },
        end: {
          line: 57,
          column: 60
        }
      },
      "26": {
        start: {
          line: 59,
          column: 8
        },
        end: {
          line: 59,
          column: 67
        }
      },
      "27": {
        start: {
          line: 62,
          column: 4
        },
        end: {
          line: 65,
          column: 6
        }
      },
      "28": {
        start: {
          line: 66,
          column: 4
        },
        end: {
          line: 69,
          column: 6
        }
      },
      "29": {
        start: {
          line: 70,
          column: 4
        },
        end: {
          line: 70,
          column: 73
        }
      },
      "30": {
        start: {
          line: 71,
          column: 4
        },
        end: {
          line: 74,
          column: 6
        }
      },
      "31": {
        start: {
          line: 76,
          column: 4
        },
        end: {
          line: 76,
          column: 34
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 6,
            column: 23
          },
          end: {
            line: 6,
            column: 24
          }
        },
        loc: {
          start: {
            line: 6,
            column: 49
          },
          end: {
            line: 78,
            column: 1
          }
        },
        line: 6
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 13,
            column: 2
          },
          end: {
            line: 26,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 13,
            column: 2
          },
          end: {
            line: 26,
            column: 3
          }
        }, {
          start: {
            line: 15,
            column: 9
          },
          end: {
            line: 26,
            column: 3
          }
        }],
        line: 13
      },
      "1": {
        loc: {
          start: {
            line: 15,
            column: 9
          },
          end: {
            line: 26,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 15,
            column: 9
          },
          end: {
            line: 26,
            column: 3
          }
        }, {
          start: {
            line: 17,
            column: 9
          },
          end: {
            line: 26,
            column: 3
          }
        }],
        line: 15
      },
      "2": {
        loc: {
          start: {
            line: 21,
            column: 6
          },
          end: {
            line: 24,
            column: 7
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 21,
            column: 6
          },
          end: {
            line: 24,
            column: 7
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 21
      },
      "3": {
        loc: {
          start: {
            line: 28,
            column: 2
          },
          end: {
            line: 38,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 28,
            column: 2
          },
          end: {
            line: 38,
            column: 3
          }
        }, {
          start: {
            line: 30,
            column: 9
          },
          end: {
            line: 38,
            column: 3
          }
        }],
        line: 28
      },
      "4": {
        loc: {
          start: {
            line: 30,
            column: 9
          },
          end: {
            line: 38,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 30,
            column: 9
          },
          end: {
            line: 38,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 30
      },
      "5": {
        loc: {
          start: {
            line: 33,
            column: 4
          },
          end: {
            line: 37,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 33,
            column: 4
          },
          end: {
            line: 37,
            column: 5
          }
        }, {
          start: {
            line: 35,
            column: 11
          },
          end: {
            line: 37,
            column: 5
          }
        }],
        line: 33
      },
      "6": {
        loc: {
          start: {
            line: 33,
            column: 8
          },
          end: {
            line: 33,
            column: 48
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 33,
            column: 8
          },
          end: {
            line: 33,
            column: 38
          }
        }, {
          start: {
            line: 33,
            column: 42
          },
          end: {
            line: 33,
            column: 48
          }
        }],
        line: 33
      },
      "7": {
        loc: {
          start: {
            line: 36,
            column: 50
          },
          end: {
            line: 36,
            column: 63
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 36,
            column: 50
          },
          end: {
            line: 36,
            column: 56
          }
        }, {
          start: {
            line: 36,
            column: 60
          },
          end: {
            line: 36,
            column: 63
          }
        }],
        line: 36
      },
      "8": {
        loc: {
          start: {
            line: 51,
            column: 2
          },
          end: {
            line: 77,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 51,
            column: 2
          },
          end: {
            line: 77,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 51
      },
      "9": {
        loc: {
          start: {
            line: 52,
            column: 4
          },
          end: {
            line: 61,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 52,
            column: 4
          },
          end: {
            line: 61,
            column: 5
          }
        }, {
          start: {
            line: 54,
            column: 11
          },
          end: {
            line: 61,
            column: 5
          }
        }],
        line: 52
      },
      "10": {
        loc: {
          start: {
            line: 54,
            column: 11
          },
          end: {
            line: 61,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 54,
            column: 11
          },
          end: {
            line: 61,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 54
      },
      "11": {
        loc: {
          start: {
            line: 56,
            column: 6
          },
          end: {
            line: 60,
            column: 7
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 56,
            column: 6
          },
          end: {
            line: 60,
            column: 7
          }
        }, {
          start: {
            line: 58,
            column: 13
          },
          end: {
            line: 60,
            column: 7
          }
        }],
        line: 56
      },
      "12": {
        loc: {
          start: {
            line: 56,
            column: 10
          },
          end: {
            line: 56,
            column: 50
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 56,
            column: 10
          },
          end: {
            line: 56,
            column: 40
          }
        }, {
          start: {
            line: 56,
            column: 44
          },
          end: {
            line: 56,
            column: 50
          }
        }],
        line: 56
      },
      "13": {
        loc: {
          start: {
            line: 59,
            column: 52
          },
          end: {
            line: 59,
            column: 65
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 59,
            column: 52
          },
          end: {
            line: 59,
            column: 58
          }
        }, {
          start: {
            line: 59,
            column: 62
          },
          end: {
            line: 59,
            column: 65
          }
        }],
        line: 59
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0
    },
    f: {
      "0": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0],
      "13": [0, 0]
    },
    inputSourceMap: null,
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "927e5fc920e31140ab88f0582df3f4f0822634bb"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_tmikkfwnz = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_tmikkfwnz();
import corsConfig from "../config/cors.config.js";

/**
 * CORS middleware that matches Laravel's CORS configuration for Fastify
 */
/* istanbul ignore next */
cov_tmikkfwnz().s[0]++;
const corsMiddleware = async (request, reply) => {
  /* istanbul ignore next */
  cov_tmikkfwnz().f[0]++;
  // Set CORS headers
  const origin =
  /* istanbul ignore next */
  (cov_tmikkfwnz().s[1]++, request.headers.origin);

  // Check if origin is allowed
  let isAllowed =
  /* istanbul ignore next */
  (cov_tmikkfwnz().s[2]++, false);
  /* istanbul ignore next */
  cov_tmikkfwnz().s[3]++;
  if (corsConfig.allowedOrigins.includes("*")) {
    /* istanbul ignore next */
    cov_tmikkfwnz().b[0][0]++;
    cov_tmikkfwnz().s[4]++;
    isAllowed = true;
  } else {
    /* istanbul ignore next */
    cov_tmikkfwnz().b[0][1]++;
    cov_tmikkfwnz().s[5]++;
    if (corsConfig.allowedOrigins.includes(origin)) {
      /* istanbul ignore next */
      cov_tmikkfwnz().b[1][0]++;
      cov_tmikkfwnz().s[6]++;
      isAllowed = true;
    } else {
      /* istanbul ignore next */
      cov_tmikkfwnz().b[1][1]++;
      cov_tmikkfwnz().s[7]++;
      // Check origin patterns
      for (const pattern of corsConfig.allowedOriginsPatterns) {
        const regex =
        /* istanbul ignore next */
        (cov_tmikkfwnz().s[8]++, new RegExp(pattern));
        /* istanbul ignore next */
        cov_tmikkfwnz().s[9]++;
        if (regex.test(origin)) {
          /* istanbul ignore next */
          cov_tmikkfwnz().b[2][0]++;
          cov_tmikkfwnz().s[10]++;
          isAllowed = true;
          /* istanbul ignore next */
          cov_tmikkfwnz().s[11]++;
          break;
        } else
        /* istanbul ignore next */
        {
          cov_tmikkfwnz().b[2][1]++;
        }
      }
    }
  }
  /* istanbul ignore next */
  cov_tmikkfwnz().s[12]++;
  if (isAllowed) {
    /* istanbul ignore next */
    cov_tmikkfwnz().b[3][0]++;
    cov_tmikkfwnz().s[13]++;
    reply.header("Access-Control-Allow-Origin", origin);
  } else {
    /* istanbul ignore next */
    cov_tmikkfwnz().b[3][1]++;
    cov_tmikkfwnz().s[14]++;
    if (corsConfig.allowedOrigins.includes("*")) {
      /* istanbul ignore next */
      cov_tmikkfwnz().b[4][0]++;
      cov_tmikkfwnz().s[15]++;
      // If wildcard is allowed and credentials are required, use the specific origin
      // Wildcard (*) cannot be used with credentials: true
      if (
      /* istanbul ignore next */
      (cov_tmikkfwnz().b[6][0]++, corsConfig.supportsCredentials) &&
      /* istanbul ignore next */
      (cov_tmikkfwnz().b[6][1]++, origin)) {
        /* istanbul ignore next */
        cov_tmikkfwnz().b[5][0]++;
        cov_tmikkfwnz().s[16]++;
        reply.header("Access-Control-Allow-Origin", origin);
      } else {
        /* istanbul ignore next */
        cov_tmikkfwnz().b[5][1]++;
        cov_tmikkfwnz().s[17]++;
        reply.header("Access-Control-Allow-Origin",
        /* istanbul ignore next */
        (cov_tmikkfwnz().b[7][0]++, origin) ||
        /* istanbul ignore next */
        (cov_tmikkfwnz().b[7][1]++, "*"));
      }
    } else
    /* istanbul ignore next */
    {
      cov_tmikkfwnz().b[4][1]++;
    }
  }

  // Set other CORS headers
  /* istanbul ignore next */
  cov_tmikkfwnz().s[18]++;
  reply.header("Access-Control-Allow-Credentials", corsConfig.supportsCredentials.toString());
  /* istanbul ignore next */
  cov_tmikkfwnz().s[19]++;
  reply.header("Access-Control-Expose-Headers", corsConfig.exposedHeaders.join(", "));

  // Handle preflight requests
  /* istanbul ignore next */
  cov_tmikkfwnz().s[20]++;
  if (request.method === "OPTIONS") {
    /* istanbul ignore next */
    cov_tmikkfwnz().b[8][0]++;
    cov_tmikkfwnz().s[21]++;
    if (isAllowed) {
      /* istanbul ignore next */
      cov_tmikkfwnz().b[9][0]++;
      cov_tmikkfwnz().s[22]++;
      reply.header("Access-Control-Allow-Origin", origin);
    } else {
      /* istanbul ignore next */
      cov_tmikkfwnz().b[9][1]++;
      cov_tmikkfwnz().s[23]++;
      if (corsConfig.allowedOrigins.includes("*")) {
        /* istanbul ignore next */
        cov_tmikkfwnz().b[10][0]++;
        cov_tmikkfwnz().s[24]++;
        // If wildcard is allowed and credentials are required, use the specific origin
        if (
        /* istanbul ignore next */
        (cov_tmikkfwnz().b[12][0]++, corsConfig.supportsCredentials) &&
        /* istanbul ignore next */
        (cov_tmikkfwnz().b[12][1]++, origin)) {
          /* istanbul ignore next */
          cov_tmikkfwnz().b[11][0]++;
          cov_tmikkfwnz().s[25]++;
          reply.header("Access-Control-Allow-Origin", origin);
        } else {
          /* istanbul ignore next */
          cov_tmikkfwnz().b[11][1]++;
          cov_tmikkfwnz().s[26]++;
          reply.header("Access-Control-Allow-Origin",
          /* istanbul ignore next */
          (cov_tmikkfwnz().b[13][0]++, origin) ||
          /* istanbul ignore next */
          (cov_tmikkfwnz().b[13][1]++, "*"));
        }
      } else
      /* istanbul ignore next */
      {
        cov_tmikkfwnz().b[10][1]++;
      }
    }
    /* istanbul ignore next */
    cov_tmikkfwnz().s[27]++;
    reply.header("Access-Control-Allow-Methods", corsConfig.allowedMethods.join(", "));
    /* istanbul ignore next */
    cov_tmikkfwnz().s[28]++;
    reply.header("Access-Control-Allow-Headers", corsConfig.allowedHeaders.join(", "));
    /* istanbul ignore next */
    cov_tmikkfwnz().s[29]++;
    reply.header("Access-Control-Max-Age", corsConfig.maxAge.toString());
    /* istanbul ignore next */
    cov_tmikkfwnz().s[30]++;
    reply.header("Access-Control-Allow-Credentials", corsConfig.supportsCredentials.toString());
    /* istanbul ignore next */
    cov_tmikkfwnz().s[31]++;
    return reply.code(204).send();
  } else
  /* istanbul ignore next */
  {
    cov_tmikkfwnz().b[8][1]++;
  }
};
export default corsMiddleware;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfdG1pa2tmd256IiwiYWN0dWFsQ292ZXJhZ2UiLCJjb3JzQ29uZmlnIiwicyIsImNvcnNNaWRkbGV3YXJlIiwicmVxdWVzdCIsInJlcGx5IiwiZiIsIm9yaWdpbiIsImhlYWRlcnMiLCJpc0FsbG93ZWQiLCJhbGxvd2VkT3JpZ2lucyIsImluY2x1ZGVzIiwiYiIsInBhdHRlcm4iLCJhbGxvd2VkT3JpZ2luc1BhdHRlcm5zIiwicmVnZXgiLCJSZWdFeHAiLCJ0ZXN0IiwiaGVhZGVyIiwic3VwcG9ydHNDcmVkZW50aWFscyIsInRvU3RyaW5nIiwiZXhwb3NlZEhlYWRlcnMiLCJqb2luIiwibWV0aG9kIiwiYWxsb3dlZE1ldGhvZHMiLCJhbGxvd2VkSGVhZGVycyIsIm1heEFnZSIsImNvZGUiLCJzZW5kIl0sInNvdXJjZXMiOlsiY29ycy5taWRkbGV3YXJlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjb3JzQ29uZmlnIGZyb20gXCIuLi9jb25maWcvY29ycy5jb25maWcuanNcIjtcblxuLyoqXG4gKiBDT1JTIG1pZGRsZXdhcmUgdGhhdCBtYXRjaGVzIExhcmF2ZWwncyBDT1JTIGNvbmZpZ3VyYXRpb24gZm9yIEZhc3RpZnlcbiAqL1xuY29uc3QgY29yc01pZGRsZXdhcmUgPSBhc3luYyAocmVxdWVzdCwgcmVwbHkpID0+IHtcbiAgLy8gU2V0IENPUlMgaGVhZGVyc1xuICBjb25zdCBvcmlnaW4gPSByZXF1ZXN0LmhlYWRlcnMub3JpZ2luO1xuXG4gIC8vIENoZWNrIGlmIG9yaWdpbiBpcyBhbGxvd2VkXG4gIGxldCBpc0FsbG93ZWQgPSBmYWxzZTtcblxuICBpZiAoY29yc0NvbmZpZy5hbGxvd2VkT3JpZ2lucy5pbmNsdWRlcyhcIipcIikpIHtcbiAgICBpc0FsbG93ZWQgPSB0cnVlO1xuICB9IGVsc2UgaWYgKGNvcnNDb25maWcuYWxsb3dlZE9yaWdpbnMuaW5jbHVkZXMob3JpZ2luKSkge1xuICAgIGlzQWxsb3dlZCA9IHRydWU7XG4gIH0gZWxzZSB7XG4gICAgLy8gQ2hlY2sgb3JpZ2luIHBhdHRlcm5zXG4gICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIGNvcnNDb25maWcuYWxsb3dlZE9yaWdpbnNQYXR0ZXJucykge1xuICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKHBhdHRlcm4pO1xuICAgICAgaWYgKHJlZ2V4LnRlc3Qob3JpZ2luKSkge1xuICAgICAgICBpc0FsbG93ZWQgPSB0cnVlO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAoaXNBbGxvd2VkKSB7XG4gICAgcmVwbHkuaGVhZGVyKFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luXCIsIG9yaWdpbik7XG4gIH0gZWxzZSBpZiAoY29yc0NvbmZpZy5hbGxvd2VkT3JpZ2lucy5pbmNsdWRlcyhcIipcIikpIHtcbiAgICAvLyBJZiB3aWxkY2FyZCBpcyBhbGxvd2VkIGFuZCBjcmVkZW50aWFscyBhcmUgcmVxdWlyZWQsIHVzZSB0aGUgc3BlY2lmaWMgb3JpZ2luXG4gICAgLy8gV2lsZGNhcmQgKCopIGNhbm5vdCBiZSB1c2VkIHdpdGggY3JlZGVudGlhbHM6IHRydWVcbiAgICBpZiAoY29yc0NvbmZpZy5zdXBwb3J0c0NyZWRlbnRpYWxzICYmIG9yaWdpbikge1xuICAgICAgcmVwbHkuaGVhZGVyKFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luXCIsIG9yaWdpbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlcGx5LmhlYWRlcihcIkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpblwiLCBvcmlnaW4gfHwgXCIqXCIpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFNldCBvdGhlciBDT1JTIGhlYWRlcnNcbiAgcmVwbHkuaGVhZGVyKFxuICAgIFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctQ3JlZGVudGlhbHNcIixcbiAgICBjb3JzQ29uZmlnLnN1cHBvcnRzQ3JlZGVudGlhbHMudG9TdHJpbmcoKVxuICApO1xuICByZXBseS5oZWFkZXIoXG4gICAgXCJBY2Nlc3MtQ29udHJvbC1FeHBvc2UtSGVhZGVyc1wiLFxuICAgIGNvcnNDb25maWcuZXhwb3NlZEhlYWRlcnMuam9pbihcIiwgXCIpXG4gICk7XG5cbiAgLy8gSGFuZGxlIHByZWZsaWdodCByZXF1ZXN0c1xuICBpZiAocmVxdWVzdC5tZXRob2QgPT09IFwiT1BUSU9OU1wiKSB7XG4gICAgaWYgKGlzQWxsb3dlZCkge1xuICAgICAgcmVwbHkuaGVhZGVyKFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luXCIsIG9yaWdpbik7XG4gICAgfSBlbHNlIGlmIChjb3JzQ29uZmlnLmFsbG93ZWRPcmlnaW5zLmluY2x1ZGVzKFwiKlwiKSkge1xuICAgICAgLy8gSWYgd2lsZGNhcmQgaXMgYWxsb3dlZCBhbmQgY3JlZGVudGlhbHMgYXJlIHJlcXVpcmVkLCB1c2UgdGhlIHNwZWNpZmljIG9yaWdpblxuICAgICAgaWYgKGNvcnNDb25maWcuc3VwcG9ydHNDcmVkZW50aWFscyAmJiBvcmlnaW4pIHtcbiAgICAgICAgcmVwbHkuaGVhZGVyKFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luXCIsIG9yaWdpbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXBseS5oZWFkZXIoXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW5cIiwgb3JpZ2luIHx8IFwiKlwiKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmVwbHkuaGVhZGVyKFxuICAgICAgXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzXCIsXG4gICAgICBjb3JzQ29uZmlnLmFsbG93ZWRNZXRob2RzLmpvaW4oXCIsIFwiKVxuICAgICk7XG4gICAgcmVwbHkuaGVhZGVyKFxuICAgICAgXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzXCIsXG4gICAgICBjb3JzQ29uZmlnLmFsbG93ZWRIZWFkZXJzLmpvaW4oXCIsIFwiKVxuICAgICk7XG4gICAgcmVwbHkuaGVhZGVyKFwiQWNjZXNzLUNvbnRyb2wtTWF4LUFnZVwiLCBjb3JzQ29uZmlnLm1heEFnZS50b1N0cmluZygpKTtcbiAgICByZXBseS5oZWFkZXIoXG4gICAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LUNyZWRlbnRpYWxzXCIsXG4gICAgICBjb3JzQ29uZmlnLnN1cHBvcnRzQ3JlZGVudGlhbHMudG9TdHJpbmcoKVxuICAgICk7XG5cbiAgICByZXR1cm4gcmVwbHkuY29kZSgyMDQpLnNlbmQoKTtcbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgY29yc01pZGRsZXdhcmU7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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