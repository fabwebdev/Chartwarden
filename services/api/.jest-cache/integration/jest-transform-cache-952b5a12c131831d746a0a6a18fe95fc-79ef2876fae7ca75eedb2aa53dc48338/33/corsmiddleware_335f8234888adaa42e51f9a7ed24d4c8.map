{"version":3,"names":["cov_tmikkfwnz","actualCoverage","corsConfig","s","corsMiddleware","request","reply","f","origin","headers","isAllowed","allowedOrigins","includes","b","pattern","allowedOriginsPatterns","regex","RegExp","test","header","supportsCredentials","toString","exposedHeaders","join","method","allowedMethods","allowedHeaders","maxAge","code","send"],"sources":["cors.middleware.js"],"sourcesContent":["import corsConfig from \"../config/cors.config.js\";\n\n/**\n * CORS middleware that matches Laravel's CORS configuration for Fastify\n */\nconst corsMiddleware = async (request, reply) => {\n  // Set CORS headers\n  const origin = request.headers.origin;\n\n  // Check if origin is allowed\n  let isAllowed = false;\n\n  if (corsConfig.allowedOrigins.includes(\"*\")) {\n    isAllowed = true;\n  } else if (corsConfig.allowedOrigins.includes(origin)) {\n    isAllowed = true;\n  } else {\n    // Check origin patterns\n    for (const pattern of corsConfig.allowedOriginsPatterns) {\n      const regex = new RegExp(pattern);\n      if (regex.test(origin)) {\n        isAllowed = true;\n        break;\n      }\n    }\n  }\n\n  if (isAllowed) {\n    reply.header(\"Access-Control-Allow-Origin\", origin);\n  } else if (corsConfig.allowedOrigins.includes(\"*\")) {\n    // If wildcard is allowed and credentials are required, use the specific origin\n    // Wildcard (*) cannot be used with credentials: true\n    if (corsConfig.supportsCredentials && origin) {\n      reply.header(\"Access-Control-Allow-Origin\", origin);\n    } else {\n      reply.header(\"Access-Control-Allow-Origin\", origin || \"*\");\n    }\n  }\n\n  // Set other CORS headers\n  reply.header(\n    \"Access-Control-Allow-Credentials\",\n    corsConfig.supportsCredentials.toString()\n  );\n  reply.header(\n    \"Access-Control-Expose-Headers\",\n    corsConfig.exposedHeaders.join(\", \")\n  );\n\n  // Handle preflight requests\n  if (request.method === \"OPTIONS\") {\n    if (isAllowed) {\n      reply.header(\"Access-Control-Allow-Origin\", origin);\n    } else if (corsConfig.allowedOrigins.includes(\"*\")) {\n      // If wildcard is allowed and credentials are required, use the specific origin\n      if (corsConfig.supportsCredentials && origin) {\n        reply.header(\"Access-Control-Allow-Origin\", origin);\n      } else {\n        reply.header(\"Access-Control-Allow-Origin\", origin || \"*\");\n      }\n    }\n    reply.header(\n      \"Access-Control-Allow-Methods\",\n      corsConfig.allowedMethods.join(\", \")\n    );\n    reply.header(\n      \"Access-Control-Allow-Headers\",\n      corsConfig.allowedHeaders.join(\", \")\n    );\n    reply.header(\"Access-Control-Max-Age\", corsConfig.maxAge.toString());\n    reply.header(\n      \"Access-Control-Allow-Credentials\",\n      corsConfig.supportsCredentials.toString()\n    );\n\n    return reply.code(204).send();\n  }\n};\n\nexport default corsMiddleware;\n"],"mappings":"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","ignoreList":[]}