{"version":3,"names":["cov_13ukcknzth","actualCoverage","encryptionService","logger","ENCRYPTED_TABLES","s","encryptRequestBody","request","reply","f","shouldProcessRequest","b","tableName","extractTableName","url","includes","recordId","params","id","body","encryptFields","debug","error","message","decryptResponseData","payload","shouldProcessResponse","data","JSON","parse","decrypted","decryptData","stringify","Array","isArray","map","item","decryptFields","result","key","value","Object","entries","encryptMethods","method","contentType","headers","statusCode","getHeader","patterns","pattern","test","match","toLowerCase","encryptRecord","record","decryptRecord","encryptRecords","records","decryptRecords","registerEncryptionMiddleware","app","addHook","info"],"sources":["encryption.middleware.js"],"sourcesContent":["import encryptionService from \"../services/EncryptionService.js\";\nimport { logger } from \"../utils/logger.js\";\n\n/**\n * Encryption Middleware for HIPAA-Compliant PHI Protection\n *\n * Automatically encrypts sensitive PHI fields before database writes\n * and decrypts them after reads. This ensures data at rest is encrypted\n * while being transparent to application code.\n *\n * HIPAA Requirements:\n * - 164.312(a)(2)(iv): Encryption of ePHI at rest\n *\n * SECURITY TICKET: encryption-implementation\n */\n\n/**\n * List of tables with encrypted fields\n */\nconst ENCRYPTED_TABLES = [\"patients\"];\n\n/**\n * Fastify hook to encrypt request body fields before processing\n *\n * This hook runs on incoming requests that create or update\n * records containing PHI fields.\n */\nexport async function encryptRequestBody(request, reply) {\n  // Only process for routes that modify PHI data\n  if (!shouldProcessRequest(request)) {\n    return;\n  }\n\n  const tableName = extractTableName(request.url);\n  if (!tableName || !ENCRYPTED_TABLES.includes(tableName)) {\n    return;\n  }\n\n  try {\n    // Get record ID for AAD if updating\n    const recordId = request.params?.id || null;\n\n    // Encrypt fields in request body\n    if (request.body && typeof request.body === \"object\") {\n      request.body = encryptionService.encryptFields(\n        tableName,\n        request.body,\n        recordId\n      );\n      logger.debug(\"Encrypted PHI fields in request body\", { tableName });\n    }\n  } catch (error) {\n    logger.error(\"Failed to encrypt request body\", {\n      error: error.message,\n      tableName,\n    });\n    // Don't fail the request - let it continue without encryption\n    // The error will be logged for investigation\n  }\n}\n\n/**\n * Fastify hook to decrypt response data after processing\n *\n * This hook runs on outgoing responses that contain PHI fields.\n */\nexport async function decryptResponseData(request, reply, payload) {\n  // Only process for routes that return PHI data\n  if (!shouldProcessResponse(request, reply)) {\n    return payload;\n  }\n\n  const tableName = extractTableName(request.url);\n  if (!tableName || !ENCRYPTED_TABLES.includes(tableName)) {\n    return payload;\n  }\n\n  try {\n    // Parse JSON payload if needed\n    let data = payload;\n    if (typeof payload === \"string\") {\n      try {\n        data = JSON.parse(payload);\n      } catch {\n        return payload; // Not JSON, return as-is\n      }\n    }\n\n    // Decrypt fields in response\n    const decrypted = decryptData(tableName, data);\n\n    // Return as JSON string if input was string\n    if (typeof payload === \"string\") {\n      return JSON.stringify(decrypted);\n    }\n    return decrypted;\n  } catch (error) {\n    logger.error(\"Failed to decrypt response data\", {\n      error: error.message,\n      tableName,\n    });\n    return payload; // Return original on error\n  }\n}\n\n/**\n * Decrypt data recursively (handles arrays and nested objects)\n *\n * @param {string} tableName - The table name for field lookup\n * @param {any} data - The data to decrypt\n * @returns {any} Decrypted data\n */\nfunction decryptData(tableName, data) {\n  if (!data) return data;\n\n  // Handle arrays\n  if (Array.isArray(data)) {\n    return data.map((item) => decryptData(tableName, item));\n  }\n\n  // Handle objects\n  if (typeof data === \"object\") {\n    // Check for standard API response structure\n    if (data.data) {\n      return {\n        ...data,\n        data: decryptData(tableName, data.data),\n      };\n    }\n\n    // Check for single record or multiple records\n    if (data.id) {\n      return encryptionService.decryptFields(tableName, data, data.id);\n    }\n\n    // Handle nested structures\n    const result = {};\n    for (const [key, value] of Object.entries(data)) {\n      if (typeof value === \"object\" && value !== null) {\n        result[key] = decryptData(tableName, value);\n      } else {\n        result[key] = value;\n      }\n    }\n    return result;\n  }\n\n  return data;\n}\n\n/**\n * Check if request should be processed for encryption\n *\n * @param {object} request - Fastify request object\n * @returns {boolean}\n */\nfunction shouldProcessRequest(request) {\n  // Only encrypt for state-changing methods\n  const encryptMethods = [\"POST\", \"PUT\", \"PATCH\"];\n  if (!encryptMethods.includes(request.method)) {\n    return false;\n  }\n\n  // Only process JSON content\n  const contentType = request.headers[\"content-type\"] || \"\";\n  if (!contentType.includes(\"application/json\")) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Check if response should be processed for decryption\n *\n * @param {object} request - Fastify request object\n * @param {object} reply - Fastify reply object\n * @returns {boolean}\n */\nfunction shouldProcessResponse(request, reply) {\n  // Only decrypt successful responses\n  if (reply.statusCode >= 400) {\n    return false;\n  }\n\n  // Only process JSON responses\n  const contentType = reply.getHeader(\"content-type\") || \"\";\n  if (!contentType.includes(\"application/json\")) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Extract table name from URL\n *\n * @param {string} url - Request URL\n * @returns {string|null} Table name or null\n */\nfunction extractTableName(url) {\n  // Match patterns like /api/patients, /api/patients/:id\n  const patterns = [\n    /\\/api\\/patients/i,\n    /\\/api\\/users/i,\n  ];\n\n  for (const pattern of patterns) {\n    if (pattern.test(url)) {\n      // Extract table name from pattern\n      const match = url.match(/\\/api\\/(\\w+)/i);\n      return match ? match[1].toLowerCase() : null;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Helper function to encrypt a single record\n * Useful for manual encryption in controllers\n *\n * @param {string} tableName - The table name\n * @param {object} record - The record to encrypt\n * @param {string|number} recordId - Optional record ID for AAD\n * @returns {object} Encrypted record\n */\nexport function encryptRecord(tableName, record, recordId = null) {\n  return encryptionService.encryptFields(tableName, record, recordId);\n}\n\n/**\n * Helper function to decrypt a single record\n * Useful for manual decryption in controllers\n *\n * @param {string} tableName - The table name\n * @param {object} record - The record to decrypt\n * @param {string|number} recordId - Optional record ID for AAD\n * @returns {object} Decrypted record\n */\nexport function decryptRecord(tableName, record, recordId = null) {\n  return encryptionService.decryptFields(tableName, record, recordId);\n}\n\n/**\n * Helper function to encrypt an array of records\n *\n * @param {string} tableName - The table name\n * @param {object[]} records - The records to encrypt\n * @returns {object[]} Encrypted records\n */\nexport function encryptRecords(tableName, records) {\n  return records.map((record) =>\n    encryptionService.encryptFields(tableName, record, record.id)\n  );\n}\n\n/**\n * Helper function to decrypt an array of records\n *\n * @param {string} tableName - The table name\n * @param {object[]} records - The records to decrypt\n * @returns {object[]} Decrypted records\n */\nexport function decryptRecords(tableName, records) {\n  return records.map((record) =>\n    encryptionService.decryptFields(tableName, record, record.id)\n  );\n}\n\n/**\n * Register encryption middleware with Fastify\n *\n * @param {object} app - Fastify instance\n */\nexport function registerEncryptionMiddleware(app) {\n  // Encrypt incoming request bodies\n  app.addHook(\"preHandler\", encryptRequestBody);\n\n  // Decrypt outgoing response bodies\n  app.addHook(\"onSend\", decryptResponseData);\n\n  logger.info(\"Encryption middleware registered for PHI protection\");\n}\n\nexport default {\n  encryptRequestBody,\n  decryptResponseData,\n  encryptRecord,\n  decryptRecord,\n  encryptRecords,\n  decryptRecords,\n  registerEncryptionMiddleware,\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}