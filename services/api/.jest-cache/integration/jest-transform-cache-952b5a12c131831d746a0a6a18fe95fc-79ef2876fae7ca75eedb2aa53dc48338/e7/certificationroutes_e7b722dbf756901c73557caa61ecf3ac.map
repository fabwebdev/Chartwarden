{"version":3,"names":["cov_1io0966kbd","actualCoverage","controller","PERMISSIONS","requireAnyPermission","validateBody","validateQuery","schemas","certificationRoutes","fastify","options","f","s","get","preHandler","VIEW_CLINICAL_NOTES","certification","list","listCertifications","bind","getPatientCertifications","post","CREATE_CLINICAL_NOTES","create","createCertification","getCertificationById","patch","UPDATE_CLINICAL_NOTES","update","updateCertification","signCertification","completeCertification","DELETE_CLINICAL_NOTES","revoke","revokeCertification","delete","deleteCertification","validateF2FForCertification","getPendingCertifications","getCertificationsDue","getCertificationsOverdue","getPatientF2F","f2f","createF2F","attestF2F","getPatientOrders","order","createOrder","signOrder"],"sources":["certification.routes.js"],"sourcesContent":["import controller from '../controllers/Certification.controller.js';\nimport { PERMISSIONS } from '../config/rbac.js';\nimport { requireAnyPermission } from '../middleware/rbac.middleware.js';\nimport { validateBody, validateQuery, schemas } from '../middleware/validation.middleware.js';\n\n/**\n * Certification Routes\n * Medicare certification periods, Face-to-Face encounters, and physician orders\n * CRITICAL: Required for Medicare reimbursement\n *\n * CMS Requirements:\n * - Initial certification within 2 days of start of care\n * - Face-to-Face encounters required for 3rd benefit period and beyond\n * - F2F must occur within 90 days before or 30 days after start of care\n * - Physician must have valid credentials (PHYSICIAN, NP, or PA)\n *\n * RESTful Endpoints:\n * - GET /certifications - List all certifications with filtering/pagination\n * - GET /certifications/:id - Retrieve specific certification details\n * - POST /patients/:id/certifications - Create new certification\n * - PATCH /certifications/:id - Update existing certification\n * - DELETE /certifications/:id - Soft delete certification\n * - POST /certifications/:id/sign - Sign certification\n * - POST /certifications/:id/complete - Mark as complete\n * - POST /certifications/:id/revoke - Revoke certification\n * - POST /certifications/:id/validate-f2f - Validate F2F requirements\n *\n * CMS Compliance Validation:\n * - Certification period types: INITIAL_90, SUBSEQUENT_90, SUBSEQUENT_60\n * - Terminal illness narrative is required\n * - Duplicate/overlapping certifications are prevented\n * - Date validation ensures proper certification windows\n * - F2F date range validation (90 days before to 30 days after)\n * - Provider credentials validation for F2F encounters\n */\nexport default async function certificationRoutes(fastify, options) {\n  // ============================================================================\n  // CERTIFICATION ROUTES\n  // ============================================================================\n\n  // List all certifications with filtering and pagination\n  // GET /certifications?status=PENDING&patient_id=123&limit=20&offset=0\n  fastify.get('/certifications', {\n    preHandler: [\n      requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES),\n      validateQuery(schemas.certification.list)\n    ]\n  }, controller.listCertifications.bind(controller));\n\n  // Get patient certifications\n  fastify.get('/patients/:id/certifications', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getPatientCertifications.bind(controller));\n\n  // Create certification with CMS validation\n  fastify.post('/patients/:id/certifications', {\n    preHandler: [\n      requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES),\n      validateBody(schemas.certification.create)\n    ]\n  }, controller.createCertification.bind(controller));\n\n  // Get single certification by ID\n  fastify.get('/certifications/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getCertificationById.bind(controller));\n\n  // Update certification (only unsigned) with validation\n  fastify.patch('/certifications/:id', {\n    preHandler: [\n      requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES),\n      validateBody(schemas.certification.update)\n    ]\n  }, controller.updateCertification.bind(controller));\n\n  // Sign certification (21 CFR Part 11 compliant)\n  fastify.post('/certifications/:id/sign', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.signCertification.bind(controller));\n\n  // Complete certification (with timeliness tracking)\n  fastify.post('/certifications/:id/complete', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.completeCertification.bind(controller));\n\n  // Revoke certification with required reason\n  fastify.post('/certifications/:id/revoke', {\n    preHandler: [\n      requireAnyPermission(PERMISSIONS.DELETE_CLINICAL_NOTES),\n      validateBody(schemas.certification.revoke)\n    ]\n  }, controller.revokeCertification.bind(controller));\n\n  // Soft delete certification\n  fastify.delete('/certifications/:id', {\n    preHandler: [\n      requireAnyPermission(PERMISSIONS.DELETE_CLINICAL_NOTES),\n      validateBody(schemas.certification.delete)\n    ]\n  }, controller.deleteCertification.bind(controller));\n\n  // Validate F2F for certification\n  fastify.post('/certifications/:id/validate-f2f', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.validateF2FForCertification.bind(controller));\n\n  // Get pending certifications (overdue)\n  fastify.get('/certifications/pending', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getPendingCertifications.bind(controller));\n\n  // Get certifications due within 30 days\n  fastify.get('/certifications/due', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getCertificationsDue.bind(controller));\n\n  // Get overdue certifications\n  fastify.get('/certifications/overdue', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getCertificationsOverdue.bind(controller));\n\n  // ============================================================================\n  // FACE-TO-FACE ENCOUNTER ROUTES\n  // CMS requires F2F within 90 days before or 30 days after start of care\n  // ============================================================================\n\n  // Get patient F2F encounters\n  fastify.get('/patients/:id/f2f', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getPatientF2F.bind(controller));\n\n  // Create F2F encounter with CMS validation\n  fastify.post('/patients/:id/f2f', {\n    preHandler: [\n      requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES),\n      validateBody(schemas.f2f.create)\n    ]\n  }, controller.createF2F.bind(controller));\n\n  // Attest F2F encounter (Hospice physician attestation)\n  fastify.post('/f2f/:id/attestation', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.attestF2F.bind(controller));\n\n  // ============================================================================\n  // ORDER ROUTES\n  // Physician orders for medications, treatments, DME, etc.\n  // ============================================================================\n\n  // Get patient orders with filtering\n  fastify.get('/patients/:id/orders', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getPatientOrders.bind(controller));\n\n  // Create order with validation\n  fastify.post('/patients/:id/orders', {\n    preHandler: [\n      requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES),\n      validateBody(schemas.order.create)\n    ]\n  }, controller.createOrder.bind(controller));\n\n  // Sign order (21 CFR Part 11 compliant)\n  fastify.post('/orders/:id/sign', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.signOrder.bind(controller));\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAfZ,OAAOE,UAAU,MAAM,4CAA4C;AACnE,SAASC,WAAW,QAAQ,mBAAmB;AAC/C,SAASC,oBAAoB,QAAQ,kCAAkC;AACvE,SAASC,YAAY,EAAEC,aAAa,EAAEC,OAAO,QAAQ,wCAAwC;;AAE7F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,eAAeC,mBAAmBA,CAACC,OAAO,EAAEC,OAAO,EAAE;EAAA;EAAAV,cAAA,GAAAW,CAAA;EAAAX,cAAA,GAAAY,CAAA;EAClE;EACA;EACA;;EAEA;EACA;EACAH,OAAO,CAACI,GAAG,CAAC,iBAAiB,EAAE;IAC7BC,UAAU,EAAE,CACVV,oBAAoB,CAACD,WAAW,CAACY,mBAAmB,CAAC,EACrDT,aAAa,CAACC,OAAO,CAACS,aAAa,CAACC,IAAI,CAAC;EAE7C,CAAC,EAAEf,UAAU,CAACgB,kBAAkB,CAACC,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAElD;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACI,GAAG,CAAC,8BAA8B,EAAE;IAC1CC,UAAU,EAAE,CAACV,oBAAoB,CAACD,WAAW,CAACY,mBAAmB,CAAC;EACpE,CAAC,EAAEb,UAAU,CAACkB,wBAAwB,CAACD,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAExD;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACY,IAAI,CAAC,8BAA8B,EAAE;IAC3CP,UAAU,EAAE,CACVV,oBAAoB,CAACD,WAAW,CAACmB,qBAAqB,CAAC,EACvDjB,YAAY,CAACE,OAAO,CAACS,aAAa,CAACO,MAAM,CAAC;EAE9C,CAAC,EAAErB,UAAU,CAACsB,mBAAmB,CAACL,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAEnD;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACI,GAAG,CAAC,qBAAqB,EAAE;IACjCC,UAAU,EAAE,CAACV,oBAAoB,CAACD,WAAW,CAACY,mBAAmB,CAAC;EACpE,CAAC,EAAEb,UAAU,CAACuB,oBAAoB,CAACN,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAEpD;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACiB,KAAK,CAAC,qBAAqB,EAAE;IACnCZ,UAAU,EAAE,CACVV,oBAAoB,CAACD,WAAW,CAACwB,qBAAqB,CAAC,EACvDtB,YAAY,CAACE,OAAO,CAACS,aAAa,CAACY,MAAM,CAAC;EAE9C,CAAC,EAAE1B,UAAU,CAAC2B,mBAAmB,CAACV,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAEnD;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACY,IAAI,CAAC,0BAA0B,EAAE;IACvCP,UAAU,EAAE,CAACV,oBAAoB,CAACD,WAAW,CAACwB,qBAAqB,CAAC;EACtE,CAAC,EAAEzB,UAAU,CAAC4B,iBAAiB,CAACX,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAEjD;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACY,IAAI,CAAC,8BAA8B,EAAE;IAC3CP,UAAU,EAAE,CAACV,oBAAoB,CAACD,WAAW,CAACwB,qBAAqB,CAAC;EACtE,CAAC,EAAEzB,UAAU,CAAC6B,qBAAqB,CAACZ,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAErD;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACY,IAAI,CAAC,4BAA4B,EAAE;IACzCP,UAAU,EAAE,CACVV,oBAAoB,CAACD,WAAW,CAAC6B,qBAAqB,CAAC,EACvD3B,YAAY,CAACE,OAAO,CAACS,aAAa,CAACiB,MAAM,CAAC;EAE9C,CAAC,EAAE/B,UAAU,CAACgC,mBAAmB,CAACf,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAEnD;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAAC0B,MAAM,CAAC,qBAAqB,EAAE;IACpCrB,UAAU,EAAE,CACVV,oBAAoB,CAACD,WAAW,CAAC6B,qBAAqB,CAAC,EACvD3B,YAAY,CAACE,OAAO,CAACS,aAAa,CAACmB,MAAM,CAAC;EAE9C,CAAC,EAAEjC,UAAU,CAACkC,mBAAmB,CAACjB,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAEnD;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACY,IAAI,CAAC,kCAAkC,EAAE;IAC/CP,UAAU,EAAE,CAACV,oBAAoB,CAACD,WAAW,CAACY,mBAAmB,CAAC;EACpE,CAAC,EAAEb,UAAU,CAACmC,2BAA2B,CAAClB,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAE3D;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACI,GAAG,CAAC,yBAAyB,EAAE;IACrCC,UAAU,EAAE,CAACV,oBAAoB,CAACD,WAAW,CAACY,mBAAmB,CAAC;EACpE,CAAC,EAAEb,UAAU,CAACoC,wBAAwB,CAACnB,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAExD;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACI,GAAG,CAAC,qBAAqB,EAAE;IACjCC,UAAU,EAAE,CAACV,oBAAoB,CAACD,WAAW,CAACY,mBAAmB,CAAC;EACpE,CAAC,EAAEb,UAAU,CAACqC,oBAAoB,CAACpB,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAEpD;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACI,GAAG,CAAC,yBAAyB,EAAE;IACrCC,UAAU,EAAE,CAACV,oBAAoB,CAACD,WAAW,CAACY,mBAAmB,CAAC;EACpE,CAAC,EAAEb,UAAU,CAACsC,wBAAwB,CAACrB,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAExD;EACA;EACA;EACA;;EAEA;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACI,GAAG,CAAC,mBAAmB,EAAE;IAC/BC,UAAU,EAAE,CAACV,oBAAoB,CAACD,WAAW,CAACY,mBAAmB,CAAC;EACpE,CAAC,EAAEb,UAAU,CAACuC,aAAa,CAACtB,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAE7C;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACY,IAAI,CAAC,mBAAmB,EAAE;IAChCP,UAAU,EAAE,CACVV,oBAAoB,CAACD,WAAW,CAACmB,qBAAqB,CAAC,EACvDjB,YAAY,CAACE,OAAO,CAACmC,GAAG,CAACnB,MAAM,CAAC;EAEpC,CAAC,EAAErB,UAAU,CAACyC,SAAS,CAACxB,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAEzC;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACY,IAAI,CAAC,sBAAsB,EAAE;IACnCP,UAAU,EAAE,CAACV,oBAAoB,CAACD,WAAW,CAACwB,qBAAqB,CAAC;EACtE,CAAC,EAAEzB,UAAU,CAAC0C,SAAS,CAACzB,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAEzC;EACA;EACA;EACA;;EAEA;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACI,GAAG,CAAC,sBAAsB,EAAE;IAClCC,UAAU,EAAE,CAACV,oBAAoB,CAACD,WAAW,CAACY,mBAAmB,CAAC;EACpE,CAAC,EAAEb,UAAU,CAAC2C,gBAAgB,CAAC1B,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAEhD;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACY,IAAI,CAAC,sBAAsB,EAAE;IACnCP,UAAU,EAAE,CACVV,oBAAoB,CAACD,WAAW,CAACmB,qBAAqB,CAAC,EACvDjB,YAAY,CAACE,OAAO,CAACuC,KAAK,CAACvB,MAAM,CAAC;EAEtC,CAAC,EAAErB,UAAU,CAAC6C,WAAW,CAAC5B,IAAI,CAACjB,UAAU,CAAC,CAAC;;EAE3C;EAAA;EAAAF,cAAA,GAAAY,CAAA;EACAH,OAAO,CAACY,IAAI,CAAC,kBAAkB,EAAE;IAC/BP,UAAU,EAAE,CAACV,oBAAoB,CAACD,WAAW,CAACwB,qBAAqB,CAAC;EACtE,CAAC,EAAEzB,UAAU,CAAC8C,SAAS,CAAC7B,IAAI,CAACjB,UAAU,CAAC,CAAC;AAC3C","ignoreList":[]}