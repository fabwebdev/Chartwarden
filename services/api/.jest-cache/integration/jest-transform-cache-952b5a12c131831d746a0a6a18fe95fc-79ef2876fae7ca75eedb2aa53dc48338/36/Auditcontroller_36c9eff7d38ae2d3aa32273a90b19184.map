{"version":3,"names":["cov_22kmel4ph2","actualCoverage","AuditService","authenticate","requireRole","ROLES","logger","s","getAuditLogs","request","reply","f","page","b","limit","userId","action","tableName","startDate","endDate","query","filters","result","parseInt","status","data","error","code","message","getUserAuditLogs","user","id","getAuditLogById","params","auditLog"],"sources":["Audit.controller.js"],"sourcesContent":["import AuditService from '../services/AuditService.js';\nimport { authenticate } from '../middleware/betterAuth.middleware.js';\nimport { requireRole } from '../middleware/rbac.middleware.js';\nimport { ROLES } from '../config/rbac.js';\n\nimport { logger } from '../utils/logger.js';\n/**\n * Get audit logs\n * @param {Object} request - Fastify request object\n * @param {Object} reply - Fastify reply object\n */\nexport const getAuditLogs = async (request, reply) => {\n  try {\n    const { page = 1, limit = 20, userId, action, tableName, startDate, endDate } = request.query;\n    \n    const filters = {};\n    if (userId) filters.userId = userId;\n    if (action) filters.action = action;\n    if (tableName) filters.tableName = tableName;\n    if (startDate) filters.startDate = startDate;\n    if (endDate) filters.endDate = endDate;\n    \n    const result = await AuditService.getAuditLogs(filters, parseInt(page), parseInt(limit));\n    \n    return {\n      status: 200,\n      data: result\n    };\n  } catch (error) {\n    logger.error('Get audit logs error:', error)\n    reply.code(500);\n            return {\n      status: 500,\n      message: 'Server error while fetching audit logs'\n    };\n  }\n};\n\n/**\n * Get audit logs for current user\n * @param {Object} request - Fastify request object\n * @param {Object} reply - Fastify reply object\n */\nexport const getUserAuditLogs = async (request, reply) => {\n  try {\n    const { page = 1, limit = 20 } = request.query;\n    \n    const result = await AuditService.getUserAuditLogs(request.user.id, parseInt(page), parseInt(limit));\n    \n    return {\n      status: 200,\n      data: result\n    };\n  } catch (error) {\n    logger.error('Get user audit logs error:', error)\n    reply.code(500);\n            return {\n      status: 500,\n      message: 'Server error while fetching user audit logs'\n    };\n  }\n};\n\n/**\n * Get audit log by ID\n * @param {Object} request - Fastify request object\n * @param {Object} reply - Fastify reply object\n */\nexport const getAuditLogById = async (request, reply) => {\n  try {\n    const { id } = request.params;\n    \n    const auditLog = await AuditService.getAuditLogById(id);\n    \n    if (!auditLog) {\n      reply.code(404);\n            return {\n        status: 404,\n        message: 'Audit log not found'\n      };\n    }\n    \n    return {\n      status: 200,\n      data: {\n        auditLog\n      }\n    };\n  } catch (error) {\n    logger.error('Get audit log by ID error:', error)\n    reply.code(500);\n            return {\n      status: 500,\n      message: 'Server error while fetching audit log'\n    };\n  }\n};\n"],"mappings":"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","ignoreList":[]}