{"version":3,"names":["cov_1sjhbgdu8f","actualCoverage","db","admission_information","eq","logAudit","logger","s","index","request","reply","f","admissionInfo","select","id","patient_id","admission_date","discharge_date","admitting_physician","reason_for_admission","current_status","createdAt","updatedAt","from","error","code","message","autoSave","admissionData","body","existingAdmissionInfo","where","limit","result","action","now","Date","b","updateData","undefined","created_at","updated_at","update","set","returning","newData","insert","values","data","show","params","info","parseInt"],"sources":["AdmissionInformation.controller.js"],"sourcesContent":["// Note: express-validator replaced with Fastify schema validation\nimport { db } from \"../../config/db.drizzle.js\";\nimport { admission_information } from \"../../db/schemas/admissionInformation.schema.js\";\nimport { eq } from \"drizzle-orm\";\nimport { logAudit } from \"../../middleware/audit.middleware.js\";\n\nimport { logger } from '../../utils/logger.js';\n// Get all admission information\nexport const index = async (request, reply) => {\n    try {\n        const admissionInfo = await db.select({\n            id: admission_information.id,\n            patient_id: admission_information.patient_id,\n            admission_date: admission_information.admission_date,\n            discharge_date: admission_information.discharge_date,\n            admitting_physician: admission_information.admitting_physician,\n            reason_for_admission: admission_information.reason_for_admission,\n            current_status: admission_information.current_status,\n            createdAt: admission_information.createdAt,\n            updatedAt: admission_information.updatedAt,\n        }).from(admission_information);\n\n        // Log audit - READ operation on admission_information table\n        await logAudit(request, 'READ', 'admission_information', null);\n\n        return admissionInfo;\n    } catch (error) {\n        logger.error(\"Error in index:\", error)\n        reply.code(500);\n            return { message: \"Server error\" };\n    }\n};\n\n// Auto save admission information\nexport const autoSave = async (request, reply) => {\n    try {\n        // Note: Validation should be done in route definition using Fastify schema\n        const admissionData = request.body;\n\n        // Check if admission information already exists for this patient\n        const existingAdmissionInfo = await db.select({ id: admission_information.id }).from(admission_information)\n            .where(eq(admission_information.patient_id, admissionData.patient_id))\n            .limit(1);\n        const admissionInfo = existingAdmissionInfo[0];\n\n        let result;\n        let action;\n        const now = new Date();\n        if (admissionInfo) {\n            // Update existing record\n            const updateData = {\n                ...admissionData,\n                createdAt: undefined, // prevent overwriting\n                created_at: undefined,\n                updatedAt: now,\n                updated_at: now,\n            };\n\n            result = await db.update(admission_information)\n                .set(updateData)\n                .where(eq(admission_information.patient_id, admissionData.patient_id))\n                .returning();\n            result = result[0];\n            action = 'UPDATE';\n        } else {\n            // Create new record\n            const newData = {\n                ...admissionData,\n                createdAt: now,\n                updatedAt: now,\n            };\n\n            result = await db.insert(admission_information)\n                .values(newData)\n                .returning();\n            result = result[0];\n            action = 'CREATE';\n        }\n\n        // Log audit - CREATE or UPDATE operation on admission_information table\n        await logAudit(request, action, 'admission_information', result.id);\n\n        reply.code(201);\n            return {\n            message: \"Admission information saved successfully.\",\n            data: result,\n        };\n    } catch (error) {\n        logger.error(\"Error in autoSave:\", error)\n        reply.code(500);\n            return { message: \"Server error\" };\n    }\n};\n\n// Get admission information by ID\nexport const show = async (request, reply) => {\n    try {\n        const { id } = request.params;\n        const admissionInfo = await db.select({\n            id: admission_information.id,\n            patient_id: admission_information.patient_id,\n            admission_date: admission_information.admission_date,\n            discharge_date: admission_information.discharge_date,\n            admitting_physician: admission_information.admitting_physician,\n            reason_for_admission: admission_information.reason_for_admission,\n            current_status: admission_information.current_status,\n            createdAt: admission_information.createdAt,\n            updatedAt: admission_information.updatedAt,\n        }).from(admission_information)\n            .where(eq(admission_information.id, id))\n            .limit(1);\n        const info = admissionInfo[0];\n\n        if (!info) {\n            reply.code(404);\n            return { error: \"Admission information not found\" };\n        }\n\n        // Log audit - READ operation on admission_information table\n        await logAudit(request, 'READ', 'admission_information', parseInt(id));\n\n        return info;\n    } catch (error) {\n        logger.error(\"Error in show:\", error)\n        reply.code(500);\n            return { message: \"Server error\" };\n    }\n};\n"],"mappings":"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","ignoreList":[]}