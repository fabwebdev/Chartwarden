8c7bc4f9926e2b536e895aa3e50214f4
/* istanbul ignore next */
function cov_21nv951r5i() {
  var path = "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/middleware/csrf.middleware.js";
  var hash = "ae21578b670521b561417891c3da2e2d46d41f3b";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/middleware/csrf.middleware.js",
    statementMap: {
      "0": {
        start: {
          line: 26,
          column: 32
        },
        end: {
          line: 40,
          column: 1
        }
      },
      "1": {
        start: {
          line: 49,
          column: 2
        },
        end: {
          line: 51,
          column: 3
        }
      },
      "2": {
        start: {
          line: 50,
          column: 4
        },
        end: {
          line: 50,
          column: 16
        }
      },
      "3": {
        start: {
          line: 54,
          column: 2
        },
        end: {
          line: 56,
          column: 3
        }
      },
      "4": {
        start: {
          line: 55,
          column: 4
        },
        end: {
          line: 55,
          column: 16
        }
      },
      "5": {
        start: {
          line: 60,
          column: 27
        },
        end: {
          line: 64,
          column: 3
        }
      },
      "6": {
        start: {
          line: 66,
          column: 2
        },
        end: {
          line: 68,
          column: 3
        }
      },
      "7": {
        start: {
          line: 66,
          column: 37
        },
        end: {
          line: 66,
          column: 58
        }
      },
      "8": {
        start: {
          line: 67,
          column: 4
        },
        end: {
          line: 67,
          column: 16
        }
      },
      "9": {
        start: {
          line: 70,
          column: 2
        },
        end: {
          line: 70,
          column: 15
        }
      },
      "10": {
        start: {
          line: 81,
          column: 2
        },
        end: {
          line: 154,
          column: 3
        }
      },
      "11": {
        start: {
          line: 83,
          column: 4
        },
        end: {
          line: 86,
          column: 5
        }
      },
      "12": {
        start: {
          line: 84,
          column: 6
        },
        end: {
          line: 84,
          column: 71
        }
      },
      "13": {
        start: {
          line: 85,
          column: 6
        },
        end: {
          line: 85,
          column: 13
        }
      },
      "14": {
        start: {
          line: 89,
          column: 4
        },
        end: {
          line: 91,
          column: 5
        }
      },
      "15": {
        start: {
          line: 90,
          column: 6
        },
        end: {
          line: 90,
          column: 13
        }
      },
      "16": {
        start: {
          line: 96,
          column: 6
        },
        end: {
          line: 100,
          column: 26
        }
      },
      "17": {
        start: {
          line: 102,
          column: 4
        },
        end: {
          line: 115,
          column: 5
        }
      },
      "18": {
        start: {
          line: 103,
          column: 6
        },
        end: {
          line: 106,
          column: 44
        }
      },
      "19": {
        start: {
          line: 108,
          column: 6
        },
        end: {
          line: 108,
          column: 22
        }
      },
      "20": {
        start: {
          line: 109,
          column: 6
        },
        end: {
          line: 114,
          column: 8
        }
      },
      "21": {
        start: {
          line: 120,
          column: 4
        },
        end: {
          line: 143,
          column: 5
        }
      },
      "22": {
        start: {
          line: 121,
          column: 6
        },
        end: {
          line: 142,
          column: 7
        }
      },
      "23": {
        start: {
          line: 122,
          column: 8
        },
        end: {
          line: 122,
          column: 60
        }
      },
      "24": {
        start: {
          line: 124,
          column: 8
        },
        end: {
          line: 127,
          column: 35
        }
      },
      "25": {
        start: {
          line: 129,
          column: 8
        },
        end: {
          line: 133,
          column: 43
        }
      },
      "26": {
        start: {
          line: 135,
          column: 8
        },
        end: {
          line: 135,
          column: 24
        }
      },
      "27": {
        start: {
          line: 136,
          column: 8
        },
        end: {
          line: 141,
          column: 10
        }
      },
      "28": {
        start: {
          line: 146,
          column: 4
        },
        end: {
          line: 146,
          column: 58
        }
      },
      "29": {
        start: {
          line: 147,
          column: 4
        },
        end: {
          line: 147,
          column: 20
        }
      },
      "30": {
        start: {
          line: 148,
          column: 4
        },
        end: {
          line: 153,
          column: 6
        }
      },
      "31": {
        start: {
          line: 170,
          column: 27
        },
        end: {
          line: 170,
          column: 61
        }
      },
      "32": {
        start: {
          line: 172,
          column: 2
        },
        end: {
          line: 174,
          column: 3
        }
      },
      "33": {
        start: {
          line: 173,
          column: 4
        },
        end: {
          line: 173,
          column: 11
        }
      },
      "34": {
        start: {
          line: 177,
          column: 2
        },
        end: {
          line: 179,
          column: 3
        }
      },
      "35": {
        start: {
          line: 178,
          column: 4
        },
        end: {
          line: 178,
          column: 11
        }
      },
      "36": {
        start: {
          line: 182,
          column: 2
        },
        end: {
          line: 184,
          column: 3
        }
      },
      "37": {
        start: {
          line: 183,
          column: 4
        },
        end: {
          line: 183,
          column: 11
        }
      },
      "38": {
        start: {
          line: 188,
          column: 4
        },
        end: {
          line: 192,
          column: 24
        }
      },
      "39": {
        start: {
          line: 194,
          column: 2
        },
        end: {
          line: 207,
          column: 3
        }
      },
      "40": {
        start: {
          line: 195,
          column: 4
        },
        end: {
          line: 198,
          column: 42
        }
      },
      "41": {
        start: {
          line: 200,
          column: 4
        },
        end: {
          line: 200,
          column: 20
        }
      },
      "42": {
        start: {
          line: 201,
          column: 4
        },
        end: {
          line: 206,
          column: 7
        }
      },
      "43": {
        start: {
          line: 210,
          column: 2
        },
        end: {
          line: 233,
          column: 3
        }
      },
      "44": {
        start: {
          line: 211,
          column: 4
        },
        end: {
          line: 232,
          column: 5
        }
      },
      "45": {
        start: {
          line: 212,
          column: 6
        },
        end: {
          line: 212,
          column: 58
        }
      },
      "46": {
        start: {
          line: 214,
          column: 6
        },
        end: {
          line: 217,
          column: 33
        }
      },
      "47": {
        start: {
          line: 219,
          column: 6
        },
        end: {
          line: 223,
          column: 41
        }
      },
      "48": {
        start: {
          line: 225,
          column: 6
        },
        end: {
          line: 225,
          column: 22
        }
      },
      "49": {
        start: {
          line: 226,
          column: 6
        },
        end: {
          line: 231,
          column: 9
        }
      }
    },
    fnMap: {
      "0": {
        name: "shouldSkipCsrf",
        decl: {
          start: {
            line: 47,
            column: 9
          },
          end: {
            line: 47,
            column: 23
          }
        },
        loc: {
          start: {
            line: 47,
            column: 29
          },
          end: {
            line: 71,
            column: 1
          }
        },
        line: 47
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 66,
            column: 28
          },
          end: {
            line: 66,
            column: 29
          }
        },
        loc: {
          start: {
            line: 66,
            column: 37
          },
          end: {
            line: 66,
            column: 58
          }
        },
        line: 66
      },
      "2": {
        name: "csrfProtection",
        decl: {
          start: {
            line: 80,
            column: 22
          },
          end: {
            line: 80,
            column: 36
          }
        },
        loc: {
          start: {
            line: 80,
            column: 53
          },
          end: {
            line: 155,
            column: 1
          }
        },
        line: 80
      },
      "3": {
        name: "csrfAutoProtect",
        decl: {
          start: {
            line: 168,
            column: 22
          },
          end: {
            line: 168,
            column: 37
          }
        },
        loc: {
          start: {
            line: 168,
            column: 54
          },
          end: {
            line: 234,
            column: 1
          }
        },
        line: 168
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 49,
            column: 2
          },
          end: {
            line: 51,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 49,
            column: 2
          },
          end: {
            line: 51,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 49
      },
      "1": {
        loc: {
          start: {
            line: 54,
            column: 2
          },
          end: {
            line: 56,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 54,
            column: 2
          },
          end: {
            line: 56,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 54
      },
      "2": {
        loc: {
          start: {
            line: 66,
            column: 2
          },
          end: {
            line: 68,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 66,
            column: 2
          },
          end: {
            line: 68,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 66
      },
      "3": {
        loc: {
          start: {
            line: 83,
            column: 4
          },
          end: {
            line: 86,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 83,
            column: 4
          },
          end: {
            line: 86,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 83
      },
      "4": {
        loc: {
          start: {
            line: 83,
            column: 8
          },
          end: {
            line: 83,
            column: 84
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 83,
            column: 8
          },
          end: {
            line: 83,
            column: 45
          }
        }, {
          start: {
            line: 83,
            column: 49
          },
          end: {
            line: 83,
            column: 84
          }
        }],
        line: 83
      },
      "5": {
        loc: {
          start: {
            line: 89,
            column: 4
          },
          end: {
            line: 91,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 89,
            column: 4
          },
          end: {
            line: 91,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 89
      },
      "6": {
        loc: {
          start: {
            line: 96,
            column: 6
          },
          end: {
            line: 100,
            column: 26
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 96,
            column: 6
          },
          end: {
            line: 96,
            column: 37
          }
        }, {
          start: {
            line: 97,
            column: 6
          },
          end: {
            line: 97,
            column: 35
          }
        }, {
          start: {
            line: 98,
            column: 6
          },
          end: {
            line: 98,
            column: 37
          }
        }, {
          start: {
            line: 99,
            column: 6
          },
          end: {
            line: 99,
            column: 25
          }
        }, {
          start: {
            line: 100,
            column: 6
          },
          end: {
            line: 100,
            column: 26
          }
        }],
        line: 96
      },
      "7": {
        loc: {
          start: {
            line: 102,
            column: 4
          },
          end: {
            line: 115,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 102,
            column: 4
          },
          end: {
            line: 115,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 102
      },
      "8": {
        loc: {
          start: {
            line: 120,
            column: 4
          },
          end: {
            line: 143,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 120,
            column: 4
          },
          end: {
            line: 143,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 120
      },
      "9": {
        loc: {
          start: {
            line: 172,
            column: 2
          },
          end: {
            line: 174,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 172,
            column: 2
          },
          end: {
            line: 174,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 172
      },
      "10": {
        loc: {
          start: {
            line: 177,
            column: 2
          },
          end: {
            line: 179,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 177,
            column: 2
          },
          end: {
            line: 179,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 177
      },
      "11": {
        loc: {
          start: {
            line: 177,
            column: 6
          },
          end: {
            line: 177,
            column: 82
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 177,
            column: 6
          },
          end: {
            line: 177,
            column: 43
          }
        }, {
          start: {
            line: 177,
            column: 47
          },
          end: {
            line: 177,
            column: 82
          }
        }],
        line: 177
      },
      "12": {
        loc: {
          start: {
            line: 182,
            column: 2
          },
          end: {
            line: 184,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 182,
            column: 2
          },
          end: {
            line: 184,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 182
      },
      "13": {
        loc: {
          start: {
            line: 188,
            column: 4
          },
          end: {
            line: 192,
            column: 24
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 188,
            column: 4
          },
          end: {
            line: 188,
            column: 35
          }
        }, {
          start: {
            line: 189,
            column: 4
          },
          end: {
            line: 189,
            column: 33
          }
        }, {
          start: {
            line: 190,
            column: 4
          },
          end: {
            line: 190,
            column: 35
          }
        }, {
          start: {
            line: 191,
            column: 4
          },
          end: {
            line: 191,
            column: 23
          }
        }, {
          start: {
            line: 192,
            column: 4
          },
          end: {
            line: 192,
            column: 24
          }
        }],
        line: 188
      },
      "14": {
        loc: {
          start: {
            line: 194,
            column: 2
          },
          end: {
            line: 207,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 194,
            column: 2
          },
          end: {
            line: 207,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 194
      },
      "15": {
        loc: {
          start: {
            line: 210,
            column: 2
          },
          end: {
            line: 233,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 210,
            column: 2
          },
          end: {
            line: 233,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 210
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0, 0, 0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0],
      "13": [0, 0, 0, 0, 0],
      "14": [0, 0],
      "15": [0, 0]
    },
    inputSourceMap: null,
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "ae21578b670521b561417891c3da2e2d46d41f3b"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_21nv951r5i = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_21nv951r5i();
/**
 * CSRF Protection Middleware
 *
 * SECURITY: TICKET #004 - Prevent Cross-Site Request Forgery attacks
 * HIPAA: Supports ยง164.312(a)(1) - Access Control
 *
 * This middleware integrates with @fastify/csrf-protection plugin to provide
 * CSRF token validation for all state-changing operations (POST, PUT, DELETE, PATCH).
 *
 * Usage:
 *   // Option 1: Use fastify's built-in csrfProtection hook (recommended)
 *   fastify.post('/api/patients', { onRequest: fastify.csrfProtection }, handler);
 *
 *   // Option 2: Use this custom middleware for additional flexibility
 *   import { csrfProtection } from '../middleware/csrf.middleware.js';
 *   fastify.post('/api/patients', { preHandler: csrfProtection }, handler);
 */

/**
 * Routes that should be exempt from CSRF protection
 * These are typically:
 * - Authentication endpoints (sign-in, sign-up) that don't have a session yet
 * - The CSRF token endpoint itself
 * - Health check endpoints
 */
export const csrfExemptRoutes =
/* istanbul ignore next */
(cov_21nv951r5i().s[0]++, ['/api/auth/csrf-token', '/api/auth/sign-in', '/api/auth/sign-up', '/api/auth/sign-in/email', '/api/auth/sign-out', '/api/auth/check-password-strength',
// Public password strength check
'/api/auth/password-policy',
// Public password policy endpoint
'/api/auth/validate-password',
// Password validation for registration
'/api/health', '/health', '/api/status',
// Validation test routes (development only)
'/api/validation-test']);

/**
 * Check if a route should be exempt from CSRF protection
 * @param {string} url - The request URL
 * @returns {boolean} - True if the route should skip CSRF protection
 */
function shouldSkipCsrf(url) {
  /* istanbul ignore next */
  cov_21nv951r5i().f[0]++;
  cov_21nv951r5i().s[1]++;
  // Exact match check
  if (csrfExemptRoutes.includes(url)) {
    /* istanbul ignore next */
    cov_21nv951r5i().b[0][0]++;
    cov_21nv951r5i().s[2]++;
    return true;
  } else
  /* istanbul ignore next */
  {
    cov_21nv951r5i().b[0][1]++;
  }

  // Prefix match for validation test routes (development only)
  cov_21nv951r5i().s[3]++;
  if (url.startsWith('/api/validation-test')) {
    /* istanbul ignore next */
    cov_21nv951r5i().b[1][0]++;
    cov_21nv951r5i().s[4]++;
    return true;
  } else
  /* istanbul ignore next */
  {
    cov_21nv951r5i().b[1][1]++;
  }

  // Check for Better Auth internal routes (they have their own CSRF handling)
  // Only skip specific Better Auth endpoints, not all /api/auth/* routes
  const betterAuthRoutes =
  /* istanbul ignore next */
  (cov_21nv951r5i().s[5]++, ['/api/auth/get-session', '/api/auth/session', '/api/auth/callback']);
  /* istanbul ignore next */
  cov_21nv951r5i().s[6]++;
  if (betterAuthRoutes.some(route => {
    /* istanbul ignore next */
    cov_21nv951r5i().f[1]++;
    cov_21nv951r5i().s[7]++;
    return url.startsWith(route);
  })) {
    /* istanbul ignore next */
    cov_21nv951r5i().b[2][0]++;
    cov_21nv951r5i().s[8]++;
    return true;
  } else
  /* istanbul ignore next */
  {
    cov_21nv951r5i().b[2][1]++;
  }
  cov_21nv951r5i().s[9]++;
  return false;
}

/**
 * CSRF Protection Pre-Handler
 * Validates CSRF token for state-changing requests
 *
 * @param {Object} request - Fastify request object
 * @param {Object} reply - Fastify reply object
 */
export async function csrfProtection(request, reply) {
  /* istanbul ignore next */
  cov_21nv951r5i().f[2]++;
  cov_21nv951r5i().s[10]++;
  try {
    /* istanbul ignore next */
    cov_21nv951r5i().s[11]++;
    // Skip CSRF validation in development if explicitly disabled
    if (
    /* istanbul ignore next */
    (cov_21nv951r5i().b[4][0]++, process.env.NODE_ENV !== 'production') &&
    /* istanbul ignore next */
    (cov_21nv951r5i().b[4][1]++, process.env.DISABLE_CSRF === 'true')) {
      /* istanbul ignore next */
      cov_21nv951r5i().b[3][0]++;
      cov_21nv951r5i().s[12]++;
      request.log.warn('CSRF protection disabled in development mode');
      /* istanbul ignore next */
      cov_21nv951r5i().s[13]++;
      return;
    } else
    /* istanbul ignore next */
    {
      cov_21nv951r5i().b[3][1]++;
    }

    // Check if route is exempt
    cov_21nv951r5i().s[14]++;
    if (shouldSkipCsrf(request.url)) {
      /* istanbul ignore next */
      cov_21nv951r5i().b[5][0]++;
      cov_21nv951r5i().s[15]++;
      return;
    } else
    /* istanbul ignore next */
    {
      cov_21nv951r5i().b[5][1]++;
    }

    // Get CSRF token from request (multiple sources supported by @fastify/csrf-protection)
    // The plugin checks: x-csrf-token header, _csrf in body, _csrf in query
    const csrfToken =
    /* istanbul ignore next */
    (cov_21nv951r5i().s[16]++,
    /* istanbul ignore next */
    (cov_21nv951r5i().b[6][0]++, request.headers['x-csrf-token']) ||
    /* istanbul ignore next */
    (cov_21nv951r5i().b[6][1]++, request.headers['csrf-token']) ||
    /* istanbul ignore next */
    (cov_21nv951r5i().b[6][2]++, request.headers['x-xsrf-token']) ||
    /* istanbul ignore next */
    (cov_21nv951r5i().b[6][3]++, request.body?._csrf) ||
    /* istanbul ignore next */
    (cov_21nv951r5i().b[6][4]++, request.query?._csrf));
    /* istanbul ignore next */
    cov_21nv951r5i().s[17]++;
    if (!csrfToken) {
      /* istanbul ignore next */
      cov_21nv951r5i().b[7][0]++;
      cov_21nv951r5i().s[18]++;
      request.log.warn({
        url: request.url,
        method: request.method
      }, 'CSRF token missing from request');
      /* istanbul ignore next */
      cov_21nv951r5i().s[19]++;
      reply.code(403);
      /* istanbul ignore next */
      cov_21nv951r5i().s[20]++;
      return {
        status: 403,
        error: 'CSRF Token Missing',
        message: 'CSRF token is required for this request. Please include the token in the x-csrf-token header.',
        hint: 'Fetch a new token from GET /api/auth/csrf-token'
      };
    } else
    /* istanbul ignore next */
    {
      cov_21nv951r5i().b[7][1]++;
    }

    // Use fastify's csrfProtection hook to validate the token
    // This is done by calling the hook directly if available
    // The @fastify/csrf-protection plugin decorates fastify with csrfProtection
    cov_21nv951r5i().s[21]++;
    if (request.server.csrfProtection) {
      /* istanbul ignore next */
      cov_21nv951r5i().b[8][0]++;
      cov_21nv951r5i().s[22]++;
      try {
        /* istanbul ignore next */
        cov_21nv951r5i().s[23]++;
        await request.server.csrfProtection(request, reply);
        // If we get here without an error, the token is valid
        /* istanbul ignore next */
        cov_21nv951r5i().s[24]++;
        request.log.debug({
          url: request.url,
          method: request.method
        }, 'CSRF token validated');
      } catch (csrfError) {
        /* istanbul ignore next */
        cov_21nv951r5i().s[25]++;
        request.log.warn({
          url: request.url,
          method: request.method,
          error: csrfError.message
        }, 'CSRF token validation failed');
        /* istanbul ignore next */
        cov_21nv951r5i().s[26]++;
        reply.code(403);
        /* istanbul ignore next */
        cov_21nv951r5i().s[27]++;
        return {
          status: 403,
          error: 'Invalid CSRF Token',
          message: 'CSRF token validation failed. The token may be expired or invalid.',
          hint: 'Fetch a new token from GET /api/auth/csrf-token and retry the request'
        };
      }
    } else
    /* istanbul ignore next */
    {
      cov_21nv951r5i().b[8][1]++;
    }
  } catch (error) {
    /* istanbul ignore next */
    cov_21nv951r5i().s[28]++;
    request.log.error({
      error
    }, 'CSRF validation error');
    /* istanbul ignore next */
    cov_21nv951r5i().s[29]++;
    reply.code(403);
    /* istanbul ignore next */
    cov_21nv951r5i().s[30]++;
    return {
      status: 403,
      error: 'CSRF Validation Error',
      message: 'An error occurred while validating the CSRF token',
      hint: 'Fetch a new token from GET /api/auth/csrf-token and retry the request'
    };
  }
}

/**
 * Auto-apply CSRF protection to all state-changing routes
 * This hook can be registered globally to protect all POST/PUT/DELETE/PATCH routes
 *
 * Usage:
 *   // Register as a global preHandler hook in server.js
 *   app.addHook('preHandler', csrfAutoProtect);
 *
 * @param {Object} request - Fastify request object
 * @param {Object} reply - Fastify reply object
 */
export async function csrfAutoProtect(request, reply) {
  /* istanbul ignore next */
  cov_21nv951r5i().f[3]++;
  // Only protect state-changing HTTP methods
  const protectedMethods =
  /* istanbul ignore next */
  (cov_21nv951r5i().s[31]++, ['POST', 'PUT', 'DELETE', 'PATCH']);
  /* istanbul ignore next */
  cov_21nv951r5i().s[32]++;
  if (!protectedMethods.includes(request.method)) {
    /* istanbul ignore next */
    cov_21nv951r5i().b[9][0]++;
    cov_21nv951r5i().s[33]++;
    return; // Skip CSRF for GET, HEAD, OPTIONS
  } else
  /* istanbul ignore next */
  {
    cov_21nv951r5i().b[9][1]++;
  }

  // Skip CSRF validation in development if explicitly disabled
  cov_21nv951r5i().s[34]++;
  if (
  /* istanbul ignore next */
  (cov_21nv951r5i().b[11][0]++, process.env.NODE_ENV !== 'production') &&
  /* istanbul ignore next */
  (cov_21nv951r5i().b[11][1]++, process.env.DISABLE_CSRF === 'true')) {
    /* istanbul ignore next */
    cov_21nv951r5i().b[10][0]++;
    cov_21nv951r5i().s[35]++;
    return;
  } else
  /* istanbul ignore next */
  {
    cov_21nv951r5i().b[10][1]++;
  }

  // Check if route is exempt
  cov_21nv951r5i().s[36]++;
  if (shouldSkipCsrf(request.url)) {
    /* istanbul ignore next */
    cov_21nv951r5i().b[12][0]++;
    cov_21nv951r5i().s[37]++;
    return;
  } else
  /* istanbul ignore next */
  {
    cov_21nv951r5i().b[12][1]++;
  }

  // Get CSRF token from request headers or body
  const csrfToken =
  /* istanbul ignore next */
  (cov_21nv951r5i().s[38]++,
  /* istanbul ignore next */
  (cov_21nv951r5i().b[13][0]++, request.headers['x-csrf-token']) ||
  /* istanbul ignore next */
  (cov_21nv951r5i().b[13][1]++, request.headers['csrf-token']) ||
  /* istanbul ignore next */
  (cov_21nv951r5i().b[13][2]++, request.headers['x-xsrf-token']) ||
  /* istanbul ignore next */
  (cov_21nv951r5i().b[13][3]++, request.body?._csrf) ||
  /* istanbul ignore next */
  (cov_21nv951r5i().b[13][4]++, request.query?._csrf));
  /* istanbul ignore next */
  cov_21nv951r5i().s[39]++;
  if (!csrfToken) {
    /* istanbul ignore next */
    cov_21nv951r5i().b[14][0]++;
    cov_21nv951r5i().s[40]++;
    request.log.warn({
      url: request.url,
      method: request.method
    }, 'CSRF token missing from request');
    /* istanbul ignore next */
    cov_21nv951r5i().s[41]++;
    reply.code(403);
    /* istanbul ignore next */
    cov_21nv951r5i().s[42]++;
    return reply.send({
      status: 403,
      error: 'CSRF Token Missing',
      message: 'CSRF token is required for this request. Please include the token in the x-csrf-token header.',
      hint: 'Fetch a new token from GET /api/auth/csrf-token'
    });
  } else
  /* istanbul ignore next */
  {
    cov_21nv951r5i().b[14][1]++;
  }

  // Use fastify's csrfProtection hook to validate the token
  cov_21nv951r5i().s[43]++;
  if (request.server.csrfProtection) {
    /* istanbul ignore next */
    cov_21nv951r5i().b[15][0]++;
    cov_21nv951r5i().s[44]++;
    try {
      /* istanbul ignore next */
      cov_21nv951r5i().s[45]++;
      await request.server.csrfProtection(request, reply);
      // Token is valid - continue to route handler
      /* istanbul ignore next */
      cov_21nv951r5i().s[46]++;
      request.log.debug({
        url: request.url,
        method: request.method
      }, 'CSRF token validated');
    } catch (csrfError) {
      /* istanbul ignore next */
      cov_21nv951r5i().s[47]++;
      request.log.warn({
        url: request.url,
        method: request.method,
        error: csrfError.message
      }, 'CSRF token validation failed');
      /* istanbul ignore next */
      cov_21nv951r5i().s[48]++;
      reply.code(403);
      /* istanbul ignore next */
      cov_21nv951r5i().s[49]++;
      return reply.send({
        status: 403,
        error: 'Invalid CSRF Token',
        message: 'CSRF token validation failed. The token may be expired or invalid.',
        hint: 'Fetch a new token from GET /api/auth/csrf-token and retry the request'
      });
    }
  } else
  /* istanbul ignore next */
  {
    cov_21nv951r5i().b[15][1]++;
  }
}
export default csrfProtection;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMjFudjk1MXI1aSIsImFjdHVhbENvdmVyYWdlIiwiY3NyZkV4ZW1wdFJvdXRlcyIsInMiLCJzaG91bGRTa2lwQ3NyZiIsInVybCIsImYiLCJpbmNsdWRlcyIsImIiLCJzdGFydHNXaXRoIiwiYmV0dGVyQXV0aFJvdXRlcyIsInNvbWUiLCJyb3V0ZSIsImNzcmZQcm90ZWN0aW9uIiwicmVxdWVzdCIsInJlcGx5IiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiRElTQUJMRV9DU1JGIiwibG9nIiwid2FybiIsImNzcmZUb2tlbiIsImhlYWRlcnMiLCJib2R5IiwiX2NzcmYiLCJxdWVyeSIsIm1ldGhvZCIsImNvZGUiLCJzdGF0dXMiLCJlcnJvciIsIm1lc3NhZ2UiLCJoaW50Iiwic2VydmVyIiwiZGVidWciLCJjc3JmRXJyb3IiLCJjc3JmQXV0b1Byb3RlY3QiLCJwcm90ZWN0ZWRNZXRob2RzIiwic2VuZCJdLCJzb3VyY2VzIjpbImNzcmYubWlkZGxld2FyZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENTUkYgUHJvdGVjdGlvbiBNaWRkbGV3YXJlXG4gKlxuICogU0VDVVJJVFk6IFRJQ0tFVCAjMDA0IC0gUHJldmVudCBDcm9zcy1TaXRlIFJlcXVlc3QgRm9yZ2VyeSBhdHRhY2tzXG4gKiBISVBBQTogU3VwcG9ydHMgwqcxNjQuMzEyKGEpKDEpIC0gQWNjZXNzIENvbnRyb2xcbiAqXG4gKiBUaGlzIG1pZGRsZXdhcmUgaW50ZWdyYXRlcyB3aXRoIEBmYXN0aWZ5L2NzcmYtcHJvdGVjdGlvbiBwbHVnaW4gdG8gcHJvdmlkZVxuICogQ1NSRiB0b2tlbiB2YWxpZGF0aW9uIGZvciBhbGwgc3RhdGUtY2hhbmdpbmcgb3BlcmF0aW9ucyAoUE9TVCwgUFVULCBERUxFVEUsIFBBVENIKS5cbiAqXG4gKiBVc2FnZTpcbiAqICAgLy8gT3B0aW9uIDE6IFVzZSBmYXN0aWZ5J3MgYnVpbHQtaW4gY3NyZlByb3RlY3Rpb24gaG9vayAocmVjb21tZW5kZWQpXG4gKiAgIGZhc3RpZnkucG9zdCgnL2FwaS9wYXRpZW50cycsIHsgb25SZXF1ZXN0OiBmYXN0aWZ5LmNzcmZQcm90ZWN0aW9uIH0sIGhhbmRsZXIpO1xuICpcbiAqICAgLy8gT3B0aW9uIDI6IFVzZSB0aGlzIGN1c3RvbSBtaWRkbGV3YXJlIGZvciBhZGRpdGlvbmFsIGZsZXhpYmlsaXR5XG4gKiAgIGltcG9ydCB7IGNzcmZQcm90ZWN0aW9uIH0gZnJvbSAnLi4vbWlkZGxld2FyZS9jc3JmLm1pZGRsZXdhcmUuanMnO1xuICogICBmYXN0aWZ5LnBvc3QoJy9hcGkvcGF0aWVudHMnLCB7IHByZUhhbmRsZXI6IGNzcmZQcm90ZWN0aW9uIH0sIGhhbmRsZXIpO1xuICovXG5cbi8qKlxuICogUm91dGVzIHRoYXQgc2hvdWxkIGJlIGV4ZW1wdCBmcm9tIENTUkYgcHJvdGVjdGlvblxuICogVGhlc2UgYXJlIHR5cGljYWxseTpcbiAqIC0gQXV0aGVudGljYXRpb24gZW5kcG9pbnRzIChzaWduLWluLCBzaWduLXVwKSB0aGF0IGRvbid0IGhhdmUgYSBzZXNzaW9uIHlldFxuICogLSBUaGUgQ1NSRiB0b2tlbiBlbmRwb2ludCBpdHNlbGZcbiAqIC0gSGVhbHRoIGNoZWNrIGVuZHBvaW50c1xuICovXG5leHBvcnQgY29uc3QgY3NyZkV4ZW1wdFJvdXRlcyA9IFtcbiAgJy9hcGkvYXV0aC9jc3JmLXRva2VuJyxcbiAgJy9hcGkvYXV0aC9zaWduLWluJyxcbiAgJy9hcGkvYXV0aC9zaWduLXVwJyxcbiAgJy9hcGkvYXV0aC9zaWduLWluL2VtYWlsJyxcbiAgJy9hcGkvYXV0aC9zaWduLW91dCcsXG4gICcvYXBpL2F1dGgvY2hlY2stcGFzc3dvcmQtc3RyZW5ndGgnLCAvLyBQdWJsaWMgcGFzc3dvcmQgc3RyZW5ndGggY2hlY2tcbiAgJy9hcGkvYXV0aC9wYXNzd29yZC1wb2xpY3knLCAvLyBQdWJsaWMgcGFzc3dvcmQgcG9saWN5IGVuZHBvaW50XG4gICcvYXBpL2F1dGgvdmFsaWRhdGUtcGFzc3dvcmQnLCAvLyBQYXNzd29yZCB2YWxpZGF0aW9uIGZvciByZWdpc3RyYXRpb25cbiAgJy9hcGkvaGVhbHRoJyxcbiAgJy9oZWFsdGgnLFxuICAnL2FwaS9zdGF0dXMnLFxuICAvLyBWYWxpZGF0aW9uIHRlc3Qgcm91dGVzIChkZXZlbG9wbWVudCBvbmx5KVxuICAnL2FwaS92YWxpZGF0aW9uLXRlc3QnXG5dO1xuXG4vKipcbiAqIENoZWNrIGlmIGEgcm91dGUgc2hvdWxkIGJlIGV4ZW1wdCBmcm9tIENTUkYgcHJvdGVjdGlvblxuICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSByZXF1ZXN0IFVSTFxuICogQHJldHVybnMge2Jvb2xlYW59IC0gVHJ1ZSBpZiB0aGUgcm91dGUgc2hvdWxkIHNraXAgQ1NSRiBwcm90ZWN0aW9uXG4gKi9cbmZ1bmN0aW9uIHNob3VsZFNraXBDc3JmKHVybCkge1xuICAvLyBFeGFjdCBtYXRjaCBjaGVja1xuICBpZiAoY3NyZkV4ZW1wdFJvdXRlcy5pbmNsdWRlcyh1cmwpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvLyBQcmVmaXggbWF0Y2ggZm9yIHZhbGlkYXRpb24gdGVzdCByb3V0ZXMgKGRldmVsb3BtZW50IG9ubHkpXG4gIGlmICh1cmwuc3RhcnRzV2l0aCgnL2FwaS92YWxpZGF0aW9uLXRlc3QnKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLy8gQ2hlY2sgZm9yIEJldHRlciBBdXRoIGludGVybmFsIHJvdXRlcyAodGhleSBoYXZlIHRoZWlyIG93biBDU1JGIGhhbmRsaW5nKVxuICAvLyBPbmx5IHNraXAgc3BlY2lmaWMgQmV0dGVyIEF1dGggZW5kcG9pbnRzLCBub3QgYWxsIC9hcGkvYXV0aC8qIHJvdXRlc1xuICBjb25zdCBiZXR0ZXJBdXRoUm91dGVzID0gW1xuICAgICcvYXBpL2F1dGgvZ2V0LXNlc3Npb24nLFxuICAgICcvYXBpL2F1dGgvc2Vzc2lvbicsXG4gICAgJy9hcGkvYXV0aC9jYWxsYmFjaydcbiAgXTtcblxuICBpZiAoYmV0dGVyQXV0aFJvdXRlcy5zb21lKHJvdXRlID0+IHVybC5zdGFydHNXaXRoKHJvdXRlKSkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn1cblxuLyoqXG4gKiBDU1JGIFByb3RlY3Rpb24gUHJlLUhhbmRsZXJcbiAqIFZhbGlkYXRlcyBDU1JGIHRva2VuIGZvciBzdGF0ZS1jaGFuZ2luZyByZXF1ZXN0c1xuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSByZXF1ZXN0IC0gRmFzdGlmeSByZXF1ZXN0IG9iamVjdFxuICogQHBhcmFtIHtPYmplY3R9IHJlcGx5IC0gRmFzdGlmeSByZXBseSBvYmplY3RcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNzcmZQcm90ZWN0aW9uKHJlcXVlc3QsIHJlcGx5KSB7XG4gIHRyeSB7XG4gICAgLy8gU2tpcCBDU1JGIHZhbGlkYXRpb24gaW4gZGV2ZWxvcG1lbnQgaWYgZXhwbGljaXRseSBkaXNhYmxlZFxuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIHByb2Nlc3MuZW52LkRJU0FCTEVfQ1NSRiA9PT0gJ3RydWUnKSB7XG4gICAgICByZXF1ZXN0LmxvZy53YXJuKCdDU1JGIHByb3RlY3Rpb24gZGlzYWJsZWQgaW4gZGV2ZWxvcG1lbnQgbW9kZScpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIHJvdXRlIGlzIGV4ZW1wdFxuICAgIGlmIChzaG91bGRTa2lwQ3NyZihyZXF1ZXN0LnVybCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBHZXQgQ1NSRiB0b2tlbiBmcm9tIHJlcXVlc3QgKG11bHRpcGxlIHNvdXJjZXMgc3VwcG9ydGVkIGJ5IEBmYXN0aWZ5L2NzcmYtcHJvdGVjdGlvbilcbiAgICAvLyBUaGUgcGx1Z2luIGNoZWNrczogeC1jc3JmLXRva2VuIGhlYWRlciwgX2NzcmYgaW4gYm9keSwgX2NzcmYgaW4gcXVlcnlcbiAgICBjb25zdCBjc3JmVG9rZW4gPVxuICAgICAgcmVxdWVzdC5oZWFkZXJzWyd4LWNzcmYtdG9rZW4nXSB8fFxuICAgICAgcmVxdWVzdC5oZWFkZXJzWydjc3JmLXRva2VuJ10gfHxcbiAgICAgIHJlcXVlc3QuaGVhZGVyc1sneC14c3JmLXRva2VuJ10gfHxcbiAgICAgIHJlcXVlc3QuYm9keT8uX2NzcmYgfHxcbiAgICAgIHJlcXVlc3QucXVlcnk/Ll9jc3JmO1xuXG4gICAgaWYgKCFjc3JmVG9rZW4pIHtcbiAgICAgIHJlcXVlc3QubG9nLndhcm4oe1xuICAgICAgICB1cmw6IHJlcXVlc3QudXJsLFxuICAgICAgICBtZXRob2Q6IHJlcXVlc3QubWV0aG9kXG4gICAgICB9LCAnQ1NSRiB0b2tlbiBtaXNzaW5nIGZyb20gcmVxdWVzdCcpO1xuXG4gICAgICByZXBseS5jb2RlKDQwMyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXM6IDQwMyxcbiAgICAgICAgZXJyb3I6ICdDU1JGIFRva2VuIE1pc3NpbmcnLFxuICAgICAgICBtZXNzYWdlOiAnQ1NSRiB0b2tlbiBpcyByZXF1aXJlZCBmb3IgdGhpcyByZXF1ZXN0LiBQbGVhc2UgaW5jbHVkZSB0aGUgdG9rZW4gaW4gdGhlIHgtY3NyZi10b2tlbiBoZWFkZXIuJyxcbiAgICAgICAgaGludDogJ0ZldGNoIGEgbmV3IHRva2VuIGZyb20gR0VUIC9hcGkvYXV0aC9jc3JmLXRva2VuJ1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBVc2UgZmFzdGlmeSdzIGNzcmZQcm90ZWN0aW9uIGhvb2sgdG8gdmFsaWRhdGUgdGhlIHRva2VuXG4gICAgLy8gVGhpcyBpcyBkb25lIGJ5IGNhbGxpbmcgdGhlIGhvb2sgZGlyZWN0bHkgaWYgYXZhaWxhYmxlXG4gICAgLy8gVGhlIEBmYXN0aWZ5L2NzcmYtcHJvdGVjdGlvbiBwbHVnaW4gZGVjb3JhdGVzIGZhc3RpZnkgd2l0aCBjc3JmUHJvdGVjdGlvblxuICAgIGlmIChyZXF1ZXN0LnNlcnZlci5jc3JmUHJvdGVjdGlvbikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgcmVxdWVzdC5zZXJ2ZXIuY3NyZlByb3RlY3Rpb24ocmVxdWVzdCwgcmVwbHkpO1xuICAgICAgICAvLyBJZiB3ZSBnZXQgaGVyZSB3aXRob3V0IGFuIGVycm9yLCB0aGUgdG9rZW4gaXMgdmFsaWRcbiAgICAgICAgcmVxdWVzdC5sb2cuZGVidWcoe1xuICAgICAgICAgIHVybDogcmVxdWVzdC51cmwsXG4gICAgICAgICAgbWV0aG9kOiByZXF1ZXN0Lm1ldGhvZFxuICAgICAgICB9LCAnQ1NSRiB0b2tlbiB2YWxpZGF0ZWQnKTtcbiAgICAgIH0gY2F0Y2ggKGNzcmZFcnJvcikge1xuICAgICAgICByZXF1ZXN0LmxvZy53YXJuKHtcbiAgICAgICAgICB1cmw6IHJlcXVlc3QudXJsLFxuICAgICAgICAgIG1ldGhvZDogcmVxdWVzdC5tZXRob2QsXG4gICAgICAgICAgZXJyb3I6IGNzcmZFcnJvci5tZXNzYWdlXG4gICAgICAgIH0sICdDU1JGIHRva2VuIHZhbGlkYXRpb24gZmFpbGVkJyk7XG5cbiAgICAgICAgcmVwbHkuY29kZSg0MDMpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN0YXR1czogNDAzLFxuICAgICAgICAgIGVycm9yOiAnSW52YWxpZCBDU1JGIFRva2VuJyxcbiAgICAgICAgICBtZXNzYWdlOiAnQ1NSRiB0b2tlbiB2YWxpZGF0aW9uIGZhaWxlZC4gVGhlIHRva2VuIG1heSBiZSBleHBpcmVkIG9yIGludmFsaWQuJyxcbiAgICAgICAgICBoaW50OiAnRmV0Y2ggYSBuZXcgdG9rZW4gZnJvbSBHRVQgL2FwaS9hdXRoL2NzcmYtdG9rZW4gYW5kIHJldHJ5IHRoZSByZXF1ZXN0J1xuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJlcXVlc3QubG9nLmVycm9yKHsgZXJyb3IgfSwgJ0NTUkYgdmFsaWRhdGlvbiBlcnJvcicpO1xuICAgIHJlcGx5LmNvZGUoNDAzKTtcbiAgICByZXR1cm4ge1xuICAgICAgc3RhdHVzOiA0MDMsXG4gICAgICBlcnJvcjogJ0NTUkYgVmFsaWRhdGlvbiBFcnJvcicsXG4gICAgICBtZXNzYWdlOiAnQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdmFsaWRhdGluZyB0aGUgQ1NSRiB0b2tlbicsXG4gICAgICBoaW50OiAnRmV0Y2ggYSBuZXcgdG9rZW4gZnJvbSBHRVQgL2FwaS9hdXRoL2NzcmYtdG9rZW4gYW5kIHJldHJ5IHRoZSByZXF1ZXN0J1xuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBBdXRvLWFwcGx5IENTUkYgcHJvdGVjdGlvbiB0byBhbGwgc3RhdGUtY2hhbmdpbmcgcm91dGVzXG4gKiBUaGlzIGhvb2sgY2FuIGJlIHJlZ2lzdGVyZWQgZ2xvYmFsbHkgdG8gcHJvdGVjdCBhbGwgUE9TVC9QVVQvREVMRVRFL1BBVENIIHJvdXRlc1xuICpcbiAqIFVzYWdlOlxuICogICAvLyBSZWdpc3RlciBhcyBhIGdsb2JhbCBwcmVIYW5kbGVyIGhvb2sgaW4gc2VydmVyLmpzXG4gKiAgIGFwcC5hZGRIb29rKCdwcmVIYW5kbGVyJywgY3NyZkF1dG9Qcm90ZWN0KTtcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gcmVxdWVzdCAtIEZhc3RpZnkgcmVxdWVzdCBvYmplY3RcbiAqIEBwYXJhbSB7T2JqZWN0fSByZXBseSAtIEZhc3RpZnkgcmVwbHkgb2JqZWN0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjc3JmQXV0b1Byb3RlY3QocmVxdWVzdCwgcmVwbHkpIHtcbiAgLy8gT25seSBwcm90ZWN0IHN0YXRlLWNoYW5naW5nIEhUVFAgbWV0aG9kc1xuICBjb25zdCBwcm90ZWN0ZWRNZXRob2RzID0gWydQT1NUJywgJ1BVVCcsICdERUxFVEUnLCAnUEFUQ0gnXTtcblxuICBpZiAoIXByb3RlY3RlZE1ldGhvZHMuaW5jbHVkZXMocmVxdWVzdC5tZXRob2QpKSB7XG4gICAgcmV0dXJuOyAvLyBTa2lwIENTUkYgZm9yIEdFVCwgSEVBRCwgT1BUSU9OU1xuICB9XG5cbiAgLy8gU2tpcCBDU1JGIHZhbGlkYXRpb24gaW4gZGV2ZWxvcG1lbnQgaWYgZXhwbGljaXRseSBkaXNhYmxlZFxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiBwcm9jZXNzLmVudi5ESVNBQkxFX0NTUkYgPT09ICd0cnVlJykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIENoZWNrIGlmIHJvdXRlIGlzIGV4ZW1wdFxuICBpZiAoc2hvdWxkU2tpcENzcmYocmVxdWVzdC51cmwpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gR2V0IENTUkYgdG9rZW4gZnJvbSByZXF1ZXN0IGhlYWRlcnMgb3IgYm9keVxuICBjb25zdCBjc3JmVG9rZW4gPVxuICAgIHJlcXVlc3QuaGVhZGVyc1sneC1jc3JmLXRva2VuJ10gfHxcbiAgICByZXF1ZXN0LmhlYWRlcnNbJ2NzcmYtdG9rZW4nXSB8fFxuICAgIHJlcXVlc3QuaGVhZGVyc1sneC14c3JmLXRva2VuJ10gfHxcbiAgICByZXF1ZXN0LmJvZHk/Ll9jc3JmIHx8XG4gICAgcmVxdWVzdC5xdWVyeT8uX2NzcmY7XG5cbiAgaWYgKCFjc3JmVG9rZW4pIHtcbiAgICByZXF1ZXN0LmxvZy53YXJuKHtcbiAgICAgIHVybDogcmVxdWVzdC51cmwsXG4gICAgICBtZXRob2Q6IHJlcXVlc3QubWV0aG9kXG4gICAgfSwgJ0NTUkYgdG9rZW4gbWlzc2luZyBmcm9tIHJlcXVlc3QnKTtcblxuICAgIHJlcGx5LmNvZGUoNDAzKTtcbiAgICByZXR1cm4gcmVwbHkuc2VuZCh7XG4gICAgICBzdGF0dXM6IDQwMyxcbiAgICAgIGVycm9yOiAnQ1NSRiBUb2tlbiBNaXNzaW5nJyxcbiAgICAgIG1lc3NhZ2U6ICdDU1JGIHRva2VuIGlzIHJlcXVpcmVkIGZvciB0aGlzIHJlcXVlc3QuIFBsZWFzZSBpbmNsdWRlIHRoZSB0b2tlbiBpbiB0aGUgeC1jc3JmLXRva2VuIGhlYWRlci4nLFxuICAgICAgaGludDogJ0ZldGNoIGEgbmV3IHRva2VuIGZyb20gR0VUIC9hcGkvYXV0aC9jc3JmLXRva2VuJ1xuICAgIH0pO1xuICB9XG5cbiAgLy8gVXNlIGZhc3RpZnkncyBjc3JmUHJvdGVjdGlvbiBob29rIHRvIHZhbGlkYXRlIHRoZSB0b2tlblxuICBpZiAocmVxdWVzdC5zZXJ2ZXIuY3NyZlByb3RlY3Rpb24pIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgcmVxdWVzdC5zZXJ2ZXIuY3NyZlByb3RlY3Rpb24ocmVxdWVzdCwgcmVwbHkpO1xuICAgICAgLy8gVG9rZW4gaXMgdmFsaWQgLSBjb250aW51ZSB0byByb3V0ZSBoYW5kbGVyXG4gICAgICByZXF1ZXN0LmxvZy5kZWJ1Zyh7XG4gICAgICAgIHVybDogcmVxdWVzdC51cmwsXG4gICAgICAgIG1ldGhvZDogcmVxdWVzdC5tZXRob2RcbiAgICAgIH0sICdDU1JGIHRva2VuIHZhbGlkYXRlZCcpO1xuICAgIH0gY2F0Y2ggKGNzcmZFcnJvcikge1xuICAgICAgcmVxdWVzdC5sb2cud2Fybih7XG4gICAgICAgIHVybDogcmVxdWVzdC51cmwsXG4gICAgICAgIG1ldGhvZDogcmVxdWVzdC5tZXRob2QsXG4gICAgICAgIGVycm9yOiBjc3JmRXJyb3IubWVzc2FnZVxuICAgICAgfSwgJ0NTUkYgdG9rZW4gdmFsaWRhdGlvbiBmYWlsZWQnKTtcblxuICAgICAgcmVwbHkuY29kZSg0MDMpO1xuICAgICAgcmV0dXJuIHJlcGx5LnNlbmQoe1xuICAgICAgICBzdGF0dXM6IDQwMyxcbiAgICAgICAgZXJyb3I6ICdJbnZhbGlkIENTUkYgVG9rZW4nLFxuICAgICAgICBtZXNzYWdlOiAnQ1NSRiB0b2tlbiB2YWxpZGF0aW9uIGZhaWxlZC4gVGhlIHRva2VuIG1heSBiZSBleHBpcmVkIG9yIGludmFsaWQuJyxcbiAgICAgICAgaGludDogJ0ZldGNoIGEgbmV3IHRva2VuIGZyb20gR0VUIC9hcGkvYXV0aC9jc3JmLXRva2VuIGFuZCByZXRyeSB0aGUgcmVxdWVzdCdcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjc3JmUHJvdGVjdGlvbjtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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QyxLQUFLLEVBQUUsb0JBQW9CO01BQzNCQyxPQUFPLEVBQUUsK0ZBQStGO01BQ3hHQyxJQUFJLEVBQUU7SUFDUixDQUFDLENBQUM7RUFDSixDQUFDO0VBQUE7RUFBQTtJQUFBaEMsY0FBQSxHQUFBUSxDQUFBO0VBQUE7O0VBRUQ7RUFBQVIsY0FBQSxHQUFBRyxDQUFBO0VBQ0EsSUFBSVcsT0FBTyxDQUFDbUIsTUFBTSxDQUFDcEIsY0FBYyxFQUFFO0lBQUE7SUFBQWIsY0FBQSxHQUFBUSxDQUFBO0lBQUFSLGNBQUEsR0FBQUcsQ0FBQTtJQUNqQyxJQUFJO01BQUE7TUFBQUgsY0FBQSxHQUFBRyxDQUFBO01BQ0YsTUFBTVcsT0FBTyxDQUFDbUIsTUFBTSxDQUFDcEIsY0FBYyxDQUFDQyxPQUFPLEVBQUVDLEtBQUssQ0FBQztNQUNuRDtNQUFBO01BQUFmLGNBQUEsR0FBQUcsQ0FBQTtNQUNBVyxPQUFPLENBQUNNLEdBQUcsQ0FBQ2MsS0FBSyxDQUFDO1FBQ2hCN0IsR0FBRyxFQUFFUyxPQUFPLENBQUNULEdBQUc7UUFDaEJzQixNQUFNLEVBQUViLE9BQU8sQ0FBQ2E7TUFDbEIsQ0FBQyxFQUFFLHNCQUFzQixDQUFDO0lBQzVCLENBQUMsQ0FBQyxPQUFPUSxTQUFTLEVBQUU7TUFBQTtNQUFBbkMsY0FBQSxHQUFBRyxDQUFBO01BQ2xCVyxPQUFPLENBQUNNLEdBQUcsQ0FBQ0MsSUFBSSxDQUFDO1FBQ2ZoQixHQUFHLEVBQUVTLE9BQU8sQ0FBQ1QsR0FBRztRQUNoQnNCLE1BQU0sRUFBRWIsT0FBTyxDQUFDYSxNQUFNO1FBQ3RCRyxLQUFLLEVBQUVLLFNBQVMsQ0FBQ0o7TUFDbkIsQ0FBQyxFQUFFLDhCQUE4QixDQUFDO01BQUM7TUFBQS9CLGNBQUEsR0FBQUcsQ0FBQTtNQUVuQ1ksS0FBSyxDQUFDYSxJQUFJLENBQUMsR0FBRyxDQUFDO01BQUM7TUFBQTVCLGNBQUEsR0FBQUcsQ0FBQTtNQUNoQixPQUFPWSxLQUFLLENBQUN1QixJQUFJLENBQUM7UUFDaEJULE1BQU0sRUFBRSxHQUFHO1FBQ1hDLEtBQUssRUFBRSxvQkFBb0I7UUFDM0JDLE9BQU8sRUFBRSxvRUFBb0U7UUFDN0VDLElBQUksRUFBRTtNQUNSLENBQUMsQ0FBQztJQUNKO0VBQ0YsQ0FBQztFQUFBO0VBQUE7SUFBQWhDLGNBQUEsR0FBQVEsQ0FBQTtFQUFBO0FBQ0g7QUFFQSxlQUFlSyxjQUFjIiwiaWdub3JlTGlzdCI6W119