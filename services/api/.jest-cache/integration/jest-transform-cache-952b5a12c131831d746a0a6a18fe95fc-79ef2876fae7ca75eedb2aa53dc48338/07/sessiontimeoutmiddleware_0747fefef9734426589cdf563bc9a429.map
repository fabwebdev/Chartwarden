{"version":3,"names":["cov_6wzoo6utb","actualCoverage","db","sessions","eq","auth","s","sessionTimeoutMiddleware","request","reply","f","b","user","betterAuthSession","now","Date","sessionToken","cookies","sessionRecords","select","from","where","token","limit","length","code","send","status","error","message","reason","session","expiresAt","log","warn","userId","id","userEmail","email","ip","path","url","lastActivity","updatedAt","idleTime","maxIdleTime","idleMinutes","Math","floor","userAgent","headers","delete","sessionCreatedAt","createdAt","sessionAge","maxSessionAge","sessionHours","update","set","createSessionTimeoutMiddleware","options","idleTimeout","absoluteTimeout","destroy"],"sources":["session-timeout.middleware.js"],"sourcesContent":["/**\n * Session Timeout Middleware\n * TICKET #013: HIPAA-compliant session timeout enforcement\n *\n * Implements:\n * - 15-minute idle timeout\n * - 8-hour absolute session timeout\n * - Automatic session destruction on timeout\n * - Audit logging of timeout events\n *\n * HIPAA Compliance: ยง164.312(a)(2)(iii) - Automatic Logoff\n */\n\nimport { db } from '../config/db.drizzle.js';\nimport { sessions } from '../db/schemas/index.js';\nimport { eq } from 'drizzle-orm';\nimport auth from '../config/betterAuth.js';\n\n/**\n * Session timeout middleware for HIPAA compliance\n * Works with Better Auth session management\n * Enforces idle timeout and absolute timeout limits\n *\n * @param {Object} request - Fastify request object\n * @param {Object} reply - Fastify reply object\n * @returns {void|Response} - Returns 401 response if session expired\n */\nexport const sessionTimeoutMiddleware = async (request, reply) => {\n    // Skip for public routes (no user or Better Auth session)\n    if (!request.user || !request.betterAuthSession) {\n        return;\n    }\n\n    const now = new Date();\n    const sessionToken = request.cookies?.['better-auth.session_token'];\n\n    if (!sessionToken) {\n        return;\n    }\n\n    try {\n        // Fetch session from database\n        const sessionRecords = await db\n            .select()\n            .from(sessions)\n            .where(eq(sessions.token, sessionToken))\n            .limit(1);\n\n        if (sessionRecords.length === 0) {\n            // Session not found in database - already expired or invalid\n            return reply.code(401).send({\n                status: 401,\n                error: 'Session Expired',\n                message: 'Your session is invalid. Please log in again.',\n                reason: 'session_not_found'\n            });\n        }\n\n        const session = sessionRecords[0];\n\n        // Check if session has expired (Better Auth handles this, but double-check)\n        if (session.expiresAt && new Date(session.expiresAt) < now) {\n            request.log.warn({\n                userId: request.user.id,\n                userEmail: request.user.email,\n                ip: request.ip,\n                path: request.url\n            }, 'Session expired (database expiration)');\n\n            return reply.code(401).send({\n                status: 401,\n                error: 'Session Expired',\n                message: 'Your session has expired. Please log in again.',\n                reason: 'session_expired'\n            });\n        }\n\n        // Check idle timeout (15 minutes of inactivity)\n        // Use updatedAt as last activity timestamp\n        const lastActivity = new Date(session.updatedAt);\n        const idleTime = now - lastActivity;\n        const maxIdleTime = 15 * 60 * 1000; // 15 minutes in milliseconds\n\n        if (idleTime > maxIdleTime) {\n            // Log idle timeout event for audit trail\n            request.log.warn({\n                userId: request.user.id,\n                userEmail: request.user.email,\n                idleMinutes: Math.floor(idleTime / 1000 / 60),\n                ip: request.ip,\n                userAgent: request.headers['user-agent'],\n                path: request.url\n            }, 'Session expired due to inactivity');\n\n            // Delete session from database\n            await db.delete(sessions).where(eq(sessions.id, session.id));\n\n            // Return 401 Unauthorized with detailed message\n            return reply.code(401).send({\n                status: 401,\n                error: 'Session Expired',\n                message: 'Your session has expired due to inactivity. Please log in again.',\n                reason: 'idle_timeout',\n                idleMinutes: Math.floor(idleTime / 1000 / 60)\n            });\n        }\n\n        // Check absolute timeout (8 hours maximum session age)\n        const sessionCreatedAt = new Date(session.createdAt);\n        const sessionAge = now - sessionCreatedAt;\n        const maxSessionAge = 8 * 60 * 60 * 1000; // 8 hours in milliseconds\n\n        if (sessionAge > maxSessionAge) {\n            // Log absolute timeout event for audit trail\n            request.log.warn({\n                userId: request.user.id,\n                userEmail: request.user.email,\n                sessionHours: Math.floor(sessionAge / 1000 / 60 / 60),\n                ip: request.ip,\n                userAgent: request.headers['user-agent'],\n                path: request.url\n            }, 'Session expired due to absolute timeout');\n\n            // Delete session from database\n            await db.delete(sessions).where(eq(sessions.id, session.id));\n\n            // Return 401 Unauthorized with detailed message\n            return reply.code(401).send({\n                status: 401,\n                error: 'Session Expired',\n                message: 'Your session has expired. Maximum session duration is 8 hours. Please log in again.',\n                reason: 'absolute_timeout',\n                sessionHours: Math.floor(sessionAge / 1000 / 60 / 60)\n            });\n        }\n\n        // Update session's updatedAt timestamp to track activity\n        await db\n            .update(sessions)\n            .set({ updatedAt: now })\n            .where(eq(sessions.id, session.id));\n\n    } catch (error) {\n        request.log.error({ error, userId: request.user?.id }, 'Error in session timeout middleware');\n        // Don't block the request on middleware errors\n        // Better Auth will handle session validation\n    }\n};\n\n/**\n * Factory function to create the session timeout middleware\n * Can be customized with different timeout values if needed\n *\n * @param {Object} options - Configuration options\n * @param {number} options.idleTimeout - Idle timeout in milliseconds (default: 15 minutes)\n * @param {number} options.absoluteTimeout - Absolute timeout in milliseconds (default: 8 hours)\n * @returns {Function} - Middleware function\n */\nexport const createSessionTimeoutMiddleware = (options = {}) => {\n    const {\n        idleTimeout = 15 * 60 * 1000, // 15 minutes\n        absoluteTimeout = 8 * 60 * 60 * 1000 // 8 hours\n    } = options;\n\n    return async (request, reply) => {\n        // Skip for public routes\n        if (!request.user || !request.session) {\n            return;\n        }\n\n        const now = Date.now();\n        const lastActivity = request.session.lastActivity || now;\n        const idleTime = now - lastActivity;\n\n        // Check idle timeout\n        if (idleTime > idleTimeout) {\n            request.log.warn({\n                userId: request.user.id,\n                idleTime: Math.floor(idleTime / 1000 / 60),\n            }, 'Session idle timeout');\n\n            try {\n                if (typeof request.session.destroy === 'function') {\n                    await request.session.destroy();\n                }\n            } catch (error) {\n                request.log.error({ error }, 'Error destroying session');\n            }\n\n            return reply.code(401).send({\n                status: 401,\n                error: 'Session Expired',\n                message: 'Your session has expired due to inactivity. Please log in again.',\n                reason: 'idle_timeout'\n            });\n        }\n\n        // Check absolute timeout\n        const sessionCreatedAt = request.session.createdAt || now;\n        const sessionAge = now - sessionCreatedAt;\n\n        if (sessionAge > absoluteTimeout) {\n            request.log.warn({\n                userId: request.user.id,\n                sessionAge: Math.floor(sessionAge / 1000 / 60 / 60),\n            }, 'Session absolute timeout');\n\n            try {\n                if (typeof request.session.destroy === 'function') {\n                    await request.session.destroy();\n                }\n            } catch (error) {\n                request.log.error({ error }, 'Error destroying session');\n            }\n\n            return reply.code(401).send({\n                status: 401,\n                error: 'Session Expired',\n                message: 'Your session has expired. Please log in again.',\n                reason: 'absolute_timeout'\n            });\n        }\n\n        // Update last activity\n        request.session.lastActivity = now;\n        if (!request.session.createdAt) {\n            request.session.createdAt = now;\n        }\n    };\n};\n\nexport default sessionTimeoutMiddleware;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}