744384ac8f7833fc5c4c620c8337aa41
/* istanbul ignore next */
function cov_6wzoo6utb() {
  var path = "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/middleware/session-timeout.middleware.js";
  var hash = "409bd695cf6b8dd1b970b72d669bce402d7a2879";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/middleware/session-timeout.middleware.js",
    statementMap: {
      "0": {
        start: {
          line: 28,
          column: 40
        },
        end: {
          line: 148,
          column: 1
        }
      },
      "1": {
        start: {
          line: 30,
          column: 4
        },
        end: {
          line: 32,
          column: 5
        }
      },
      "2": {
        start: {
          line: 31,
          column: 8
        },
        end: {
          line: 31,
          column: 15
        }
      },
      "3": {
        start: {
          line: 34,
          column: 16
        },
        end: {
          line: 34,
          column: 26
        }
      },
      "4": {
        start: {
          line: 35,
          column: 25
        },
        end: {
          line: 35,
          column: 71
        }
      },
      "5": {
        start: {
          line: 37,
          column: 4
        },
        end: {
          line: 39,
          column: 5
        }
      },
      "6": {
        start: {
          line: 38,
          column: 8
        },
        end: {
          line: 38,
          column: 15
        }
      },
      "7": {
        start: {
          line: 41,
          column: 4
        },
        end: {
          line: 147,
          column: 5
        }
      },
      "8": {
        start: {
          line: 43,
          column: 31
        },
        end: {
          line: 47,
          column: 21
        }
      },
      "9": {
        start: {
          line: 49,
          column: 8
        },
        end: {
          line: 57,
          column: 9
        }
      },
      "10": {
        start: {
          line: 51,
          column: 12
        },
        end: {
          line: 56,
          column: 15
        }
      },
      "11": {
        start: {
          line: 59,
          column: 24
        },
        end: {
          line: 59,
          column: 41
        }
      },
      "12": {
        start: {
          line: 62,
          column: 8
        },
        end: {
          line: 76,
          column: 9
        }
      },
      "13": {
        start: {
          line: 63,
          column: 12
        },
        end: {
          line: 68,
          column: 56
        }
      },
      "14": {
        start: {
          line: 70,
          column: 12
        },
        end: {
          line: 75,
          column: 15
        }
      },
      "15": {
        start: {
          line: 80,
          column: 29
        },
        end: {
          line: 80,
          column: 56
        }
      },
      "16": {
        start: {
          line: 81,
          column: 25
        },
        end: {
          line: 81,
          column: 43
        }
      },
      "17": {
        start: {
          line: 82,
          column: 28
        },
        end: {
          line: 82,
          column: 42
        }
      },
      "18": {
        start: {
          line: 84,
          column: 8
        },
        end: {
          line: 106,
          column: 9
        }
      },
      "19": {
        start: {
          line: 86,
          column: 12
        },
        end: {
          line: 93,
          column: 52
        }
      },
      "20": {
        start: {
          line: 96,
          column: 12
        },
        end: {
          line: 96,
          column: 73
        }
      },
      "21": {
        start: {
          line: 99,
          column: 12
        },
        end: {
          line: 105,
          column: 15
        }
      },
      "22": {
        start: {
          line: 109,
          column: 33
        },
        end: {
          line: 109,
          column: 60
        }
      },
      "23": {
        start: {
          line: 110,
          column: 27
        },
        end: {
          line: 110,
          column: 49
        }
      },
      "24": {
        start: {
          line: 111,
          column: 30
        },
        end: {
          line: 111,
          column: 48
        }
      },
      "25": {
        start: {
          line: 113,
          column: 8
        },
        end: {
          line: 135,
          column: 9
        }
      },
      "26": {
        start: {
          line: 115,
          column: 12
        },
        end: {
          line: 122,
          column: 58
        }
      },
      "27": {
        start: {
          line: 125,
          column: 12
        },
        end: {
          line: 125,
          column: 73
        }
      },
      "28": {
        start: {
          line: 128,
          column: 12
        },
        end: {
          line: 134,
          column: 15
        }
      },
      "29": {
        start: {
          line: 138,
          column: 8
        },
        end: {
          line: 141,
          column: 48
        }
      },
      "30": {
        start: {
          line: 144,
          column: 8
        },
        end: {
          line: 144,
          column: 102
        }
      },
      "31": {
        start: {
          line: 159,
          column: 46
        },
        end: {
          line: 230,
          column: 1
        }
      },
      "32": {
        start: {
          line: 163,
          column: 8
        },
        end: {
          line: 163,
          column: 15
        }
      },
      "33": {
        start: {
          line: 165,
          column: 4
        },
        end: {
          line: 229,
          column: 6
        }
      },
      "34": {
        start: {
          line: 167,
          column: 8
        },
        end: {
          line: 169,
          column: 9
        }
      },
      "35": {
        start: {
          line: 168,
          column: 12
        },
        end: {
          line: 168,
          column: 19
        }
      },
      "36": {
        start: {
          line: 171,
          column: 20
        },
        end: {
          line: 171,
          column: 30
        }
      },
      "37": {
        start: {
          line: 172,
          column: 29
        },
        end: {
          line: 172,
          column: 64
        }
      },
      "38": {
        start: {
          line: 173,
          column: 25
        },
        end: {
          line: 173,
          column: 43
        }
      },
      "39": {
        start: {
          line: 176,
          column: 8
        },
        end: {
          line: 196,
          column: 9
        }
      },
      "40": {
        start: {
          line: 177,
          column: 12
        },
        end: {
          line: 180,
          column: 39
        }
      },
      "41": {
        start: {
          line: 182,
          column: 12
        },
        end: {
          line: 188,
          column: 13
        }
      },
      "42": {
        start: {
          line: 183,
          column: 16
        },
        end: {
          line: 185,
          column: 17
        }
      },
      "43": {
        start: {
          line: 184,
          column: 20
        },
        end: {
          line: 184,
          column: 52
        }
      },
      "44": {
        start: {
          line: 187,
          column: 16
        },
        end: {
          line: 187,
          column: 73
        }
      },
      "45": {
        start: {
          line: 190,
          column: 12
        },
        end: {
          line: 195,
          column: 15
        }
      },
      "46": {
        start: {
          line: 199,
          column: 33
        },
        end: {
          line: 199,
          column: 65
        }
      },
      "47": {
        start: {
          line: 200,
          column: 27
        },
        end: {
          line: 200,
          column: 49
        }
      },
      "48": {
        start: {
          line: 202,
          column: 8
        },
        end: {
          line: 222,
          column: 9
        }
      },
      "49": {
        start: {
          line: 203,
          column: 12
        },
        end: {
          line: 206,
          column: 43
        }
      },
      "50": {
        start: {
          line: 208,
          column: 12
        },
        end: {
          line: 214,
          column: 13
        }
      },
      "51": {
        start: {
          line: 209,
          column: 16
        },
        end: {
          line: 211,
          column: 17
        }
      },
      "52": {
        start: {
          line: 210,
          column: 20
        },
        end: {
          line: 210,
          column: 52
        }
      },
      "53": {
        start: {
          line: 213,
          column: 16
        },
        end: {
          line: 213,
          column: 73
        }
      },
      "54": {
        start: {
          line: 216,
          column: 12
        },
        end: {
          line: 221,
          column: 15
        }
      },
      "55": {
        start: {
          line: 225,
          column: 8
        },
        end: {
          line: 225,
          column: 43
        }
      },
      "56": {
        start: {
          line: 226,
          column: 8
        },
        end: {
          line: 228,
          column: 9
        }
      },
      "57": {
        start: {
          line: 227,
          column: 12
        },
        end: {
          line: 227,
          column: 44
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 28,
            column: 40
          },
          end: {
            line: 28,
            column: 41
          }
        },
        loc: {
          start: {
            line: 28,
            column: 66
          },
          end: {
            line: 148,
            column: 1
          }
        },
        line: 28
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 159,
            column: 46
          },
          end: {
            line: 159,
            column: 47
          }
        },
        loc: {
          start: {
            line: 159,
            column: 64
          },
          end: {
            line: 230,
            column: 1
          }
        },
        line: 159
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 165,
            column: 11
          },
          end: {
            line: 165,
            column: 12
          }
        },
        loc: {
          start: {
            line: 165,
            column: 37
          },
          end: {
            line: 229,
            column: 5
          }
        },
        line: 165
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 30,
            column: 4
          },
          end: {
            line: 32,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 30,
            column: 4
          },
          end: {
            line: 32,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 30
      },
      "1": {
        loc: {
          start: {
            line: 30,
            column: 8
          },
          end: {
            line: 30,
            column: 51
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 30,
            column: 8
          },
          end: {
            line: 30,
            column: 21
          }
        }, {
          start: {
            line: 30,
            column: 25
          },
          end: {
            line: 30,
            column: 51
          }
        }],
        line: 30
      },
      "2": {
        loc: {
          start: {
            line: 37,
            column: 4
          },
          end: {
            line: 39,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 37,
            column: 4
          },
          end: {
            line: 39,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 37
      },
      "3": {
        loc: {
          start: {
            line: 49,
            column: 8
          },
          end: {
            line: 57,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 49,
            column: 8
          },
          end: {
            line: 57,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 49
      },
      "4": {
        loc: {
          start: {
            line: 62,
            column: 8
          },
          end: {
            line: 76,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 62,
            column: 8
          },
          end: {
            line: 76,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 62
      },
      "5": {
        loc: {
          start: {
            line: 62,
            column: 12
          },
          end: {
            line: 62,
            column: 66
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 62,
            column: 12
          },
          end: {
            line: 62,
            column: 29
          }
        }, {
          start: {
            line: 62,
            column: 33
          },
          end: {
            line: 62,
            column: 66
          }
        }],
        line: 62
      },
      "6": {
        loc: {
          start: {
            line: 84,
            column: 8
          },
          end: {
            line: 106,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 84,
            column: 8
          },
          end: {
            line: 106,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 84
      },
      "7": {
        loc: {
          start: {
            line: 113,
            column: 8
          },
          end: {
            line: 135,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 113,
            column: 8
          },
          end: {
            line: 135,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 113
      },
      "8": {
        loc: {
          start: {
            line: 159,
            column: 47
          },
          end: {
            line: 159,
            column: 59
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 159,
            column: 57
          },
          end: {
            line: 159,
            column: 59
          }
        }],
        line: 159
      },
      "9": {
        loc: {
          start: {
            line: 161,
            column: 8
          },
          end: {
            line: 161,
            column: 36
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 161,
            column: 22
          },
          end: {
            line: 161,
            column: 36
          }
        }],
        line: 161
      },
      "10": {
        loc: {
          start: {
            line: 162,
            column: 8
          },
          end: {
            line: 162,
            column: 44
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 162,
            column: 26
          },
          end: {
            line: 162,
            column: 44
          }
        }],
        line: 162
      },
      "11": {
        loc: {
          start: {
            line: 167,
            column: 8
          },
          end: {
            line: 169,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 167,
            column: 8
          },
          end: {
            line: 169,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 167
      },
      "12": {
        loc: {
          start: {
            line: 167,
            column: 12
          },
          end: {
            line: 167,
            column: 45
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 167,
            column: 12
          },
          end: {
            line: 167,
            column: 25
          }
        }, {
          start: {
            line: 167,
            column: 29
          },
          end: {
            line: 167,
            column: 45
          }
        }],
        line: 167
      },
      "13": {
        loc: {
          start: {
            line: 172,
            column: 29
          },
          end: {
            line: 172,
            column: 64
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 172,
            column: 29
          },
          end: {
            line: 172,
            column: 57
          }
        }, {
          start: {
            line: 172,
            column: 61
          },
          end: {
            line: 172,
            column: 64
          }
        }],
        line: 172
      },
      "14": {
        loc: {
          start: {
            line: 176,
            column: 8
          },
          end: {
            line: 196,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 176,
            column: 8
          },
          end: {
            line: 196,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 176
      },
      "15": {
        loc: {
          start: {
            line: 183,
            column: 16
          },
          end: {
            line: 185,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 183,
            column: 16
          },
          end: {
            line: 185,
            column: 17
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 183
      },
      "16": {
        loc: {
          start: {
            line: 199,
            column: 33
          },
          end: {
            line: 199,
            column: 65
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 199,
            column: 33
          },
          end: {
            line: 199,
            column: 58
          }
        }, {
          start: {
            line: 199,
            column: 62
          },
          end: {
            line: 199,
            column: 65
          }
        }],
        line: 199
      },
      "17": {
        loc: {
          start: {
            line: 202,
            column: 8
          },
          end: {
            line: 222,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 202,
            column: 8
          },
          end: {
            line: 222,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 202
      },
      "18": {
        loc: {
          start: {
            line: 209,
            column: 16
          },
          end: {
            line: 211,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 209,
            column: 16
          },
          end: {
            line: 211,
            column: 17
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 209
      },
      "19": {
        loc: {
          start: {
            line: 226,
            column: 8
          },
          end: {
            line: 228,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 226,
            column: 8
          },
          end: {
            line: 228,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 226
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0],
      "9": [0],
      "10": [0],
      "11": [0, 0],
      "12": [0, 0],
      "13": [0, 0],
      "14": [0, 0],
      "15": [0, 0],
      "16": [0, 0],
      "17": [0, 0],
      "18": [0, 0],
      "19": [0, 0]
    },
    inputSourceMap: null,
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "409bd695cf6b8dd1b970b72d669bce402d7a2879"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_6wzoo6utb = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_6wzoo6utb();
/**
 * Session Timeout Middleware
 * TICKET #013: HIPAA-compliant session timeout enforcement
 *
 * Implements:
 * - 15-minute idle timeout
 * - 8-hour absolute session timeout
 * - Automatic session destruction on timeout
 * - Audit logging of timeout events
 *
 * HIPAA Compliance: ยง164.312(a)(2)(iii) - Automatic Logoff
 */

import { db } from '../config/db.drizzle.js';
import { sessions } from '../db/schemas/index.js';
import { eq } from 'drizzle-orm';
import auth from '../config/betterAuth.js';

/**
 * Session timeout middleware for HIPAA compliance
 * Works with Better Auth session management
 * Enforces idle timeout and absolute timeout limits
 *
 * @param {Object} request - Fastify request object
 * @param {Object} reply - Fastify reply object
 * @returns {void|Response} - Returns 401 response if session expired
 */
/* istanbul ignore next */
cov_6wzoo6utb().s[0]++;
export const sessionTimeoutMiddleware = async (request, reply) => {
  /* istanbul ignore next */
  cov_6wzoo6utb().f[0]++;
  cov_6wzoo6utb().s[1]++;
  // Skip for public routes (no user or Better Auth session)
  if (
  /* istanbul ignore next */
  (cov_6wzoo6utb().b[1][0]++, !request.user) ||
  /* istanbul ignore next */
  (cov_6wzoo6utb().b[1][1]++, !request.betterAuthSession)) {
    /* istanbul ignore next */
    cov_6wzoo6utb().b[0][0]++;
    cov_6wzoo6utb().s[2]++;
    return;
  } else
  /* istanbul ignore next */
  {
    cov_6wzoo6utb().b[0][1]++;
  }
  const now =
  /* istanbul ignore next */
  (cov_6wzoo6utb().s[3]++, new Date());
  const sessionToken =
  /* istanbul ignore next */
  (cov_6wzoo6utb().s[4]++, request.cookies?.['better-auth.session_token']);
  /* istanbul ignore next */
  cov_6wzoo6utb().s[5]++;
  if (!sessionToken) {
    /* istanbul ignore next */
    cov_6wzoo6utb().b[2][0]++;
    cov_6wzoo6utb().s[6]++;
    return;
  } else
  /* istanbul ignore next */
  {
    cov_6wzoo6utb().b[2][1]++;
  }
  cov_6wzoo6utb().s[7]++;
  try {
    // Fetch session from database
    const sessionRecords =
    /* istanbul ignore next */
    (cov_6wzoo6utb().s[8]++, await db.select().from(sessions).where(eq(sessions.token, sessionToken)).limit(1));
    /* istanbul ignore next */
    cov_6wzoo6utb().s[9]++;
    if (sessionRecords.length === 0) {
      /* istanbul ignore next */
      cov_6wzoo6utb().b[3][0]++;
      cov_6wzoo6utb().s[10]++;
      // Session not found in database - already expired or invalid
      return reply.code(401).send({
        status: 401,
        error: 'Session Expired',
        message: 'Your session is invalid. Please log in again.',
        reason: 'session_not_found'
      });
    } else
    /* istanbul ignore next */
    {
      cov_6wzoo6utb().b[3][1]++;
    }
    const session =
    /* istanbul ignore next */
    (cov_6wzoo6utb().s[11]++, sessionRecords[0]);

    // Check if session has expired (Better Auth handles this, but double-check)
    /* istanbul ignore next */
    cov_6wzoo6utb().s[12]++;
    if (
    /* istanbul ignore next */
    (cov_6wzoo6utb().b[5][0]++, session.expiresAt) &&
    /* istanbul ignore next */
    (cov_6wzoo6utb().b[5][1]++, new Date(session.expiresAt) < now)) {
      /* istanbul ignore next */
      cov_6wzoo6utb().b[4][0]++;
      cov_6wzoo6utb().s[13]++;
      request.log.warn({
        userId: request.user.id,
        userEmail: request.user.email,
        ip: request.ip,
        path: request.url
      }, 'Session expired (database expiration)');
      /* istanbul ignore next */
      cov_6wzoo6utb().s[14]++;
      return reply.code(401).send({
        status: 401,
        error: 'Session Expired',
        message: 'Your session has expired. Please log in again.',
        reason: 'session_expired'
      });
    } else
    /* istanbul ignore next */
    {
      cov_6wzoo6utb().b[4][1]++;
    }

    // Check idle timeout (15 minutes of inactivity)
    // Use updatedAt as last activity timestamp
    const lastActivity =
    /* istanbul ignore next */
    (cov_6wzoo6utb().s[15]++, new Date(session.updatedAt));
    const idleTime =
    /* istanbul ignore next */
    (cov_6wzoo6utb().s[16]++, now - lastActivity);
    const maxIdleTime =
    /* istanbul ignore next */
    (cov_6wzoo6utb().s[17]++, 15 * 60 * 1000); // 15 minutes in milliseconds
    /* istanbul ignore next */
    cov_6wzoo6utb().s[18]++;
    if (idleTime > maxIdleTime) {
      /* istanbul ignore next */
      cov_6wzoo6utb().b[6][0]++;
      cov_6wzoo6utb().s[19]++;
      // Log idle timeout event for audit trail
      request.log.warn({
        userId: request.user.id,
        userEmail: request.user.email,
        idleMinutes: Math.floor(idleTime / 1000 / 60),
        ip: request.ip,
        userAgent: request.headers['user-agent'],
        path: request.url
      }, 'Session expired due to inactivity');

      // Delete session from database
      /* istanbul ignore next */
      cov_6wzoo6utb().s[20]++;
      await db.delete(sessions).where(eq(sessions.id, session.id));

      // Return 401 Unauthorized with detailed message
      /* istanbul ignore next */
      cov_6wzoo6utb().s[21]++;
      return reply.code(401).send({
        status: 401,
        error: 'Session Expired',
        message: 'Your session has expired due to inactivity. Please log in again.',
        reason: 'idle_timeout',
        idleMinutes: Math.floor(idleTime / 1000 / 60)
      });
    } else
    /* istanbul ignore next */
    {
      cov_6wzoo6utb().b[6][1]++;
    }

    // Check absolute timeout (8 hours maximum session age)
    const sessionCreatedAt =
    /* istanbul ignore next */
    (cov_6wzoo6utb().s[22]++, new Date(session.createdAt));
    const sessionAge =
    /* istanbul ignore next */
    (cov_6wzoo6utb().s[23]++, now - sessionCreatedAt);
    const maxSessionAge =
    /* istanbul ignore next */
    (cov_6wzoo6utb().s[24]++, 8 * 60 * 60 * 1000); // 8 hours in milliseconds
    /* istanbul ignore next */
    cov_6wzoo6utb().s[25]++;
    if (sessionAge > maxSessionAge) {
      /* istanbul ignore next */
      cov_6wzoo6utb().b[7][0]++;
      cov_6wzoo6utb().s[26]++;
      // Log absolute timeout event for audit trail
      request.log.warn({
        userId: request.user.id,
        userEmail: request.user.email,
        sessionHours: Math.floor(sessionAge / 1000 / 60 / 60),
        ip: request.ip,
        userAgent: request.headers['user-agent'],
        path: request.url
      }, 'Session expired due to absolute timeout');

      // Delete session from database
      /* istanbul ignore next */
      cov_6wzoo6utb().s[27]++;
      await db.delete(sessions).where(eq(sessions.id, session.id));

      // Return 401 Unauthorized with detailed message
      /* istanbul ignore next */
      cov_6wzoo6utb().s[28]++;
      return reply.code(401).send({
        status: 401,
        error: 'Session Expired',
        message: 'Your session has expired. Maximum session duration is 8 hours. Please log in again.',
        reason: 'absolute_timeout',
        sessionHours: Math.floor(sessionAge / 1000 / 60 / 60)
      });
    } else
    /* istanbul ignore next */
    {
      cov_6wzoo6utb().b[7][1]++;
    }

    // Update session's updatedAt timestamp to track activity
    cov_6wzoo6utb().s[29]++;
    await db.update(sessions).set({
      updatedAt: now
    }).where(eq(sessions.id, session.id));
  } catch (error) {
    /* istanbul ignore next */
    cov_6wzoo6utb().s[30]++;
    request.log.error({
      error,
      userId: request.user?.id
    }, 'Error in session timeout middleware');
    // Don't block the request on middleware errors
    // Better Auth will handle session validation
  }
};

/**
 * Factory function to create the session timeout middleware
 * Can be customized with different timeout values if needed
 *
 * @param {Object} options - Configuration options
 * @param {number} options.idleTimeout - Idle timeout in milliseconds (default: 15 minutes)
 * @param {number} options.absoluteTimeout - Absolute timeout in milliseconds (default: 8 hours)
 * @returns {Function} - Middleware function
 */
/* istanbul ignore next */
cov_6wzoo6utb().s[31]++;
export const createSessionTimeoutMiddleware = (options =
/* istanbul ignore next */
(cov_6wzoo6utb().b[8][0]++, {})) => {
  /* istanbul ignore next */
  cov_6wzoo6utb().f[1]++;
  const {
    idleTimeout =
    /* istanbul ignore next */
    (cov_6wzoo6utb().b[9][0]++, 15 * 60 * 1000),
    // 15 minutes
    absoluteTimeout =
    /* istanbul ignore next */
    (cov_6wzoo6utb().b[10][0]++, 8 * 60 * 60 * 1000) // 8 hours
  } =
  /* istanbul ignore next */
  (cov_6wzoo6utb().s[32]++, options);
  /* istanbul ignore next */
  cov_6wzoo6utb().s[33]++;
  return async (request, reply) => {
    /* istanbul ignore next */
    cov_6wzoo6utb().f[2]++;
    cov_6wzoo6utb().s[34]++;
    // Skip for public routes
    if (
    /* istanbul ignore next */
    (cov_6wzoo6utb().b[12][0]++, !request.user) ||
    /* istanbul ignore next */
    (cov_6wzoo6utb().b[12][1]++, !request.session)) {
      /* istanbul ignore next */
      cov_6wzoo6utb().b[11][0]++;
      cov_6wzoo6utb().s[35]++;
      return;
    } else
    /* istanbul ignore next */
    {
      cov_6wzoo6utb().b[11][1]++;
    }
    const now =
    /* istanbul ignore next */
    (cov_6wzoo6utb().s[36]++, Date.now());
    const lastActivity =
    /* istanbul ignore next */
    (cov_6wzoo6utb().s[37]++,
    /* istanbul ignore next */
    (cov_6wzoo6utb().b[13][0]++, request.session.lastActivity) ||
    /* istanbul ignore next */
    (cov_6wzoo6utb().b[13][1]++, now));
    const idleTime =
    /* istanbul ignore next */
    (cov_6wzoo6utb().s[38]++, now - lastActivity);

    // Check idle timeout
    /* istanbul ignore next */
    cov_6wzoo6utb().s[39]++;
    if (idleTime > idleTimeout) {
      /* istanbul ignore next */
      cov_6wzoo6utb().b[14][0]++;
      cov_6wzoo6utb().s[40]++;
      request.log.warn({
        userId: request.user.id,
        idleTime: Math.floor(idleTime / 1000 / 60)
      }, 'Session idle timeout');
      /* istanbul ignore next */
      cov_6wzoo6utb().s[41]++;
      try {
        /* istanbul ignore next */
        cov_6wzoo6utb().s[42]++;
        if (typeof request.session.destroy === 'function') {
          /* istanbul ignore next */
          cov_6wzoo6utb().b[15][0]++;
          cov_6wzoo6utb().s[43]++;
          await request.session.destroy();
        } else
        /* istanbul ignore next */
        {
          cov_6wzoo6utb().b[15][1]++;
        }
      } catch (error) {
        /* istanbul ignore next */
        cov_6wzoo6utb().s[44]++;
        request.log.error({
          error
        }, 'Error destroying session');
      }
      /* istanbul ignore next */
      cov_6wzoo6utb().s[45]++;
      return reply.code(401).send({
        status: 401,
        error: 'Session Expired',
        message: 'Your session has expired due to inactivity. Please log in again.',
        reason: 'idle_timeout'
      });
    } else
    /* istanbul ignore next */
    {
      cov_6wzoo6utb().b[14][1]++;
    }

    // Check absolute timeout
    const sessionCreatedAt =
    /* istanbul ignore next */
    (cov_6wzoo6utb().s[46]++,
    /* istanbul ignore next */
    (cov_6wzoo6utb().b[16][0]++, request.session.createdAt) ||
    /* istanbul ignore next */
    (cov_6wzoo6utb().b[16][1]++, now));
    const sessionAge =
    /* istanbul ignore next */
    (cov_6wzoo6utb().s[47]++, now - sessionCreatedAt);
    /* istanbul ignore next */
    cov_6wzoo6utb().s[48]++;
    if (sessionAge > absoluteTimeout) {
      /* istanbul ignore next */
      cov_6wzoo6utb().b[17][0]++;
      cov_6wzoo6utb().s[49]++;
      request.log.warn({
        userId: request.user.id,
        sessionAge: Math.floor(sessionAge / 1000 / 60 / 60)
      }, 'Session absolute timeout');
      /* istanbul ignore next */
      cov_6wzoo6utb().s[50]++;
      try {
        /* istanbul ignore next */
        cov_6wzoo6utb().s[51]++;
        if (typeof request.session.destroy === 'function') {
          /* istanbul ignore next */
          cov_6wzoo6utb().b[18][0]++;
          cov_6wzoo6utb().s[52]++;
          await request.session.destroy();
        } else
        /* istanbul ignore next */
        {
          cov_6wzoo6utb().b[18][1]++;
        }
      } catch (error) {
        /* istanbul ignore next */
        cov_6wzoo6utb().s[53]++;
        request.log.error({
          error
        }, 'Error destroying session');
      }
      /* istanbul ignore next */
      cov_6wzoo6utb().s[54]++;
      return reply.code(401).send({
        status: 401,
        error: 'Session Expired',
        message: 'Your session has expired. Please log in again.',
        reason: 'absolute_timeout'
      });
    } else
    /* istanbul ignore next */
    {
      cov_6wzoo6utb().b[17][1]++;
    }

    // Update last activity
    cov_6wzoo6utb().s[55]++;
    request.session.lastActivity = now;
    /* istanbul ignore next */
    cov_6wzoo6utb().s[56]++;
    if (!request.session.createdAt) {
      /* istanbul ignore next */
      cov_6wzoo6utb().b[19][0]++;
      cov_6wzoo6utb().s[57]++;
      request.session.createdAt = now;
    } else
    /* istanbul ignore next */
    {
      cov_6wzoo6utb().b[19][1]++;
    }
  };
};
export default sessionTimeoutMiddleware;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfNnd6b282dXRiIiwiYWN0dWFsQ292ZXJhZ2UiLCJkYiIsInNlc3Npb25zIiwiZXEiLCJhdXRoIiwicyIsInNlc3Npb25UaW1lb3V0TWlkZGxld2FyZSIsInJlcXVlc3QiLCJyZXBseSIsImYiLCJiIiwidXNlciIsImJldHRlckF1dGhTZXNzaW9uIiwibm93IiwiRGF0ZSIsInNlc3Npb25Ub2tlbiIsImNvb2tpZXMiLCJzZXNzaW9uUmVjb3JkcyIsInNlbGVjdCIsImZyb20iLCJ3aGVyZSIsInRva2VuIiwibGltaXQiLCJsZW5ndGgiLCJjb2RlIiwic2VuZCIsInN0YXR1cyIsImVycm9yIiwibWVzc2FnZSIsInJlYXNvbiIsInNlc3Npb24iLCJleHBpcmVzQXQiLCJsb2ciLCJ3YXJuIiwidXNlcklkIiwiaWQiLCJ1c2VyRW1haWwiLCJlbWFpbCIsImlwIiwicGF0aCIsInVybCIsImxhc3RBY3Rpdml0eSIsInVwZGF0ZWRBdCIsImlkbGVUaW1lIiwibWF4SWRsZVRpbWUiLCJpZGxlTWludXRlcyIsIk1hdGgiLCJmbG9vciIsInVzZXJBZ2VudCIsImhlYWRlcnMiLCJkZWxldGUiLCJzZXNzaW9uQ3JlYXRlZEF0IiwiY3JlYXRlZEF0Iiwic2Vzc2lvbkFnZSIsIm1heFNlc3Npb25BZ2UiLCJzZXNzaW9uSG91cnMiLCJ1cGRhdGUiLCJzZXQiLCJjcmVhdGVTZXNzaW9uVGltZW91dE1pZGRsZXdhcmUiLCJvcHRpb25zIiwiaWRsZVRpbWVvdXQiLCJhYnNvbHV0ZVRpbWVvdXQiLCJkZXN0cm95Il0sInNvdXJjZXMiOlsic2Vzc2lvbi10aW1lb3V0Lm1pZGRsZXdhcmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTZXNzaW9uIFRpbWVvdXQgTWlkZGxld2FyZVxuICogVElDS0VUICMwMTM6IEhJUEFBLWNvbXBsaWFudCBzZXNzaW9uIHRpbWVvdXQgZW5mb3JjZW1lbnRcbiAqXG4gKiBJbXBsZW1lbnRzOlxuICogLSAxNS1taW51dGUgaWRsZSB0aW1lb3V0XG4gKiAtIDgtaG91ciBhYnNvbHV0ZSBzZXNzaW9uIHRpbWVvdXRcbiAqIC0gQXV0b21hdGljIHNlc3Npb24gZGVzdHJ1Y3Rpb24gb24gdGltZW91dFxuICogLSBBdWRpdCBsb2dnaW5nIG9mIHRpbWVvdXQgZXZlbnRzXG4gKlxuICogSElQQUEgQ29tcGxpYW5jZTogwqcxNjQuMzEyKGEpKDIpKGlpaSkgLSBBdXRvbWF0aWMgTG9nb2ZmXG4gKi9cblxuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi9jb25maWcvZGIuZHJpenpsZS5qcyc7XG5pbXBvcnQgeyBzZXNzaW9ucyB9IGZyb20gJy4uL2RiL3NjaGVtYXMvaW5kZXguanMnO1xuaW1wb3J0IHsgZXEgfSBmcm9tICdkcml6emxlLW9ybSc7XG5pbXBvcnQgYXV0aCBmcm9tICcuLi9jb25maWcvYmV0dGVyQXV0aC5qcyc7XG5cbi8qKlxuICogU2Vzc2lvbiB0aW1lb3V0IG1pZGRsZXdhcmUgZm9yIEhJUEFBIGNvbXBsaWFuY2VcbiAqIFdvcmtzIHdpdGggQmV0dGVyIEF1dGggc2Vzc2lvbiBtYW5hZ2VtZW50XG4gKiBFbmZvcmNlcyBpZGxlIHRpbWVvdXQgYW5kIGFic29sdXRlIHRpbWVvdXQgbGltaXRzXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IHJlcXVlc3QgLSBGYXN0aWZ5IHJlcXVlc3Qgb2JqZWN0XG4gKiBAcGFyYW0ge09iamVjdH0gcmVwbHkgLSBGYXN0aWZ5IHJlcGx5IG9iamVjdFxuICogQHJldHVybnMge3ZvaWR8UmVzcG9uc2V9IC0gUmV0dXJucyA0MDEgcmVzcG9uc2UgaWYgc2Vzc2lvbiBleHBpcmVkXG4gKi9cbmV4cG9ydCBjb25zdCBzZXNzaW9uVGltZW91dE1pZGRsZXdhcmUgPSBhc3luYyAocmVxdWVzdCwgcmVwbHkpID0+IHtcbiAgICAvLyBTa2lwIGZvciBwdWJsaWMgcm91dGVzIChubyB1c2VyIG9yIEJldHRlciBBdXRoIHNlc3Npb24pXG4gICAgaWYgKCFyZXF1ZXN0LnVzZXIgfHwgIXJlcXVlc3QuYmV0dGVyQXV0aFNlc3Npb24pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3Qgc2Vzc2lvblRva2VuID0gcmVxdWVzdC5jb29raWVzPy5bJ2JldHRlci1hdXRoLnNlc3Npb25fdG9rZW4nXTtcblxuICAgIGlmICghc2Vzc2lvblRva2VuKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICAvLyBGZXRjaCBzZXNzaW9uIGZyb20gZGF0YWJhc2VcbiAgICAgICAgY29uc3Qgc2Vzc2lvblJlY29yZHMgPSBhd2FpdCBkYlxuICAgICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgICAuZnJvbShzZXNzaW9ucylcbiAgICAgICAgICAgIC53aGVyZShlcShzZXNzaW9ucy50b2tlbiwgc2Vzc2lvblRva2VuKSlcbiAgICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICBpZiAoc2Vzc2lvblJlY29yZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAvLyBTZXNzaW9uIG5vdCBmb3VuZCBpbiBkYXRhYmFzZSAtIGFscmVhZHkgZXhwaXJlZCBvciBpbnZhbGlkXG4gICAgICAgICAgICByZXR1cm4gcmVwbHkuY29kZSg0MDEpLnNlbmQoe1xuICAgICAgICAgICAgICAgIHN0YXR1czogNDAxLFxuICAgICAgICAgICAgICAgIGVycm9yOiAnU2Vzc2lvbiBFeHBpcmVkJyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnWW91ciBzZXNzaW9uIGlzIGludmFsaWQuIFBsZWFzZSBsb2cgaW4gYWdhaW4uJyxcbiAgICAgICAgICAgICAgICByZWFzb246ICdzZXNzaW9uX25vdF9mb3VuZCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IHNlc3Npb25SZWNvcmRzWzBdO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHNlc3Npb24gaGFzIGV4cGlyZWQgKEJldHRlciBBdXRoIGhhbmRsZXMgdGhpcywgYnV0IGRvdWJsZS1jaGVjaylcbiAgICAgICAgaWYgKHNlc3Npb24uZXhwaXJlc0F0ICYmIG5ldyBEYXRlKHNlc3Npb24uZXhwaXJlc0F0KSA8IG5vdykge1xuICAgICAgICAgICAgcmVxdWVzdC5sb2cud2Fybih7XG4gICAgICAgICAgICAgICAgdXNlcklkOiByZXF1ZXN0LnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgdXNlckVtYWlsOiByZXF1ZXN0LnVzZXIuZW1haWwsXG4gICAgICAgICAgICAgICAgaXA6IHJlcXVlc3QuaXAsXG4gICAgICAgICAgICAgICAgcGF0aDogcmVxdWVzdC51cmxcbiAgICAgICAgICAgIH0sICdTZXNzaW9uIGV4cGlyZWQgKGRhdGFiYXNlIGV4cGlyYXRpb24pJyk7XG5cbiAgICAgICAgICAgIHJldHVybiByZXBseS5jb2RlKDQwMSkuc2VuZCh7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiA0MDEsXG4gICAgICAgICAgICAgICAgZXJyb3I6ICdTZXNzaW9uIEV4cGlyZWQnLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdZb3VyIHNlc3Npb24gaGFzIGV4cGlyZWQuIFBsZWFzZSBsb2cgaW4gYWdhaW4uJyxcbiAgICAgICAgICAgICAgICByZWFzb246ICdzZXNzaW9uX2V4cGlyZWQnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGlkbGUgdGltZW91dCAoMTUgbWludXRlcyBvZiBpbmFjdGl2aXR5KVxuICAgICAgICAvLyBVc2UgdXBkYXRlZEF0IGFzIGxhc3QgYWN0aXZpdHkgdGltZXN0YW1wXG4gICAgICAgIGNvbnN0IGxhc3RBY3Rpdml0eSA9IG5ldyBEYXRlKHNlc3Npb24udXBkYXRlZEF0KTtcbiAgICAgICAgY29uc3QgaWRsZVRpbWUgPSBub3cgLSBsYXN0QWN0aXZpdHk7XG4gICAgICAgIGNvbnN0IG1heElkbGVUaW1lID0gMTUgKiA2MCAqIDEwMDA7IC8vIDE1IG1pbnV0ZXMgaW4gbWlsbGlzZWNvbmRzXG5cbiAgICAgICAgaWYgKGlkbGVUaW1lID4gbWF4SWRsZVRpbWUpIHtcbiAgICAgICAgICAgIC8vIExvZyBpZGxlIHRpbWVvdXQgZXZlbnQgZm9yIGF1ZGl0IHRyYWlsXG4gICAgICAgICAgICByZXF1ZXN0LmxvZy53YXJuKHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHJlcXVlc3QudXNlci5pZCxcbiAgICAgICAgICAgICAgICB1c2VyRW1haWw6IHJlcXVlc3QudXNlci5lbWFpbCxcbiAgICAgICAgICAgICAgICBpZGxlTWludXRlczogTWF0aC5mbG9vcihpZGxlVGltZSAvIDEwMDAgLyA2MCksXG4gICAgICAgICAgICAgICAgaXA6IHJlcXVlc3QuaXAsXG4gICAgICAgICAgICAgICAgdXNlckFnZW50OiByZXF1ZXN0LmhlYWRlcnNbJ3VzZXItYWdlbnQnXSxcbiAgICAgICAgICAgICAgICBwYXRoOiByZXF1ZXN0LnVybFxuICAgICAgICAgICAgfSwgJ1Nlc3Npb24gZXhwaXJlZCBkdWUgdG8gaW5hY3Rpdml0eScpO1xuXG4gICAgICAgICAgICAvLyBEZWxldGUgc2Vzc2lvbiBmcm9tIGRhdGFiYXNlXG4gICAgICAgICAgICBhd2FpdCBkYi5kZWxldGUoc2Vzc2lvbnMpLndoZXJlKGVxKHNlc3Npb25zLmlkLCBzZXNzaW9uLmlkKSk7XG5cbiAgICAgICAgICAgIC8vIFJldHVybiA0MDEgVW5hdXRob3JpemVkIHdpdGggZGV0YWlsZWQgbWVzc2FnZVxuICAgICAgICAgICAgcmV0dXJuIHJlcGx5LmNvZGUoNDAxKS5zZW5kKHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IDQwMSxcbiAgICAgICAgICAgICAgICBlcnJvcjogJ1Nlc3Npb24gRXhwaXJlZCcsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1lvdXIgc2Vzc2lvbiBoYXMgZXhwaXJlZCBkdWUgdG8gaW5hY3Rpdml0eS4gUGxlYXNlIGxvZyBpbiBhZ2Fpbi4nLFxuICAgICAgICAgICAgICAgIHJlYXNvbjogJ2lkbGVfdGltZW91dCcsXG4gICAgICAgICAgICAgICAgaWRsZU1pbnV0ZXM6IE1hdGguZmxvb3IoaWRsZVRpbWUgLyAxMDAwIC8gNjApXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGFic29sdXRlIHRpbWVvdXQgKDggaG91cnMgbWF4aW11bSBzZXNzaW9uIGFnZSlcbiAgICAgICAgY29uc3Qgc2Vzc2lvbkNyZWF0ZWRBdCA9IG5ldyBEYXRlKHNlc3Npb24uY3JlYXRlZEF0KTtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbkFnZSA9IG5vdyAtIHNlc3Npb25DcmVhdGVkQXQ7XG4gICAgICAgIGNvbnN0IG1heFNlc3Npb25BZ2UgPSA4ICogNjAgKiA2MCAqIDEwMDA7IC8vIDggaG91cnMgaW4gbWlsbGlzZWNvbmRzXG5cbiAgICAgICAgaWYgKHNlc3Npb25BZ2UgPiBtYXhTZXNzaW9uQWdlKSB7XG4gICAgICAgICAgICAvLyBMb2cgYWJzb2x1dGUgdGltZW91dCBldmVudCBmb3IgYXVkaXQgdHJhaWxcbiAgICAgICAgICAgIHJlcXVlc3QubG9nLndhcm4oe1xuICAgICAgICAgICAgICAgIHVzZXJJZDogcmVxdWVzdC51c2VyLmlkLFxuICAgICAgICAgICAgICAgIHVzZXJFbWFpbDogcmVxdWVzdC51c2VyLmVtYWlsLFxuICAgICAgICAgICAgICAgIHNlc3Npb25Ib3VyczogTWF0aC5mbG9vcihzZXNzaW9uQWdlIC8gMTAwMCAvIDYwIC8gNjApLFxuICAgICAgICAgICAgICAgIGlwOiByZXF1ZXN0LmlwLFxuICAgICAgICAgICAgICAgIHVzZXJBZ2VudDogcmVxdWVzdC5oZWFkZXJzWyd1c2VyLWFnZW50J10sXG4gICAgICAgICAgICAgICAgcGF0aDogcmVxdWVzdC51cmxcbiAgICAgICAgICAgIH0sICdTZXNzaW9uIGV4cGlyZWQgZHVlIHRvIGFic29sdXRlIHRpbWVvdXQnKTtcblxuICAgICAgICAgICAgLy8gRGVsZXRlIHNlc3Npb24gZnJvbSBkYXRhYmFzZVxuICAgICAgICAgICAgYXdhaXQgZGIuZGVsZXRlKHNlc3Npb25zKS53aGVyZShlcShzZXNzaW9ucy5pZCwgc2Vzc2lvbi5pZCkpO1xuXG4gICAgICAgICAgICAvLyBSZXR1cm4gNDAxIFVuYXV0aG9yaXplZCB3aXRoIGRldGFpbGVkIG1lc3NhZ2VcbiAgICAgICAgICAgIHJldHVybiByZXBseS5jb2RlKDQwMSkuc2VuZCh7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiA0MDEsXG4gICAgICAgICAgICAgICAgZXJyb3I6ICdTZXNzaW9uIEV4cGlyZWQnLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdZb3VyIHNlc3Npb24gaGFzIGV4cGlyZWQuIE1heGltdW0gc2Vzc2lvbiBkdXJhdGlvbiBpcyA4IGhvdXJzLiBQbGVhc2UgbG9nIGluIGFnYWluLicsXG4gICAgICAgICAgICAgICAgcmVhc29uOiAnYWJzb2x1dGVfdGltZW91dCcsXG4gICAgICAgICAgICAgICAgc2Vzc2lvbkhvdXJzOiBNYXRoLmZsb29yKHNlc3Npb25BZ2UgLyAxMDAwIC8gNjAgLyA2MClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHNlc3Npb24ncyB1cGRhdGVkQXQgdGltZXN0YW1wIHRvIHRyYWNrIGFjdGl2aXR5XG4gICAgICAgIGF3YWl0IGRiXG4gICAgICAgICAgICAudXBkYXRlKHNlc3Npb25zKVxuICAgICAgICAgICAgLnNldCh7IHVwZGF0ZWRBdDogbm93IH0pXG4gICAgICAgICAgICAud2hlcmUoZXEoc2Vzc2lvbnMuaWQsIHNlc3Npb24uaWQpKTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJlcXVlc3QubG9nLmVycm9yKHsgZXJyb3IsIHVzZXJJZDogcmVxdWVzdC51c2VyPy5pZCB9LCAnRXJyb3IgaW4gc2Vzc2lvbiB0aW1lb3V0IG1pZGRsZXdhcmUnKTtcbiAgICAgICAgLy8gRG9uJ3QgYmxvY2sgdGhlIHJlcXVlc3Qgb24gbWlkZGxld2FyZSBlcnJvcnNcbiAgICAgICAgLy8gQmV0dGVyIEF1dGggd2lsbCBoYW5kbGUgc2Vzc2lvbiB2YWxpZGF0aW9uXG4gICAgfVxufTtcblxuLyoqXG4gKiBGYWN0b3J5IGZ1bmN0aW9uIHRvIGNyZWF0ZSB0aGUgc2Vzc2lvbiB0aW1lb3V0IG1pZGRsZXdhcmVcbiAqIENhbiBiZSBjdXN0b21pemVkIHdpdGggZGlmZmVyZW50IHRpbWVvdXQgdmFsdWVzIGlmIG5lZWRlZFxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gQ29uZmlndXJhdGlvbiBvcHRpb25zXG4gKiBAcGFyYW0ge251bWJlcn0gb3B0aW9ucy5pZGxlVGltZW91dCAtIElkbGUgdGltZW91dCBpbiBtaWxsaXNlY29uZHMgKGRlZmF1bHQ6IDE1IG1pbnV0ZXMpXG4gKiBAcGFyYW0ge251bWJlcn0gb3B0aW9ucy5hYnNvbHV0ZVRpbWVvdXQgLSBBYnNvbHV0ZSB0aW1lb3V0IGluIG1pbGxpc2Vjb25kcyAoZGVmYXVsdDogOCBob3VycylcbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gLSBNaWRkbGV3YXJlIGZ1bmN0aW9uXG4gKi9cbmV4cG9ydCBjb25zdCBjcmVhdGVTZXNzaW9uVGltZW91dE1pZGRsZXdhcmUgPSAob3B0aW9ucyA9IHt9KSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgICBpZGxlVGltZW91dCA9IDE1ICogNjAgKiAxMDAwLCAvLyAxNSBtaW51dGVzXG4gICAgICAgIGFic29sdXRlVGltZW91dCA9IDggKiA2MCAqIDYwICogMTAwMCAvLyA4IGhvdXJzXG4gICAgfSA9IG9wdGlvbnM7XG5cbiAgICByZXR1cm4gYXN5bmMgKHJlcXVlc3QsIHJlcGx5KSA9PiB7XG4gICAgICAgIC8vIFNraXAgZm9yIHB1YmxpYyByb3V0ZXNcbiAgICAgICAgaWYgKCFyZXF1ZXN0LnVzZXIgfHwgIXJlcXVlc3Quc2Vzc2lvbikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgY29uc3QgbGFzdEFjdGl2aXR5ID0gcmVxdWVzdC5zZXNzaW9uLmxhc3RBY3Rpdml0eSB8fCBub3c7XG4gICAgICAgIGNvbnN0IGlkbGVUaW1lID0gbm93IC0gbGFzdEFjdGl2aXR5O1xuXG4gICAgICAgIC8vIENoZWNrIGlkbGUgdGltZW91dFxuICAgICAgICBpZiAoaWRsZVRpbWUgPiBpZGxlVGltZW91dCkge1xuICAgICAgICAgICAgcmVxdWVzdC5sb2cud2Fybih7XG4gICAgICAgICAgICAgICAgdXNlcklkOiByZXF1ZXN0LnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgaWRsZVRpbWU6IE1hdGguZmxvb3IoaWRsZVRpbWUgLyAxMDAwIC8gNjApLFxuICAgICAgICAgICAgfSwgJ1Nlc3Npb24gaWRsZSB0aW1lb3V0Jyk7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXF1ZXN0LnNlc3Npb24uZGVzdHJveSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCByZXF1ZXN0LnNlc3Npb24uZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdC5sb2cuZXJyb3IoeyBlcnJvciB9LCAnRXJyb3IgZGVzdHJveWluZyBzZXNzaW9uJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXBseS5jb2RlKDQwMSkuc2VuZCh7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiA0MDEsXG4gICAgICAgICAgICAgICAgZXJyb3I6ICdTZXNzaW9uIEV4cGlyZWQnLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdZb3VyIHNlc3Npb24gaGFzIGV4cGlyZWQgZHVlIHRvIGluYWN0aXZpdHkuIFBsZWFzZSBsb2cgaW4gYWdhaW4uJyxcbiAgICAgICAgICAgICAgICByZWFzb246ICdpZGxlX3RpbWVvdXQnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGFic29sdXRlIHRpbWVvdXRcbiAgICAgICAgY29uc3Qgc2Vzc2lvbkNyZWF0ZWRBdCA9IHJlcXVlc3Quc2Vzc2lvbi5jcmVhdGVkQXQgfHwgbm93O1xuICAgICAgICBjb25zdCBzZXNzaW9uQWdlID0gbm93IC0gc2Vzc2lvbkNyZWF0ZWRBdDtcblxuICAgICAgICBpZiAoc2Vzc2lvbkFnZSA+IGFic29sdXRlVGltZW91dCkge1xuICAgICAgICAgICAgcmVxdWVzdC5sb2cud2Fybih7XG4gICAgICAgICAgICAgICAgdXNlcklkOiByZXF1ZXN0LnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgc2Vzc2lvbkFnZTogTWF0aC5mbG9vcihzZXNzaW9uQWdlIC8gMTAwMCAvIDYwIC8gNjApLFxuICAgICAgICAgICAgfSwgJ1Nlc3Npb24gYWJzb2x1dGUgdGltZW91dCcpO1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVxdWVzdC5zZXNzaW9uLmRlc3Ryb3kgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgcmVxdWVzdC5zZXNzaW9uLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHJlcXVlc3QubG9nLmVycm9yKHsgZXJyb3IgfSwgJ0Vycm9yIGRlc3Ryb3lpbmcgc2Vzc2lvbicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVwbHkuY29kZSg0MDEpLnNlbmQoe1xuICAgICAgICAgICAgICAgIHN0YXR1czogNDAxLFxuICAgICAgICAgICAgICAgIGVycm9yOiAnU2Vzc2lvbiBFeHBpcmVkJyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnWW91ciBzZXNzaW9uIGhhcyBleHBpcmVkLiBQbGVhc2UgbG9nIGluIGFnYWluLicsXG4gICAgICAgICAgICAgICAgcmVhc29uOiAnYWJzb2x1dGVfdGltZW91dCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIGxhc3QgYWN0aXZpdHlcbiAgICAgICAgcmVxdWVzdC5zZXNzaW9uLmxhc3RBY3Rpdml0eSA9IG5vdztcbiAgICAgICAgaWYgKCFyZXF1ZXN0LnNlc3Npb24uY3JlYXRlZEF0KSB7XG4gICAgICAgICAgICByZXF1ZXN0LnNlc3Npb24uY3JlYXRlZEF0ID0gbm93O1xuICAgICAgICB9XG4gICAgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHNlc3Npb25UaW1lb3V0TWlkZGxld2FyZTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQWVZO0lBQUFBLGFBQUEsWUFBQUEsQ0FBQTtNQUFBLE9BQUFDLGNBQUE7SUFBQTtFQUFBO0VBQUEsT0FBQUEsY0FBQTtBQUFBO0FBQUFELGFBQUE7QUFm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