{"version":3,"names":["cov_cb03bxtun","actualCoverage","ElectronicSignatureController","PERMISSIONS","requireAnyPermission","electronicSignatureRoutes","fastify","options","f","s","post","preHandler","UPDATE_CLINICAL_NOTES","create","get","VIEW_CLINICAL_NOTES","show","getByDocument","verify","createVerificationToken","verifyByToken","cosign","getPendingCosignatures","DELETE_CLINICAL_NOTES","revoke","VIEW_AUDIT_LOGS","getAuditTrail","getMySignatures","VIEW_REPORTS","getComplianceReport"],"sources":["electronicSignature.routes.js"],"sourcesContent":["import ElectronicSignatureController from '../controllers/ElectronicSignature.controller.js';\nimport { PERMISSIONS } from '../config/rbac.js';\nimport { requireAnyPermission } from '../middleware/rbac.middleware.js';\n\n/**\n * Electronic Signature Routes\n *\n * 21 CFR Part 11 Compliant Electronic Signature API\n *\n * All routes require authentication via the global auth middleware.\n * Additional permission checks are applied where needed.\n */\nasync function electronicSignatureRoutes(fastify, options) {\n  // ============================================================================\n  // SIGNATURE CREATION & MANAGEMENT\n  // ============================================================================\n\n  /**\n   * Create a new electronic signature\n   * POST /electronic-signatures\n   *\n   * Required body fields:\n   * - document_type: Type of document being signed (e.g., 'encounter', 'order', 'certification')\n   * - document_id: ID of the document being signed\n   * - signature_type: TYPED | DRAWN | BIOMETRIC | PIN | SMART_CARD | DIGITAL_CERT\n   * - signature_meaning: AUTHOR | REVIEWER | APPROVER | VERIFIER | WITNESS | COSIGNER | etc.\n   * - signature_statement: Legal statement the signer is acknowledging\n   * - signature_data: Actual signature data (typed name, base64 image, etc.)\n   *\n   * Optional fields:\n   * - document_content: Content to hash for integrity verification\n   * - document_version: Version of the document (default: '1.0')\n   * - signature_image_format: Format for DRAWN signatures (PNG, SVG)\n   * - requires_cosigner: Whether a cosignature is required (default: false)\n   * - required_cosigner_id: Specific user ID required to cosign\n   * - required_cosigner_role: Role required for cosigner (e.g., 'doctor')\n   * - cosignature_deadline: Deadline for cosignature\n   * - regulatory_context: Regulatory framework (default: 'HIPAA')\n   * - metadata: Additional metadata object\n   */\n  fastify.post('/electronic-signatures', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, ElectronicSignatureController.create);\n\n  /**\n   * Get electronic signature by ID\n   * GET /electronic-signatures/:id\n   */\n  fastify.get('/electronic-signatures/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, ElectronicSignatureController.show);\n\n  /**\n   * Get all signatures for a specific document\n   * GET /electronic-signatures/document/:documentType/:documentId\n   *\n   * Query parameters:\n   * - status: Filter by signature status (VALID, PENDING_REVIEW, REVOKED, etc.)\n   * - meaning: Filter by signature meaning (AUTHOR, COSIGNER, etc.)\n   * - include_superseded: Include superseded signatures (default: false)\n   */\n  fastify.get('/electronic-signatures/document/:documentType/:documentId', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, ElectronicSignatureController.getByDocument);\n\n  // ============================================================================\n  // SIGNATURE VERIFICATION\n  // ============================================================================\n\n  /**\n   * Verify signature integrity\n   * POST /electronic-signatures/:id/verify\n   *\n   * Verifies that the document content matches the stored hash.\n   * Required body:\n   * - document_content: Content to verify against stored hash\n   */\n  fastify.post('/electronic-signatures/:id/verify', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, ElectronicSignatureController.verify);\n\n  /**\n   * Create a verification token for external verification\n   * POST /electronic-signatures/:id/verification-token\n   *\n   * Creates a token that can be used to verify the signature without authentication.\n   * Useful for sharing verification links with external parties.\n   *\n   * Optional body:\n   * - expires_in_hours: Hours until token expires (default: 24)\n   * - max_uses: Maximum number of times token can be used (default: unlimited)\n   */\n  fastify.post('/electronic-signatures/:id/verification-token', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, ElectronicSignatureController.createVerificationToken);\n\n  /**\n   * Verify signature using external token (public endpoint)\n   * GET /electronic-signatures/verify-token/:token\n   *\n   * This endpoint does not require authentication - anyone with the token\n   * can verify the signature. Rate limiting should be applied.\n   */\n  fastify.get('/electronic-signatures/verify-token/:token', {\n    // No authentication required for token-based verification\n  }, ElectronicSignatureController.verifyByToken);\n\n  // ============================================================================\n  // COSIGNATURE WORKFLOW\n  // ============================================================================\n\n  /**\n   * Cosign a signature\n   * POST /electronic-signatures/:id/cosign\n   *\n   * Creates a cosignature for a document that requires cosigning.\n   * The cosigner must be authorized (matching required_cosigner_id or required_cosigner_role).\n   *\n   * Required body:\n   * - signature_data: Cosigner's signature data\n   *\n   * Optional body:\n   * - signature_type: Type of signature (default: TYPED)\n   * - signature_statement: Custom statement (default: standard cosigner statement)\n   * - signature_image_format: Format for DRAWN signatures\n   */\n  fastify.post('/electronic-signatures/:id/cosign', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, ElectronicSignatureController.cosign);\n\n  /**\n   * Get pending cosignatures for the current user\n   * GET /electronic-signatures/pending-cosignatures\n   *\n   * Returns all signatures that require cosigning by the current user\n   * based on their user ID or role.\n   */\n  fastify.get('/electronic-signatures/pending-cosignatures', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, ElectronicSignatureController.getPendingCosignatures);\n\n  // ============================================================================\n  // SIGNATURE REVOCATION\n  // ============================================================================\n\n  /**\n   * Revoke a signature\n   * POST /electronic-signatures/:id/revoke\n   *\n   * Marks a signature as revoked. This is an immutable operation -\n   * the signature record is preserved for audit purposes.\n   *\n   * Required body:\n   * - revocation_reason: Reason for revoking the signature\n   */\n  fastify.post('/electronic-signatures/:id/revoke', {\n    preHandler: [requireAnyPermission(PERMISSIONS.DELETE_CLINICAL_NOTES)]\n  }, ElectronicSignatureController.revoke);\n\n  // ============================================================================\n  // AUDIT & REPORTING\n  // ============================================================================\n\n  /**\n   * Get signature audit trail\n   * GET /electronic-signatures/:id/audit-trail\n   *\n   * Returns the complete audit trail for a signature, including\n   * all events (creation, views, verifications, etc.).\n   */\n  fastify.get('/electronic-signatures/:id/audit-trail', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_AUDIT_LOGS)]\n  }, ElectronicSignatureController.getAuditTrail);\n\n  /**\n   * Get current user's signature history\n   * GET /electronic-signatures/my-signatures\n   *\n   * Query parameters:\n   * - limit: Number of results (default: 50)\n   * - offset: Pagination offset (default: 0)\n   * - status: Filter by status\n   * - document_type: Filter by document type\n   * - start_date: Filter by signed_at >= date\n   * - end_date: Filter by signed_at <= date\n   */\n  fastify.get('/electronic-signatures/my-signatures', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, ElectronicSignatureController.getMySignatures);\n\n  /**\n   * Get compliance report for signatures\n   * GET /electronic-signatures/compliance-report\n   *\n   * Generates a compliance report with signature statistics.\n   *\n   * Query parameters:\n   * - start_date: Start of reporting period (default: 30 days ago)\n   * - end_date: End of reporting period (default: now)\n   */\n  fastify.get('/electronic-signatures/compliance-report', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_AUDIT_LOGS, PERMISSIONS.VIEW_REPORTS)]\n  }, ElectronicSignatureController.getComplianceReport);\n}\n\nexport default electronicSignatureRoutes;\n"],"mappings":"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","ignoreList":[]}