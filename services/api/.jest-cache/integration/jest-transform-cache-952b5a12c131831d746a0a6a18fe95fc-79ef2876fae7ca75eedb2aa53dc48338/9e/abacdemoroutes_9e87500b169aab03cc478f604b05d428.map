{"version":3,"names":["cov_1ftjep2fj9","actualCoverage","authenticate","requireRole","requirePermission","requireAbacAccess","requirePatientRecordAccess","requireRbacAndAbac","requireRbacOrAbac","ROLES","PERMISSIONS","abacDemoRoutes","fastify","options","f","s","get","preHandler","ADMIN","request","reply","status","message","user","DOCTOR","NURSE","params","id","patientId","VIEW_PATIENT","type","ownerId","role","b"],"sources":["abac-demo.routes.js"],"sourcesContent":["import { authenticate } from \"../middleware/betterAuth.middleware.js\";\nimport {\n  requireRole,\n  requirePermission,\n} from \"../middleware/rbac.middleware.js\";\nimport {\n  requireAbacAccess,\n  requirePatientRecordAccess,\n  requireRbacAndAbac,\n  requireRbacOrAbac,\n} from \"../middleware/abac.middleware.js\";\nimport { ROLES, PERMISSIONS } from \"../config/rbac.js\";\n\n// Fastify plugin for ABAC demo routes\nasync function abacDemoRoutes(fastify, options) {\n  // Demo route showing RBAC only - Admins can access\n  fastify.get(\n    \"/rbac-only/admin\",\n    {\n      preHandler: [authenticate, requireRole(ROLES.ADMIN)],\n    },\n    async (request, reply) => {\n      return {\n        status: 200,\n        message: \"RBAC Only: Admins can access this route\",\n        user: request.user,\n      };\n    }\n  );\n\n  // Demo route showing RBAC only - Healthcare staff can access\n  fastify.get(\n    \"/rbac-only/healthcare\",\n    {\n      preHandler: [authenticate, requireRole(ROLES.ADMIN, ROLES.DOCTOR, ROLES.NURSE)],\n    },\n    async (request, reply) => {\n      return {\n        status: 200,\n        message: \"RBAC Only: Healthcare staff can access this route\",\n        user: request.user,\n      };\n    }\n  );\n\n  // Demo route showing ABAC only - Access based on patient record ownership\n  fastify.get(\n    \"/abac-only/patient/:id\",\n    {\n      preHandler: [authenticate, requirePatientRecordAccess((request) => request.params.id)],\n    },\n    async (request, reply) => {\n      return {\n        status: 200,\n        message: \"ABAC Only: Access granted based on patient record ownership\",\n        user: request.user,\n        patientId: request.params.id,\n      };\n    }\n  );\n\n  // Demo route showing RBAC and ABAC together - User must have permission AND satisfy ABAC policies\n  fastify.get(\n    \"/rbac-and-abac/patient/:id\",\n    {\n      preHandler: [\n        authenticate,\n        requireRbacAndAbac([PERMISSIONS.VIEW_PATIENT], {\n          type: \"patient_record\",\n          ownerId: null /* will be set dynamically */,\n        }),\n      ],\n    },\n    async (request, reply) => {\n      return {\n        status: 200,\n        message:\n          \"RBAC and ABAC: Both permission and attribute policies satisfied\",\n        user: request.user,\n        patientId: request.params.id,\n      };\n    }\n  );\n\n  // Demo route showing RBAC or ABAC - User can satisfy either RBAC permissions or ABAC policies\n  fastify.get(\n    \"/rbac-or-abac/patient/:id\",\n    {\n      preHandler: [\n        authenticate,\n        requireRbacOrAbac([PERMISSIONS.VIEW_PATIENT], {\n          type: \"patient_record\",\n          ownerId: null /* will be set dynamically */,\n        }),\n      ],\n    },\n    async (request, reply) => {\n      return {\n        status: 200,\n        message:\n          \"RBAC or ABAC: Either permission or attribute policies satisfied\",\n        user: request.user,\n        patientId: request.params.id,\n      };\n    }\n  );\n\n  // Demo route showing complex access control - Admins always have access, doctors have access during business hours\n  fastify.get(\n    \"/complex-access/patient/:id\",\n    {\n      preHandler: [\n        authenticate,\n        async (request, reply) => {\n          // First check if user is admin (they always have access)\n          if (request.user.role === ROLES.ADMIN) {\n            return;\n          }\n\n          // For non-admins, apply ABAC access control\n          await requirePatientRecordAccess((request) => request.params.id)(request, reply);\n        },\n      ],\n    },\n    async (request, reply) => {\n      return {\n        status: 200,\n        message:\n          \"Complex Access Control: Access granted based on role and attributes\",\n        user: request.user,\n        patientId: request.params.id,\n      };\n    }\n  );\n}\n\nexport default abacDemoRoutes;\n"],"mappings":"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","ignoreList":[]}