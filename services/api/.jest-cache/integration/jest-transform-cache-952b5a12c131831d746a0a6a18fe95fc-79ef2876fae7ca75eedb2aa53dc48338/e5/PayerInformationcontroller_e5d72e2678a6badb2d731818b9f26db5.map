{"version":3,"names":["cov_f6q6y5rxd","actualCoverage","db","payer_information","eq","logger","PayerInformationController","store","request","reply","f","s","patient_id","social_security","medicare_beneficiary","medicaid_number","medicaid_recipient","payer_info","body","b","code","message","existingPayerInfo","select","id","from","where","limit","payerInfo","payerInformationData","undefined","result","update","set","returning","insert","values","data","error","show","params","payerInformationRecords","createdAt","updatedAt","payerInformation"],"sources":["PayerInformation.controller.js"],"sourcesContent":["import { db } from \"../../config/db.drizzle.js\";\nimport { payer_information } from \"../../db/schemas/payerInformation.schema.js\";\nimport { eq } from \"drizzle-orm\";\n\nimport { logger } from '../../utils/logger.js';\nclass PayerInformationController {\n    // Store or update payer information\n    async store(request, reply) {\n        try {\n            const {\n                patient_id,\n                social_security,\n                medicare_beneficiary,\n                medicaid_number,\n                medicaid_recipient,\n                payer_info,\n            } = request.body;\n\n            // Validate required fields\n            if (!patient_id) {\n                reply.code(400);\n            return {\n                    message: \"Patient ID is required\",\n                };\n            }\n\n            // Check if payer information already exists for this patient\n            const existingPayerInfo = await db.select({\n                id: payer_information.id,\n            }).from(payer_information).where(eq(payer_information.patient_id, patient_id)).limit(1);\n            const payerInfo = existingPayerInfo[0];\n\n            // Prepare data for update or create\n            const payerInformationData = {\n                patient_id: patient_id,\n                social_security: social_security || null,\n                medicare_beneficiary: medicare_beneficiary || null,\n                medicaid_number: medicaid_number || null,\n                medicaid_recipient:\n                    medicaid_recipient !== undefined\n                        ? medicaid_recipient\n                        : null,\n                payer_info: payer_info || null,\n            };\n\n            let result;\n            if (payerInfo) {\n                // Update existing payer information\n                result = await db.update(payer_information).set(payerInformationData).where(eq(payer_information.patient_id, patient_id)).returning();\n                result = result[0];\n            } else {\n                // Create new payer information\n                result = await db.insert(payer_information).values(payerInformationData).returning();\n                result = result[0];\n            }\n\n            reply.code(200);\n            return {\n                message: \"Données sauvegardées avec succès\",\n                data: result,\n            };\n        } catch (error) {\n            logger.error(\"Error saving payer information:\", error)\n            reply.code(500);\n            return {\n                message: \"Internal server error\",\n                error: error.message,\n            };\n        }\n    }\n\n    // Show payer information for a specific patient\n    async show(request, reply) {\n        try {\n            const { id } = request.params;\n\n            const payerInformationRecords = await db.select({\n                id: payer_information.id,\n                patient_id: payer_information.patient_id,\n                social_security: payer_information.social_security,\n                medicare_beneficiary: payer_information.medicare_beneficiary,\n                medicaid_number: payer_information.medicaid_number,\n                payer_info: payer_information.payer_info,\n                medicaid_recipient: payer_information.medicaid_recipient,\n                createdAt: payer_information.createdAt,\n                updatedAt: payer_information.updatedAt,\n            }).from(payer_information).where(eq(payer_information.patient_id, id)).limit(1);\n            const payerInformation = payerInformationRecords[0];\n\n            if (!payerInformation) {\n                reply.code(404);\n            return {\n                    error: \"No payer information found for this patient\",\n                };\n            }\n\n            reply.code(200);\n            return payerInformation;\n        } catch (error) {\n            logger.error(\"Error fetching payer information:\", error)\n            reply.code(500);\n            return {\n                message: \"Internal server error\",\n                error: error.message,\n            };\n        }\n    }\n}\n\nexport default new PayerInformationController();"],"mappings":"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","ignoreList":[]}