faf3d034fcdf55d5e5506fc6c1ca51e5
/* istanbul ignore next */
function cov_f6q6y5rxd() {
  var path = "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/controllers/patient/PayerInformation.controller.js";
  var hash = "7e0989420cf45cc55bed4089cfe963af44b0a32c";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/controllers/patient/PayerInformation.controller.js",
    statementMap: {
      "0": {
        start: {
          line: 9,
          column: 8
        },
        end: {
          line: 69,
          column: 9
        }
      },
      "1": {
        start: {
          line: 17,
          column: 16
        },
        end: {
          line: 17,
          column: 28
        }
      },
      "2": {
        start: {
          line: 20,
          column: 12
        },
        end: {
          line: 25,
          column: 13
        }
      },
      "3": {
        start: {
          line: 21,
          column: 16
        },
        end: {
          line: 21,
          column: 32
        }
      },
      "4": {
        start: {
          line: 22,
          column: 12
        },
        end: {
          line: 24,
          column: 18
        }
      },
      "5": {
        start: {
          line: 28,
          column: 38
        },
        end: {
          line: 30,
          column: 99
        }
      },
      "6": {
        start: {
          line: 31,
          column: 30
        },
        end: {
          line: 31,
          column: 50
        }
      },
      "7": {
        start: {
          line: 34,
          column: 41
        },
        end: {
          line: 44,
          column: 13
        }
      },
      "8": {
        start: {
          line: 47,
          column: 12
        },
        end: {
          line: 55,
          column: 13
        }
      },
      "9": {
        start: {
          line: 49,
          column: 16
        },
        end: {
          line: 49,
          column: 150
        }
      },
      "10": {
        start: {
          line: 50,
          column: 16
        },
        end: {
          line: 50,
          column: 35
        }
      },
      "11": {
        start: {
          line: 53,
          column: 16
        },
        end: {
          line: 53,
          column: 101
        }
      },
      "12": {
        start: {
          line: 54,
          column: 16
        },
        end: {
          line: 54,
          column: 35
        }
      },
      "13": {
        start: {
          line: 57,
          column: 12
        },
        end: {
          line: 57,
          column: 28
        }
      },
      "14": {
        start: {
          line: 58,
          column: 12
        },
        end: {
          line: 61,
          column: 14
        }
      },
      "15": {
        start: {
          line: 63,
          column: 12
        },
        end: {
          line: 63,
          column: 66
        }
      },
      "16": {
        start: {
          line: 64,
          column: 12
        },
        end: {
          line: 64,
          column: 28
        }
      },
      "17": {
        start: {
          line: 65,
          column: 12
        },
        end: {
          line: 68,
          column: 14
        }
      },
      "18": {
        start: {
          line: 74,
          column: 8
        },
        end: {
          line: 106,
          column: 9
        }
      },
      "19": {
        start: {
          line: 75,
          column: 27
        },
        end: {
          line: 75,
          column: 41
        }
      },
      "20": {
        start: {
          line: 77,
          column: 44
        },
        end: {
          line: 87,
          column: 91
        }
      },
      "21": {
        start: {
          line: 88,
          column: 37
        },
        end: {
          line: 88,
          column: 63
        }
      },
      "22": {
        start: {
          line: 90,
          column: 12
        },
        end: {
          line: 95,
          column: 13
        }
      },
      "23": {
        start: {
          line: 91,
          column: 16
        },
        end: {
          line: 91,
          column: 32
        }
      },
      "24": {
        start: {
          line: 92,
          column: 12
        },
        end: {
          line: 94,
          column: 18
        }
      },
      "25": {
        start: {
          line: 97,
          column: 12
        },
        end: {
          line: 97,
          column: 28
        }
      },
      "26": {
        start: {
          line: 98,
          column: 12
        },
        end: {
          line: 98,
          column: 36
        }
      },
      "27": {
        start: {
          line: 100,
          column: 12
        },
        end: {
          line: 100,
          column: 68
        }
      },
      "28": {
        start: {
          line: 101,
          column: 12
        },
        end: {
          line: 101,
          column: 28
        }
      },
      "29": {
        start: {
          line: 102,
          column: 12
        },
        end: {
          line: 105,
          column: 14
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 8,
            column: 4
          },
          end: {
            line: 8,
            column: 5
          }
        },
        loc: {
          start: {
            line: 8,
            column: 32
          },
          end: {
            line: 70,
            column: 5
          }
        },
        line: 8
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 73,
            column: 4
          },
          end: {
            line: 73,
            column: 5
          }
        },
        loc: {
          start: {
            line: 73,
            column: 31
          },
          end: {
            line: 107,
            column: 5
          }
        },
        line: 73
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 20,
            column: 12
          },
          end: {
            line: 25,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 20,
            column: 12
          },
          end: {
            line: 25,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 20
      },
      "1": {
        loc: {
          start: {
            line: 36,
            column: 33
          },
          end: {
            line: 36,
            column: 56
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 36,
            column: 33
          },
          end: {
            line: 36,
            column: 48
          }
        }, {
          start: {
            line: 36,
            column: 52
          },
          end: {
            line: 36,
            column: 56
          }
        }],
        line: 36
      },
      "2": {
        loc: {
          start: {
            line: 37,
            column: 38
          },
          end: {
            line: 37,
            column: 66
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 37,
            column: 38
          },
          end: {
            line: 37,
            column: 58
          }
        }, {
          start: {
            line: 37,
            column: 62
          },
          end: {
            line: 37,
            column: 66
          }
        }],
        line: 37
      },
      "3": {
        loc: {
          start: {
            line: 38,
            column: 33
          },
          end: {
            line: 38,
            column: 56
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 38,
            column: 33
          },
          end: {
            line: 38,
            column: 48
          }
        }, {
          start: {
            line: 38,
            column: 52
          },
          end: {
            line: 38,
            column: 56
          }
        }],
        line: 38
      },
      "4": {
        loc: {
          start: {
            line: 40,
            column: 20
          },
          end: {
            line: 42,
            column: 30
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 41,
            column: 26
          },
          end: {
            line: 41,
            column: 44
          }
        }, {
          start: {
            line: 42,
            column: 26
          },
          end: {
            line: 42,
            column: 30
          }
        }],
        line: 40
      },
      "5": {
        loc: {
          start: {
            line: 43,
            column: 28
          },
          end: {
            line: 43,
            column: 46
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 43,
            column: 28
          },
          end: {
            line: 43,
            column: 38
          }
        }, {
          start: {
            line: 43,
            column: 42
          },
          end: {
            line: 43,
            column: 46
          }
        }],
        line: 43
      },
      "6": {
        loc: {
          start: {
            line: 47,
            column: 12
          },
          end: {
            line: 55,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 47,
            column: 12
          },
          end: {
            line: 55,
            column: 13
          }
        }, {
          start: {
            line: 51,
            column: 19
          },
          end: {
            line: 55,
            column: 13
          }
        }],
        line: 47
      },
      "7": {
        loc: {
          start: {
            line: 90,
            column: 12
          },
          end: {
            line: 95,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 90,
            column: 12
          },
          end: {
            line: 95,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 90
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0
    },
    f: {
      "0": 0,
      "1": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0]
    },
    inputSourceMap: null,
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "7e0989420cf45cc55bed4089cfe963af44b0a32c"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_f6q6y5rxd = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_f6q6y5rxd();
import { db } from "../../config/db.drizzle.js";
import { payer_information } from "../../db/schemas/payerInformation.schema.js";
import { eq } from "drizzle-orm";
import { logger } from '../../utils/logger.js';
class PayerInformationController {
  // Store or update payer information
  async store(request, reply) {
    /* istanbul ignore next */
    cov_f6q6y5rxd().f[0]++;
    cov_f6q6y5rxd().s[0]++;
    try {
      const {
        patient_id,
        social_security,
        medicare_beneficiary,
        medicaid_number,
        medicaid_recipient,
        payer_info
      } =
      /* istanbul ignore next */
      (cov_f6q6y5rxd().s[1]++, request.body);

      // Validate required fields
      /* istanbul ignore next */
      cov_f6q6y5rxd().s[2]++;
      if (!patient_id) {
        /* istanbul ignore next */
        cov_f6q6y5rxd().b[0][0]++;
        cov_f6q6y5rxd().s[3]++;
        reply.code(400);
        /* istanbul ignore next */
        cov_f6q6y5rxd().s[4]++;
        return {
          message: "Patient ID is required"
        };
      } else
      /* istanbul ignore next */
      {
        cov_f6q6y5rxd().b[0][1]++;
      }

      // Check if payer information already exists for this patient
      const existingPayerInfo =
      /* istanbul ignore next */
      (cov_f6q6y5rxd().s[5]++, await db.select({
        id: payer_information.id
      }).from(payer_information).where(eq(payer_information.patient_id, patient_id)).limit(1));
      const payerInfo =
      /* istanbul ignore next */
      (cov_f6q6y5rxd().s[6]++, existingPayerInfo[0]);

      // Prepare data for update or create
      const payerInformationData =
      /* istanbul ignore next */
      (cov_f6q6y5rxd().s[7]++, {
        patient_id: patient_id,
        social_security:
        /* istanbul ignore next */
        (cov_f6q6y5rxd().b[1][0]++, social_security) ||
        /* istanbul ignore next */
        (cov_f6q6y5rxd().b[1][1]++, null),
        medicare_beneficiary:
        /* istanbul ignore next */
        (cov_f6q6y5rxd().b[2][0]++, medicare_beneficiary) ||
        /* istanbul ignore next */
        (cov_f6q6y5rxd().b[2][1]++, null),
        medicaid_number:
        /* istanbul ignore next */
        (cov_f6q6y5rxd().b[3][0]++, medicaid_number) ||
        /* istanbul ignore next */
        (cov_f6q6y5rxd().b[3][1]++, null),
        medicaid_recipient: medicaid_recipient !== undefined ?
        /* istanbul ignore next */
        (cov_f6q6y5rxd().b[4][0]++, medicaid_recipient) :
        /* istanbul ignore next */
        (cov_f6q6y5rxd().b[4][1]++, null),
        payer_info:
        /* istanbul ignore next */
        (cov_f6q6y5rxd().b[5][0]++, payer_info) ||
        /* istanbul ignore next */
        (cov_f6q6y5rxd().b[5][1]++, null)
      });
      let result;
      /* istanbul ignore next */
      cov_f6q6y5rxd().s[8]++;
      if (payerInfo) {
        /* istanbul ignore next */
        cov_f6q6y5rxd().b[6][0]++;
        cov_f6q6y5rxd().s[9]++;
        // Update existing payer information
        result = await db.update(payer_information).set(payerInformationData).where(eq(payer_information.patient_id, patient_id)).returning();
        /* istanbul ignore next */
        cov_f6q6y5rxd().s[10]++;
        result = result[0];
      } else {
        /* istanbul ignore next */
        cov_f6q6y5rxd().b[6][1]++;
        cov_f6q6y5rxd().s[11]++;
        // Create new payer information
        result = await db.insert(payer_information).values(payerInformationData).returning();
        /* istanbul ignore next */
        cov_f6q6y5rxd().s[12]++;
        result = result[0];
      }
      /* istanbul ignore next */
      cov_f6q6y5rxd().s[13]++;
      reply.code(200);
      /* istanbul ignore next */
      cov_f6q6y5rxd().s[14]++;
      return {
        message: "Données sauvegardées avec succès",
        data: result
      };
    } catch (error) {
      /* istanbul ignore next */
      cov_f6q6y5rxd().s[15]++;
      logger.error("Error saving payer information:", error);
      /* istanbul ignore next */
      cov_f6q6y5rxd().s[16]++;
      reply.code(500);
      /* istanbul ignore next */
      cov_f6q6y5rxd().s[17]++;
      return {
        message: "Internal server error",
        error: error.message
      };
    }
  }

  // Show payer information for a specific patient
  async show(request, reply) {
    /* istanbul ignore next */
    cov_f6q6y5rxd().f[1]++;
    cov_f6q6y5rxd().s[18]++;
    try {
      const {
        id
      } =
      /* istanbul ignore next */
      (cov_f6q6y5rxd().s[19]++, request.params);
      const payerInformationRecords =
      /* istanbul ignore next */
      (cov_f6q6y5rxd().s[20]++, await db.select({
        id: payer_information.id,
        patient_id: payer_information.patient_id,
        social_security: payer_information.social_security,
        medicare_beneficiary: payer_information.medicare_beneficiary,
        medicaid_number: payer_information.medicaid_number,
        payer_info: payer_information.payer_info,
        medicaid_recipient: payer_information.medicaid_recipient,
        createdAt: payer_information.createdAt,
        updatedAt: payer_information.updatedAt
      }).from(payer_information).where(eq(payer_information.patient_id, id)).limit(1));
      const payerInformation =
      /* istanbul ignore next */
      (cov_f6q6y5rxd().s[21]++, payerInformationRecords[0]);
      /* istanbul ignore next */
      cov_f6q6y5rxd().s[22]++;
      if (!payerInformation) {
        /* istanbul ignore next */
        cov_f6q6y5rxd().b[7][0]++;
        cov_f6q6y5rxd().s[23]++;
        reply.code(404);
        /* istanbul ignore next */
        cov_f6q6y5rxd().s[24]++;
        return {
          error: "No payer information found for this patient"
        };
      } else
      /* istanbul ignore next */
      {
        cov_f6q6y5rxd().b[7][1]++;
      }
      cov_f6q6y5rxd().s[25]++;
      reply.code(200);
      /* istanbul ignore next */
      cov_f6q6y5rxd().s[26]++;
      return payerInformation;
    } catch (error) {
      /* istanbul ignore next */
      cov_f6q6y5rxd().s[27]++;
      logger.error("Error fetching payer information:", error);
      /* istanbul ignore next */
      cov_f6q6y5rxd().s[28]++;
      reply.code(500);
      /* istanbul ignore next */
      cov_f6q6y5rxd().s[29]++;
      return {
        message: "Internal server error",
        error: error.message
      };
    }
  }
}
export default new PayerInformationController();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfZjZxNnk1cnhkIiwiYWN0dWFsQ292ZXJhZ2UiLCJkYiIsInBheWVyX2luZm9ybWF0aW9uIiwiZXEiLCJsb2dnZXIiLCJQYXllckluZm9ybWF0aW9uQ29udHJvbGxlciIsInN0b3JlIiwicmVxdWVzdCIsInJlcGx5IiwiZiIsInMiLCJwYXRpZW50X2lkIiwic29jaWFsX3NlY3VyaXR5IiwibWVkaWNhcmVfYmVuZWZpY2lhcnkiLCJtZWRpY2FpZF9udW1iZXIiLCJtZWRpY2FpZF9yZWNpcGllbnQiLCJwYXllcl9pbmZvIiwiYm9keSIsImIiLCJjb2RlIiwibWVzc2FnZSIsImV4aXN0aW5nUGF5ZXJJbmZvIiwic2VsZWN0IiwiaWQiLCJmcm9tIiwid2hlcmUiLCJsaW1pdCIsInBheWVySW5mbyIsInBheWVySW5mb3JtYXRpb25EYXRhIiwidW5kZWZpbmVkIiwicmVzdWx0IiwidXBkYXRlIiwic2V0IiwicmV0dXJuaW5nIiwiaW5zZXJ0IiwidmFsdWVzIiwiZGF0YSIsImVycm9yIiwic2hvdyIsInBhcmFtcyIsInBheWVySW5mb3JtYXRpb25SZWNvcmRzIiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicGF5ZXJJbmZvcm1hdGlvbiJdLCJzb3VyY2VzIjpbIlBheWVySW5mb3JtYXRpb24uY29udHJvbGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkYiB9IGZyb20gXCIuLi8uLi9jb25maWcvZGIuZHJpenpsZS5qc1wiO1xuaW1wb3J0IHsgcGF5ZXJfaW5mb3JtYXRpb24gfSBmcm9tIFwiLi4vLi4vZGIvc2NoZW1hcy9wYXllckluZm9ybWF0aW9uLnNjaGVtYS5qc1wiO1xuaW1wb3J0IHsgZXEgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vLi4vdXRpbHMvbG9nZ2VyLmpzJztcbmNsYXNzIFBheWVySW5mb3JtYXRpb25Db250cm9sbGVyIHtcbiAgICAvLyBTdG9yZSBvciB1cGRhdGUgcGF5ZXIgaW5mb3JtYXRpb25cbiAgICBhc3luYyBzdG9yZShyZXF1ZXN0LCByZXBseSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgICAgIHBhdGllbnRfaWQsXG4gICAgICAgICAgICAgICAgc29jaWFsX3NlY3VyaXR5LFxuICAgICAgICAgICAgICAgIG1lZGljYXJlX2JlbmVmaWNpYXJ5LFxuICAgICAgICAgICAgICAgIG1lZGljYWlkX251bWJlcixcbiAgICAgICAgICAgICAgICBtZWRpY2FpZF9yZWNpcGllbnQsXG4gICAgICAgICAgICAgICAgcGF5ZXJfaW5mbyxcbiAgICAgICAgICAgIH0gPSByZXF1ZXN0LmJvZHk7XG5cbiAgICAgICAgICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xuICAgICAgICAgICAgaWYgKCFwYXRpZW50X2lkKSB7XG4gICAgICAgICAgICAgICAgcmVwbHkuY29kZSg0MDApO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJQYXRpZW50IElEIGlzIHJlcXVpcmVkXCIsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgcGF5ZXIgaW5mb3JtYXRpb24gYWxyZWFkeSBleGlzdHMgZm9yIHRoaXMgcGF0aWVudFxuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdQYXllckluZm8gPSBhd2FpdCBkYi5zZWxlY3Qoe1xuICAgICAgICAgICAgICAgIGlkOiBwYXllcl9pbmZvcm1hdGlvbi5pZCxcbiAgICAgICAgICAgIH0pLmZyb20ocGF5ZXJfaW5mb3JtYXRpb24pLndoZXJlKGVxKHBheWVyX2luZm9ybWF0aW9uLnBhdGllbnRfaWQsIHBhdGllbnRfaWQpKS5saW1pdCgxKTtcbiAgICAgICAgICAgIGNvbnN0IHBheWVySW5mbyA9IGV4aXN0aW5nUGF5ZXJJbmZvWzBdO1xuXG4gICAgICAgICAgICAvLyBQcmVwYXJlIGRhdGEgZm9yIHVwZGF0ZSBvciBjcmVhdGVcbiAgICAgICAgICAgIGNvbnN0IHBheWVySW5mb3JtYXRpb25EYXRhID0ge1xuICAgICAgICAgICAgICAgIHBhdGllbnRfaWQ6IHBhdGllbnRfaWQsXG4gICAgICAgICAgICAgICAgc29jaWFsX3NlY3VyaXR5OiBzb2NpYWxfc2VjdXJpdHkgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICBtZWRpY2FyZV9iZW5lZmljaWFyeTogbWVkaWNhcmVfYmVuZWZpY2lhcnkgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICBtZWRpY2FpZF9udW1iZXI6IG1lZGljYWlkX251bWJlciB8fCBudWxsLFxuICAgICAgICAgICAgICAgIG1lZGljYWlkX3JlY2lwaWVudDpcbiAgICAgICAgICAgICAgICAgICAgbWVkaWNhaWRfcmVjaXBpZW50ICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgICAgID8gbWVkaWNhaWRfcmVjaXBpZW50XG4gICAgICAgICAgICAgICAgICAgICAgICA6IG51bGwsXG4gICAgICAgICAgICAgICAgcGF5ZXJfaW5mbzogcGF5ZXJfaW5mbyB8fCBudWxsLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbGV0IHJlc3VsdDtcbiAgICAgICAgICAgIGlmIChwYXllckluZm8pIHtcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgcGF5ZXIgaW5mb3JtYXRpb25cbiAgICAgICAgICAgICAgICByZXN1bHQgPSBhd2FpdCBkYi51cGRhdGUocGF5ZXJfaW5mb3JtYXRpb24pLnNldChwYXllckluZm9ybWF0aW9uRGF0YSkud2hlcmUoZXEocGF5ZXJfaW5mb3JtYXRpb24ucGF0aWVudF9pZCwgcGF0aWVudF9pZCkpLnJldHVybmluZygpO1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdFswXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIG5ldyBwYXllciBpbmZvcm1hdGlvblxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IGRiLmluc2VydChwYXllcl9pbmZvcm1hdGlvbikudmFsdWVzKHBheWVySW5mb3JtYXRpb25EYXRhKS5yZXR1cm5pbmcoKTtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSByZXN1bHRbMF07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlcGx5LmNvZGUoMjAwKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJEb25uw6llcyBzYXV2ZWdhcmTDqWVzIGF2ZWMgc3VjY8Ooc1wiLFxuICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoXCJFcnJvciBzYXZpbmcgcGF5ZXIgaW5mb3JtYXRpb246XCIsIGVycm9yKVxuICAgICAgICAgICAgcmVwbHkuY29kZSg1MDApO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkludGVybmFsIHNlcnZlciBlcnJvclwiLFxuICAgICAgICAgICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIFNob3cgcGF5ZXIgaW5mb3JtYXRpb24gZm9yIGEgc3BlY2lmaWMgcGF0aWVudFxuICAgIGFzeW5jIHNob3cocmVxdWVzdCwgcmVwbHkpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHsgaWQgfSA9IHJlcXVlc3QucGFyYW1zO1xuXG4gICAgICAgICAgICBjb25zdCBwYXllckluZm9ybWF0aW9uUmVjb3JkcyA9IGF3YWl0IGRiLnNlbGVjdCh7XG4gICAgICAgICAgICAgICAgaWQ6IHBheWVyX2luZm9ybWF0aW9uLmlkLFxuICAgICAgICAgICAgICAgIHBhdGllbnRfaWQ6IHBheWVyX2luZm9ybWF0aW9uLnBhdGllbnRfaWQsXG4gICAgICAgICAgICAgICAgc29jaWFsX3NlY3VyaXR5OiBwYXllcl9pbmZvcm1hdGlvbi5zb2NpYWxfc2VjdXJpdHksXG4gICAgICAgICAgICAgICAgbWVkaWNhcmVfYmVuZWZpY2lhcnk6IHBheWVyX2luZm9ybWF0aW9uLm1lZGljYXJlX2JlbmVmaWNpYXJ5LFxuICAgICAgICAgICAgICAgIG1lZGljYWlkX251bWJlcjogcGF5ZXJfaW5mb3JtYXRpb24ubWVkaWNhaWRfbnVtYmVyLFxuICAgICAgICAgICAgICAgIHBheWVyX2luZm86IHBheWVyX2luZm9ybWF0aW9uLnBheWVyX2luZm8sXG4gICAgICAgICAgICAgICAgbWVkaWNhaWRfcmVjaXBpZW50OiBwYXllcl9pbmZvcm1hdGlvbi5tZWRpY2FpZF9yZWNpcGllbnQsXG4gICAgICAgICAgICAgICAgY3JlYXRlZEF0OiBwYXllcl9pbmZvcm1hdGlvbi5jcmVhdGVkQXQsXG4gICAgICAgICAgICAgICAgdXBkYXRlZEF0OiBwYXllcl9pbmZvcm1hdGlvbi51cGRhdGVkQXQsXG4gICAgICAgICAgICB9KS5mcm9tKHBheWVyX2luZm9ybWF0aW9uKS53aGVyZShlcShwYXllcl9pbmZvcm1hdGlvbi5wYXRpZW50X2lkLCBpZCkpLmxpbWl0KDEpO1xuICAgICAgICAgICAgY29uc3QgcGF5ZXJJbmZvcm1hdGlvbiA9IHBheWVySW5mb3JtYXRpb25SZWNvcmRzWzBdO1xuXG4gICAgICAgICAgICBpZiAoIXBheWVySW5mb3JtYXRpb24pIHtcbiAgICAgICAgICAgICAgICByZXBseS5jb2RlKDQwNCk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBlcnJvcjogXCJObyBwYXllciBpbmZvcm1hdGlvbiBmb3VuZCBmb3IgdGhpcyBwYXRpZW50XCIsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVwbHkuY29kZSgyMDApO1xuICAgICAgICAgICAgcmV0dXJuIHBheWVySW5mb3JtYXRpb247XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBwYXllciBpbmZvcm1hdGlvbjpcIiwgZXJyb3IpXG4gICAgICAgICAgICByZXBseS5jb2RlKDUwMCk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiSW50ZXJuYWwgc2VydmVyIGVycm9yXCIsXG4gICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBuZXcgUGF5ZXJJbmZvcm1hdGlvbkNvbnRyb2xsZXIoKTsiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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