{"version":3,"names":["cov_w1rgflqv3","actualCoverage","db","report_schedules","eq","and","isNull","lte","asc","logger","ReportExecutionService","ReportDeliveryService","isRunning","s","MAX_CONCURRENT_REPORTS","b","parseInt","process","env","processScheduledReports","f","warn","skipped","reason","startTime","Date","now","results","processed","successful","failed","details","info","initialize","dueSchedules","select","from","where","is_active","deleted_at","next_execution_at","orderBy","limit","length","message","chunks","chunkArray","chunk","chunkResults","Promise","allSettled","map","schedule","executeScheduledReport","i","result","status","value","push","schedule_id","id","configuration_id","report_id","reportId","delivery_status","deliveryStatus","error","duration","duration_ms","pause_start_date","pause_end_date","pauseStart","pauseEnd","end_date","update","set","updated_at","report","executeReport","parameters","schedule_parameters","outputFormat","output_format","executionType","scheduleId","deliveryResult","deliverReport","deliveryError","getScheduledReportsJobStatus","maxConcurrent","triggerScheduledReports","array","size","slice"],"sources":["scheduledReports.job.js"],"sourcesContent":["import { db } from \"../config/db.drizzle.js\";\nimport { report_schedules } from \"../db/schemas/index.js\";\nimport { eq, and, isNull, lte, asc } from \"drizzle-orm\";\nimport { logger } from \"../utils/logger.js\";\nimport ReportExecutionService from \"../services/ReportExecutionService.js\";\nimport ReportDeliveryService from \"../services/ReportDeliveryService.js\";\n\n/**\n * Scheduled Reports Job\n * Processes all due scheduled reports\n *\n * This job runs at configured intervals to:\n * 1. Find all schedules with next_execution_at <= now\n * 2. Execute each report using ReportExecutionService\n * 3. Deliver results using ReportDeliveryService\n * 4. Update schedule with next execution time\n *\n * HIPAA Compliance:\n * - All executions are logged\n * - Error handling with audit trail\n * - Rate limiting to prevent abuse\n */\n\n// Track concurrent executions to prevent overload\nlet isRunning = false;\nconst MAX_CONCURRENT_REPORTS = parseInt(process.env.MAX_CONCURRENT_REPORTS) || 5;\n\n/**\n * Process all due scheduled reports\n * @returns {Object} Execution summary\n */\nexport async function processScheduledReports() {\n  // Prevent concurrent runs\n  if (isRunning) {\n    logger.warn('Scheduled reports job already running, skipping...');\n    return { skipped: true, reason: 'Job already running' };\n  }\n\n  isRunning = true;\n  const startTime = Date.now();\n  const results = {\n    processed: 0,\n    successful: 0,\n    failed: 0,\n    skipped: 0,\n    details: []\n  };\n\n  try {\n    logger.info('Starting scheduled reports job...');\n\n    // Initialize the execution service (ensure output directory exists)\n    await ReportExecutionService.initialize();\n\n    // Find all due schedules\n    const now = new Date();\n    const dueSchedules = await db\n      .select()\n      .from(report_schedules)\n      .where(and(\n        eq(report_schedules.is_active, true),\n        isNull(report_schedules.deleted_at),\n        lte(report_schedules.next_execution_at, now)\n      ))\n      .orderBy(asc(report_schedules.next_execution_at))\n      .limit(MAX_CONCURRENT_REPORTS * 2); // Get more than we'll process in case some skip\n\n    if (dueSchedules.length === 0) {\n      logger.info('No scheduled reports due for execution');\n      return { ...results, message: 'No reports due' };\n    }\n\n    logger.info(`Found ${dueSchedules.length} scheduled reports due for execution`);\n\n    // Process schedules with concurrency limit\n    const chunks = chunkArray(dueSchedules, MAX_CONCURRENT_REPORTS);\n\n    for (const chunk of chunks) {\n      const chunkResults = await Promise.allSettled(\n        chunk.map(schedule => executeScheduledReport(schedule))\n      );\n\n      for (let i = 0; i < chunkResults.length; i++) {\n        const result = chunkResults[i];\n        const schedule = chunk[i];\n\n        results.processed++;\n\n        if (result.status === 'fulfilled') {\n          if (result.value.skipped) {\n            results.skipped++;\n            results.details.push({\n              schedule_id: schedule.id,\n              status: 'SKIPPED',\n              reason: result.value.reason\n            });\n          } else {\n            results.successful++;\n            results.details.push({\n              schedule_id: schedule.id,\n              configuration_id: schedule.configuration_id,\n              status: 'SUCCESS',\n              report_id: result.value.reportId,\n              delivery_status: result.value.deliveryStatus\n            });\n          }\n        } else {\n          results.failed++;\n          results.details.push({\n            schedule_id: schedule.id,\n            configuration_id: schedule.configuration_id,\n            status: 'FAILED',\n            error: result.reason?.message || 'Unknown error'\n          });\n          logger.error(`Scheduled report ${schedule.id} failed:`, result.reason);\n        }\n      }\n    }\n\n    const duration = Date.now() - startTime;\n    logger.info(`Scheduled reports job completed in ${duration}ms`, results);\n\n    return {\n      ...results,\n      duration_ms: duration\n    };\n\n  } catch (error) {\n    logger.error('Scheduled reports job failed:', error);\n    throw error;\n  } finally {\n    isRunning = false;\n  }\n}\n\n/**\n * Execute a single scheduled report\n * @param {Object} schedule - Schedule record\n * @returns {Object} Execution result\n */\nasync function executeScheduledReport(schedule) {\n  logger.info(`Executing scheduled report: ${schedule.id} (config: ${schedule.configuration_id})`);\n\n  try {\n    // Check if within pause period\n    if (schedule.pause_start_date && schedule.pause_end_date) {\n      const now = new Date();\n      const pauseStart = new Date(schedule.pause_start_date);\n      const pauseEnd = new Date(schedule.pause_end_date);\n\n      if (now >= pauseStart && now <= pauseEnd) {\n        logger.info(`Schedule ${schedule.id} is paused until ${pauseEnd}`);\n        return { skipped: true, reason: 'Schedule is paused' };\n      }\n    }\n\n    // Check if schedule has ended\n    if (schedule.end_date && new Date(schedule.end_date) < new Date()) {\n      logger.info(`Schedule ${schedule.id} has ended`);\n\n      // Deactivate the schedule\n      await db\n        .update(report_schedules)\n        .set({\n          is_active: false,\n          updated_at: new Date()\n        })\n        .where(eq(report_schedules.id, schedule.id));\n\n      return { skipped: true, reason: 'Schedule has ended' };\n    }\n\n    // Execute the report\n    const report = await ReportExecutionService.executeReport(schedule.configuration_id, {\n      parameters: schedule.schedule_parameters,\n      outputFormat: schedule.output_format,\n      executionType: 'SCHEDULED',\n      scheduleId: schedule.id\n    });\n\n    if (report.skipped) {\n      return report;\n    }\n\n    // Deliver if successful\n    let deliveryStatus = 'NOT_REQUIRED';\n    if (report.status === 'SUCCESS') {\n      try {\n        const deliveryResult = await ReportDeliveryService.deliverReport(report.id, schedule.id);\n        deliveryStatus = deliveryResult.status;\n      } catch (deliveryError) {\n        logger.error(`Delivery failed for report ${report.id}:`, deliveryError);\n        deliveryStatus = 'FAILED';\n      }\n    }\n\n    return {\n      reportId: report.id,\n      status: report.status,\n      deliveryStatus\n    };\n\n  } catch (error) {\n    logger.error(`Error executing scheduled report ${schedule.id}:`, error);\n    throw error;\n  }\n}\n\n/**\n * Get the current status of the scheduled reports job\n * @returns {Object} Job status\n */\nexport function getScheduledReportsJobStatus() {\n  return {\n    isRunning,\n    maxConcurrent: MAX_CONCURRENT_REPORTS\n  };\n}\n\n/**\n * Manually trigger scheduled reports processing\n * (Useful for testing and admin operations)\n */\nexport async function triggerScheduledReports() {\n  return await processScheduledReports();\n}\n\n/**\n * Helper function to chunk an array\n */\nfunction chunkArray(array, size) {\n  const chunks = [];\n  for (let i = 0; i < array.length; i += size) {\n    chunks.push(array.slice(i, i + size));\n  }\n  return chunks;\n}\n\nexport default {\n  processScheduledReports,\n  getScheduledReportsJobStatus,\n  triggerScheduledReports\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}