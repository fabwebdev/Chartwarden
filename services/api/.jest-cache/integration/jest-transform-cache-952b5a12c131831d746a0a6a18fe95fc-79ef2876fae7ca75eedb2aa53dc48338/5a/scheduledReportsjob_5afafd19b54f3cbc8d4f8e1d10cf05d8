c3439aede7915c70f0a7b0be0e351d75
/* istanbul ignore next */
function cov_w1rgflqv3() {
  var path = "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/jobs/scheduledReports.job.js";
  var hash = "e722056e18bc09ae55fe31b324c92270df1c1b33";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/jobs/scheduledReports.job.js",
    statementMap: {
      "0": {
        start: {
          line: 25,
          column: 16
        },
        end: {
          line: 25,
          column: 21
        }
      },
      "1": {
        start: {
          line: 26,
          column: 31
        },
        end: {
          line: 26,
          column: 80
        }
      },
      "2": {
        start: {
          line: 34,
          column: 2
        },
        end: {
          line: 37,
          column: 3
        }
      },
      "3": {
        start: {
          line: 35,
          column: 4
        },
        end: {
          line: 35,
          column: 70
        }
      },
      "4": {
        start: {
          line: 36,
          column: 4
        },
        end: {
          line: 36,
          column: 60
        }
      },
      "5": {
        start: {
          line: 39,
          column: 2
        },
        end: {
          line: 39,
          column: 19
        }
      },
      "6": {
        start: {
          line: 40,
          column: 20
        },
        end: {
          line: 40,
          column: 30
        }
      },
      "7": {
        start: {
          line: 41,
          column: 18
        },
        end: {
          line: 47,
          column: 3
        }
      },
      "8": {
        start: {
          line: 49,
          column: 2
        },
        end: {
          line: 133,
          column: 3
        }
      },
      "9": {
        start: {
          line: 50,
          column: 4
        },
        end: {
          line: 50,
          column: 53
        }
      },
      "10": {
        start: {
          line: 53,
          column: 4
        },
        end: {
          line: 53,
          column: 46
        }
      },
      "11": {
        start: {
          line: 56,
          column: 16
        },
        end: {
          line: 56,
          column: 26
        }
      },
      "12": {
        start: {
          line: 57,
          column: 25
        },
        end: {
          line: 66,
          column: 40
        }
      },
      "13": {
        start: {
          line: 68,
          column: 4
        },
        end: {
          line: 71,
          column: 5
        }
      },
      "14": {
        start: {
          line: 69,
          column: 6
        },
        end: {
          line: 69,
          column: 60
        }
      },
      "15": {
        start: {
          line: 70,
          column: 6
        },
        end: {
          line: 70,
          column: 55
        }
      },
      "16": {
        start: {
          line: 73,
          column: 4
        },
        end: {
          line: 73,
          column: 84
        }
      },
      "17": {
        start: {
          line: 76,
          column: 19
        },
        end: {
          line: 76,
          column: 67
        }
      },
      "18": {
        start: {
          line: 78,
          column: 4
        },
        end: {
          line: 118,
          column: 5
        }
      },
      "19": {
        start: {
          line: 79,
          column: 27
        },
        end: {
          line: 81,
          column: 7
        }
      },
      "20": {
        start: {
          line: 80,
          column: 30
        },
        end: {
          line: 80,
          column: 62
        }
      },
      "21": {
        start: {
          line: 83,
          column: 6
        },
        end: {
          line: 117,
          column: 7
        }
      },
      "22": {
        start: {
          line: 83,
          column: 19
        },
        end: {
          line: 83,
          column: 20
        }
      },
      "23": {
        start: {
          line: 84,
          column: 23
        },
        end: {
          line: 84,
          column: 38
        }
      },
      "24": {
        start: {
          line: 85,
          column: 25
        },
        end: {
          line: 85,
          column: 33
        }
      },
      "25": {
        start: {
          line: 87,
          column: 8
        },
        end: {
          line: 87,
          column: 28
        }
      },
      "26": {
        start: {
          line: 89,
          column: 8
        },
        end: {
          line: 116,
          column: 9
        }
      },
      "27": {
        start: {
          line: 90,
          column: 10
        },
        end: {
          line: 106,
          column: 11
        }
      },
      "28": {
        start: {
          line: 91,
          column: 12
        },
        end: {
          line: 91,
          column: 30
        }
      },
      "29": {
        start: {
          line: 92,
          column: 12
        },
        end: {
          line: 96,
          column: 15
        }
      },
      "30": {
        start: {
          line: 98,
          column: 12
        },
        end: {
          line: 98,
          column: 33
        }
      },
      "31": {
        start: {
          line: 99,
          column: 12
        },
        end: {
          line: 105,
          column: 15
        }
      },
      "32": {
        start: {
          line: 108,
          column: 10
        },
        end: {
          line: 108,
          column: 27
        }
      },
      "33": {
        start: {
          line: 109,
          column: 10
        },
        end: {
          line: 114,
          column: 13
        }
      },
      "34": {
        start: {
          line: 115,
          column: 10
        },
        end: {
          line: 115,
          column: 81
        }
      },
      "35": {
        start: {
          line: 120,
          column: 21
        },
        end: {
          line: 120,
          column: 43
        }
      },
      "36": {
        start: {
          line: 121,
          column: 4
        },
        end: {
          line: 121,
          column: 77
        }
      },
      "37": {
        start: {
          line: 123,
          column: 4
        },
        end: {
          line: 126,
          column: 6
        }
      },
      "38": {
        start: {
          line: 129,
          column: 4
        },
        end: {
          line: 129,
          column: 57
        }
      },
      "39": {
        start: {
          line: 130,
          column: 4
        },
        end: {
          line: 130,
          column: 16
        }
      },
      "40": {
        start: {
          line: 132,
          column: 4
        },
        end: {
          line: 132,
          column: 22
        }
      },
      "41": {
        start: {
          line: 142,
          column: 2
        },
        end: {
          line: 142,
          column: 99
        }
      },
      "42": {
        start: {
          line: 144,
          column: 2
        },
        end: {
          line: 206,
          column: 3
        }
      },
      "43": {
        start: {
          line: 146,
          column: 4
        },
        end: {
          line: 155,
          column: 5
        }
      },
      "44": {
        start: {
          line: 147,
          column: 18
        },
        end: {
          line: 147,
          column: 28
        }
      },
      "45": {
        start: {
          line: 148,
          column: 25
        },
        end: {
          line: 148,
          column: 60
        }
      },
      "46": {
        start: {
          line: 149,
          column: 23
        },
        end: {
          line: 149,
          column: 56
        }
      },
      "47": {
        start: {
          line: 151,
          column: 6
        },
        end: {
          line: 154,
          column: 7
        }
      },
      "48": {
        start: {
          line: 152,
          column: 8
        },
        end: {
          line: 152,
          column: 75
        }
      },
      "49": {
        start: {
          line: 153,
          column: 8
        },
        end: {
          line: 153,
          column: 63
        }
      },
      "50": {
        start: {
          line: 158,
          column: 4
        },
        end: {
          line: 171,
          column: 5
        }
      },
      "51": {
        start: {
          line: 159,
          column: 6
        },
        end: {
          line: 159,
          column: 55
        }
      },
      "52": {
        start: {
          line: 162,
          column: 6
        },
        end: {
          line: 168,
          column: 53
        }
      },
      "53": {
        start: {
          line: 170,
          column: 6
        },
        end: {
          line: 170,
          column: 61
        }
      },
      "54": {
        start: {
          line: 174,
          column: 19
        },
        end: {
          line: 179,
          column: 6
        }
      },
      "55": {
        start: {
          line: 181,
          column: 4
        },
        end: {
          line: 183,
          column: 5
        }
      },
      "56": {
        start: {
          line: 182,
          column: 6
        },
        end: {
          line: 182,
          column: 20
        }
      },
      "57": {
        start: {
          line: 186,
          column: 25
        },
        end: {
          line: 186,
          column: 39
        }
      },
      "58": {
        start: {
          line: 187,
          column: 4
        },
        end: {
          line: 195,
          column: 5
        }
      },
      "59": {
        start: {
          line: 188,
          column: 6
        },
        end: {
          line: 194,
          column: 7
        }
      },
      "60": {
        start: {
          line: 189,
          column: 31
        },
        end: {
          line: 189,
          column: 96
        }
      },
      "61": {
        start: {
          line: 190,
          column: 8
        },
        end: {
          line: 190,
          column: 47
        }
      },
      "62": {
        start: {
          line: 192,
          column: 8
        },
        end: {
          line: 192,
          column: 80
        }
      },
      "63": {
        start: {
          line: 193,
          column: 8
        },
        end: {
          line: 193,
          column: 34
        }
      },
      "64": {
        start: {
          line: 197,
          column: 4
        },
        end: {
          line: 201,
          column: 6
        }
      },
      "65": {
        start: {
          line: 204,
          column: 4
        },
        end: {
          line: 204,
          column: 76
        }
      },
      "66": {
        start: {
          line: 205,
          column: 4
        },
        end: {
          line: 205,
          column: 16
        }
      },
      "67": {
        start: {
          line: 214,
          column: 2
        },
        end: {
          line: 217,
          column: 4
        }
      },
      "68": {
        start: {
          line: 225,
          column: 2
        },
        end: {
          line: 225,
          column: 41
        }
      },
      "69": {
        start: {
          line: 232,
          column: 17
        },
        end: {
          line: 232,
          column: 19
        }
      },
      "70": {
        start: {
          line: 233,
          column: 2
        },
        end: {
          line: 235,
          column: 3
        }
      },
      "71": {
        start: {
          line: 233,
          column: 15
        },
        end: {
          line: 233,
          column: 16
        }
      },
      "72": {
        start: {
          line: 234,
          column: 4
        },
        end: {
          line: 234,
          column: 42
        }
      },
      "73": {
        start: {
          line: 236,
          column: 2
        },
        end: {
          line: 236,
          column: 16
        }
      }
    },
    fnMap: {
      "0": {
        name: "processScheduledReports",
        decl: {
          start: {
            line: 32,
            column: 22
          },
          end: {
            line: 32,
            column: 45
          }
        },
        loc: {
          start: {
            line: 32,
            column: 48
          },
          end: {
            line: 134,
            column: 1
          }
        },
        line: 32
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 80,
            column: 18
          },
          end: {
            line: 80,
            column: 19
          }
        },
        loc: {
          start: {
            line: 80,
            column: 30
          },
          end: {
            line: 80,
            column: 62
          }
        },
        line: 80
      },
      "2": {
        name: "executeScheduledReport",
        decl: {
          start: {
            line: 141,
            column: 15
          },
          end: {
            line: 141,
            column: 37
          }
        },
        loc: {
          start: {
            line: 141,
            column: 48
          },
          end: {
            line: 207,
            column: 1
          }
        },
        line: 141
      },
      "3": {
        name: "getScheduledReportsJobStatus",
        decl: {
          start: {
            line: 213,
            column: 16
          },
          end: {
            line: 213,
            column: 44
          }
        },
        loc: {
          start: {
            line: 213,
            column: 47
          },
          end: {
            line: 218,
            column: 1
          }
        },
        line: 213
      },
      "4": {
        name: "triggerScheduledReports",
        decl: {
          start: {
            line: 224,
            column: 22
          },
          end: {
            line: 224,
            column: 45
          }
        },
        loc: {
          start: {
            line: 224,
            column: 48
          },
          end: {
            line: 226,
            column: 1
          }
        },
        line: 224
      },
      "5": {
        name: "chunkArray",
        decl: {
          start: {
            line: 231,
            column: 9
          },
          end: {
            line: 231,
            column: 19
          }
        },
        loc: {
          start: {
            line: 231,
            column: 33
          },
          end: {
            line: 237,
            column: 1
          }
        },
        line: 231
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 26,
            column: 31
          },
          end: {
            line: 26,
            column: 80
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 26,
            column: 31
          },
          end: {
            line: 26,
            column: 75
          }
        }, {
          start: {
            line: 26,
            column: 79
          },
          end: {
            line: 26,
            column: 80
          }
        }],
        line: 26
      },
      "1": {
        loc: {
          start: {
            line: 34,
            column: 2
          },
          end: {
            line: 37,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 34,
            column: 2
          },
          end: {
            line: 37,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 34
      },
      "2": {
        loc: {
          start: {
            line: 68,
            column: 4
          },
          end: {
            line: 71,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 68,
            column: 4
          },
          end: {
            line: 71,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 68
      },
      "3": {
        loc: {
          start: {
            line: 89,
            column: 8
          },
          end: {
            line: 116,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 89,
            column: 8
          },
          end: {
            line: 116,
            column: 9
          }
        }, {
          start: {
            line: 107,
            column: 15
          },
          end: {
            line: 116,
            column: 9
          }
        }],
        line: 89
      },
      "4": {
        loc: {
          start: {
            line: 90,
            column: 10
          },
          end: {
            line: 106,
            column: 11
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 90,
            column: 10
          },
          end: {
            line: 106,
            column: 11
          }
        }, {
          start: {
            line: 97,
            column: 17
          },
          end: {
            line: 106,
            column: 11
          }
        }],
        line: 90
      },
      "5": {
        loc: {
          start: {
            line: 113,
            column: 19
          },
          end: {
            line: 113,
            column: 60
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 113,
            column: 19
          },
          end: {
            line: 113,
            column: 41
          }
        }, {
          start: {
            line: 113,
            column: 45
          },
          end: {
            line: 113,
            column: 60
          }
        }],
        line: 113
      },
      "6": {
        loc: {
          start: {
            line: 146,
            column: 4
          },
          end: {
            line: 155,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 146,
            column: 4
          },
          end: {
            line: 155,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 146
      },
      "7": {
        loc: {
          start: {
            line: 146,
            column: 8
          },
          end: {
            line: 146,
            column: 60
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 146,
            column: 8
          },
          end: {
            line: 146,
            column: 33
          }
        }, {
          start: {
            line: 146,
            column: 37
          },
          end: {
            line: 146,
            column: 60
          }
        }],
        line: 146
      },
      "8": {
        loc: {
          start: {
            line: 151,
            column: 6
          },
          end: {
            line: 154,
            column: 7
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 151,
            column: 6
          },
          end: {
            line: 154,
            column: 7
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 151
      },
      "9": {
        loc: {
          start: {
            line: 151,
            column: 10
          },
          end: {
            line: 151,
            column: 46
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 151,
            column: 10
          },
          end: {
            line: 151,
            column: 27
          }
        }, {
          start: {
            line: 151,
            column: 31
          },
          end: {
            line: 151,
            column: 46
          }
        }],
        line: 151
      },
      "10": {
        loc: {
          start: {
            line: 158,
            column: 4
          },
          end: {
            line: 171,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 158,
            column: 4
          },
          end: {
            line: 171,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 158
      },
      "11": {
        loc: {
          start: {
            line: 158,
            column: 8
          },
          end: {
            line: 158,
            column: 69
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 158,
            column: 8
          },
          end: {
            line: 158,
            column: 25
          }
        }, {
          start: {
            line: 158,
            column: 29
          },
          end: {
            line: 158,
            column: 69
          }
        }],
        line: 158
      },
      "12": {
        loc: {
          start: {
            line: 181,
            column: 4
          },
          end: {
            line: 183,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 181,
            column: 4
          },
          end: {
            line: 183,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 181
      },
      "13": {
        loc: {
          start: {
            line: 187,
            column: 4
          },
          end: {
            line: 195,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 187,
            column: 4
          },
          end: {
            line: 195,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 187
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0,
      "61": 0,
      "62": 0,
      "63": 0,
      "64": 0,
      "65": 0,
      "66": 0,
      "67": 0,
      "68": 0,
      "69": 0,
      "70": 0,
      "71": 0,
      "72": 0,
      "73": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0],
      "13": [0, 0]
    },
    inputSourceMap: null,
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "e722056e18bc09ae55fe31b324c92270df1c1b33"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_w1rgflqv3 = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_w1rgflqv3();
import { db } from "../config/db.drizzle.js";
import { report_schedules } from "../db/schemas/index.js";
import { eq, and, isNull, lte, asc } from "drizzle-orm";
import { logger } from "../utils/logger.js";
import ReportExecutionService from "../services/ReportExecutionService.js";
import ReportDeliveryService from "../services/ReportDeliveryService.js";

/**
 * Scheduled Reports Job
 * Processes all due scheduled reports
 *
 * This job runs at configured intervals to:
 * 1. Find all schedules with next_execution_at <= now
 * 2. Execute each report using ReportExecutionService
 * 3. Deliver results using ReportDeliveryService
 * 4. Update schedule with next execution time
 *
 * HIPAA Compliance:
 * - All executions are logged
 * - Error handling with audit trail
 * - Rate limiting to prevent abuse
 */

// Track concurrent executions to prevent overload
let isRunning =
/* istanbul ignore next */
(cov_w1rgflqv3().s[0]++, false);
const MAX_CONCURRENT_REPORTS =
/* istanbul ignore next */
(cov_w1rgflqv3().s[1]++,
/* istanbul ignore next */
(cov_w1rgflqv3().b[0][0]++, parseInt(process.env.MAX_CONCURRENT_REPORTS)) ||
/* istanbul ignore next */
(cov_w1rgflqv3().b[0][1]++, 5));

/**
 * Process all due scheduled reports
 * @returns {Object} Execution summary
 */
export async function processScheduledReports() {
  /* istanbul ignore next */
  cov_w1rgflqv3().f[0]++;
  cov_w1rgflqv3().s[2]++;
  // Prevent concurrent runs
  if (isRunning) {
    /* istanbul ignore next */
    cov_w1rgflqv3().b[1][0]++;
    cov_w1rgflqv3().s[3]++;
    logger.warn('Scheduled reports job already running, skipping...');
    /* istanbul ignore next */
    cov_w1rgflqv3().s[4]++;
    return {
      skipped: true,
      reason: 'Job already running'
    };
  } else
  /* istanbul ignore next */
  {
    cov_w1rgflqv3().b[1][1]++;
  }
  cov_w1rgflqv3().s[5]++;
  isRunning = true;
  const startTime =
  /* istanbul ignore next */
  (cov_w1rgflqv3().s[6]++, Date.now());
  const results =
  /* istanbul ignore next */
  (cov_w1rgflqv3().s[7]++, {
    processed: 0,
    successful: 0,
    failed: 0,
    skipped: 0,
    details: []
  });
  /* istanbul ignore next */
  cov_w1rgflqv3().s[8]++;
  try {
    /* istanbul ignore next */
    cov_w1rgflqv3().s[9]++;
    logger.info('Starting scheduled reports job...');

    // Initialize the execution service (ensure output directory exists)
    /* istanbul ignore next */
    cov_w1rgflqv3().s[10]++;
    await ReportExecutionService.initialize();

    // Find all due schedules
    const now =
    /* istanbul ignore next */
    (cov_w1rgflqv3().s[11]++, new Date());
    const dueSchedules =
    /* istanbul ignore next */
    (cov_w1rgflqv3().s[12]++, await db.select().from(report_schedules).where(and(eq(report_schedules.is_active, true), isNull(report_schedules.deleted_at), lte(report_schedules.next_execution_at, now))).orderBy(asc(report_schedules.next_execution_at)).limit(MAX_CONCURRENT_REPORTS * 2)); // Get more than we'll process in case some skip
    /* istanbul ignore next */
    cov_w1rgflqv3().s[13]++;
    if (dueSchedules.length === 0) {
      /* istanbul ignore next */
      cov_w1rgflqv3().b[2][0]++;
      cov_w1rgflqv3().s[14]++;
      logger.info('No scheduled reports due for execution');
      /* istanbul ignore next */
      cov_w1rgflqv3().s[15]++;
      return {
        ...results,
        message: 'No reports due'
      };
    } else
    /* istanbul ignore next */
    {
      cov_w1rgflqv3().b[2][1]++;
    }
    cov_w1rgflqv3().s[16]++;
    logger.info(`Found ${dueSchedules.length} scheduled reports due for execution`);

    // Process schedules with concurrency limit
    const chunks =
    /* istanbul ignore next */
    (cov_w1rgflqv3().s[17]++, chunkArray(dueSchedules, MAX_CONCURRENT_REPORTS));
    /* istanbul ignore next */
    cov_w1rgflqv3().s[18]++;
    for (const chunk of chunks) {
      const chunkResults =
      /* istanbul ignore next */
      (cov_w1rgflqv3().s[19]++, await Promise.allSettled(chunk.map(schedule => {
        /* istanbul ignore next */
        cov_w1rgflqv3().f[1]++;
        cov_w1rgflqv3().s[20]++;
        return executeScheduledReport(schedule);
      })));
      /* istanbul ignore next */
      cov_w1rgflqv3().s[21]++;
      for (let i =
      /* istanbul ignore next */
      (cov_w1rgflqv3().s[22]++, 0); i < chunkResults.length; i++) {
        const result =
        /* istanbul ignore next */
        (cov_w1rgflqv3().s[23]++, chunkResults[i]);
        const schedule =
        /* istanbul ignore next */
        (cov_w1rgflqv3().s[24]++, chunk[i]);
        /* istanbul ignore next */
        cov_w1rgflqv3().s[25]++;
        results.processed++;
        /* istanbul ignore next */
        cov_w1rgflqv3().s[26]++;
        if (result.status === 'fulfilled') {
          /* istanbul ignore next */
          cov_w1rgflqv3().b[3][0]++;
          cov_w1rgflqv3().s[27]++;
          if (result.value.skipped) {
            /* istanbul ignore next */
            cov_w1rgflqv3().b[4][0]++;
            cov_w1rgflqv3().s[28]++;
            results.skipped++;
            /* istanbul ignore next */
            cov_w1rgflqv3().s[29]++;
            results.details.push({
              schedule_id: schedule.id,
              status: 'SKIPPED',
              reason: result.value.reason
            });
          } else {
            /* istanbul ignore next */
            cov_w1rgflqv3().b[4][1]++;
            cov_w1rgflqv3().s[30]++;
            results.successful++;
            /* istanbul ignore next */
            cov_w1rgflqv3().s[31]++;
            results.details.push({
              schedule_id: schedule.id,
              configuration_id: schedule.configuration_id,
              status: 'SUCCESS',
              report_id: result.value.reportId,
              delivery_status: result.value.deliveryStatus
            });
          }
        } else {
          /* istanbul ignore next */
          cov_w1rgflqv3().b[3][1]++;
          cov_w1rgflqv3().s[32]++;
          results.failed++;
          /* istanbul ignore next */
          cov_w1rgflqv3().s[33]++;
          results.details.push({
            schedule_id: schedule.id,
            configuration_id: schedule.configuration_id,
            status: 'FAILED',
            error:
            /* istanbul ignore next */
            (cov_w1rgflqv3().b[5][0]++, result.reason?.message) ||
            /* istanbul ignore next */
            (cov_w1rgflqv3().b[5][1]++, 'Unknown error')
          });
          /* istanbul ignore next */
          cov_w1rgflqv3().s[34]++;
          logger.error(`Scheduled report ${schedule.id} failed:`, result.reason);
        }
      }
    }
    const duration =
    /* istanbul ignore next */
    (cov_w1rgflqv3().s[35]++, Date.now() - startTime);
    /* istanbul ignore next */
    cov_w1rgflqv3().s[36]++;
    logger.info(`Scheduled reports job completed in ${duration}ms`, results);
    /* istanbul ignore next */
    cov_w1rgflqv3().s[37]++;
    return {
      ...results,
      duration_ms: duration
    };
  } catch (error) {
    /* istanbul ignore next */
    cov_w1rgflqv3().s[38]++;
    logger.error('Scheduled reports job failed:', error);
    /* istanbul ignore next */
    cov_w1rgflqv3().s[39]++;
    throw error;
  } finally {
    /* istanbul ignore next */
    cov_w1rgflqv3().s[40]++;
    isRunning = false;
  }
}

/**
 * Execute a single scheduled report
 * @param {Object} schedule - Schedule record
 * @returns {Object} Execution result
 */
async function executeScheduledReport(schedule) {
  /* istanbul ignore next */
  cov_w1rgflqv3().f[2]++;
  cov_w1rgflqv3().s[41]++;
  logger.info(`Executing scheduled report: ${schedule.id} (config: ${schedule.configuration_id})`);
  /* istanbul ignore next */
  cov_w1rgflqv3().s[42]++;
  try {
    /* istanbul ignore next */
    cov_w1rgflqv3().s[43]++;
    // Check if within pause period
    if (
    /* istanbul ignore next */
    (cov_w1rgflqv3().b[7][0]++, schedule.pause_start_date) &&
    /* istanbul ignore next */
    (cov_w1rgflqv3().b[7][1]++, schedule.pause_end_date)) {
      /* istanbul ignore next */
      cov_w1rgflqv3().b[6][0]++;
      const now =
      /* istanbul ignore next */
      (cov_w1rgflqv3().s[44]++, new Date());
      const pauseStart =
      /* istanbul ignore next */
      (cov_w1rgflqv3().s[45]++, new Date(schedule.pause_start_date));
      const pauseEnd =
      /* istanbul ignore next */
      (cov_w1rgflqv3().s[46]++, new Date(schedule.pause_end_date));
      /* istanbul ignore next */
      cov_w1rgflqv3().s[47]++;
      if (
      /* istanbul ignore next */
      (cov_w1rgflqv3().b[9][0]++, now >= pauseStart) &&
      /* istanbul ignore next */
      (cov_w1rgflqv3().b[9][1]++, now <= pauseEnd)) {
        /* istanbul ignore next */
        cov_w1rgflqv3().b[8][0]++;
        cov_w1rgflqv3().s[48]++;
        logger.info(`Schedule ${schedule.id} is paused until ${pauseEnd}`);
        /* istanbul ignore next */
        cov_w1rgflqv3().s[49]++;
        return {
          skipped: true,
          reason: 'Schedule is paused'
        };
      } else
      /* istanbul ignore next */
      {
        cov_w1rgflqv3().b[8][1]++;
      }
    } else
    /* istanbul ignore next */
    {
      cov_w1rgflqv3().b[6][1]++;
    }

    // Check if schedule has ended
    cov_w1rgflqv3().s[50]++;
    if (
    /* istanbul ignore next */
    (cov_w1rgflqv3().b[11][0]++, schedule.end_date) &&
    /* istanbul ignore next */
    (cov_w1rgflqv3().b[11][1]++, new Date(schedule.end_date) < new Date())) {
      /* istanbul ignore next */
      cov_w1rgflqv3().b[10][0]++;
      cov_w1rgflqv3().s[51]++;
      logger.info(`Schedule ${schedule.id} has ended`);

      // Deactivate the schedule
      /* istanbul ignore next */
      cov_w1rgflqv3().s[52]++;
      await db.update(report_schedules).set({
        is_active: false,
        updated_at: new Date()
      }).where(eq(report_schedules.id, schedule.id));
      /* istanbul ignore next */
      cov_w1rgflqv3().s[53]++;
      return {
        skipped: true,
        reason: 'Schedule has ended'
      };
    } else
    /* istanbul ignore next */
    {
      cov_w1rgflqv3().b[10][1]++;
    }

    // Execute the report
    const report =
    /* istanbul ignore next */
    (cov_w1rgflqv3().s[54]++, await ReportExecutionService.executeReport(schedule.configuration_id, {
      parameters: schedule.schedule_parameters,
      outputFormat: schedule.output_format,
      executionType: 'SCHEDULED',
      scheduleId: schedule.id
    }));
    /* istanbul ignore next */
    cov_w1rgflqv3().s[55]++;
    if (report.skipped) {
      /* istanbul ignore next */
      cov_w1rgflqv3().b[12][0]++;
      cov_w1rgflqv3().s[56]++;
      return report;
    } else
    /* istanbul ignore next */
    {
      cov_w1rgflqv3().b[12][1]++;
    }

    // Deliver if successful
    let deliveryStatus =
    /* istanbul ignore next */
    (cov_w1rgflqv3().s[57]++, 'NOT_REQUIRED');
    /* istanbul ignore next */
    cov_w1rgflqv3().s[58]++;
    if (report.status === 'SUCCESS') {
      /* istanbul ignore next */
      cov_w1rgflqv3().b[13][0]++;
      cov_w1rgflqv3().s[59]++;
      try {
        const deliveryResult =
        /* istanbul ignore next */
        (cov_w1rgflqv3().s[60]++, await ReportDeliveryService.deliverReport(report.id, schedule.id));
        /* istanbul ignore next */
        cov_w1rgflqv3().s[61]++;
        deliveryStatus = deliveryResult.status;
      } catch (deliveryError) {
        /* istanbul ignore next */
        cov_w1rgflqv3().s[62]++;
        logger.error(`Delivery failed for report ${report.id}:`, deliveryError);
        /* istanbul ignore next */
        cov_w1rgflqv3().s[63]++;
        deliveryStatus = 'FAILED';
      }
    } else
    /* istanbul ignore next */
    {
      cov_w1rgflqv3().b[13][1]++;
    }
    cov_w1rgflqv3().s[64]++;
    return {
      reportId: report.id,
      status: report.status,
      deliveryStatus
    };
  } catch (error) {
    /* istanbul ignore next */
    cov_w1rgflqv3().s[65]++;
    logger.error(`Error executing scheduled report ${schedule.id}:`, error);
    /* istanbul ignore next */
    cov_w1rgflqv3().s[66]++;
    throw error;
  }
}

/**
 * Get the current status of the scheduled reports job
 * @returns {Object} Job status
 */
export function getScheduledReportsJobStatus() {
  /* istanbul ignore next */
  cov_w1rgflqv3().f[3]++;
  cov_w1rgflqv3().s[67]++;
  return {
    isRunning,
    maxConcurrent: MAX_CONCURRENT_REPORTS
  };
}

/**
 * Manually trigger scheduled reports processing
 * (Useful for testing and admin operations)
 */
export async function triggerScheduledReports() {
  /* istanbul ignore next */
  cov_w1rgflqv3().f[4]++;
  cov_w1rgflqv3().s[68]++;
  return await processScheduledReports();
}

/**
 * Helper function to chunk an array
 */
function chunkArray(array, size) {
  /* istanbul ignore next */
  cov_w1rgflqv3().f[5]++;
  const chunks =
  /* istanbul ignore next */
  (cov_w1rgflqv3().s[69]++, []);
  /* istanbul ignore next */
  cov_w1rgflqv3().s[70]++;
  for (let i =
  /* istanbul ignore next */
  (cov_w1rgflqv3().s[71]++, 0); i < array.length; i += size) {
    /* istanbul ignore next */
    cov_w1rgflqv3().s[72]++;
    chunks.push(array.slice(i, i + size));
  }
  /* istanbul ignore next */
  cov_w1rgflqv3().s[73]++;
  return chunks;
}
export default {
  processScheduledReports,
  getScheduledReportsJobStatus,
  triggerScheduledReports
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfdzFyZ2ZscXYzIiwiYWN0dWFsQ292ZXJhZ2UiLCJkYiIsInJlcG9ydF9zY2hlZHVsZXMiLCJlcSIsImFuZCIsImlzTnVsbCIsImx0ZSIsImFzYyIsImxvZ2dlciIsIlJlcG9ydEV4ZWN1dGlvblNlcnZpY2UiLCJSZXBvcnREZWxpdmVyeVNlcnZpY2UiLCJpc1J1bm5pbmciLCJzIiwiTUFYX0NPTkNVUlJFTlRfUkVQT1JUUyIsImIiLCJwYXJzZUludCIsInByb2Nlc3MiLCJlbnYiLCJwcm9jZXNzU2NoZWR1bGVkUmVwb3J0cyIsImYiLCJ3YXJuIiwic2tpcHBlZCIsInJlYXNvbiIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJyZXN1bHRzIiwicHJvY2Vzc2VkIiwic3VjY2Vzc2Z1bCIsImZhaWxlZCIsImRldGFpbHMiLCJpbmZvIiwiaW5pdGlhbGl6ZSIsImR1ZVNjaGVkdWxlcyIsInNlbGVjdCIsImZyb20iLCJ3aGVyZSIsImlzX2FjdGl2ZSIsImRlbGV0ZWRfYXQiLCJuZXh0X2V4ZWN1dGlvbl9hdCIsIm9yZGVyQnkiLCJsaW1pdCIsImxlbmd0aCIsIm1lc3NhZ2UiLCJjaHVua3MiLCJjaHVua0FycmF5IiwiY2h1bmsiLCJjaHVua1Jlc3VsdHMiLCJQcm9taXNlIiwiYWxsU2V0dGxlZCIsIm1hcCIsInNjaGVkdWxlIiwiZXhlY3V0ZVNjaGVkdWxlZFJlcG9ydCIsImkiLCJyZXN1bHQiLCJzdGF0dXMiLCJ2YWx1ZSIsInB1c2giLCJzY2hlZHVsZV9pZCIsImlkIiwiY29uZmlndXJhdGlvbl9pZCIsInJlcG9ydF9pZCIsInJlcG9ydElkIiwiZGVsaXZlcnlfc3RhdHVzIiwiZGVsaXZlcnlTdGF0dXMiLCJlcnJvciIsImR1cmF0aW9uIiwiZHVyYXRpb25fbXMiLCJwYXVzZV9zdGFydF9kYXRlIiwicGF1c2VfZW5kX2RhdGUiLCJwYXVzZVN0YXJ0IiwicGF1c2VFbmQiLCJlbmRfZGF0ZSIsInVwZGF0ZSIsInNldCIsInVwZGF0ZWRfYXQiLCJyZXBvcnQiLCJleGVjdXRlUmVwb3J0IiwicGFyYW1ldGVycyIsInNjaGVkdWxlX3BhcmFtZXRlcnMiLCJvdXRwdXRGb3JtYXQiLCJvdXRwdXRfZm9ybWF0IiwiZXhlY3V0aW9uVHlwZSIsInNjaGVkdWxlSWQiLCJkZWxpdmVyeVJlc3VsdCIsImRlbGl2ZXJSZXBvcnQiLCJkZWxpdmVyeUVycm9yIiwiZ2V0U2NoZWR1bGVkUmVwb3J0c0pvYlN0YXR1cyIsIm1heENvbmN1cnJlbnQiLCJ0cmlnZ2VyU2NoZWR1bGVkUmVwb3J0cyIsImFycmF5Iiwic2l6ZSIsInNsaWNlIl0sInNvdXJjZXMiOlsic2NoZWR1bGVkUmVwb3J0cy5qb2IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGIgfSBmcm9tIFwiLi4vY29uZmlnL2RiLmRyaXp6bGUuanNcIjtcbmltcG9ydCB7IHJlcG9ydF9zY2hlZHVsZXMgfSBmcm9tIFwiLi4vZGIvc2NoZW1hcy9pbmRleC5qc1wiO1xuaW1wb3J0IHsgZXEsIGFuZCwgaXNOdWxsLCBsdGUsIGFzYyB9IGZyb20gXCJkcml6emxlLW9ybVwiO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIi4uL3V0aWxzL2xvZ2dlci5qc1wiO1xuaW1wb3J0IFJlcG9ydEV4ZWN1dGlvblNlcnZpY2UgZnJvbSBcIi4uL3NlcnZpY2VzL1JlcG9ydEV4ZWN1dGlvblNlcnZpY2UuanNcIjtcbmltcG9ydCBSZXBvcnREZWxpdmVyeVNlcnZpY2UgZnJvbSBcIi4uL3NlcnZpY2VzL1JlcG9ydERlbGl2ZXJ5U2VydmljZS5qc1wiO1xuXG4vKipcbiAqIFNjaGVkdWxlZCBSZXBvcnRzIEpvYlxuICogUHJvY2Vzc2VzIGFsbCBkdWUgc2NoZWR1bGVkIHJlcG9ydHNcbiAqXG4gKiBUaGlzIGpvYiBydW5zIGF0IGNvbmZpZ3VyZWQgaW50ZXJ2YWxzIHRvOlxuICogMS4gRmluZCBhbGwgc2NoZWR1bGVzIHdpdGggbmV4dF9leGVjdXRpb25fYXQgPD0gbm93XG4gKiAyLiBFeGVjdXRlIGVhY2ggcmVwb3J0IHVzaW5nIFJlcG9ydEV4ZWN1dGlvblNlcnZpY2VcbiAqIDMuIERlbGl2ZXIgcmVzdWx0cyB1c2luZyBSZXBvcnREZWxpdmVyeVNlcnZpY2VcbiAqIDQuIFVwZGF0ZSBzY2hlZHVsZSB3aXRoIG5leHQgZXhlY3V0aW9uIHRpbWVcbiAqXG4gKiBISVBBQSBDb21wbGlhbmNlOlxuICogLSBBbGwgZXhlY3V0aW9ucyBhcmUgbG9nZ2VkXG4gKiAtIEVycm9yIGhhbmRsaW5nIHdpdGggYXVkaXQgdHJhaWxcbiAqIC0gUmF0ZSBsaW1pdGluZyB0byBwcmV2ZW50IGFidXNlXG4gKi9cblxuLy8gVHJhY2sgY29uY3VycmVudCBleGVjdXRpb25zIHRvIHByZXZlbnQgb3ZlcmxvYWRcbmxldCBpc1J1bm5pbmcgPSBmYWxzZTtcbmNvbnN0IE1BWF9DT05DVVJSRU5UX1JFUE9SVFMgPSBwYXJzZUludChwcm9jZXNzLmVudi5NQVhfQ09OQ1VSUkVOVF9SRVBPUlRTKSB8fCA1O1xuXG4vKipcbiAqIFByb2Nlc3MgYWxsIGR1ZSBzY2hlZHVsZWQgcmVwb3J0c1xuICogQHJldHVybnMge09iamVjdH0gRXhlY3V0aW9uIHN1bW1hcnlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NTY2hlZHVsZWRSZXBvcnRzKCkge1xuICAvLyBQcmV2ZW50IGNvbmN1cnJlbnQgcnVuc1xuICBpZiAoaXNSdW5uaW5nKSB7XG4gICAgbG9nZ2VyLndhcm4oJ1NjaGVkdWxlZCByZXBvcnRzIGpvYiBhbHJlYWR5IHJ1bm5pbmcsIHNraXBwaW5nLi4uJyk7XG4gICAgcmV0dXJuIHsgc2tpcHBlZDogdHJ1ZSwgcmVhc29uOiAnSm9iIGFscmVhZHkgcnVubmluZycgfTtcbiAgfVxuXG4gIGlzUnVubmluZyA9IHRydWU7XG4gIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gIGNvbnN0IHJlc3VsdHMgPSB7XG4gICAgcHJvY2Vzc2VkOiAwLFxuICAgIHN1Y2Nlc3NmdWw6IDAsXG4gICAgZmFpbGVkOiAwLFxuICAgIHNraXBwZWQ6IDAsXG4gICAgZGV0YWlsczogW11cbiAgfTtcblxuICB0cnkge1xuICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyBzY2hlZHVsZWQgcmVwb3J0cyBqb2IuLi4nKTtcblxuICAgIC8vIEluaXRpYWxpemUgdGhlIGV4ZWN1dGlvbiBzZXJ2aWNlIChlbnN1cmUgb3V0cHV0IGRpcmVjdG9yeSBleGlzdHMpXG4gICAgYXdhaXQgUmVwb3J0RXhlY3V0aW9uU2VydmljZS5pbml0aWFsaXplKCk7XG5cbiAgICAvLyBGaW5kIGFsbCBkdWUgc2NoZWR1bGVzXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBkdWVTY2hlZHVsZXMgPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuZnJvbShyZXBvcnRfc2NoZWR1bGVzKVxuICAgICAgLndoZXJlKGFuZChcbiAgICAgICAgZXEocmVwb3J0X3NjaGVkdWxlcy5pc19hY3RpdmUsIHRydWUpLFxuICAgICAgICBpc051bGwocmVwb3J0X3NjaGVkdWxlcy5kZWxldGVkX2F0KSxcbiAgICAgICAgbHRlKHJlcG9ydF9zY2hlZHVsZXMubmV4dF9leGVjdXRpb25fYXQsIG5vdylcbiAgICAgICkpXG4gICAgICAub3JkZXJCeShhc2MocmVwb3J0X3NjaGVkdWxlcy5uZXh0X2V4ZWN1dGlvbl9hdCkpXG4gICAgICAubGltaXQoTUFYX0NPTkNVUlJFTlRfUkVQT1JUUyAqIDIpOyAvLyBHZXQgbW9yZSB0aGFuIHdlJ2xsIHByb2Nlc3MgaW4gY2FzZSBzb21lIHNraXBcblxuICAgIGlmIChkdWVTY2hlZHVsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBsb2dnZXIuaW5mbygnTm8gc2NoZWR1bGVkIHJlcG9ydHMgZHVlIGZvciBleGVjdXRpb24nKTtcbiAgICAgIHJldHVybiB7IC4uLnJlc3VsdHMsIG1lc3NhZ2U6ICdObyByZXBvcnRzIGR1ZScgfTtcbiAgICB9XG5cbiAgICBsb2dnZXIuaW5mbyhgRm91bmQgJHtkdWVTY2hlZHVsZXMubGVuZ3RofSBzY2hlZHVsZWQgcmVwb3J0cyBkdWUgZm9yIGV4ZWN1dGlvbmApO1xuXG4gICAgLy8gUHJvY2VzcyBzY2hlZHVsZXMgd2l0aCBjb25jdXJyZW5jeSBsaW1pdFxuICAgIGNvbnN0IGNodW5rcyA9IGNodW5rQXJyYXkoZHVlU2NoZWR1bGVzLCBNQVhfQ09OQ1VSUkVOVF9SRVBPUlRTKTtcblxuICAgIGZvciAoY29uc3QgY2h1bmsgb2YgY2h1bmtzKSB7XG4gICAgICBjb25zdCBjaHVua1Jlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQoXG4gICAgICAgIGNodW5rLm1hcChzY2hlZHVsZSA9PiBleGVjdXRlU2NoZWR1bGVkUmVwb3J0KHNjaGVkdWxlKSlcbiAgICAgICk7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2h1bmtSZXN1bHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNodW5rUmVzdWx0c1tpXTtcbiAgICAgICAgY29uc3Qgc2NoZWR1bGUgPSBjaHVua1tpXTtcblxuICAgICAgICByZXN1bHRzLnByb2Nlc3NlZCsrO1xuXG4gICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09PSAnZnVsZmlsbGVkJykge1xuICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUuc2tpcHBlZCkge1xuICAgICAgICAgICAgcmVzdWx0cy5za2lwcGVkKys7XG4gICAgICAgICAgICByZXN1bHRzLmRldGFpbHMucHVzaCh7XG4gICAgICAgICAgICAgIHNjaGVkdWxlX2lkOiBzY2hlZHVsZS5pZCxcbiAgICAgICAgICAgICAgc3RhdHVzOiAnU0tJUFBFRCcsXG4gICAgICAgICAgICAgIHJlYXNvbjogcmVzdWx0LnZhbHVlLnJlYXNvblxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdHMuc3VjY2Vzc2Z1bCsrO1xuICAgICAgICAgICAgcmVzdWx0cy5kZXRhaWxzLnB1c2goe1xuICAgICAgICAgICAgICBzY2hlZHVsZV9pZDogc2NoZWR1bGUuaWQsXG4gICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb25faWQ6IHNjaGVkdWxlLmNvbmZpZ3VyYXRpb25faWQsXG4gICAgICAgICAgICAgIHN0YXR1czogJ1NVQ0NFU1MnLFxuICAgICAgICAgICAgICByZXBvcnRfaWQ6IHJlc3VsdC52YWx1ZS5yZXBvcnRJZCxcbiAgICAgICAgICAgICAgZGVsaXZlcnlfc3RhdHVzOiByZXN1bHQudmFsdWUuZGVsaXZlcnlTdGF0dXNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXN1bHRzLmZhaWxlZCsrO1xuICAgICAgICAgIHJlc3VsdHMuZGV0YWlscy5wdXNoKHtcbiAgICAgICAgICAgIHNjaGVkdWxlX2lkOiBzY2hlZHVsZS5pZCxcbiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb25faWQ6IHNjaGVkdWxlLmNvbmZpZ3VyYXRpb25faWQsXG4gICAgICAgICAgICBzdGF0dXM6ICdGQUlMRUQnLFxuICAgICAgICAgICAgZXJyb3I6IHJlc3VsdC5yZWFzb24/Lm1lc3NhZ2UgfHwgJ1Vua25vd24gZXJyb3InXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKGBTY2hlZHVsZWQgcmVwb3J0ICR7c2NoZWR1bGUuaWR9IGZhaWxlZDpgLCByZXN1bHQucmVhc29uKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICBsb2dnZXIuaW5mbyhgU2NoZWR1bGVkIHJlcG9ydHMgam9iIGNvbXBsZXRlZCBpbiAke2R1cmF0aW9ufW1zYCwgcmVzdWx0cyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4ucmVzdWx0cyxcbiAgICAgIGR1cmF0aW9uX21zOiBkdXJhdGlvblxuICAgIH07XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ1NjaGVkdWxlZCByZXBvcnRzIGpvYiBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9IGZpbmFsbHkge1xuICAgIGlzUnVubmluZyA9IGZhbHNlO1xuICB9XG59XG5cbi8qKlxuICogRXhlY3V0ZSBhIHNpbmdsZSBzY2hlZHVsZWQgcmVwb3J0XG4gKiBAcGFyYW0ge09iamVjdH0gc2NoZWR1bGUgLSBTY2hlZHVsZSByZWNvcmRcbiAqIEByZXR1cm5zIHtPYmplY3R9IEV4ZWN1dGlvbiByZXN1bHRcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVNjaGVkdWxlZFJlcG9ydChzY2hlZHVsZSkge1xuICBsb2dnZXIuaW5mbyhgRXhlY3V0aW5nIHNjaGVkdWxlZCByZXBvcnQ6ICR7c2NoZWR1bGUuaWR9IChjb25maWc6ICR7c2NoZWR1bGUuY29uZmlndXJhdGlvbl9pZH0pYCk7XG5cbiAgdHJ5IHtcbiAgICAvLyBDaGVjayBpZiB3aXRoaW4gcGF1c2UgcGVyaW9kXG4gICAgaWYgKHNjaGVkdWxlLnBhdXNlX3N0YXJ0X2RhdGUgJiYgc2NoZWR1bGUucGF1c2VfZW5kX2RhdGUpIHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICBjb25zdCBwYXVzZVN0YXJ0ID0gbmV3IERhdGUoc2NoZWR1bGUucGF1c2Vfc3RhcnRfZGF0ZSk7XG4gICAgICBjb25zdCBwYXVzZUVuZCA9IG5ldyBEYXRlKHNjaGVkdWxlLnBhdXNlX2VuZF9kYXRlKTtcblxuICAgICAgaWYgKG5vdyA+PSBwYXVzZVN0YXJ0ICYmIG5vdyA8PSBwYXVzZUVuZCkge1xuICAgICAgICBsb2dnZXIuaW5mbyhgU2NoZWR1bGUgJHtzY2hlZHVsZS5pZH0gaXMgcGF1c2VkIHVudGlsICR7cGF1c2VFbmR9YCk7XG4gICAgICAgIHJldHVybiB7IHNraXBwZWQ6IHRydWUsIHJlYXNvbjogJ1NjaGVkdWxlIGlzIHBhdXNlZCcgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBzY2hlZHVsZSBoYXMgZW5kZWRcbiAgICBpZiAoc2NoZWR1bGUuZW5kX2RhdGUgJiYgbmV3IERhdGUoc2NoZWR1bGUuZW5kX2RhdGUpIDwgbmV3IERhdGUoKSkge1xuICAgICAgbG9nZ2VyLmluZm8oYFNjaGVkdWxlICR7c2NoZWR1bGUuaWR9IGhhcyBlbmRlZGApO1xuXG4gICAgICAvLyBEZWFjdGl2YXRlIHRoZSBzY2hlZHVsZVxuICAgICAgYXdhaXQgZGJcbiAgICAgICAgLnVwZGF0ZShyZXBvcnRfc2NoZWR1bGVzKVxuICAgICAgICAuc2V0KHtcbiAgICAgICAgICBpc19hY3RpdmU6IGZhbHNlLFxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKClcbiAgICAgICAgfSlcbiAgICAgICAgLndoZXJlKGVxKHJlcG9ydF9zY2hlZHVsZXMuaWQsIHNjaGVkdWxlLmlkKSk7XG5cbiAgICAgIHJldHVybiB7IHNraXBwZWQ6IHRydWUsIHJlYXNvbjogJ1NjaGVkdWxlIGhhcyBlbmRlZCcgfTtcbiAgICB9XG5cbiAgICAvLyBFeGVjdXRlIHRoZSByZXBvcnRcbiAgICBjb25zdCByZXBvcnQgPSBhd2FpdCBSZXBvcnRFeGVjdXRpb25TZXJ2aWNlLmV4ZWN1dGVSZXBvcnQoc2NoZWR1bGUuY29uZmlndXJhdGlvbl9pZCwge1xuICAgICAgcGFyYW1ldGVyczogc2NoZWR1bGUuc2NoZWR1bGVfcGFyYW1ldGVycyxcbiAgICAgIG91dHB1dEZvcm1hdDogc2NoZWR1bGUub3V0cHV0X2Zvcm1hdCxcbiAgICAgIGV4ZWN1dGlvblR5cGU6ICdTQ0hFRFVMRUQnLFxuICAgICAgc2NoZWR1bGVJZDogc2NoZWR1bGUuaWRcbiAgICB9KTtcblxuICAgIGlmIChyZXBvcnQuc2tpcHBlZCkge1xuICAgICAgcmV0dXJuIHJlcG9ydDtcbiAgICB9XG5cbiAgICAvLyBEZWxpdmVyIGlmIHN1Y2Nlc3NmdWxcbiAgICBsZXQgZGVsaXZlcnlTdGF0dXMgPSAnTk9UX1JFUVVJUkVEJztcbiAgICBpZiAocmVwb3J0LnN0YXR1cyA9PT0gJ1NVQ0NFU1MnKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBkZWxpdmVyeVJlc3VsdCA9IGF3YWl0IFJlcG9ydERlbGl2ZXJ5U2VydmljZS5kZWxpdmVyUmVwb3J0KHJlcG9ydC5pZCwgc2NoZWR1bGUuaWQpO1xuICAgICAgICBkZWxpdmVyeVN0YXR1cyA9IGRlbGl2ZXJ5UmVzdWx0LnN0YXR1cztcbiAgICAgIH0gY2F0Y2ggKGRlbGl2ZXJ5RXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKGBEZWxpdmVyeSBmYWlsZWQgZm9yIHJlcG9ydCAke3JlcG9ydC5pZH06YCwgZGVsaXZlcnlFcnJvcik7XG4gICAgICAgIGRlbGl2ZXJ5U3RhdHVzID0gJ0ZBSUxFRCc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHJlcG9ydElkOiByZXBvcnQuaWQsXG4gICAgICBzdGF0dXM6IHJlcG9ydC5zdGF0dXMsXG4gICAgICBkZWxpdmVyeVN0YXR1c1xuICAgIH07XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoYEVycm9yIGV4ZWN1dGluZyBzY2hlZHVsZWQgcmVwb3J0ICR7c2NoZWR1bGUuaWR9OmAsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vKipcbiAqIEdldCB0aGUgY3VycmVudCBzdGF0dXMgb2YgdGhlIHNjaGVkdWxlZCByZXBvcnRzIGpvYlxuICogQHJldHVybnMge09iamVjdH0gSm9iIHN0YXR1c1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2NoZWR1bGVkUmVwb3J0c0pvYlN0YXR1cygpIHtcbiAgcmV0dXJuIHtcbiAgICBpc1J1bm5pbmcsXG4gICAgbWF4Q29uY3VycmVudDogTUFYX0NPTkNVUlJFTlRfUkVQT1JUU1xuICB9O1xufVxuXG4vKipcbiAqIE1hbnVhbGx5IHRyaWdnZXIgc2NoZWR1bGVkIHJlcG9ydHMgcHJvY2Vzc2luZ1xuICogKFVzZWZ1bCBmb3IgdGVzdGluZyBhbmQgYWRtaW4gb3BlcmF0aW9ucylcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHRyaWdnZXJTY2hlZHVsZWRSZXBvcnRzKCkge1xuICByZXR1cm4gYXdhaXQgcHJvY2Vzc1NjaGVkdWxlZFJlcG9ydHMoKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdG8gY2h1bmsgYW4gYXJyYXlcbiAqL1xuZnVuY3Rpb24gY2h1bmtBcnJheShhcnJheSwgc2l6ZSkge1xuICBjb25zdCBjaHVua3MgPSBbXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkgKz0gc2l6ZSkge1xuICAgIGNodW5rcy5wdXNoKGFycmF5LnNsaWNlKGksIGkgKyBzaXplKSk7XG4gIH1cbiAgcmV0dXJuIGNodW5rcztcbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBwcm9jZXNzU2NoZWR1bGVkUmVwb3J0cyxcbiAgZ2V0U2NoZWR1bGVkUmVwb3J0c0pvYlN0YXR1cyxcbiAgdHJpZ2dlclNjaGVkdWxlZFJlcG9ydHNcbn07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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