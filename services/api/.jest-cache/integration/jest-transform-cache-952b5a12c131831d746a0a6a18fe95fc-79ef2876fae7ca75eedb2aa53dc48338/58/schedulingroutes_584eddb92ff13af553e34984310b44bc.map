{"version":3,"names":["cov_oszfffxwe","actualCoverage","controller","PERMISSIONS","requireAnyPermission","schedulingRoutes","fastify","options","f","s","get","preHandler","VIEW_CLINICAL_NOTES","getAllVisits","post","CREATE_CLINICAL_NOTES","createVisit","getVisitById","patch","UPDATE_CLINICAL_NOTES","updateVisit","checkIn","checkOut","cancelVisit","rescheduleVisit","confirmVisit","getRecurringVisits","createRecurringVisit","updateRecurringVisit","deactivateRecurringVisit","VIEW_USERS","getOnCallSchedules","UPDATE_USER","createOnCallSchedule","getCurrentOnCall","getOnCallLogs","createOnCallLog","VIEW_REPORTS","getVisitCompliance","getNonCompliantPatients","getOverdueRNVisits","getAvailableSlots","checkStaffAvailability","scheduleVisitStrict","getConflicts","detectConflicts","getUnresolvedConflictsCount","createConflict","resolveConflict","acknowledgeConflict"],"sources":["scheduling.routes.js"],"sourcesContent":["import controller from '../controllers/Scheduling.controller.js';\nimport { PERMISSIONS } from '../config/rbac.js';\nimport { requireAnyPermission } from '../middleware/rbac.middleware.js';\n\n/**\n * Scheduling Routes\n * Module J - MEDIUM Priority\n *\n * Purpose: Calendar management, GPS check-in/out, on-call rotations\n * Compliance: Visit frequency requirements, on-call coverage, timeliness tracking\n *\n * Endpoints:\n * - Scheduled visits management (9 endpoints)\n * - Recurring visit templates (4 endpoints)\n * - On-call schedule management (3 endpoints)\n * - On-call log tracking (2 endpoints)\n * - Visit compliance monitoring (3 endpoints)\n * - Staff availability (2 endpoints) - NEW\n * - Strict scheduling (1 endpoint) - NEW\n * - Scheduling conflict tracking (6 endpoints)\n * Total: 30 endpoints\n */\nexport default async function schedulingRoutes(fastify, options) {\n  // ============================================================================\n  // SCHEDULED VISITS ROUTES\n  // ============================================================================\n\n  // Get all visits with filters\n  fastify.get('/visits', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getAllVisits);\n\n  // Create scheduled visit\n  fastify.post('/visits', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES)]\n  }, controller.createVisit);\n\n  // Get visit by ID\n  fastify.get('/visits/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getVisitById);\n\n  // Update visit\n  fastify.patch('/visits/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.updateVisit);\n\n  // Check in to visit (GPS tracking)\n  fastify.post('/visits/:id/checkin', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.checkIn);\n\n  // Check out from visit (GPS tracking)\n  fastify.post('/visits/:id/checkout', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.checkOut);\n\n  // Cancel visit\n  fastify.post('/visits/:id/cancel', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.cancelVisit);\n\n  // Reschedule visit\n  fastify.post('/visits/:id/reschedule', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.rescheduleVisit);\n\n  // Confirm visit\n  fastify.post('/visits/:id/confirm', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.confirmVisit);\n\n  // ============================================================================\n  // RECURRING VISITS ROUTES\n  // ============================================================================\n\n  // Get recurring visit templates\n  fastify.get('/recurring-visits', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getRecurringVisits);\n\n  // Create recurring visit template\n  fastify.post('/recurring-visits', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES)]\n  }, controller.createRecurringVisit);\n\n  // Update recurring visit template\n  fastify.patch('/recurring-visits/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.updateRecurringVisit);\n\n  // Deactivate recurring visit\n  fastify.post('/recurring-visits/:id/deactivate', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.deactivateRecurringVisit);\n\n  // ============================================================================\n  // ON-CALL SCHEDULE ROUTES\n  // ============================================================================\n\n  // Get on-call schedules\n  fastify.get('/on-call', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_USERS)]\n  }, controller.getOnCallSchedules);\n\n  // Create on-call schedule\n  fastify.post('/on-call', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_USER)]\n  }, controller.createOnCallSchedule);\n\n  // Get current on-call staff\n  fastify.get('/on-call/current', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_USERS)]\n  }, controller.getCurrentOnCall);\n\n  // ============================================================================\n  // ON-CALL LOGS ROUTES\n  // ============================================================================\n\n  // Get on-call logs\n  fastify.get('/on-call/logs', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getOnCallLogs);\n\n  // Create on-call log entry\n  fastify.post('/on-call/logs', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES)]\n  }, controller.createOnCallLog);\n\n  // ============================================================================\n  // VISIT COMPLIANCE ROUTES\n  // ============================================================================\n\n  // Get visit compliance reports\n  fastify.get('/compliance/visits', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_REPORTS)]\n  }, controller.getVisitCompliance);\n\n  // Get non-compliant patients\n  fastify.get('/compliance/visits/non-compliant', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_REPORTS)]\n  }, controller.getNonCompliantPatients);\n\n  // Get overdue RN visits\n  fastify.get('/compliance/visits/rn-overdue', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_REPORTS)]\n  }, controller.getOverdueRNVisits);\n\n  // ============================================================================\n  // STAFF AVAILABILITY ROUTES\n  // ============================================================================\n\n  // Get available time slots for a staff member\n  fastify.get('/staff/:staff_id/available-slots', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getAvailableSlots);\n\n  // Check staff availability for a specific time range\n  fastify.get('/staff/:staff_id/check-availability', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.checkStaffAvailability);\n\n  // ============================================================================\n  // STRICT SCHEDULING ROUTE\n  // ============================================================================\n\n  // Schedule a visit with strict conflict prevention (rejects if conflicts exist)\n  fastify.post('/visits/schedule-strict', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES)]\n  }, controller.scheduleVisitStrict);\n\n  // ============================================================================\n  // SCHEDULING CONFLICTS ROUTES\n  // ============================================================================\n\n  // Get scheduling conflicts\n  fastify.get('/conflicts', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getConflicts);\n\n  // Detect conflicts for staff on a date\n  fastify.get('/conflicts/detect', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.detectConflicts);\n\n  // Get unresolved conflicts count\n  fastify.get('/conflicts/unresolved-count', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getUnresolvedConflictsCount);\n\n  // Create/record a conflict\n  fastify.post('/conflicts', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES)]\n  }, controller.createConflict);\n\n  // Resolve a conflict\n  fastify.post('/conflicts/:id/resolve', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.resolveConflict);\n\n  // Acknowledge a conflict\n  fastify.post('/conflicts/:id/acknowledge', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.acknowledgeConflict);\n}\n"],"mappings":"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","ignoreList":[]}