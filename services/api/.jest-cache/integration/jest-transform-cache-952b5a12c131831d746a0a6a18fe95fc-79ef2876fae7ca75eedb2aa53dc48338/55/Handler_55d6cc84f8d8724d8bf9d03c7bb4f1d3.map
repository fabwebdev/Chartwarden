{"version":3,"names":["cov_23326n9792","actualCoverage","crypto","redactPII","redactPIIFromObject","logger","Handler","constructor","f","s","dontReport","dontFlash","genericMessages","generateErrorId","Date","now","randomBytes","toString","toUpperCase","shouldReport","error","some","type","report","errorId","context","b","errorDetails","timestamp","toISOString","name","message","code","status","statusCode","process","env","NODE_ENV","stack","redactedDetails","aggressive","keepIPAddresses","JSON","stringify","sanitizeMessage","sanitized","dangerousPatterns","pattern","test","length","substring","isValidationError","validation","undefined","Array","isArray","errors","sanitizeValidationErrors","map","msg","path","field","location","buildProductionResponse","response","buildDevelopmentResponse","detail","hint","render","request","reply","url","method","ip","userAgent","headers","userId","user","id","send","reportable","callback","reportCallback","renderForConsole"],"sources":["Handler.js"],"sourcesContent":["/**\n * Secure Error Handler\n *\n * SECURITY: TICKET #005 - Prevent PHI/PII leakage in error messages\n * HIPAA: Â§164.514(b) - De-identification of PHI\n * OWASP: A04:2021 - Insecure Design\n *\n * This handler ensures:\n * - No PHI/PII in error responses\n * - No database details exposed to client\n * - No stack traces in production\n * - Unique error tracking IDs\n * - Server-side logging with PII redaction\n */\n\nimport crypto from 'crypto';\nimport { redactPII, redactPIIFromObject } from '../utils/piiRedactor.js';\n\nimport { logger } from '../utils/logger.js';\nclass Handler {\n  constructor() {\n    /**\n     * A list of the exception types that are not reported.\n     * @var {Array}\n     */\n    this.dontReport = [\n      // Add error types that shouldn't be logged\n    ];\n\n    /**\n     * A list of the inputs that are never flashed for validation exceptions.\n     * @var {Array}\n     */\n    this.dontFlash = [\n      'current_password',\n      'password',\n      'password_confirmation',\n      'ssn',\n      'social_security_number',\n      'credit_card',\n      'token',\n      'api_key',\n      'secret'\n    ];\n\n    /**\n     * Generic error messages for different status codes\n     */\n    this.genericMessages = {\n      400: 'Bad Request',\n      401: 'Unauthorized',\n      403: 'Forbidden',\n      404: 'Resource Not Found',\n      405: 'Method Not Allowed',\n      409: 'Conflict',\n      422: 'Validation Error',\n      429: 'Too Many Requests',\n      500: 'Internal Server Error',\n      502: 'Bad Gateway',\n      503: 'Service Unavailable',\n      504: 'Gateway Timeout'\n    };\n  }\n\n  /**\n   * Generate a unique error tracking ID\n   * @returns {string} Unique error ID\n   */\n  generateErrorId() {\n    return `ERR-${Date.now()}-${crypto.randomBytes(4).toString('hex').toUpperCase()}`;\n  }\n\n  /**\n   * Check if error should be reported\n   * @param {Error} error\n   * @returns {boolean}\n   */\n  shouldReport(error) {\n    return !this.dontReport.some(type => error instanceof type);\n  }\n\n  /**\n   * Report or log an exception with PII redaction\n   * @param {Error} error\n   * @param {string} errorId\n   * @param {Object} context\n   */\n  report(error, errorId, context = {}) {\n    if (!this.shouldReport(error)) {\n      return;\n    }\n\n    // Prepare error details for logging\n    const errorDetails = {\n      errorId,\n      timestamp: new Date().toISOString(),\n      name: error.name,\n      message: error.message,\n      code: error.code,\n      status: error.status || error.statusCode || 500,\n      ...context\n    };\n\n    // Add stack trace in non-production\n    if (process.env.NODE_ENV !== 'production') {\n      errorDetails.stack = error.stack;\n    }\n\n    // Redact PII from error details before logging\n    const redactedDetails = redactPIIFromObject(errorDetails, {\n      aggressive: true,\n      keepIPAddresses: false\n    });\n\n    // Log to console (in production, this should go to a logging service)\n    logger.error('ðŸ”´ Error Report:', JSON.stringify(redactedDetails, null, 2));\n\n    // In production, send to logging service (Sentry, Loggly, etc.)\n    if (process.env.NODE_ENV === 'production') {\n      // TODO: Send to external logging service\n      // Example: Sentry.captureException(error, { extra: redactedDetails });\n    }\n  }\n\n  /**\n   * Sanitize error message - remove database hints, SQL, and PHI\n   * @param {string} message\n   * @returns {string}\n   */\n  sanitizeMessage(message) {\n    if (!message) return 'An error occurred';\n\n    // Redact PII first\n    let sanitized = redactPII(message, { aggressive: true });\n\n    // Remove database-specific error patterns\n    const dangerousPatterns = [\n      /relation \".*\" does not exist/gi,\n      /column \".*\" does not exist/gi,\n      /duplicate key value violates unique constraint/gi,\n      /null value in column \".*\" violates not-null constraint/gi,\n      /foreign key constraint/gi,\n      /syntax error at or near/gi,\n      /invalid input syntax for type/gi,\n      /ERROR:.*DETAIL:/gi,\n      /ERROR:.*HINT:/gi,\n      /at .* line \\d+/gi,\n      /in \\/.*\\.js:\\d+/gi\n    ];\n\n    for (const pattern of dangerousPatterns) {\n      if (pattern.test(sanitized)) {\n        return 'A database error occurred. Please contact support.';\n      }\n    }\n\n    // Truncate very long messages\n    if (sanitized.length > 200) {\n      sanitized = sanitized.substring(0, 200) + '...';\n    }\n\n    return sanitized;\n  }\n\n  /**\n   * Determine if this is a validation error\n   * @param {Error} error\n   * @returns {boolean}\n   */\n  isValidationError(error) {\n    return (\n      error.statusCode === 422 ||\n      error.status === 422 ||\n      error.name === 'ValidationError' ||\n      error.validation !== undefined ||\n      Array.isArray(error.errors)\n    );\n  }\n\n  /**\n   * Sanitize validation errors - keep field names, remove values\n   * @param {Array} errors\n   * @returns {Array}\n   */\n  sanitizeValidationErrors(errors) {\n    if (!Array.isArray(errors)) {\n      return [];\n    }\n\n    return errors.map(error => {\n      // Keep only safe fields\n      const sanitized = {\n        type: error.type || 'field',\n        msg: this.sanitizeMessage(error.msg || error.message),\n        path: error.path || error.field,\n        location: error.location || 'body'\n      };\n\n      // Remove the actual invalid value (could contain PHI)\n      // Never include: error.value, error.actual, error.received\n\n      return sanitized;\n    });\n  }\n\n  /**\n   * Build production-safe error response\n   * @param {Error} error\n   * @param {string} errorId\n   * @returns {Object}\n   */\n  buildProductionResponse(error, errorId) {\n    const status = error.status || error.statusCode || 500;\n\n    // Base response with generic message\n    const response = {\n      status,\n      error: this.genericMessages[status] || 'Error',\n      message: this.genericMessages[status] || 'An error occurred',\n      errorId // Include error ID so user can reference it when contacting support\n    };\n\n    // For validation errors, include sanitized field-level errors\n    if (this.isValidationError(error)) {\n      response.error = 'Validation Error';\n      response.message = 'The request contains invalid data';\n\n      if (error.errors || error.validation) {\n        response.errors = this.sanitizeValidationErrors(\n          error.errors || error.validation\n        );\n      }\n    }\n\n    // For 404s, we can be a bit more specific\n    if (status === 404) {\n      response.message = 'The requested resource was not found';\n    }\n\n    // For 401/403, generic auth messages\n    if (status === 401) {\n      response.message = 'Authentication required';\n    }\n\n    if (status === 403) {\n      response.message = 'You do not have permission to access this resource';\n    }\n\n    return response;\n  }\n\n  /**\n   * Build development error response (includes more details)\n   * @param {Error} error\n   * @param {string} errorId\n   * @returns {Object}\n   */\n  buildDevelopmentResponse(error, errorId) {\n    const status = error.status || error.statusCode || 500;\n\n    const response = {\n      status,\n      error: error.name || 'Error',\n      message: this.sanitizeMessage(error.message),\n      errorId\n    };\n\n    // Include validation errors\n    if (this.isValidationError(error) && (error.errors || error.validation)) {\n      response.errors = this.sanitizeValidationErrors(\n        error.errors || error.validation\n      );\n    }\n\n    // Include stack trace in development only\n    if (process.env.NODE_ENV === 'development') {\n      response.stack = error.stack;\n\n      // Include additional error details (but redact PII)\n      if (error.code) response.code = error.code;\n\n      // Sanitize database hints\n      if (error.detail) {\n        response.detail = redactPII(error.detail, { aggressive: true });\n      }\n\n      if (error.hint) {\n        response.hint = redactPII(error.hint, { aggressive: true });\n      }\n    }\n\n    return response;\n  }\n\n  /**\n   * Render an exception into an HTTP response\n   * @param {Object} request\n   * @param {Object} reply\n   * @param {Error} error\n   */\n  render(request, reply, error) {\n    const errorId = this.generateErrorId();\n    const status = error.status || error.statusCode || 500;\n\n    // Build context for logging\n    const context = {\n      path: request.url,\n      method: request.method,\n      ip: request.ip,\n      userAgent: request.headers['user-agent'],\n      userId: request.user?.id\n    };\n\n    // Report error with PII redaction\n    this.report(error, errorId, context);\n\n    // Build response based on environment\n    let response;\n    if (process.env.NODE_ENV === 'production') {\n      response = this.buildProductionResponse(error, errorId);\n    } else {\n      response = this.buildDevelopmentResponse(error, errorId);\n    }\n\n    // Send response\n    return reply.code(status).send(response);\n  }\n\n  /**\n   * Register the exception handling callbacks for the application.\n   * @param {Function} callback\n   */\n  reportable(callback) {\n    this.reportCallback = callback;\n  }\n\n  /**\n   * Render an exception for console command errors.\n   * @param {Error} error\n   */\n  renderForConsole(error) {\n    const errorId = this.generateErrorId();\n    const message = redactPII(error.message, { aggressive: true });\n\n    logger.error(`[${errorId}] Console command error:`, message)\n\n    if (process.env.NODE_ENV === 'development') {\n      logger.error(error.stack)\n    }\n  }\n}\n\nexport default new Handler();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}