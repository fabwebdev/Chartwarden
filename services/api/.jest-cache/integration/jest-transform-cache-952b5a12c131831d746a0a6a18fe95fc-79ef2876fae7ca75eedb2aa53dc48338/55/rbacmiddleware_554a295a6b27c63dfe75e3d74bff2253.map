{"version":3,"names":["cov_1yptz10rbc","actualCoverage","ROLES","PERMISSIONS","userHasPermission","db","user_has_roles","roles","role_has_permissions","permissions","eq","inArray","logger","permissionCache","s","Map","CACHE_TTL_MS","getUserPermissionsFromDB","userId","f","cached","get","b","Date","now","timestamp","userRoles","select","role_id","from","where","user_id","length","set","roleIds","map","r","rolePermissions","permission_id","permissionIds","Set","rp","permissionRecords","name","id","permissionNames","p","error","clearPermissionCache","delete","clear","requireRole","allowedRoles","request","reply","user","code","send","status","message","userRole","role","PATIENT","includes","requirePermission","requiredPermissions","hasAllPermissions","every","permission","requireDynamicPermission","userPermissions","requireAnyPermission","hasAnyPermission","some","requireAnyDynamicPermission","loadUserPermissions","requireAdmin","ADMIN","requireMedicalStaff","DOCTOR","requireHealthcareStaff","NURSE","requireUserManagement","MANAGE_USERS"],"sources":["rbac.middleware.js"],"sourcesContent":["import { ROLES, PERMISSIONS, userHasPermission } from '../config/rbac.js';\nimport { db } from '../config/db.drizzle.js';\nimport { user_has_roles, roles, role_has_permissions, permissions } from '../db/schemas/index.js';\nimport { eq, inArray } from 'drizzle-orm';\nimport { logger } from '../utils/logger.js';\n\n// Cache for user permissions (with TTL)\nconst permissionCache = new Map();\nconst CACHE_TTL_MS = 5 * 60 * 1000; // 5 minutes\n\n/**\n * Get user permissions from database (with caching)\n * @param {string} userId - The user ID\n * @returns {Promise<string[]>} - Array of permission names\n */\nasync function getUserPermissionsFromDB(userId) {\n  // Check cache first\n  const cached = permissionCache.get(userId);\n  if (cached && Date.now() - cached.timestamp < CACHE_TTL_MS) {\n    return cached.permissions;\n  }\n\n  try {\n    // Get user's roles\n    const userRoles = await db\n      .select({ role_id: user_has_roles.role_id })\n      .from(user_has_roles)\n      .where(eq(user_has_roles.user_id, userId));\n\n    if (userRoles.length === 0) {\n      permissionCache.set(userId, { permissions: [], timestamp: Date.now() });\n      return [];\n    }\n\n    const roleIds = userRoles.map(r => r.role_id);\n\n    // Get permissions for all roles\n    const rolePermissions = await db\n      .select({ permission_id: role_has_permissions.permission_id })\n      .from(role_has_permissions)\n      .where(inArray(role_has_permissions.role_id, roleIds));\n\n    if (rolePermissions.length === 0) {\n      permissionCache.set(userId, { permissions: [], timestamp: Date.now() });\n      return [];\n    }\n\n    const permissionIds = [...new Set(rolePermissions.map(rp => rp.permission_id))];\n\n    // Get permission names\n    const permissionRecords = await db\n      .select({ name: permissions.name })\n      .from(permissions)\n      .where(inArray(permissions.id, permissionIds));\n\n    const permissionNames = permissionRecords.map(p => p.name);\n\n    // Cache the result\n    permissionCache.set(userId, { permissions: permissionNames, timestamp: Date.now() });\n\n    return permissionNames;\n  } catch (error) {\n    logger.error('Error fetching user permissions from database:', error);\n    return [];\n  }\n}\n\n/**\n * Clear permission cache for a specific user (call when roles/permissions change)\n * @param {string} userId - The user ID\n */\nexport function clearPermissionCache(userId) {\n  if (userId) {\n    permissionCache.delete(userId);\n  } else {\n    permissionCache.clear();\n  }\n}\n\n/**\n * Middleware to check if user has a specific role\n * @param {...string} allowedRoles - Roles that are allowed to access the route\n */\nexport const requireRole = (...allowedRoles) => {\n  return async (request, reply) => {\n    // Check if user is authenticated\n    if (!request.user) {\n      return reply.code(401).send({\n        status: 401,\n        message: 'Access denied. Authentication required.'\n      });\n    }\n\n    // Check if user has one of the allowed roles\n    const userRole = request.user.role || ROLES.PATIENT; // Default to patient if no role specified\n    if (!allowedRoles.includes(userRole)) {\n      return reply.code(403).send({\n        status: 403,\n        message: 'Access denied. Insufficient permissions.'\n      });\n    }\n  };\n};\n\n/**\n * Middleware to check if user has specific permissions (static config-based)\n * @param {...string} requiredPermissions - Permissions required to access the route\n */\nexport const requirePermission = (...requiredPermissions) => {\n  return async (request, reply) => {\n    // Check if user is authenticated\n    if (!request.user) {\n      return reply.code(401).send({\n        status: 401,\n        message: 'Access denied. Authentication required.'\n      });\n    }\n\n    // Check if user has all required permissions using static config\n    const userRole = request.user.role || ROLES.PATIENT; // Default to patient if no role specified\n    const hasAllPermissions = requiredPermissions.every(permission =>\n      userHasPermission(userRole, permission)\n    );\n\n    if (!hasAllPermissions) {\n      return reply.code(403).send({\n        status: 403,\n        message: 'Access denied. Insufficient permissions.'\n      });\n    }\n  };\n};\n\n/**\n * Middleware to check if user has specific permissions (dynamic DB-based)\n * This loads permissions from the database for more flexible permission management\n * @param {...string} requiredPermissions - Permissions required to access the route\n */\nexport const requireDynamicPermission = (...requiredPermissions) => {\n  return async (request, reply) => {\n    // Check if user is authenticated\n    if (!request.user) {\n      return reply.code(401).send({\n        status: 401,\n        message: 'Access denied. Authentication required.'\n      });\n    }\n\n    try {\n      // Get user's actual permissions from database\n      const userPermissions = await getUserPermissionsFromDB(request.user.id);\n\n      // Check if user has all required permissions\n      const hasAllPermissions = requiredPermissions.every(permission =>\n        userPermissions.includes(permission)\n      );\n\n      if (!hasAllPermissions) {\n        return reply.code(403).send({\n          status: 403,\n          message: 'Access denied. Insufficient permissions.'\n        });\n      }\n    } catch (error) {\n      logger.error('Error checking dynamic permissions:', error);\n      return reply.code(500).send({\n        status: 500,\n        message: 'Server error during authorization.'\n      });\n    }\n  };\n};\n\n/**\n * Middleware to check if user has any of the specified permissions\n * @param {...string} requiredPermissions - Permissions where having any is sufficient\n */\nexport const requireAnyPermission = (...requiredPermissions) => {\n  return async (request, reply) => {\n    // Check if user is authenticated\n    if (!request.user) {\n      return reply.code(401).send({\n        status: 401,\n        message: 'Access denied. Authentication required.'\n      });\n    }\n\n    // Check if user has any of the required permissions\n    const userRole = request.user.role || ROLES.PATIENT; // Default to patient if no role specified\n    const hasAnyPermission = requiredPermissions.some(permission =>\n      userHasPermission(userRole, permission)\n    );\n\n    if (!hasAnyPermission) {\n      return reply.code(403).send({\n        status: 403,\n        message: 'Access denied. Insufficient permissions.'\n      });\n    }\n  };\n};\n\n/**\n * Middleware to check if user has any of the specified permissions (dynamic DB-based)\n * @param {...string} requiredPermissions - Permissions where having any is sufficient\n */\nexport const requireAnyDynamicPermission = (...requiredPermissions) => {\n  return async (request, reply) => {\n    // Check if user is authenticated\n    if (!request.user) {\n      return reply.code(401).send({\n        status: 401,\n        message: 'Access denied. Authentication required.'\n      });\n    }\n\n    try {\n      // Get user's actual permissions from database\n      const userPermissions = await getUserPermissionsFromDB(request.user.id);\n\n      // Check if user has any of the required permissions\n      const hasAnyPermission = requiredPermissions.some(permission =>\n        userPermissions.includes(permission)\n      );\n\n      if (!hasAnyPermission) {\n        return reply.code(403).send({\n          status: 403,\n          message: 'Access denied. Insufficient permissions.'\n        });\n      }\n    } catch (error) {\n      logger.error('Error checking dynamic permissions:', error);\n      return reply.code(500).send({\n        status: 500,\n        message: 'Server error during authorization.'\n      });\n    }\n  };\n};\n\n/**\n * Middleware to load and attach user permissions to request object\n * Use this when you need to check permissions in controller logic\n */\nexport const loadUserPermissions = async (request, reply) => {\n  if (!request.user) return;\n\n  try {\n    request.userPermissions = await getUserPermissionsFromDB(request.user.id);\n  } catch (error) {\n    logger.error('Error loading user permissions:', error);\n    request.userPermissions = [];\n  }\n};\n\n/**\n * Middleware to check if user is an admin\n */\nexport const requireAdmin = requireRole(ROLES.ADMIN);\n\n/**\n * Middleware to check if user is a doctor or admin\n */\nexport const requireMedicalStaff = requireRole(ROLES.ADMIN, ROLES.DOCTOR);\n\n/**\n * Middleware to check if user is healthcare staff (doctor, nurse, or admin)\n */\nexport const requireHealthcareStaff = requireRole(ROLES.ADMIN, ROLES.DOCTOR, ROLES.NURSE);\n\n/**\n * Middleware to require user management permission (admin only)\n */\nexport const requireUserManagement = requirePermission(PERMISSIONS.MANAGE_USERS);\n\nexport default {\n  requireRole,\n  requirePermission,\n  requireDynamicPermission,\n  requireAnyPermission,\n  requireAnyDynamicPermission,\n  loadUserPermissions,\n  clearPermissionCache,\n  requireAdmin,\n  requireMedicalStaff,\n  requireHealthcareStaff,\n  requireUserManagement\n};"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}