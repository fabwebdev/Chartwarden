{"version":3,"names":["cov_k9ipm4kdk","actualCoverage","crypto","Handler","AppError","ValidationError","DatabaseError","RateLimitError","ErrorCodes","getErrorMessage","sanitize","mapFastifyValidationError","error","f","errors","s","b","validation","Array","isArray","v","push","field","instancePath","replace","params","missingProperty","message","code","VALIDATION_FAILED","mapDatabaseError","pgErrorMap","DATABASE_UNIQUE_VIOLATION","status","DATABASE_FOREIGN_KEY_VIOLATION","VALIDATION_REQUIRED_FIELD","VALIDATION_INVALID_FORMAT","VALIDATION_OUT_OF_RANGE","DATABASE_ERROR","DATABASE_CONNECTION_FAILED","SYSTEM_MAINTENANCE","mapping","dbError","statusCode","isDatabaseError","test","isFastifyValidationError","undefined","validationContext","errorHandler","request","reply","isDevelopment","process","env","NODE_ENV","isProduction","trackingId","Date","now","randomBytes","toString","toUpperCase","processedError","errorCode","SYSTEM_INTERNAL_ERROR","isOperational","logLevel","logData","userId","user","id","path","url","method","details","internalMessage","m","err","log","response","success","getErrorName","getClientSafeMessage","length","map","e","retryAfter","header","errorType","constructor","name","stack","split","slice","originalError","send","SYSTEM_ERROR","errorNames","notFoundHandler","warn","RESOURCE_NOT_FOUND"],"sources":["error.middleware.js"],"sourcesContent":["/**\n * Global Error Handling Middleware\n * TICKET #005: Secure error handling with PHI protection\n * TICKET #016: Centralized error handling integration\n *\n * HIPAA Compliance:\n * - All error messages are sanitized to prevent PHI/PII leakage\n * - Database errors return generic messages\n * - Stack traces only in development\n * - Unique tracking IDs for error correlation\n */\n\nimport crypto from 'crypto';\nimport Handler from \"../exceptions/Handler.js\";\nimport {\n  AppError,\n  ValidationError,\n  DatabaseError,\n  RateLimitError,\n  ErrorCodes,\n  getErrorMessage\n} from \"../utils/errorHandler.js\";\nimport { sanitize } from \"../utils/logger.js\";\n\n/**\n * Map Fastify validation errors to our ValidationError\n * @param {Error} error - Fastify validation error\n * @returns {ValidationError}\n */\nfunction mapFastifyValidationError(error) {\n  const errors = [];\n\n  if (error.validation && Array.isArray(error.validation)) {\n    for (const v of error.validation) {\n      errors.push({\n        field: v.instancePath?.replace('/', '') || v.params?.missingProperty || 'unknown',\n        message: v.message || 'Invalid value',\n        code: ErrorCodes.VALIDATION_FAILED\n      });\n    }\n  }\n\n  return new ValidationError('The request contains invalid data', { errors });\n}\n\n/**\n * Map database errors to our DatabaseError with appropriate codes\n * @param {Error} error - Database error\n * @returns {AppError}\n */\nfunction mapDatabaseError(error) {\n  // PostgreSQL error codes\n  const pgErrorMap = {\n    '23505': { code: ErrorCodes.DATABASE_UNIQUE_VIOLATION, status: 409 },  // Unique violation\n    '23503': { code: ErrorCodes.DATABASE_FOREIGN_KEY_VIOLATION, status: 400 },  // Foreign key violation\n    '23502': { code: ErrorCodes.VALIDATION_REQUIRED_FIELD, status: 422 },  // Not null violation\n    '22P02': { code: ErrorCodes.VALIDATION_INVALID_FORMAT, status: 422 },  // Invalid text representation\n    '22003': { code: ErrorCodes.VALIDATION_OUT_OF_RANGE, status: 422 },    // Numeric value out of range\n    '42P01': { code: ErrorCodes.DATABASE_ERROR, status: 500 },             // Undefined table\n    '42703': { code: ErrorCodes.DATABASE_ERROR, status: 500 },             // Undefined column\n    '08006': { code: ErrorCodes.DATABASE_CONNECTION_FAILED, status: 503 }, // Connection failure\n    '57P01': { code: ErrorCodes.SYSTEM_MAINTENANCE, status: 503 },         // Admin shutdown\n  };\n\n  const mapping = pgErrorMap[error.code];\n  if (mapping) {\n    const dbError = new DatabaseError(error.message, { code: mapping.code });\n    dbError.statusCode = mapping.status;\n    return dbError;\n  }\n\n  return new DatabaseError(error.message);\n}\n\n/**\n * Determine if error is a database error\n * @param {Error} error\n * @returns {boolean}\n */\nfunction isDatabaseError(error) {\n  // PostgreSQL errors have a 5-character code\n  return error.code && typeof error.code === 'string' && /^[0-9A-Z]{5}$/.test(error.code);\n}\n\n/**\n * Determine if error is a Fastify validation error\n * @param {Error} error\n * @returns {boolean}\n */\nfunction isFastifyValidationError(error) {\n  return error.validation !== undefined || error.validationContext !== undefined;\n}\n\n/**\n * Global error handling middleware for Fastify\n * Works with both old-style errors and new AppError classes\n *\n * @param {Error} error\n * @param {Object} request\n * @param {Object} reply\n */\nconst errorHandler = (error, request, reply) => {\n  const isDevelopment = process.env.NODE_ENV === 'development';\n  const isProduction = process.env.NODE_ENV === 'production';\n\n  // Generate tracking ID for error correlation\n  const trackingId = `ERR-${Date.now()}-${crypto.randomBytes(4).toString('hex').toUpperCase()}`;\n\n  // Transform known error types\n  let processedError = error;\n\n  // Handle Fastify validation errors\n  if (isFastifyValidationError(error)) {\n    processedError = mapFastifyValidationError(error);\n  }\n  // Handle database errors\n  else if (isDatabaseError(error)) {\n    processedError = mapDatabaseError(error);\n  }\n  // Ensure AppError instances have proper status\n  else if (error instanceof AppError) {\n    error.statusCode = error.statusCode || 500;\n    error.status = error.statusCode;\n    processedError = error;\n  }\n\n  // Determine status code\n  const statusCode = processedError.statusCode || processedError.status || 500;\n  const errorCode = processedError.code || (statusCode >= 500 ? ErrorCodes.SYSTEM_INTERNAL_ERROR : null);\n  const isOperational = processedError.isOperational || processedError instanceof AppError;\n\n  // Log error with full context (PHI-safe)\n  const logLevel = statusCode >= 500 ? 'error' : 'warn';\n  const logData = {\n    trackingId,\n    errorCode,\n    statusCode,\n    isOperational,\n    userId: request.user?.id,\n    path: request.url,\n    method: request.method,\n    // Sanitize details to prevent PHI leakage\n    details: processedError.details ? sanitize(processedError.details) : undefined,\n    internalMessage: processedError.internalMessage ? sanitize({ m: processedError.internalMessage }).m : undefined\n  };\n\n  // Only include error object in logs for 500 errors or development\n  if (statusCode >= 500 || isDevelopment) {\n    logData.err = error;\n  }\n\n  request.log[logLevel](logData, `[${trackingId}] ${isOperational ? 'Operational' : 'Programming'} error: ${error.message}`);\n\n  // Build HIPAA-compliant response\n  const response = {\n    success: false,\n    status: statusCode,\n    error: getErrorName(statusCode),\n    message: getClientSafeMessage(processedError, statusCode, isOperational, isProduction),\n    trackingId\n  };\n\n  // Add error code for machine-readable error handling\n  if (errorCode) {\n    response.code = errorCode;\n  }\n\n  // Add validation errors (sanitized)\n  if (processedError instanceof ValidationError && processedError.errors?.length > 0) {\n    response.errors = processedError.errors.map(e => ({\n      field: e.field,\n      message: e.message,\n      code: e.code\n    }));\n  }\n\n  // Add rate limit headers\n  if (processedError instanceof RateLimitError && processedError.retryAfter) {\n    reply.header('Retry-After', processedError.retryAfter);\n    response.retryAfter = processedError.retryAfter;\n  }\n\n  // Development-only information\n  if (isDevelopment) {\n    response.errorType = processedError.constructor.name;\n    if (error.stack) {\n      response.stack = error.stack.split('\\n').slice(0, 10);\n    }\n    // Include original error message for debugging\n    if (processedError !== error) {\n      response.originalError = error.message;\n    }\n  }\n\n  return reply.code(statusCode).send(response);\n};\n\n/**\n * Get client-safe error message based on environment and error type\n * HIPAA: Never expose internal system details\n */\nfunction getClientSafeMessage(error, statusCode, isOperational, isProduction) {\n  // For database errors, always use generic message\n  if (error instanceof DatabaseError) {\n    return getErrorMessage(error.code || ErrorCodes.DATABASE_ERROR);\n  }\n\n  // In production, hide internal errors\n  if (isProduction && statusCode >= 500 && !isOperational) {\n    return getErrorMessage(ErrorCodes.SYSTEM_INTERNAL_ERROR);\n  }\n\n  // For operational errors, use their message\n  if (isOperational && error.message) {\n    return error.message;\n  }\n\n  // Default to generic message\n  return getErrorMessage(ErrorCodes.SYSTEM_ERROR);\n}\n\n/**\n * Get human-readable error name from status code\n */\nfunction getErrorName(statusCode) {\n  const errorNames = {\n    400: 'Bad Request',\n    401: 'Unauthorized',\n    403: 'Forbidden',\n    404: 'Not Found',\n    409: 'Conflict',\n    410: 'Gone',\n    415: 'Unsupported Media Type',\n    422: 'Validation Error',\n    423: 'Locked',\n    429: 'Too Many Requests',\n    500: 'Internal Server Error',\n    502: 'Bad Gateway',\n    503: 'Service Unavailable',\n    504: 'Gateway Timeout'\n  };\n  return errorNames[statusCode] || 'Error';\n}\n\n/**\n * Not Found handler for undefined routes\n * @param {Object} request\n * @param {Object} reply\n */\nexport const notFoundHandler = (request, reply) => {\n  const trackingId = `ERR-${Date.now()}-${crypto.randomBytes(4).toString('hex').toUpperCase()}`;\n\n  request.log.warn({\n    trackingId,\n    path: request.url,\n    method: request.method,\n    userId: request.user?.id\n  }, `[${trackingId}] Route not found: ${request.method} ${request.url}`);\n\n  return reply.code(404).send({\n    success: false,\n    status: 404,\n    error: 'Not Found',\n    message: 'The requested resource was not found',\n    code: ErrorCodes.RESOURCE_NOT_FOUND,\n    trackingId\n  });\n};\n\nexport default errorHandler;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}