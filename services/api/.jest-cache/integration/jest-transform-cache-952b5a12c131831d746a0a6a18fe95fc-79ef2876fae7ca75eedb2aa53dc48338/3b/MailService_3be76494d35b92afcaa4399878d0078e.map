{"version":3,"names":["cov_2pyf67xzd4","actualCoverage","nodemailer","mailConfig","logger","MailService","constructor","f","s","config","transporter","initializeTransporter","defaultMailer","default","mailerConfig","mailers","b","warn","transport","createTransport","host","port","secure","encryption","auth","user","username","pass","password","tls","rejectUnauthorized","sendmail","newline","path","streamTransport","buffer","sendMail","options","callback","info","messageId","send","Error","mailOptions","from","name","address","error","sendText","to","subject","text","sendHtml","html","verify"],"sources":["MailService.js"],"sourcesContent":["import nodemailer from 'nodemailer';\nimport mailConfig from '../config/mail.config.js';\n\nimport { logger } from '../utils/logger.js';\nclass MailService {\n    constructor() {\n        this.config = mailConfig;\n        this.transporter = null;\n        this.initializeTransporter();\n    }\n    \n    /**\n     * Initialize the mail transporter\n     */\n    initializeTransporter() {\n        const defaultMailer = this.config.default;\n        const mailerConfig = this.config.mailers[defaultMailer];\n        \n        if (!mailerConfig) {\n            logger.warn(`Mailer configuration for ${defaultMailer} not found`)\n            return;\n        }\n        \n        switch (mailerConfig.transport) {\n            case 'smtp':\n                this.transporter = nodemailer.createTransport({\n                    host: mailerConfig.host,\n                    port: mailerConfig.port,\n                    secure: mailerConfig.encryption === 'ssl',\n                    auth: {\n                        user: mailerConfig.username,\n                        pass: mailerConfig.password\n                    },\n                    tls: {\n                        rejectUnauthorized: false\n                    }\n                });\n                break;\n\n            case 'sendmail':\n                this.transporter = nodemailer.createTransport({\n                    sendmail: true,\n                    newline: 'unix',\n                    path: mailerConfig.path\n                });\n                break;\n\n            case 'log':\n                this.transporter = nodemailer.createTransport({\n                    streamTransport: true,\n                    buffer: true\n                });\n                break;\n                \n            case 'null':\n            default:\n                // No-op transporter\n                this.transporter = {\n                    sendMail: (options, callback) => {\n                        logger.info('Email would be sent:', options)\n                        callback(null, { messageId: 'mock-message-id' });\n                    }\n                };\n                break;\n        }\n    }\n    \n    /**\n     * Send an email\n     * @param {Object} options - Email options\n     * @returns {Promise} Promise that resolves when email is sent\n     */\n    async send(options) {\n        if (!this.transporter) {\n            throw new Error('Mail transporter not initialized');\n        }\n        \n        // Merge with default from address\n        const mailOptions = {\n            from: options.from || `${this.config.from.name} <${this.config.from.address}>`,\n            ...options\n        };\n        \n        try {\n            const info = await this.transporter.sendMail(mailOptions);\n            logger.info('Email sent:', info.messageId)\n            return info;\n        } catch (error) {\n            logger.error('Error sending email:', error)\n            throw error;\n        }\n    }\n    \n    /**\n     * Send a plain text email\n     * @param {string} to - Recipient email address\n     * @param {string} subject - Email subject\n     * @param {string} text - Plain text content\n     * @returns {Promise} Promise that resolves when email is sent\n     */\n    async sendText(to, subject, text) {\n        return await this.send({\n            to: to,\n            subject: subject,\n            text: text\n        });\n    }\n    \n    /**\n     * Send an HTML email\n     * @param {string} to - Recipient email address\n     * @param {string} subject - Email subject\n     * @param {string} html - HTML content\n     * @returns {Promise} Promise that resolves when email is sent\n     */\n    async sendHtml(to, subject, html) {\n        return await this.send({\n            to: to,\n            subject: subject,\n            html: html\n        });\n    }\n    \n    /**\n     * Verify the transporter configuration\n     * @returns {Promise} Promise that resolves when transporter is verified\n     */\n    async verify() {\n        if (!this.transporter) {\n            throw new Error('Mail transporter not initialized');\n        }\n        \n        try {\n            await this.transporter.verify();\n            logger.info('Mail transporter verified successfully')\n            return true;\n        } catch (error) {\n            logger.error('Error verifying mail transporter:', error)\n            return false;\n        }\n    }\n}\n\nexport default new MailService();"],"mappings":"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","ignoreList":[]}