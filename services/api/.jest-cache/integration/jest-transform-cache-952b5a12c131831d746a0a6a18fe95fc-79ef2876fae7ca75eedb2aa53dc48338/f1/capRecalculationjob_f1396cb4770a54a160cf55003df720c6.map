{"version":3,"names":["cov_22wg1uh93q","actualCoverage","db","cap_tracking","patients","payment_applications","claims","eq","and","gte","lte","sql","isNull","MailService","logger","recalculateAllCaps","f","s","info","currentYear","Date","getFullYear","startYear","cap_year_start","cap_year_end","cap_amount_cents","b","parseInt","process","env","CAP_YEAR_AMOUNT_CENTS","activePatientsResult","select","patient_id","from","where","service_start_date","service_end_date","deleted_at","groupBy","activePatientIds","map","r","length","updatedCount","newAlerts","paymentTotal","total","applied_amount","innerJoin","claim_id","id","total_payments_cents","remaining_cap_cents","utilization_percentage","toFixed","cap_exceeded","cap_exceeded_amount_cents","existing","cap_year","limit","alert_80_triggered","alert_90_triggered","alert_95_triggered","capData","cap_year_start_date","cap_year_end_date","cap_exceeded_date","toISOString","split","alert_80_date","alert_90_date","alert_95_date","last_calculated_at","calculation_status","update","set","push","threshold","utilization","insert","values","sendCapAlerts","success","updated","alerts_sent","error","alerts","alert","patient","subject","first_name","last_name","message","medical_record_number","sendMail","to","CAP_ALERT_EMAIL","text"],"sources":["capRecalculation.job.js"],"sourcesContent":["import { db } from '../config/db.drizzle.js';\nimport { cap_tracking, patients, payment_applications, claims } from '../db/schemas/index.js';\nimport { eq, and, gte, lte, sql, isNull } from 'drizzle-orm';\nimport MailService from '../services/MailService.js';\n\nimport { logger } from '../utils/logger.js';\n/**\n * Daily Cap Recalculation Job\n * Recalculates Medicare cap for all active patients\n * Schedule: Daily at 2:00 AM\n * Cron: 0 2 * * *\n */\nexport async function recalculateAllCaps() {\n  logger.info('Starting daily cap recalculation job...')\n\n  try {\n    const currentYear = new Date().getFullYear();\n    const startYear = currentYear - 1;\n    const cap_year_start = `${startYear}-10-01`;\n    const cap_year_end = `${currentYear}-09-30`;\n\n    // FY 2025 cap amount: $34,465.34 = 3446534 cents\n    const cap_amount_cents = parseInt(process.env.CAP_YEAR_AMOUNT_CENTS) || 3446534;\n\n    // Get all patients with claims in current cap year\n    const activePatientsResult = await db\n      .select({\n        patient_id: claims.patient_id\n      })\n      .from(claims)\n      .where(and(\n        gte(claims.service_start_date, cap_year_start),\n        lte(claims.service_end_date, cap_year_end),\n        isNull(claims.deleted_at)\n      ))\n      .groupBy(claims.patient_id);\n\n    const activePatientIds = activePatientsResult.map(r => r.patient_id);\n    logger.info(`Found ${activePatientIds.length} patients with activity in current cap year`)\n\n    let updatedCount = 0;\n    let newAlerts = [];\n\n    for (const patient_id of activePatientIds) {\n      // Calculate total payments for this patient in cap year\n      const paymentTotal = await db\n        .select({\n          total: sql`COALESCE(SUM(${payment_applications.applied_amount}), 0)`\n        })\n        .from(payment_applications)\n        .innerJoin(claims, eq(payment_applications.claim_id, claims.id))\n        .where(and(\n          eq(claims.patient_id, patient_id),\n          gte(claims.service_start_date, cap_year_start),\n          lte(claims.service_end_date, cap_year_end),\n          isNull(claims.deleted_at)\n        ));\n\n      const total_payments_cents = parseInt(paymentTotal[0]?.total || 0);\n      const remaining_cap_cents = cap_amount_cents - total_payments_cents;\n      const utilization_percentage = ((total_payments_cents / cap_amount_cents) * 100).toFixed(2);\n\n      // Check if cap exceeded\n      const cap_exceeded = total_payments_cents > cap_amount_cents;\n      const cap_exceeded_amount_cents = cap_exceeded ? total_payments_cents - cap_amount_cents : null;\n\n      // Get existing cap tracking record\n      const existing = await db\n        .select()\n        .from(cap_tracking)\n        .where(and(\n          eq(cap_tracking.patient_id, patient_id),\n          eq(cap_tracking.cap_year, currentYear),\n          isNull(cap_tracking.deleted_at)\n        ))\n        .limit(1);\n\n      // Check for new alert thresholds\n      const alert_80_triggered = utilization_percentage >= 80;\n      const alert_90_triggered = utilization_percentage >= 90;\n      const alert_95_triggered = utilization_percentage >= 95;\n\n      const capData = {\n        patient_id: patient_id,\n        cap_year: currentYear,\n        cap_year_start_date: cap_year_start,\n        cap_year_end_date: cap_year_end,\n        cap_amount_cents: cap_amount_cents,\n        total_payments_cents: total_payments_cents,\n        remaining_cap_cents: remaining_cap_cents,\n        utilization_percentage: utilization_percentage,\n        cap_exceeded: cap_exceeded,\n        cap_exceeded_date: cap_exceeded && !existing[0]?.cap_exceeded ? new Date().toISOString().split('T')[0] : existing[0]?.cap_exceeded_date,\n        cap_exceeded_amount_cents: cap_exceeded_amount_cents,\n        alert_80_triggered: alert_80_triggered,\n        alert_80_date: alert_80_triggered && !existing[0]?.alert_80_triggered ? new Date() : existing[0]?.alert_80_date,\n        alert_90_triggered: alert_90_triggered,\n        alert_90_date: alert_90_triggered && !existing[0]?.alert_90_triggered ? new Date() : existing[0]?.alert_90_date,\n        alert_95_triggered: alert_95_triggered,\n        alert_95_date: alert_95_triggered && !existing[0]?.alert_95_triggered ? new Date() : existing[0]?.alert_95_date,\n        last_calculated_at: new Date(),\n        calculation_status: 'CURRENT'\n      };\n\n      if (existing[0]) {\n        // Update existing record\n        await db\n          .update(cap_tracking)\n          .set(capData)\n          .where(eq(cap_tracking.id, existing[0].id));\n\n        // Check for new alerts\n        if (alert_80_triggered && !existing[0].alert_80_triggered) {\n          newAlerts.push({ patient_id, threshold: 80, utilization: utilization_percentage });\n        }\n        if (alert_90_triggered && !existing[0].alert_90_triggered) {\n          newAlerts.push({ patient_id, threshold: 90, utilization: utilization_percentage });\n        }\n        if (alert_95_triggered && !existing[0].alert_95_triggered) {\n          newAlerts.push({ patient_id, threshold: 95, utilization: utilization_percentage });\n        }\n      } else {\n        // Create new record\n        await db\n          .insert(cap_tracking)\n          .values(capData);\n\n        // Send initial alerts if thresholds already crossed\n        if (alert_95_triggered) {\n          newAlerts.push({ patient_id, threshold: 95, utilization: utilization_percentage });\n        } else if (alert_90_triggered) {\n          newAlerts.push({ patient_id, threshold: 90, utilization: utilization_percentage });\n        } else if (alert_80_triggered) {\n          newAlerts.push({ patient_id, threshold: 80, utilization: utilization_percentage });\n        }\n      }\n\n      updatedCount++;\n    }\n\n    // Send email alerts for new thresholds crossed\n    if (newAlerts.length > 0) {\n      await sendCapAlerts(newAlerts);\n    }\n\n    logger.info(`Cap recalculation completed. Updated ${updatedCount} records, sent ${newAlerts.length} alerts`)\n\n    return {\n      success: true,\n      updated: updatedCount,\n      alerts_sent: newAlerts.length\n    };\n  } catch (error) {\n    logger.error('Error in cap recalculation job:', error)\n    throw error;\n  }\n}\n\n/**\n * Send cap threshold alerts\n */\nasync function sendCapAlerts(alerts) {\n  for (const alert of alerts) {\n    try {\n      // Get patient info\n      const patient = await db\n        .select()\n        .from(patients)\n        .where(eq(patients.id, alert.patient_id))\n        .limit(1);\n\n      if (patient[0]) {\n        const subject = `Cap Alert: Patient ${patient[0].first_name} ${patient[0].last_name} at ${alert.utilization}% utilization`;\n        const message = `\nMedicare Hospice Cap Alert\n\nPatient: ${patient[0].first_name} ${patient[0].last_name} (MRN: ${patient[0].medical_record_number})\nCap Utilization: ${alert.utilization}%\nAlert Threshold: ${alert.threshold}%\n\nThis patient has reached ${alert.threshold}% of their Medicare hospice cap amount.\nPlease review their care plan and billing to ensure compliance.\n\nThis is an automated notification from the Hospice EHR system.\n        `;\n\n        // Send email to billing team (configure recipients in .env)\n        await MailService.sendMail({\n          to: process.env.CAP_ALERT_EMAIL || 'billing@hospice.example.com',\n          subject: subject,\n          text: message\n        });\n      }\n    } catch (error) {\n      logger.error(`Failed to send cap alert for patient ${alert.patient_id}:`, error)\n    }\n  }\n}\n\nexport default recalculateAllCaps;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}