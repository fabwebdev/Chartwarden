{"version":3,"names":["cov_141nqp5g7r","actualCoverage","controller","PERMISSIONS","requireAnyPermission","hopeAssessmentRoutes","fastify","options","f","s","get","preHandler","VIEW_CLINICAL_NOTES","index","post","CREATE_CLINICAL_NOTES","create","show","put","UPDATE_CLINICAL_NOTES","replace","patch","update","delete","DELETE_CLINICAL_NOTES","getHistory","getCMSComplianceStatus","submit","getCMSRequirements","VIEW_REPORTS","getComplianceDashboard","getPending","getOverdue","getCompliance","VIEW_PATIENT","getPatientAssessments","createAdmissionAssessment","createHUV1Assessment","createHUV2Assessment","createDischargeAssessment","createTransferAssessment","createResumptionAssessment","createRecertificationAssessment","createSFVAssessment","validate","sign"],"sources":["hopeAssessment.routes.js"],"sourcesContent":["import controller from '../controllers/HOPEAssessment.controller.js';\nimport { PERMISSIONS } from '../config/rbac.js';\nimport { requireAnyPermission } from '../middleware/rbac.middleware.js';\n\n/**\n * HOPE Assessment Routes\n * Hospice Outcomes & Patient Evaluation (HOPE) - CMS requirement\n * Critical: Non-compliance can result in 4% Medicare payment reduction\n *\n * CMS References:\n * - 42 CFR ยง 418.54 - Condition of Participation: Initial and Comprehensive Assessment\n * - 42 CFR ยง 418.56 - Condition of Participation: Hospice Aide and Homemaker Services\n * - 42 CFR ยง 418.58 - Condition of Participation: Quality Assessment and Performance Improvement\n * - 42 CFR ยง 418.76 - Condition of Participation: Hospice Care Team\n * - 21 CFR Part 11 - Electronic Records; Electronic Signatures\n */\nexport default async function hopeAssessmentRoutes(fastify, options) {\n  // ============================================================================\n  // REST API Endpoints - Generic CRUD Operations\n  // ============================================================================\n\n  // List all assessments with filters and pagination\n  // GET /assessments?patient_id=&assessment_type=&date_from=&date_to=&limit=&offset=\n  fastify.get('/assessments', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.index);\n\n  // Create new assessment (generic endpoint with type in body)\n  // POST /assessments { patient_id, assessment_type, ... }\n  fastify.post('/assessments', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES)]\n  }, controller.create);\n\n  // Get single assessment by ID\n  // GET /assessments/:id\n  fastify.get('/assessments/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.show);\n\n  // Full update (PUT) - replaces entire assessment\n  // PUT /assessments/:id\n  fastify.put('/assessments/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.replace);\n\n  // Partial update (PATCH) - updates specific fields\n  // PATCH /assessments/:id\n  fastify.patch('/assessments/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.update);\n\n  // Soft delete assessment\n  // DELETE /assessments/:id\n  fastify.delete('/assessments/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.DELETE_CLINICAL_NOTES)]\n  }, controller.delete);\n\n  // Get assessment version history\n  // GET /assessments/:id/history\n  fastify.get('/assessments/:id/history', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getHistory);\n\n  // Get detailed CMS compliance status for assessment\n  // GET /assessments/:id/cms-compliance\n  fastify.get('/assessments/:id/cms-compliance', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getCMSComplianceStatus);\n\n  // Submit assessment to CMS iQIES (alias for existing route)\n  // POST /assessments/:id/submit\n  fastify.post('/assessments/:id/submit', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.submit);\n\n  // ============================================================================\n  // CMS Requirements Endpoints\n  // ============================================================================\n\n  // Get CMS requirements by assessment type\n  // GET /cms-requirements?assessment_type=\n  fastify.get('/cms-requirements', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getCMSRequirements);\n\n  // ============================================================================\n  // Reports & Dashboard Endpoints\n  // ============================================================================\n\n  // Get aggregate compliance dashboard data\n  // GET /reports/compliance?date_from=&date_to=&assessment_type=\n  fastify.get('/reports/compliance', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_REPORTS)]\n  }, controller.getComplianceDashboard);\n\n  // ============================================================================\n  // Legacy Query routes (must be registered before parameterized routes)\n  // ============================================================================\n  fastify.get('/hope-assessments/pending', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getPending);\n\n  fastify.get('/hope-assessments/overdue', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getOverdue);\n\n  fastify.get('/hope-assessments/compliance', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_REPORTS)]\n  }, controller.getCompliance);\n\n  // ============================================================================\n  // Patient-specific assessment creation routes\n  // ============================================================================\n  fastify.get('/patients/:id/hope-assessments', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_PATIENT, PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.getPatientAssessments);\n\n  // Admission assessment (within 5 days of admission) - RN required\n  fastify.post('/patients/:id/hope-assessments/admission', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES)]\n  }, controller.createAdmissionAssessment);\n\n  // HUV1 - HOPE Update Visit 1 (days 6-15 after admission)\n  fastify.post('/patients/:id/hope-assessments/huv1', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES)]\n  }, controller.createHUV1Assessment);\n\n  // HUV2 - HOPE Update Visit 2 (days 16-30 after admission)\n  fastify.post('/patients/:id/hope-assessments/huv2', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES)]\n  }, controller.createHUV2Assessment);\n\n  // Discharge assessment (within 2 days of discharge)\n  fastify.post('/patients/:id/hope-assessments/discharge', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES)]\n  }, controller.createDischargeAssessment);\n\n  // Transfer assessment (within 2 days of transfer)\n  fastify.post('/patients/:id/hope-assessments/transfer', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES)]\n  }, controller.createTransferAssessment);\n\n  // Resumption of care assessment (within 5 days of resumption)\n  fastify.post('/patients/:id/hope-assessments/resumption', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES)]\n  }, controller.createResumptionAssessment);\n\n  // Recertification assessment (within 5 days of recertification)\n  fastify.post('/patients/:id/hope-assessments/recertification', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES)]\n  }, controller.createRecertificationAssessment);\n\n  // Symptom Follow-up Visit (within 48 hours of moderate/severe symptom)\n  fastify.post('/patients/:id/hope-assessments/sfv', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_CLINICAL_NOTES)]\n  }, controller.createSFVAssessment);\n\n  // ============================================================================\n  // Assessment management routes\n  // ============================================================================\n\n  // Get single assessment\n  fastify.get('/hope-assessments/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.show);\n\n  // Update assessment (blocked if signed/submitted per 21 CFR Part 11)\n  fastify.patch('/hope-assessments/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.update);\n\n  // Delete assessment (soft delete - blocked if signed/submitted)\n  fastify.delete('/hope-assessments/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.DELETE_CLINICAL_NOTES)]\n  }, controller.delete);\n\n  // ============================================================================\n  // Validation and signature routes\n  // ============================================================================\n\n  // Validate assessment for CMS compliance\n  fastify.post('/hope-assessments/:id/validate', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_CLINICAL_NOTES)]\n  }, controller.validate);\n\n  // Sign assessment (21 CFR Part 11 compliant electronic signature)\n  fastify.post('/hope-assessments/:id/sign', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.sign);\n\n  // Submit assessment to CMS iQIES system\n  fastify.post('/hope-assessments/:id/submit', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_CLINICAL_NOTES)]\n  }, controller.submit);\n}\n"],"mappings":"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","ignoreList":[]}