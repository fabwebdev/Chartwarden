{"version":3,"names":["cov_1trjw7lmvq","actualCoverage","fs","path","fileURLToPath","__filename","s","import","meta","url","__dirname","dirname","docsPath","join","parseYamlSimple","yamlContent","f","info","title","b","match","trim","version","openapi","pathMatches","schemaMatches","tagMatches","stats","endpoints","length","schemas","tags","docsRoutes","fastify","get","request","reply","htmlPath","html","readFileSync","type","send","error","log","code","status","message","yamlPath","header","yaml","jsonContent","default","load","yamlEndpoint","metadata","parsed","data","openApiVersion","swaggerUi","openapiYaml","openapiJson","lastUpdated","Date","toISOString"],"sources":["docs.routes.js"],"sourcesContent":["/**\n * API Documentation Routes\n *\n * Serves OpenAPI/Swagger documentation at /api/docs\n *\n * Endpoints:\n * - GET /api/docs - Swagger UI interface\n * - GET /api/docs/openapi.yaml - OpenAPI 3.0 specification (YAML)\n * - GET /api/docs/openapi.json - OpenAPI 3.0 specification (JSON)\n * - GET /api/docs/info - API metadata and statistics\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n// Path to docs directory\nconst docsPath = path.join(__dirname, '../../docs');\n\n/**\n * Simple YAML to JSON parser for OpenAPI spec\n * Handles the basic YAML structure without external dependencies\n * @param {string} yamlContent - YAML content string\n * @returns {object} Parsed object\n */\nfunction parseYamlSimple(yamlContent) {\n  // For OpenAPI spec, we'll extract key metadata using regex\n  const info = {\n    title: yamlContent.match(/title:\\s*(.+)/)?.[1]?.trim() || 'Chartwarden API',\n    version: yamlContent.match(/version:\\s*(.+)/)?.[1]?.trim() || '2.0.0',\n    openapi: yamlContent.match(/openapi:\\s*(.+)/)?.[1]?.trim() || '3.0.3'\n  };\n\n  // Count paths (endpoints)\n  const pathMatches = yamlContent.match(/^\\s{2}\\/[^\\s:]+:/gm) || [];\n\n  // Count schemas\n  const schemaMatches = yamlContent.match(/^\\s{4}[A-Z][a-zA-Z]+:$/gm) || [];\n\n  // Count tags\n  const tagMatches = yamlContent.match(/^\\s{2}- name:/gm) || [];\n\n  return {\n    info,\n    stats: {\n      endpoints: pathMatches.length,\n      schemas: schemaMatches.length,\n      tags: tagMatches.length\n    }\n  };\n}\n\n/**\n * Register documentation routes\n * @param {import('fastify').FastifyInstance} fastify\n */\nasync function docsRoutes(fastify) {\n  // Serve Swagger UI at /api/docs\n  fastify.get('/', async (request, reply) => {\n    try {\n      const htmlPath = path.join(docsPath, 'swagger-ui.html');\n      const html = fs.readFileSync(htmlPath, 'utf8');\n      reply.type('text/html').send(html);\n    } catch (error) {\n      fastify.log.error('Error serving Swagger UI:', error);\n      reply.code(500).send({\n        status: 500,\n        message: 'Error loading API documentation'\n      });\n    }\n  });\n\n  // Serve OpenAPI YAML specification\n  fastify.get('/openapi.yaml', async (request, reply) => {\n    try {\n      const yamlPath = path.join(docsPath, 'openapi.yaml');\n      const yamlContent = fs.readFileSync(yamlPath, 'utf8');\n      reply\n        .type('text/yaml')\n        .header('Content-Disposition', 'inline; filename=\"openapi.yaml\"')\n        .header('Access-Control-Allow-Origin', '*')\n        .send(yamlContent);\n    } catch (error) {\n      fastify.log.error('Error serving OpenAPI YAML:', error);\n      reply.code(500).send({\n        status: 500,\n        message: 'Error loading OpenAPI specification'\n      });\n    }\n  });\n\n  // Serve OpenAPI JSON specification\n  // Note: For full JSON conversion, consider adding js-yaml package\n  // Currently returns basic metadata as JSON\n  fastify.get('/openapi.json', async (request, reply) => {\n    try {\n      const yamlPath = path.join(docsPath, 'openapi.yaml');\n      const yamlContent = fs.readFileSync(yamlPath, 'utf8');\n\n      // Try to dynamically import js-yaml if available\n      try {\n        const yaml = await import('js-yaml');\n        const jsonContent = yaml.default.load(yamlContent);\n        return reply\n          .type('application/json')\n          .header('Content-Disposition', 'inline; filename=\"openapi.json\"')\n          .header('Access-Control-Allow-Origin', '*')\n          .send(jsonContent);\n      } catch {\n        // js-yaml not available, return message directing to YAML endpoint\n        return reply.code(200).send({\n          status: 200,\n          message: 'Full JSON specification requires js-yaml package. Use /api/docs/openapi.yaml instead.',\n          yamlEndpoint: '/api/docs/openapi.yaml',\n          metadata: parseYamlSimple(yamlContent)\n        });\n      }\n    } catch (error) {\n      fastify.log.error('Error serving OpenAPI JSON:', error);\n      reply.code(500).send({\n        status: 500,\n        message: 'Error loading OpenAPI specification'\n      });\n    }\n  });\n\n  // Provide API documentation metadata\n  fastify.get('/info', async (request, reply) => {\n    try {\n      const yamlPath = path.join(docsPath, 'openapi.yaml');\n      const yamlContent = fs.readFileSync(yamlPath, 'utf8');\n      const parsed = parseYamlSimple(yamlContent);\n\n      reply.send({\n        status: 200,\n        data: {\n          title: parsed.info.title,\n          version: parsed.info.version,\n          openApiVersion: parsed.info.openapi,\n          stats: parsed.stats,\n          endpoints: {\n            swaggerUi: '/api/docs',\n            openapiYaml: '/api/docs/openapi.yaml',\n            openapiJson: '/api/docs/openapi.json',\n            info: '/api/docs/info'\n          },\n          lastUpdated: new Date().toISOString()\n        }\n      });\n    } catch (error) {\n      fastify.log.error('Error getting API info:', error);\n      reply.code(500).send({\n        status: 500,\n        message: 'Error loading API information'\n      });\n    }\n  });\n}\n\nexport default docsRoutes;\n"],"mappings":"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","ignoreList":[]}