{"version":3,"names":["cov_21vms2tuvg","actualCoverage","controller","index","store","show","update","verifyToken","PERMISSIONS","requireAnyPermission","requirePermission","vitalSignsRoutes","fastify","options","f","s","get","preHandler","VIEW_VITAL_SIGNS","getPatientVitalSigns","bind","getLatestVitalSigns","getPatientStats","getPatientTrend","post","CREATE_VITAL_SIGNS","create","getReference","UPDATE_VITAL_SIGNS","put","fullUpdate","patch","delete","DELETE_VITAL_SIGNS","VIEW_AUDIT_LOGS","restore","sign","amend"],"sources":["VitalSigns.routes.js"],"sourcesContent":["import controller from '../../controllers/patient/VitalSigns.controller.js';\nimport { index, store, show, update } from '../../controllers/patient/VitalSigns.controller.js';\nimport { verifyToken } from '../../middleware/betterAuth.middleware.js';\nimport { PERMISSIONS } from '../../config/rbac.js';\nimport { requireAnyPermission, requirePermission } from '../../middleware/rbac.middleware.js';\n\n/**\n * Vital Signs Routes\n * Comprehensive vital signs (BP, HR, RR, Temp, SpO2, Pain) with timestamp, value, and unit information\n *\n * RBAC Permissions:\n * - Nurse: create, read (VIEW_VITAL_SIGNS, CREATE_VITAL_SIGNS)\n * - Doctor: create, read, update (VIEW_VITAL_SIGNS, CREATE_VITAL_SIGNS, UPDATE_VITAL_SIGNS)\n * - Admin: full CRUD + view deleted (all vital signs permissions + VIEW_AUDIT_LOGS)\n *\n * Routes are organized into:\n * 1. Patient-scoped routes: /patients/:patientId/vital-signs\n * 2. Global routes: /vital-signs\n * 3. Signature/compliance routes: /vital-signs/:id/sign, /vital-signs/:id/amend\n * 4. Admin routes: /vital-signs/:id/restore\n */\nasync function vitalSignsRoutes(fastify, options) {\n  // =========================================\n  // Patient-scoped vital signs routes\n  // =========================================\n\n  // Get all vital signs for a patient\n  // Nurses, Doctors, Admin can view\n  fastify.get('/patients/:patientId/vital-signs', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_VITAL_SIGNS)]\n  }, controller.getPatientVitalSigns.bind(controller));\n\n  // Get latest vital signs for a patient\n  // Nurses, Doctors, Admin can view\n  fastify.get('/patients/:patientId/vital-signs/latest', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_VITAL_SIGNS)]\n  }, controller.getLatestVitalSigns.bind(controller));\n\n  // Get vital signs statistics for a patient\n  // Nurses, Doctors, Admin can view\n  fastify.get('/patients/:patientId/vital-signs/stats', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_VITAL_SIGNS)]\n  }, controller.getPatientStats.bind(controller));\n\n  // Get vital signs trend for a patient\n  // Nurses, Doctors, Admin can view\n  fastify.get('/patients/:patientId/vital-signs/trend', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_VITAL_SIGNS)]\n  }, controller.getPatientTrend.bind(controller));\n\n  // Create vital signs for a patient\n  // Nurses, Doctors, Admin can create\n  fastify.post('/patients/:patientId/vital-signs', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_VITAL_SIGNS)]\n  }, controller.create.bind(controller));\n\n  // =========================================\n  // Global vital signs routes\n  // =========================================\n\n  // Get vital signs reference information (normal ranges, methods, etc.)\n  // Anyone with view permission can access reference data\n  fastify.get('/vital-signs/reference', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_VITAL_SIGNS)]\n  }, controller.getReference.bind(controller));\n\n  // Get all vital signs (with filters)\n  // Nurses, Doctors, Admin can view\n  fastify.get('/vital-signs', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_VITAL_SIGNS)]\n  }, index);\n\n  // Create new vital signs (legacy route)\n  // Nurses, Doctors, Admin can create\n  fastify.post('/vital-signs/store', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_VITAL_SIGNS)]\n  }, store);\n\n  // Get a single vital sign record by ID\n  // Nurses, Doctors, Admin can view\n  fastify.get('/vital-signs/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.VIEW_VITAL_SIGNS)]\n  }, show);\n\n  // Update vital signs by ID (legacy pattern - POST)\n  // Doctors, Admin can update\n  fastify.post('/vital-signs/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_VITAL_SIGNS)]\n  }, update);\n\n  // Full update vital signs by ID (RESTful pattern - PUT)\n  // Replaces entire record, requires version for optimistic locking\n  // Doctors, Admin can update\n  fastify.put('/vital-signs/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_VITAL_SIGNS)]\n  }, controller.fullUpdate.bind(controller));\n\n  // Partial update vital signs by ID (RESTful pattern - PATCH)\n  // Updates only specified fields, requires version for optimistic locking\n  // Doctors, Admin can update\n  fastify.patch('/vital-signs/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_VITAL_SIGNS)]\n  }, controller.update.bind(controller));\n\n  // Soft delete vital signs by ID\n  // Admin only can delete\n  fastify.delete('/vital-signs/:id', {\n    preHandler: [requireAnyPermission(PERMISSIONS.DELETE_VITAL_SIGNS)]\n  }, controller.delete.bind(controller));\n\n  // =========================================\n  // Admin-only routes\n  // =========================================\n\n  // Restore soft-deleted vital signs\n  // Admin only (requires DELETE permission + VIEW_AUDIT_LOGS for accessing deleted records)\n  fastify.post('/vital-signs/:id/restore', {\n    preHandler: [requirePermission(PERMISSIONS.DELETE_VITAL_SIGNS, PERMISSIONS.VIEW_AUDIT_LOGS)]\n  }, controller.restore.bind(controller));\n\n  // =========================================\n  // Signature and compliance routes (21 CFR Part 11)\n  // =========================================\n\n  // Sign vital signs record\n  // Creates an electronic signature attestation\n  // Nurses, Doctors, Admin can sign their own records\n  fastify.post('/vital-signs/:id/sign', {\n    preHandler: [requireAnyPermission(PERMISSIONS.CREATE_VITAL_SIGNS, PERMISSIONS.UPDATE_VITAL_SIGNS)]\n  }, controller.sign.bind(controller));\n\n  // Amend signed vital signs record\n  // Creates a new version with amendment reason (original preserved)\n  // Doctors, Admin can amend\n  fastify.post('/vital-signs/:id/amend', {\n    preHandler: [requireAnyPermission(PERMISSIONS.UPDATE_VITAL_SIGNS)]\n  }, controller.amend.bind(controller));\n}\n\nexport default vitalSignsRoutes;\n"],"mappings":"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","ignoreList":[]}