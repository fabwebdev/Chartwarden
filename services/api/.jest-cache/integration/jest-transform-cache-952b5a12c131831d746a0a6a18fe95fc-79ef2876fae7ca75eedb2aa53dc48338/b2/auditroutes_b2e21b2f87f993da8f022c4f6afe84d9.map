{"version":3,"names":["cov_oqt7yo0k1","actualCoverage","getAuditLogs","getUserAuditLogs","getAuditLogById","getComplianceReport","getUserActivityReport","getResourceAccessHistory","getRetentionStatus","getAuditStats","getArchivalCandidates","authenticate","requireRole","ROLES","auditRoutes","fastify","options","f","s","get","preHandler","ADMIN"],"sources":["audit.routes.js"],"sourcesContent":["import { getAuditLogs, getUserAuditLogs, getAuditLogById } from '../controllers/Audit.controller.js';\nimport {\n  getComplianceReport,\n  getUserActivityReport,\n  getResourceAccessHistory,\n  getRetentionStatus,\n  getAuditStats,\n  getArchivalCandidates,\n} from '../controllers/AuditCompliance.controller.js';\nimport { authenticate } from '../middleware/betterAuth.middleware.js';\nimport { requireRole } from '../middleware/rbac.middleware.js';\nimport { ROLES } from '../config/rbac.js';\n\n// Fastify plugin for audit routes\nasync function auditRoutes(fastify, options) {\n  // =====================\n  // Compliance Endpoints (Admin only)\n  // =====================\n\n  // Get compliance report for date range\n  // GET /api/audit/compliance/report?startDate=2024-01-01&endDate=2024-12-31\n  fastify.get('/compliance/report', {\n    preHandler: [authenticate, requireRole(ROLES.ADMIN)],\n  }, getComplianceReport);\n\n  // Get user activity report\n  // GET /api/audit/compliance/user/:userId?startDate=2024-01-01&endDate=2024-12-31\n  fastify.get('/compliance/user/:userId', {\n    preHandler: [authenticate, requireRole(ROLES.ADMIN)],\n  }, getUserActivityReport);\n\n  // Get resource access history\n  // GET /api/audit/compliance/resource/:resourceType/:resourceId\n  fastify.get('/compliance/resource/:resourceType/:resourceId', {\n    preHandler: [authenticate, requireRole(ROLES.ADMIN)],\n  }, getResourceAccessHistory);\n\n  // Get retention compliance status\n  // GET /api/audit/compliance/retention\n  fastify.get('/compliance/retention', {\n    preHandler: [authenticate, requireRole(ROLES.ADMIN)],\n  }, getRetentionStatus);\n\n  // Get audit service statistics\n  // GET /api/audit/compliance/stats\n  fastify.get('/compliance/stats', {\n    preHandler: [authenticate, requireRole(ROLES.ADMIN)],\n  }, getAuditStats);\n\n  // Get archival candidates\n  // GET /api/audit/compliance/archival?retentionYears=6\n  fastify.get('/compliance/archival', {\n    preHandler: [authenticate, requireRole(ROLES.ADMIN)],\n  }, getArchivalCandidates);\n\n  // =====================\n  // Basic Audit Log Endpoints\n  // =====================\n\n  // Admin routes for audit logs\n  fastify.get('/', {\n    preHandler: [authenticate, requireRole(ROLES.ADMIN)],\n  }, getAuditLogs);\n\n  fastify.get('/:id', {\n    preHandler: [authenticate, requireRole(ROLES.ADMIN)],\n  }, getAuditLogById);\n\n  // User route to get their own audit logs\n  fastify.get('/user/logs', {\n    preHandler: [authenticate],\n  }, getUserAuditLogs);\n}\n\nexport default auditRoutes;\n"],"mappings":"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","ignoreList":[]}