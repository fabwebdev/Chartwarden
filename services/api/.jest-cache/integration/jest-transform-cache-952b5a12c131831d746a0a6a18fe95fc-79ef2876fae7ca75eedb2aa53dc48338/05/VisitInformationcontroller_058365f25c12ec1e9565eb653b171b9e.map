{"version":3,"names":["cov_xo1c5axl7","actualCoverage","db","visit_information","eq","logger","VisitInformationController","store","request","reply","f","s","patient_id","visit_date","visit_time_in","travel_time_in","travel_time_out","visit_time_out","documenttation_time","associated_mileage","surcharge","body","b","code","message","existingVisitInfo","select","id","from","where","limit","visitInfo","visitInformationData","result","update","set","returning","insert","values","data","error","show","params","visitInformationRecords","createdAt","updatedAt","visitInformationRecord"],"sources":["VisitInformation.controller.js"],"sourcesContent":["import { db } from \"../../config/db.drizzle.js\";\nimport { visit_information } from \"../../db/schemas/visitInformation.schema.js\";\nimport { eq } from \"drizzle-orm\";\n\nimport { logger } from '../../utils/logger.js';\nclass VisitInformationController {\n    // Store or update visit information\n    async store(request, reply) {\n        try {\n            const {\n                patient_id,\n                visit_date,\n                visit_time_in,\n                travel_time_in,\n                travel_time_out,\n                visit_time_out,\n                documenttation_time,\n                associated_mileage,\n                surcharge,\n            } = request.body;\n\n            // Validate required fields\n            if (!patient_id) {\n                reply.code(400);\n            return {\n                    message: \"Patient ID is required\",\n                };\n            }\n\n            // Check if visit information already exists for this patient\n            const existingVisitInfo = await db.select({\n                id: visit_information.id\n            }).from(visit_information).where(eq(visit_information.patient_id, patient_id)).limit(1);\n            const visitInfo = existingVisitInfo[0];\n\n            // Prepare data for update or create\n            const visitInformationData = {\n                patient_id: patient_id,\n                visit_date: visit_date || null,\n                visit_time_in: visit_time_in || null,\n                travel_time_in: travel_time_in || null,\n                travel_time_out: travel_time_out || null,\n                visit_time_out: visit_time_out || null,\n                documenttation_time: documenttation_time || null,\n                associated_mileage: associated_mileage || null,\n                surcharge: surcharge || null,\n            };\n\n            let result;\n            if (visitInfo) {\n                // Update existing visit information\n                result = await db.update(visit_information).set(visitInformationData).where(eq(visit_information.patient_id, patient_id)).returning();\n                result = result[0];\n            } else {\n                // Create new visit information\n                result = await db.insert(visit_information).values(visitInformationData).returning();\n                result = result[0];\n            }\n\n            reply.code(200);\n            return {\n                message: \"Données sauvegardées avec succès\",\n                data: result,\n            };\n        } catch (error) {\n            logger.error(\"Error saving visit information:\", error)\n            reply.code(500);\n            return {\n                message: \"Internal server error\",\n                error: error.message,\n            };\n        }\n    }\n\n    // Show visit information for a specific patient\n    async show(request, reply) {\n        try {\n            const { id } = request.params;\n\n            const visitInformationRecords = await db.select({\n                id: visit_information.id,\n                patient_id: visit_information.patient_id,\n                visit_date: visit_information.visit_date,\n                visit_time_in: visit_information.visit_time_in,\n                visit_time_out: visit_information.visit_time_out,\n                travel_time_in: visit_information.travel_time_in,\n                travel_time_out: visit_information.travel_time_out,\n                documenttation_time: visit_information.documenttation_time,\n                associated_mileage: visit_information.associated_mileage,\n                surcharge: visit_information.surcharge,\n                createdAt: visit_information.createdAt,\n                updatedAt: visit_information.updatedAt\n            }).from(visit_information).where(eq(visit_information.patient_id, id)).limit(1);\n            const visitInformationRecord = visitInformationRecords[0];\n\n            if (!visitInformationRecord) {\n                reply.code(404);\n            return {\n                    error: \"No visit information found for this patient\",\n                };\n            }\n\n            reply.code(200);\n            return visitInformationRecord;\n        } catch (error) {\n            logger.error(\"Error fetching visit information:\", error)\n            reply.code(500);\n            return {\n                message: \"Internal server error\",\n                error: error.message,\n            };\n        }\n    }\n}\n\nexport default new VisitInformationController();"],"mappings":"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","ignoreList":[]}