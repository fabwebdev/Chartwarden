{"version":3,"names":["cov_1tz5k5c38s","actualCoverage","db","report_schedules","generated_reports","report_recipients","report_access_logs","users","eq","and","isNull","inArray","logger","MailService","fs","path","ReportDeliveryService","constructor","f","s","maxRetries","b","parseInt","process","env","DELIVERY_MAX_RETRIES","retryDelayMs","DELIVERY_RETRY_DELAY_MS","metrics","totalDeliveries","successfulDeliveries","failedDeliveries","deliveriesByChannel","EMAIL","WEBHOOK","FILE","deliverReport","generatedReportId","scheduleId","startTime","Date","now","deliveryResults","report","select","from","where","id","Error","status","recipients","getScheduleRecipients","length","updateDeliveryStatus","message","schedule","recipient","result","deliverToRecipient","push","deliveredAt","error","failedAt","allSuccess","every","r","allFailed","overallStatus","duration","schedule_id","is_active","resolvedRecipients","recipient_type","user_id","user","email","name","role","usersWithRole","webhook_url","deliverViaEmail","deliverViaWebhook","subject","custom_subject","email_subject","output_filename","body","custom_body","email_body","buildDefaultEmailBody","emailOptions","to","html","include_attachment","fileContent","readFile","storage_path","attachments","filename","content","contentType","mime_type","include_inline","htmlContent","send","channel","messageId","output_format","completed_at","toLocaleString","formatFileSize","file_size_bytes","payload","event","timestamp","toISOString","format","size","generatedAt","configurationId","configuration_id","checksum","file_checksum","response","fetch","method","headers","JSON","stringify","ok","statusText","statusCode","webhookUrl","attempts","updates","delivery_status","delivery_attempts","delivered_at","delivered_to","filter","a","map","type","update","set","retryFailedDeliveries","failedAttempts","logAccess","userId","accessType","requestInfo","insert","values","generated_report_id","access_type","ip_address","ip","user_agent","userAgent","success","logFailedAccess","error_message","bytes","units","i","toFixed","getMetrics","successRate"],"sources":["ReportDeliveryService.js"],"sourcesContent":["import { db } from \"../config/db.drizzle.js\";\nimport {\n  report_schedules,\n  generated_reports,\n  report_recipients,\n  report_access_logs\n} from \"../db/schemas/index.js\";\nimport { users } from \"../db/schemas/user.schema.js\";\nimport { eq, and, isNull, inArray } from \"drizzle-orm\";\nimport { logger } from \"../utils/logger.js\";\nimport MailService from \"./MailService.js\";\nimport fs from \"fs/promises\";\nimport path from \"path\";\n\n/**\n * Report Delivery Service\n * Handles multi-channel delivery of generated reports\n *\n * Delivery Channels:\n * - EMAIL: Send report as attachment to specified recipients\n * - WEBHOOK: POST report data or URL to webhook endpoint\n * - FILE: Store in designated file location\n * - DOWNLOAD: On-demand retrieval via API\n *\n * HIPAA Compliance:\n * - All deliveries are logged\n * - PHI handling with encryption in transit\n * - Delivery audit trail maintained\n */\nclass ReportDeliveryService {\n  constructor() {\n    // Retry configuration\n    this.maxRetries = parseInt(process.env.DELIVERY_MAX_RETRIES) || 3;\n    this.retryDelayMs = parseInt(process.env.DELIVERY_RETRY_DELAY_MS) || 60000;\n\n    // Delivery metrics\n    this.metrics = {\n      totalDeliveries: 0,\n      successfulDeliveries: 0,\n      failedDeliveries: 0,\n      deliveriesByChannel: {\n        EMAIL: 0,\n        WEBHOOK: 0,\n        FILE: 0\n      }\n    };\n  }\n\n  /**\n   * Deliver a generated report to all configured recipients\n   * @param {number} generatedReportId - ID of the generated report\n   * @param {number} scheduleId - Optional schedule ID for scheduled deliveries\n   * @returns {Object} Delivery results\n   */\n  async deliverReport(generatedReportId, scheduleId = null) {\n    const startTime = Date.now();\n    const deliveryResults = [];\n\n    try {\n      // Get the generated report\n      const [report] = await db\n        .select()\n        .from(generated_reports)\n        .where(eq(generated_reports.id, generatedReportId));\n\n      if (!report) {\n        throw new Error(`Generated report ${generatedReportId} not found`);\n      }\n\n      if (report.status !== 'SUCCESS') {\n        throw new Error(`Cannot deliver report with status: ${report.status}`);\n      }\n\n      // Get recipients from schedule or direct configuration\n      let recipients = [];\n      if (scheduleId) {\n        recipients = await this.getScheduleRecipients(scheduleId);\n      }\n\n      // If no recipients configured, mark as not required\n      if (recipients.length === 0) {\n        await this.updateDeliveryStatus(generatedReportId, 'NOT_REQUIRED', []);\n        return {\n          status: 'NOT_REQUIRED',\n          message: 'No recipients configured',\n          deliveryResults: []\n        };\n      }\n\n      // Get schedule for email customization\n      let schedule = null;\n      if (scheduleId) {\n        [schedule] = await db\n          .select()\n          .from(report_schedules)\n          .where(eq(report_schedules.id, scheduleId));\n      }\n\n      // Deliver to each recipient\n      for (const recipient of recipients) {\n        try {\n          const result = await this.deliverToRecipient(report, recipient, schedule);\n          deliveryResults.push({\n            recipient,\n            status: 'SUCCESS',\n            deliveredAt: new Date(),\n            ...result\n          });\n          this.metrics.successfulDeliveries++;\n        } catch (error) {\n          logger.error(`Delivery failed for recipient:`, { recipient, error: error.message });\n          deliveryResults.push({\n            recipient,\n            status: 'FAILED',\n            error: error.message,\n            failedAt: new Date()\n          });\n          this.metrics.failedDeliveries++;\n        }\n      }\n\n      this.metrics.totalDeliveries++;\n\n      // Determine overall delivery status\n      const allSuccess = deliveryResults.every(r => r.status === 'SUCCESS');\n      const allFailed = deliveryResults.every(r => r.status === 'FAILED');\n      const overallStatus = allSuccess ? 'DELIVERED' : allFailed ? 'FAILED' : 'PARTIAL';\n\n      // Update report delivery status\n      await this.updateDeliveryStatus(\n        generatedReportId,\n        overallStatus,\n        deliveryResults\n      );\n\n      return {\n        status: overallStatus,\n        deliveryResults,\n        duration: Date.now() - startTime\n      };\n\n    } catch (error) {\n      logger.error(`Report delivery failed:`, error);\n\n      await this.updateDeliveryStatus(generatedReportId, 'FAILED', [{\n        error: error.message,\n        failedAt: new Date()\n      }]);\n\n      throw error;\n    }\n  }\n\n  /**\n   * Get recipients for a schedule\n   */\n  async getScheduleRecipients(scheduleId) {\n    const recipients = await db\n      .select()\n      .from(report_recipients)\n      .where(and(\n        eq(report_recipients.schedule_id, scheduleId),\n        eq(report_recipients.is_active, true)\n      ));\n\n    // Resolve user IDs to emails\n    const resolvedRecipients = [];\n\n    for (const recipient of recipients) {\n      switch (recipient.recipient_type) {\n        case 'USER':\n          if (recipient.user_id) {\n            const [user] = await db\n              .select({ email: users.email, name: users.name })\n              .from(users)\n              .where(eq(users.id, recipient.user_id));\n            if (user?.email) {\n              resolvedRecipients.push({\n                ...recipient,\n                email: user.email,\n                name: user.name\n              });\n            }\n          }\n          break;\n\n        case 'EMAIL':\n          if (recipient.email) {\n            resolvedRecipients.push(recipient);\n          }\n          break;\n\n        case 'ROLE':\n          // Get all users with the specified role\n          if (recipient.role) {\n            const usersWithRole = await db\n              .select({ id: users.id, email: users.email, name: users.name })\n              .from(users)\n              .where(eq(users.role, recipient.role));\n\n            for (const user of usersWithRole) {\n              if (user.email) {\n                resolvedRecipients.push({\n                  ...recipient,\n                  user_id: user.id,\n                  email: user.email,\n                  name: user.name\n                });\n              }\n            }\n          }\n          break;\n\n        case 'WEBHOOK':\n          if (recipient.webhook_url) {\n            resolvedRecipients.push(recipient);\n          }\n          break;\n      }\n    }\n\n    return resolvedRecipients;\n  }\n\n  /**\n   * Deliver report to a single recipient\n   */\n  async deliverToRecipient(report, recipient, schedule) {\n    switch (recipient.recipient_type) {\n      case 'USER':\n      case 'EMAIL':\n      case 'ROLE':\n        return await this.deliverViaEmail(report, recipient, schedule);\n\n      case 'WEBHOOK':\n        return await this.deliverViaWebhook(report, recipient);\n\n      default:\n        throw new Error(`Unsupported recipient type: ${recipient.recipient_type}`);\n    }\n  }\n\n  /**\n   * Deliver report via email\n   */\n  async deliverViaEmail(report, recipient, schedule) {\n    if (!recipient.email) {\n      throw new Error('No email address for recipient');\n    }\n\n    this.metrics.deliveriesByChannel.EMAIL++;\n\n    // Build email content\n    const subject = recipient.custom_subject ||\n      schedule?.email_subject ||\n      `Report Ready: ${report.output_filename}`;\n\n    const body = recipient.custom_body ||\n      schedule?.email_body ||\n      this.buildDefaultEmailBody(report);\n\n    const emailOptions = {\n      to: recipient.email,\n      subject,\n      html: body\n    };\n\n    // Attach report file if configured\n    if (recipient.include_attachment !== false) {\n      try {\n        const fileContent = await fs.readFile(report.storage_path);\n        emailOptions.attachments = [{\n          filename: report.output_filename,\n          content: fileContent,\n          contentType: report.mime_type\n        }];\n      } catch (error) {\n        logger.error(`Failed to attach file: ${error.message}`);\n        // Continue without attachment\n      }\n    }\n\n    // Include inline content if configured\n    if (recipient.include_inline && report.mime_type === 'text/html') {\n      try {\n        const htmlContent = await fs.readFile(report.storage_path, 'utf-8');\n        emailOptions.html = body + '\\n<hr>\\n' + htmlContent;\n      } catch (error) {\n        logger.error(`Failed to include inline content: ${error.message}`);\n      }\n    }\n\n    const result = await MailService.send(emailOptions);\n\n    return {\n      channel: 'EMAIL',\n      messageId: result.messageId,\n      recipient: recipient.email\n    };\n  }\n\n  /**\n   * Build default email body\n   */\n  buildDefaultEmailBody(report) {\n    return `\n      <html>\n        <body style=\"font-family: Arial, sans-serif; line-height: 1.6;\">\n          <h2>Your Report is Ready</h2>\n          <p>Your requested report has been generated and is attached to this email.</p>\n          <table style=\"border-collapse: collapse; margin: 20px 0;\">\n            <tr>\n              <td style=\"padding: 8px; border: 1px solid #ddd; font-weight: bold;\">Report:</td>\n              <td style=\"padding: 8px; border: 1px solid #ddd;\">${report.output_filename}</td>\n            </tr>\n            <tr>\n              <td style=\"padding: 8px; border: 1px solid #ddd; font-weight: bold;\">Format:</td>\n              <td style=\"padding: 8px; border: 1px solid #ddd;\">${report.output_format}</td>\n            </tr>\n            <tr>\n              <td style=\"padding: 8px; border: 1px solid #ddd; font-weight: bold;\">Generated:</td>\n              <td style=\"padding: 8px; border: 1px solid #ddd;\">${new Date(report.completed_at).toLocaleString()}</td>\n            </tr>\n            <tr>\n              <td style=\"padding: 8px; border: 1px solid #ddd; font-weight: bold;\">Size:</td>\n              <td style=\"padding: 8px; border: 1px solid #ddd;\">${this.formatFileSize(report.file_size_bytes)}</td>\n            </tr>\n          </table>\n          <p style=\"color: #666; font-size: 0.9em;\">\n            This is an automated message from the Chartwarden EHR System.\n            Please do not reply to this email.\n          </p>\n          <hr>\n          <p style=\"color: #999; font-size: 0.8em;\">\n            CONFIDENTIALITY NOTICE: This email and any attachments may contain Protected Health Information (PHI)\n            that is privileged and confidential. If you are not the intended recipient, please notify the sender\n            immediately and delete this message.\n          </p>\n        </body>\n      </html>\n    `;\n  }\n\n  /**\n   * Deliver report via webhook\n   */\n  async deliverViaWebhook(report, recipient) {\n    if (!recipient.webhook_url) {\n      throw new Error('No webhook URL for recipient');\n    }\n\n    this.metrics.deliveriesByChannel.WEBHOOK++;\n\n    const payload = {\n      event: 'report.generated',\n      timestamp: new Date().toISOString(),\n      report: {\n        id: report.id,\n        filename: report.output_filename,\n        format: report.output_format,\n        size: report.file_size_bytes,\n        generatedAt: report.completed_at,\n        configurationId: report.configuration_id,\n        checksum: report.file_checksum\n      }\n    };\n\n    const response = await fetch(recipient.webhook_url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-Chartwarden-Event': 'report.generated',\n        'X-Chartwarden-Timestamp': payload.timestamp\n      },\n      body: JSON.stringify(payload)\n    });\n\n    if (!response.ok) {\n      throw new Error(`Webhook delivery failed: ${response.status} ${response.statusText}`);\n    }\n\n    return {\n      channel: 'WEBHOOK',\n      statusCode: response.status,\n      webhookUrl: recipient.webhook_url\n    };\n  }\n\n  /**\n   * Update delivery status on generated report\n   */\n  async updateDeliveryStatus(generatedReportId, status, attempts) {\n    const updates = {\n      delivery_status: status,\n      delivery_attempts: attempts\n    };\n\n    if (status === 'DELIVERED' || status === 'PARTIAL') {\n      updates.delivered_at = new Date();\n      updates.delivered_to = attempts\n        .filter(a => a.status === 'SUCCESS')\n        .map(a => ({\n          type: a.recipient?.recipient_type,\n          email: a.recipient?.email,\n          deliveredAt: a.deliveredAt\n        }));\n    }\n\n    await db\n      .update(generated_reports)\n      .set(updates)\n      .where(eq(generated_reports.id, generatedReportId));\n  }\n\n  /**\n   * Retry failed deliveries for a report\n   */\n  async retryFailedDeliveries(generatedReportId) {\n    const [report] = await db\n      .select()\n      .from(generated_reports)\n      .where(eq(generated_reports.id, generatedReportId));\n\n    if (!report) {\n      throw new Error('Generated report not found');\n    }\n\n    if (report.delivery_status !== 'FAILED' && report.delivery_status !== 'PARTIAL') {\n      throw new Error('Can only retry failed or partial deliveries');\n    }\n\n    // Get failed attempts\n    const failedAttempts = (report.delivery_attempts || [])\n      .filter(a => a.status === 'FAILED');\n\n    if (failedAttempts.length === 0) {\n      return { status: 'NO_FAILURES', message: 'No failed deliveries to retry' };\n    }\n\n    // Re-attempt delivery\n    return await this.deliverReport(generatedReportId, report.schedule_id);\n  }\n\n  /**\n   * Log report access for HIPAA compliance\n   */\n  async logAccess(generatedReportId, userId, accessType, requestInfo = {}) {\n    await db.insert(report_access_logs).values({\n      generated_report_id: generatedReportId,\n      user_id: userId,\n      access_type: accessType,\n      ip_address: requestInfo.ip,\n      user_agent: requestInfo.userAgent,\n      success: true\n    });\n  }\n\n  /**\n   * Log failed access attempt\n   */\n  async logFailedAccess(generatedReportId, userId, accessType, error, requestInfo = {}) {\n    await db.insert(report_access_logs).values({\n      generated_report_id: generatedReportId,\n      user_id: userId,\n      access_type: accessType,\n      ip_address: requestInfo.ip,\n      user_agent: requestInfo.userAgent,\n      success: false,\n      error_message: error\n    });\n  }\n\n  /**\n   * Format file size for display\n   */\n  formatFileSize(bytes) {\n    if (!bytes) return '0 B';\n    const units = ['B', 'KB', 'MB', 'GB'];\n    let i = 0;\n    let size = bytes;\n    while (size >= 1024 && i < units.length - 1) {\n      size /= 1024;\n      i++;\n    }\n    return `${size.toFixed(1)} ${units[i]}`;\n  }\n\n  /**\n   * Get delivery metrics\n   */\n  getMetrics() {\n    return {\n      ...this.metrics,\n      successRate: this.metrics.totalDeliveries > 0\n        ? ((this.metrics.successfulDeliveries / this.metrics.totalDeliveries) * 100).toFixed(2) + '%'\n        : '0%'\n    };\n  }\n}\n\nexport default new ReportDeliveryService();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}