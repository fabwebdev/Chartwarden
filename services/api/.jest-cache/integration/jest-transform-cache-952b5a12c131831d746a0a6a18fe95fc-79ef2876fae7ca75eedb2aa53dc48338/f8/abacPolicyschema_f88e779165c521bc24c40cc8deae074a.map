{"version":3,"names":["cov_167kcty5y2","actualCoverage","pgTable","serial","varchar","text","boolean","timestamp","jsonb","integer","index","abacPolicies","s","id","primaryKey","name","length","notNull","unique","description","resourceType","action","rules","effect","default","priority","isActive","createdBy","updatedBy","createdAt","defaultNow","updatedAt","table","f","resourceTypeIdx","on","actionIdx","isActiveIdx","priorityIdx","abacAttributes","category","dataType","provider","providerConfig","possibleValues","categoryIdx","abacAccessLogs","userId","sessionId","ipAddress","userAgent","resourceId","decision","userAttributes","resourceAttributes","environmentAttributes","evaluatedPolicies","matchedPolicyId","matchedPolicyName","evaluationTimeMs","errorMessage","userIdIdx","decisionIdx","createdAtIdx","abacPolicyTestCases","policyId","expectedDecision","lastTestResult","lastTestedAt","policyIdIdx"],"sources":["abacPolicy.schema.js"],"sourcesContent":["import {\n  pgTable,\n  serial,\n  varchar,\n  text,\n  boolean,\n  timestamp,\n  jsonb,\n  integer,\n  index,\n} from \"drizzle-orm/pg-core\";\n\n/**\n * ABAC Policy Schema\n * Stores attribute-based access control policies that can be dynamically evaluated\n */\nexport const abacPolicies = pgTable(\n  \"abac_policies\",\n  {\n    id: serial(\"id\").primaryKey(),\n    name: varchar(\"name\", { length: 255 }).notNull().unique(),\n    description: text(\"description\"),\n\n    // Policy targeting\n    resourceType: varchar(\"resource_type\", { length: 100 }).notNull(), // e.g., 'patient_record', 'medication', 'encounter'\n    action: varchar(\"action\", { length: 50 }).notNull(), // e.g., 'read', 'write', 'delete', 'manage'\n\n    // Policy rules stored as JSON\n    // Format: { conditions: [...], effect: 'allow' | 'deny' }\n    rules: jsonb(\"rules\").notNull(),\n\n    // Policy effect when conditions are met\n    effect: varchar(\"effect\", { length: 10 }).notNull().default(\"allow\"), // 'allow' or 'deny'\n\n    // Priority for conflict resolution (higher = evaluated first)\n    priority: integer(\"priority\").notNull().default(0),\n\n    // Policy status\n    isActive: boolean(\"is_active\").notNull().default(true),\n\n    // Metadata\n    createdBy: integer(\"created_by\"),\n    updatedBy: integer(\"updated_by\"),\n    createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n    updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n  },\n  (table) => ({\n    resourceTypeIdx: index(\"abac_policies_resource_type_idx\").on(table.resourceType),\n    actionIdx: index(\"abac_policies_action_idx\").on(table.action),\n    isActiveIdx: index(\"abac_policies_is_active_idx\").on(table.isActive),\n    priorityIdx: index(\"abac_policies_priority_idx\").on(table.priority),\n  })\n);\n\n/**\n * ABAC Attribute Definitions Schema\n * Defines the available attributes that can be used in policies\n */\nexport const abacAttributes = pgTable(\n  \"abac_attributes\",\n  {\n    id: serial(\"id\").primaryKey(),\n    name: varchar(\"name\", { length: 100 }).notNull().unique(),\n    category: varchar(\"category\", { length: 50 }).notNull(), // 'user', 'resource', 'environment'\n    dataType: varchar(\"data_type\", { length: 50 }).notNull(), // 'string', 'number', 'boolean', 'array', 'date'\n    description: text(\"description\"),\n\n    // Provider information for dynamic attribute resolution\n    provider: varchar(\"provider\", { length: 100 }), // e.g., 'database', 'request', 'session'\n    providerConfig: jsonb(\"provider_config\"), // Configuration for the provider\n\n    // Possible values (for enumerated attributes)\n    possibleValues: jsonb(\"possible_values\"),\n\n    isActive: boolean(\"is_active\").notNull().default(true),\n    createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n    updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n  },\n  (table) => ({\n    categoryIdx: index(\"abac_attributes_category_idx\").on(table.category),\n    isActiveIdx: index(\"abac_attributes_is_active_idx\").on(table.isActive),\n  })\n);\n\n/**\n * ABAC Access Decision Log Schema\n * Audit trail for all access decisions made by the ABAC system\n */\nexport const abacAccessLogs = pgTable(\n  \"abac_access_logs\",\n  {\n    id: serial(\"id\").primaryKey(),\n\n    // Request context\n    userId: integer(\"user_id\"),\n    sessionId: varchar(\"session_id\", { length: 255 }),\n    ipAddress: varchar(\"ip_address\", { length: 45 }),\n    userAgent: text(\"user_agent\"),\n\n    // Resource being accessed\n    resourceType: varchar(\"resource_type\", { length: 100 }).notNull(),\n    resourceId: varchar(\"resource_id\", { length: 255 }),\n    action: varchar(\"action\", { length: 50 }).notNull(),\n\n    // Decision outcome\n    decision: varchar(\"decision\", { length: 10 }).notNull(), // 'allow', 'deny'\n\n    // Full context used for evaluation (for debugging/compliance)\n    userAttributes: jsonb(\"user_attributes\"),\n    resourceAttributes: jsonb(\"resource_attributes\"),\n    environmentAttributes: jsonb(\"environment_attributes\"),\n\n    // Policies that were evaluated\n    evaluatedPolicies: jsonb(\"evaluated_policies\"),\n    matchedPolicyId: integer(\"matched_policy_id\"),\n    matchedPolicyName: varchar(\"matched_policy_name\", { length: 255 }),\n\n    // Performance metrics\n    evaluationTimeMs: integer(\"evaluation_time_ms\"),\n\n    // Error information if any\n    errorMessage: text(\"error_message\"),\n\n    createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  },\n  (table) => ({\n    userIdIdx: index(\"abac_access_logs_user_id_idx\").on(table.userId),\n    resourceTypeIdx: index(\"abac_access_logs_resource_type_idx\").on(table.resourceType),\n    decisionIdx: index(\"abac_access_logs_decision_idx\").on(table.decision),\n    createdAtIdx: index(\"abac_access_logs_created_at_idx\").on(table.createdAt),\n  })\n);\n\n/**\n * ABAC Policy Test Cases Schema\n * Stores test cases for policy simulation/validation\n */\nexport const abacPolicyTestCases = pgTable(\n  \"abac_policy_test_cases\",\n  {\n    id: serial(\"id\").primaryKey(),\n    policyId: integer(\"policy_id\").notNull(),\n    name: varchar(\"name\", { length: 255 }).notNull(),\n    description: text(\"description\"),\n\n    // Test input\n    userAttributes: jsonb(\"user_attributes\").notNull(),\n    resourceAttributes: jsonb(\"resource_attributes\").notNull(),\n    environmentAttributes: jsonb(\"environment_attributes\"),\n\n    // Expected outcome\n    expectedDecision: varchar(\"expected_decision\", { length: 10 }).notNull(), // 'allow', 'deny'\n\n    // Last test result\n    lastTestResult: varchar(\"last_test_result\", { length: 10 }), // 'pass', 'fail'\n    lastTestedAt: timestamp(\"last_tested_at\"),\n\n    createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n    updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n  },\n  (table) => ({\n    policyIdIdx: index(\"abac_policy_test_cases_policy_id_idx\").on(table.policyId),\n  })\n);\n\nexport default {\n  abacPolicies,\n  abacAttributes,\n  abacAccessLogs,\n  abacPolicyTestCases,\n};\n"],"mappings":"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","ignoreList":[]}