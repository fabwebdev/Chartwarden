{"version":3,"names":["cov_10blaraer1","actualCoverage","db","integumentary_assessment","integumentary","eq","logger","IntegumentaryAssessmentController","index","request","reply","f","s","integumentaryAssessments","select","id","patient_id","integumentary_ids","createdAt","updatedAt","from","code","error","message","integumentaryList","name","store","body","b","existingAssessments","where","limit","existingAssessment","integumentaryIdsString","Array","isArray","join","result","now","Date","update","set","returning","insert","values","data","show","params","info","length","integumentaryAssessment","parseInt"],"sources":["IntegumentaryAssessment.controller.js"],"sourcesContent":["import { db } from \"../../config/db.drizzle.js\";\nimport { integumentary_assessment } from \"../../db/schemas/integumentaryAssessment.schema.js\";\nimport { integumentary } from \"../../db/schemas/integumentary.schema.js\";\nimport { eq } from \"drizzle-orm\";\n\nimport { logger } from '../../utils/logger.js';\nclass IntegumentaryAssessmentController {\n    // Get all integumentary assessments\n    async index(request, reply) {\n        try {\n            const integumentaryAssessments = await db.select({\n                id: integumentary_assessment.id,\n                patient_id: integumentary_assessment.patient_id,\n                integumentary_ids: integumentary_assessment.integumentary_ids,\n                createdAt: integumentary_assessment.createdAt,\n                updatedAt: integumentary_assessment.updatedAt,\n            }).from(integumentary_assessment);\n            reply.code(200);\n            return integumentaryAssessments;\n        } catch (error) {\n            logger.error(\"Error fetching integumentary assessments:\", error)\n            reply.code(500);\n            return {\n                message: \"Internal server error\",\n                error: error.message,\n            };\n        }\n    }\n\n    // Get all integumentary options\n    async integumentaryList(request, reply) {\n        try {\n            const integumentaryList = await db.select({\n                id: integumentary.id,\n                name: integumentary.name,\n                createdAt: integumentary.createdAt,\n                updatedAt: integumentary.updatedAt,\n            }).from(integumentary);\n            reply.code(200);\n            return integumentaryList;\n        } catch (error) {\n            logger.error(\"Error fetching integumentary list:\", error)\n            reply.code(500);\n            return {\n                message: \"Internal server error\",\n                error: error.message,\n            };\n        }\n    }\n\n    // Store or update integumentary assessment\n    async store(request, reply) {\n        try {\n            const { patient_id, integumentary_ids } = request.body;\n\n            // Validate required fields\n            if (!patient_id) {\n                reply.code(400);\n            return {\n                    message: \"Patient ID is required\",\n                };\n            }\n\n            if (!integumentary_ids) {\n                reply.code(400);\n            return {\n                    message: \"Integumentary IDs are required\",\n                };\n            }\n\n            // Check if integumentary assessment already exists for this patient\n            const existingAssessments = await db.select({ id: integumentary_assessment.id }).from(integumentary_assessment)\n                .where(eq(integumentary_assessment.patient_id, patient_id))\n                .limit(1);\n            const existingAssessment = existingAssessments[0];\n\n            // Convert integumentary_ids array to comma-separated string\n            const integumentaryIdsString = Array.isArray(integumentary_ids)\n                ? integumentary_ids.join(\",\")\n                : integumentary_ids;\n\n            let result;\n            const now = new Date();\n            if (existingAssessment) {\n                // Update existing integumentary assessment\n                result = await db.update(integumentary_assessment)\n                    .set({ \n                        integumentary_ids: integumentaryIdsString,\n                        updatedAt: now\n                    })\n                    .where(eq(integumentary_assessment.patient_id, patient_id))\n                    .returning();\n                result = result[0];\n            } else {\n                // Create new integumentary assessment\n                result = await db.insert(integumentary_assessment)\n                    .values({\n                        patient_id: patient_id,\n                        integumentary_ids: integumentaryIdsString,\n                        createdAt: now,\n                        updatedAt: now,\n                    })\n                    .returning();\n                result = result[0];\n            }\n\n            reply.code(201);\n            return {\n                message: \"Integumentary assessment created or updated successfully\",\n                data: result,\n            };\n        } catch (error) {\n            logger.error(\"Error storing integumentary assessment:\", error)\n            reply.code(500);\n            return {\n                message: \"Internal server error\",\n                error: error.message,\n            };\n        }\n    }\n\n    // Show integumentary assessment for a specific patient\n    // Returns empty data if no assessment exists (to allow frontend to render form)\n    async show(request, reply) {\n        try {\n            const { id } = request.params;\n            logger.info(\"üîç IntegumentaryAssessmentController.show called with patient_id:\", id)\n\n            const integumentaryAssessments = await db.select({\n                id: integumentary_assessment.id,\n                patient_id: integumentary_assessment.patient_id,\n                integumentary_ids: integumentary_assessment.integumentary_ids,\n                createdAt: integumentary_assessment.createdAt,\n                updatedAt: integumentary_assessment.updatedAt,\n            }).from(integumentary_assessment)\n                .where(eq(integumentary_assessment.patient_id, id))\n                .limit(1);\n\n            logger.info(\"üìä Found assessments:\", integumentaryAssessments.length)\n            const integumentaryAssessment = integumentaryAssessments[0];\n\n            if (!integumentaryAssessment) {\n                logger.info(\"‚ÑπÔ∏è No integumentary assessment found for patient_id:\", id, \"- returning empty data\")\n                // Return 200 with empty data instead of 404, so frontend can render form\n                reply.code(200);\n                return {\n                    id: null,\n                    patient_id: parseInt(id),\n                    integumentary_ids: \"\",\n                    createdAt: null,\n                    updatedAt: null,\n                };\n            }\n\n            logger.info(\"‚úÖ Found integumentary assessment:\", integumentaryAssessment.id)\n            reply.code(200);\n            return integumentaryAssessment;\n        } catch (error) {\n            logger.error(\"‚ùå Error fetching integumentary assessment:\", error)\n            reply.code(500);\n            return {\n                message: \"Internal server error\",\n                error: error.message,\n            };\n        }\n    }\n}\n\nexport default new IntegumentaryAssessmentController();"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAfZ,SAASE,EAAE,QAAQ,4BAA4B;AAC/C,SAASC,wBAAwB,QAAQ,oDAAoD;AAC7F,SAASC,aAAa,QAAQ,0CAA0C;AACxE,SAASC,EAAE,QAAQ,aAAa;AAEhC,SAASC,MAAM,QAAQ,uBAAuB;AAC9C,MAAMC,iCAAiC,CAAC;EACpC;EACA,MAAMC,KAAKA,CAACC,OAAO,EAAEC,KAAK,EAAE;IAAA;IAAAV,cAAA,GAAAW,CAAA;IAAAX,cAAA,GAAAY,CAAA;IACxB,IAAI;MACA,MAAMC,wBAAwB;MAAA;MAAA,CAAAb,cAAA,GAAAY,CAAA,OAAG,MAAMV,EAAE,CAACY,MAAM,CAAC;QAC7CC,EAAE,EAAEZ,wBAAwB,CAACY,EAAE;QAC/BC,UAAU,EAAEb,wBAAwB,CAACa,UAAU;QAC/CC,iBAAiB,EAAEd,wBAAwB,CAACc,iBAAiB;QAC7DC,SAAS,EAAEf,wBAAwB,CAACe,SAAS;QAC7CC,SAAS,EAAEhB,wBAAwB,CAACgB;MACxC,CAAC,CAAC,CAACC,IAAI,CAACjB,wBAAwB,CAAC;MAAC;MAAAH,cAAA,GAAAY,CAAA;MAClCF,KAAK,CAACW,IAAI,CAAC,GAAG,CAAC;MAAC;MAAArB,cAAA,GAAAY,CAAA;MAChB,OAAOC,wBAAwB;IACnC,CAAC,CAAC,OAAOS,KAAK,EAAE;MAAA;MAAAtB,cAAA,GAAAY,CAAA;MACZN,MAAM,CAACgB,KAAK,CAAC,2CAA2C,EAAEA,KAAK,CAAC;MAAA;MAAAtB,cAAA,GAAAY,CAAA;MAChEF,KAAK,CAACW,IAAI,CAAC,GAAG,CAAC;MAAC;MAAArB,cAAA,GAAAY,CAAA;MAChB,OAAO;QACHW,OAAO,EAAE,uBAAuB;QAChCD,KAAK,EAAEA,KAAK,CAACC;MACjB,CAAC;IACL;EACJ;;EAEA;EACA,MAAMC,iBAAiBA,CAACf,OAAO,EAAEC,KAAK,EAAE;IAAA;IAAAV,cAAA,GAAAW,CAAA;IAAAX,cAAA,GAAAY,CAAA;IACpC,IAAI;MACA,MAAMY,iBAAiB;MAAA;MAAA,CAAAxB,cAAA,GAAAY,CAAA,OAAG,MAAMV,EAAE,CAACY,MAAM,CAAC;QACtCC,EAAE,EAAEX,aAAa,CAACW,EAAE;QACpBU,IAAI,EAAErB,aAAa,CAACqB,IAAI;QACxBP,SAAS,EAAEd,aAAa,CAACc,SAAS;QAClCC,SAAS,EAAEf,aAAa,CAACe;MAC7B,CAAC,CAAC,CAACC,IAAI,CAAChB,aAAa,CAAC;MAAC;MAAAJ,cAAA,GAAAY,CAAA;MACvBF,KAAK,CAACW,IAAI,CAAC,GAAG,CAAC;MAAC;MAAArB,cAAA,GAAAY,CAAA;MAChB,OAAOY,iBAAiB;IAC5B,CAAC,CAAC,OAAOF,KAAK,EAAE;MAAA;MAAAtB,cAAA,GAAAY,CAAA;MACZN,MAAM,CAACgB,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;MAAA;MAAAtB,cAAA,GAAAY,CAAA;MACzDF,KAAK,CAACW,IAAI,CAAC,GAAG,CAAC;MAAC;MAAArB,cAAA,GAAAY,CAAA;MAChB,OAAO;QACHW,OAAO,EAAE,uBAAuB;QAChCD,KAAK,EAAEA,KAAK,CAACC;MACjB,CAAC;IACL;EACJ;;EAEA;EACA,MAAMG,KAAKA,CAACjB,OAAO,EAAEC,KAAK,EAAE;IAAA;IAAAV,cAAA,GAAAW,CAAA;IAAAX,cAAA,GAAAY,CAAA;IACxB,IAAI;MACA,MAAM;QAAEI,UAAU;QAAEC;MAAkB,CAAC;MAAA;MAAA,CAAAjB,cAAA,GAAAY,CAAA,QAAGH,OAAO,CAACkB,IAAI;;MAEtD;MAAA;MAAA3B,cAAA,GAAAY,CAAA;MACA,IAAI,CAACI,UAAU,EAAE;QAAA;QAAAhB,cAAA,GAAA4B,CAAA;QAAA5B,cAAA,GAAAY,CAAA;QACbF,KAAK,CAACW,IAAI,CAAC,GAAG,CAAC;QAAC;QAAArB,cAAA,GAAAY,CAAA;QACpB,OAAO;UACCW,OAAO,EAAE;QACb,CAAC;MACL,CAAC;MAAA;MAAA;QAAAvB,cAAA,GAAA4B,CAAA;MAAA;MAAA5B,cAAA,GAAAY,CAAA;MAED,IAAI,CAACK,iBAAiB,EAAE;QAAA;QAAAjB,cAAA,GAAA4B,CAAA;QAAA5B,cAAA,GAAAY,CAAA;QACpBF,KAAK,CAACW,IAAI,CAAC,GAAG,CAAC;QAAC;QAAArB,cAAA,GAAAY,CAAA;QACpB,OAAO;UACCW,OAAO,EAAE;QACb,CAAC;MACL,CAAC;MAAA;MAAA;QAAAvB,cAAA,GAAA4B,CAAA;MAAA;;MAED;MACA,MAAMC,mBAAmB;MAAA;MAAA,CAAA7B,cAAA,GAAAY,CAAA,QAAG,MAAMV,EAAE,CAACY,MAAM,CAAC;QAAEC,EAAE,EAAEZ,wBAAwB,CAACY;MAAG,CAAC,CAAC,CAACK,IAAI,CAACjB,wBAAwB,CAAC,CAC1G2B,KAAK,CAACzB,EAAE,CAACF,wBAAwB,CAACa,UAAU,EAAEA,UAAU,CAAC,CAAC,CAC1De,KAAK,CAAC,CAAC,CAAC;MACb,MAAMC,kBAAkB;MAAA;MAAA,CAAAhC,cAAA,GAAAY,CAAA,QAAGiB,mBAAmB,CAAC,CAAC,CAAC;;MAEjD;MACA,MAAMI,sBAAsB;MAAA;MAAA,CAAAjC,cAAA,GAAAY,CAAA,QAAGsB,KAAK,CAACC,OAAO,CAAClB,iBAAiB,CAAC;MAAA;MAAA,CAAAjB,cAAA,GAAA4B,CAAA,UACzDX,iBAAiB,CAACmB,IAAI,CAAC,GAAG,CAAC;MAAA;MAAA,CAAApC,cAAA,GAAA4B,CAAA,UAC3BX,iBAAiB;MAEvB,IAAIoB,MAAM;MACV,MAAMC,GAAG;MAAA;MAAA,CAAAtC,cAAA,GAAAY,CAAA,QAAG,IAAI2B,IAAI,CAAC,CAAC;MAAC;MAAAvC,cAAA,GAAAY,CAAA;MACvB,IAAIoB,kBAAkB,EAAE;QAAA;QAAAhC,cAAA,GAAA4B,CAAA;QAAA5B,cAAA,GAAAY,CAAA;QACpB;QACAyB,MAAM,GAAG,MAAMnC,EAAE,CAACsC,MAAM,CAACrC,wBAAwB,CAAC,CAC7CsC,GAAG,CAAC;UACDxB,iBAAiB,EAAEgB,sBAAsB;UACzCd,SAAS,EAAEmB;QACf,CAAC,CAAC,CACDR,KAAK,CAACzB,EAAE,CAACF,wBAAwB,CAACa,UAAU,EAAEA,UAAU,CAAC,CAAC,CAC1D0B,SAAS,CAAC,CAAC;QAAC;QAAA1C,cAAA,GAAAY,CAAA;QACjByB,MAAM,GAAGA,MAAM,CAAC,CAAC,CAAC;MACtB,CAAC,MAAM;QAAA;QAAArC,cAAA,GAAA4B,CAAA;QAAA5B,cAAA,GAAAY,CAAA;QACH;QACAyB,MAAM,GAAG,MAAMnC,EAAE,CAACyC,MAAM,CAACxC,wBAAwB,CAAC,CAC7CyC,MAAM,CAAC;UACJ5B,UAAU,EAAEA,UAAU;UACtBC,iBAAiB,EAAEgB,sBAAsB;UACzCf,SAAS,EAAEoB,GAAG;UACdnB,SAAS,EAAEmB;QACf,CAAC,CAAC,CACDI,SAAS,CAAC,CAAC;QAAC;QAAA1C,cAAA,GAAAY,CAAA;QACjByB,MAAM,GAAGA,MAAM,CAAC,CAAC,CAAC;MACtB;MAAC;MAAArC,cAAA,GAAAY,CAAA;MAEDF,KAAK,CAACW,IAAI,CAAC,GAAG,CAAC;MAAC;MAAArB,cAAA,GAAAY,CAAA;MAChB,OAAO;QACHW,OAAO,EAAE,0DAA0D;QACnEsB,IAAI,EAAER;MACV,CAAC;IACL,CAAC,CAAC,OAAOf,KAAK,EAAE;MAAA;MAAAtB,cAAA,GAAAY,CAAA;MACZN,MAAM,CAACgB,KAAK,CAAC,yCAAyC,EAAEA,KAAK,CAAC;MAAA;MAAAtB,cAAA,GAAAY,CAAA;MAC9DF,KAAK,CAACW,IAAI,CAAC,GAAG,CAAC;MAAC;MAAArB,cAAA,GAAAY,CAAA;MAChB,OAAO;QACHW,OAAO,EAAE,uBAAuB;QAChCD,KAAK,EAAEA,KAAK,CAACC;MACjB,CAAC;IACL;EACJ;;EAEA;EACA;EACA,MAAMuB,IAAIA,CAACrC,OAAO,EAAEC,KAAK,EAAE;IAAA;IAAAV,cAAA,GAAAW,CAAA;IAAAX,cAAA,GAAAY,CAAA;IACvB,IAAI;MACA,MAAM;QAAEG;MAAG,CAAC;MAAA;MAAA,CAAAf,cAAA,GAAAY,CAAA,QAAGH,OAAO,CAACsC,MAAM;MAAC;MAAA/C,cAAA,GAAAY,CAAA;MAC9BN,MAAM,CAAC0C,IAAI,CAAC,mEAAmE,EAAEjC,EAAE,CAAC;MAEpF,MAAMF,wBAAwB;MAAA;MAAA,CAAAb,cAAA,GAAAY,CAAA,QAAG,MAAMV,EAAE,CAACY,MAAM,CAAC;QAC7CC,EAAE,EAAEZ,wBAAwB,CAACY,EAAE;QAC/BC,UAAU,EAAEb,wBAAwB,CAACa,UAAU;QAC/CC,iBAAiB,EAAEd,wBAAwB,CAACc,iBAAiB;QAC7DC,SAAS,EAAEf,wBAAwB,CAACe,SAAS;QAC7CC,SAAS,EAAEhB,wBAAwB,CAACgB;MACxC,CAAC,CAAC,CAACC,IAAI,CAACjB,wBAAwB,CAAC,CAC5B2B,KAAK,CAACzB,EAAE,CAACF,wBAAwB,CAACa,UAAU,EAAED,EAAE,CAAC,CAAC,CAClDgB,KAAK,CAAC,CAAC,CAAC;MAAC;MAAA/B,cAAA,GAAAY,CAAA;MAEdN,MAAM,CAAC0C,IAAI,CAAC,uBAAuB,EAAEnC,wBAAwB,CAACoC,MAAM,CAAC;MACrE,MAAMC,uBAAuB;MAAA;MAAA,CAAAlD,cAAA,GAAAY,CAAA,QAAGC,wBAAwB,CAAC,CAAC,CAAC;MAAC;MAAAb,cAAA,GAAAY,CAAA;MAE5D,IAAI,CAACsC,uBAAuB,EAAE;QAAA;QAAAlD,cAAA,GAAA4B,CAAA;QAAA5B,cAAA,GAAAY,CAAA;QAC1BN,MAAM,CAAC0C,IAAI,CAAC,sDAAsD,EAAEjC,EAAE,EAAE,wBAAwB,CAAC;QACjG;QAAA;QAAAf,cAAA,GAAAY,CAAA;QACAF,KAAK,CAACW,IAAI,CAAC,GAAG,CAAC;QAAC;QAAArB,cAAA,GAAAY,CAAA;QAChB,OAAO;UACHG,EAAE,EAAE,IAAI;UACRC,UAAU,EAAEmC,QAAQ,CAACpC,EAAE,CAAC;UACxBE,iBAAiB,EAAE,EAAE;UACrBC,SAAS,EAAE,IAAI;UACfC,SAAS,EAAE;QACf,CAAC;MACL,CAAC;MAAA;MAAA;QAAAnB,cAAA,GAAA4B,CAAA;MAAA;MAAA5B,cAAA,GAAAY,CAAA;MAEDN,MAAM,CAAC0C,IAAI,CAAC,mCAAmC,EAAEE,uBAAuB,CAACnC,EAAE,CAAC;MAAA;MAAAf,cAAA,GAAAY,CAAA;MAC5EF,KAAK,CAACW,IAAI,CAAC,GAAG,CAAC;MAAC;MAAArB,cAAA,GAAAY,CAAA;MAChB,OAAOsC,uBAAuB;IAClC,CAAC,CAAC,OAAO5B,KAAK,EAAE;MAAA;MAAAtB,cAAA,GAAAY,CAAA;MACZN,MAAM,CAACgB,KAAK,CAAC,4CAA4C,EAAEA,KAAK,CAAC;MAAA;MAAAtB,cAAA,GAAAY,CAAA;MACjEF,KAAK,CAACW,IAAI,CAAC,GAAG,CAAC;MAAC;MAAArB,cAAA,GAAAY,CAAA;MAChB,OAAO;QACHW,OAAO,EAAE,uBAAuB;QAChCD,KAAK,EAAEA,KAAK,CAACC;MACjB,CAAC;IACL;EACJ;AACJ;AAEA,eAAe,IAAIhB,iCAAiC,CAAC,CAAC","ignoreList":[]}