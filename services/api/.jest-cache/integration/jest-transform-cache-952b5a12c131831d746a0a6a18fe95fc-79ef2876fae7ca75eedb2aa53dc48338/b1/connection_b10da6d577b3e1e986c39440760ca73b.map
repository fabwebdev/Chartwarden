{"version":3,"names":["cov_p23gz224d","actualCoverage","db","pool","info","error","warn","s","connectDB","f","process","env","DATABASE_URL","b","Error","client","connect","query","release","environment","NODE_ENV","err","exit","closeDB","end"],"sources":["connection.js"],"sourcesContent":["import { db, pool } from \"../config/db.drizzle.js\";\n\nimport { info, error, warn } from '../utils/logger.js';\n\nconst connectDB = async () => {\n  try {\n    // Check if DATABASE_URL exists\n    if (!process.env.DATABASE_URL) {\n      throw new Error(\"DATABASE_URL is not defined in environment variables\");\n    }\n\n    info(\"Connecting to database...\");\n\n    // Test connection using the pool from db.drizzle.js\n    const client = await pool.connect();\n    await client.query(\"SELECT NOW()\");\n    client.release();\n\n    info(\"Database connected successfully\", { environment: process.env.NODE_ENV || \"development\" });\n\n    return db;\n  } catch (err) {\n    error(\"Database connection failed\", err);\n\n    if (process.env.NODE_ENV === \"production\") {\n      warn(\"Application will continue running without database connection. Please check DATABASE_URL.\");\n      return null;\n    } else {\n      error(\"Exiting in development mode. Please fix database connection.\");\n      process.exit(1);\n    }\n  }\n};\n\n// Graceful shutdown\nconst closeDB = async () => {\n  if (pool) {\n    await pool.end();\n    info(\"Database connection closed\");\n  }\n};\n\n// Export functions and db instance\nexport default connectDB;\nexport { db, closeDB };\n"],"mappings":"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","ignoreList":[]}