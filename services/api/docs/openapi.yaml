openapi: 3.0.3
info:
  title: Chartwarden Hospice EHR API
  description: |
    Comprehensive REST API for the Chartwarden Hospice Electronic Health Record (EHR) System.

    ## Overview
    This API provides HIPAA-compliant endpoints for managing hospice patient care, clinical documentation,
    billing, and administrative functions.

    ## Key Features
    - **HIPAA Compliance**: Full audit logging, encryption, and access controls
    - **Medicare Compliance**: CMS-required documentation, certifications, and billing
    - **21 CFR Part 11**: Electronic signatures with SHA-256 hashing
    - **RBAC/ABAC**: Role-based and attribute-based access control
    - **Real-time Updates**: Socket.IO integration for live notifications

    ## Authentication
    All endpoints (except /health and /api/auth/*) require authentication via session cookies.
    Use the `/api/auth/sign-in` endpoint to authenticate and obtain session cookies.

    ## Rate Limiting
    - Unauthenticated requests: 100 requests/minute
    - Authenticated requests: 500 requests/minute
    - Authentication endpoints have additional stricter limits

    ## CSRF Protection
    State-changing requests (POST, PUT, DELETE, PATCH) require a CSRF token.
    Obtain a token from `GET /api/auth/csrf-token` and include it in the `x-csrf-token` header.

  version: 2.0.0
  contact:
    name: Chartwarden API Support
    email: api-support@chartwarden.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  termsOfService: https://chartwarden.com/terms

servers:
  - url: http://localhost:3001/api
    description: Development server
  - url: https://staging.chartwarden.com/api
    description: Staging server
  - url: https://api.chartwarden.com/api
    description: Production server

security:
  - CookieAuth: []
  - CSRFToken: []

tags:
  # Core Operations
  - name: Health
    description: System health and status endpoints
  - name: Authentication
    description: User authentication and session management
  - name: Users
    description: User account management
  - name: RBAC
    description: Role-based access control management
  - name: ABAC
    description: Attribute-based access control policies
  - name: Audit
    description: Audit logging and compliance tracking

  # Patient Management
  - name: Patients
    description: Patient demographics and core information
  - name: Patient Contacts
    description: Patient emergency contacts and relationships
  - name: Patient Identifiers
    description: Patient identifiers (MRN, SSN, insurance IDs)
  - name: Patient Payers
    description: Patient insurance and payer information
  - name: Patient Pharmacy
    description: Patient preferred pharmacy settings
  - name: Admission
    description: Patient admission and enrollment information
  - name: Discharge
    description: Patient discharge management
  - name: Benefit Period
    description: Medicare benefit period tracking

  # Clinical Documentation
  - name: Encounters
    description: Clinical visit and encounter documentation
  - name: Nursing Notes
    description: Nursing clinical notes and assessments
  - name: Care Plans
    description: Care planning and goal management
  - name: Prognosis
    description: Patient prognosis documentation
  - name: HOPE Assessment
    description: Hospice Outcome and Patient Evaluation assessments
  - name: IDG Meetings
    description: Interdisciplinary group meetings

  # Medications
  - name: Medications
    description: Patient medication management
  - name: MAR
    description: Medication Administration Record
  - name: Comfort Kit
    description: Emergency medication kit management

  # Pain Assessment
  - name: Pain
    description: Pain assessment and management
  - name: Detailed Pain Assessment
    description: Comprehensive pain assessments
  - name: FLACC Scale
    description: Pediatric/non-verbal pain assessment
  - name: PAINAD Scale
    description: Pain assessment in advanced dementia
  - name: Numeric Rating Scale
    description: 0-10 pain rating scale
  - name: Wong-Baker FACES
    description: Visual pain scale

  # Body Systems Assessments
  - name: Cardiac Assessment
    description: Cardiovascular system assessment
  - name: Respiratory Assessment
    description: Respiratory system assessment
  - name: Endocrine Assessment
    description: Endocrine system assessment
  - name: Hematological Assessment
    description: Hematological system assessment
  - name: Integumentary Assessment
    description: Skin and wound assessment
  - name: Nutrition Assessment
    description: Nutritional status assessment

  # Vital Signs
  - name: Vital Signs
    description: Patient vital signs documentation

  # Certifications
  - name: Certifications
    description: Medicare certification periods
  - name: Face-to-Face
    description: F2F encounter tracking

  # Billing & Revenue
  - name: Billing
    description: Claim and billing management
  - name: Claims
    description: Healthcare claim processing
  - name: ERA
    description: Electronic Remittance Advice processing
  - name: Eligibility
    description: Insurance eligibility verification
  - name: Denial Management
    description: Claim denial tracking and appeals
  - name: Revenue Recognition
    description: Revenue forecasting and recognition
  - name: Clearinghouse
    description: EDI clearinghouse integration

  # Administrative
  - name: Staff
    description: Staff management
  - name: Scheduling
    description: Staff and visit scheduling
  - name: Bereavement
    description: Bereavement support tracking
  - name: QAPI
    description: Quality Assurance and Performance Improvement
  - name: Reports
    description: Report generation
  - name: Data Export
    description: Multi-format data export
  - name: Admin Settings
    description: System configuration

  # Signatures
  - name: Electronic Signatures
    description: 21 CFR Part 11 compliant signatures

  # Real-time
  - name: Socket.IO
    description: WebSocket real-time communication

paths:
  # ==========================================================================
  # HEALTH ENDPOINTS
  # ==========================================================================
  /health:
    get:
      tags:
        - Health
      summary: System health check
      description: Returns the overall health status of the API and its dependencies
      operationId: getHealth
      security: []
      responses:
        '200':
          description: System is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheck'
              example:
                status: healthy
                timestamp: "2024-12-31T12:00:00.000Z"
                services:
                  database:
                    status: connected
                  redis:
                    status: connected
                    latencyMs: 2
        '503':
          description: System is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheck'

  /health/redis:
    get:
      tags:
        - Health
      summary: Redis health check
      description: Returns detailed Redis connection status
      operationId: getRedisHealth
      security: []
      responses:
        '200':
          description: Redis is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RedisHealthCheck'
        '503':
          description: Redis is unhealthy

  # ==========================================================================
  # AUTHENTICATION ENDPOINTS
  # ==========================================================================
  /auth/sign-up:
    post:
      tags:
        - Authentication
      summary: Register new user
      description: Create a new user account. Rate limited to 3 attempts per hour.
      operationId: signUp
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          description: Email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '429':
          $ref: '#/components/responses/RateLimited'

  /auth/sign-in:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user and create session. Rate limited to 5 attempts per 15 minutes.
      operationId: signIn
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignInRequest'
      responses:
        '200':
          description: Login successful
          headers:
            Set-Cookie:
              description: Session cookie
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '429':
          $ref: '#/components/responses/RateLimited'

  /auth/sign-out:
    post:
      tags:
        - Authentication
      summary: User logout
      description: End the current session and clear cookies
      operationId: signOut
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: Logged out successfully

  /auth/me:
    get:
      tags:
        - Authentication
      summary: Get current user
      description: Returns the currently authenticated user's profile
      operationId: getCurrentUser
      responses:
        '200':
          description: Current user profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/csrf-token:
    get:
      tags:
        - Authentication
      summary: Get CSRF token
      description: Obtain a CSRF token for state-changing requests
      operationId: getCsrfToken
      security: []
      responses:
        '200':
          description: CSRF token
          content:
            application/json:
              schema:
                type: object
                properties:
                  csrfToken:
                    type: string
                    description: Token to include in x-csrf-token header

  /auth/change-password:
    post:
      tags:
        - Authentication
      summary: Change password
      description: Change the current user's password. Rate limited to 3 attempts per 15 minutes.
      operationId: changePassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: Password changed successfully
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimited'

  /auth/password-policy:
    get:
      tags:
        - Authentication
      summary: Get password policy
      description: Returns the current password policy requirements
      operationId: getPasswordPolicy
      security: []
      responses:
        '200':
          description: Password policy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordPolicy'

  /auth/check-password-strength:
    post:
      tags:
        - Authentication
      summary: Check password strength
      description: Validate a password against the password policy
      operationId: checkPasswordStrength
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
      responses:
        '200':
          description: Password strength result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordStrengthResult'

  # ==========================================================================
  # PATIENT ENDPOINTS
  # ==========================================================================
  /patient:
    get:
      tags:
        - Patients
      summary: List all patients
      description: Retrieve a list of all patients with optional filtering and pagination
      operationId: listPatients
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/SearchParam'
        - name: status
          in: query
          schema:
            type: string
            enum: [ACTIVE, DISCHARGED, DECEASED, PENDING]
      responses:
        '200':
          description: List of patients
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

    post:
      tags:
        - Patients
      summary: Create patient
      description: Create a new patient record
      operationId: createPatient
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatientCreate'
      responses:
        '201':
          description: Patient created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /patient/{patientId}:
    get:
      tags:
        - Patients
      summary: Get patient
      description: Retrieve a single patient by ID
      operationId: getPatient
      parameters:
        - $ref: '#/components/parameters/PatientId'
      responses:
        '200':
          description: Patient details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags:
        - Patients
      summary: Update patient
      description: Update an existing patient record
      operationId: updatePatient
      parameters:
        - $ref: '#/components/parameters/PatientId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatientUpdate'
      responses:
        '200':
          description: Patient updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Patients
      summary: Delete patient
      description: Soft delete a patient (admin only)
      operationId: deletePatient
      parameters:
        - $ref: '#/components/parameters/PatientId'
      responses:
        '200':
          description: Patient deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: Patient deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==========================================================================
  # PATIENT CONTACTS
  # ==========================================================================
  /patients/{patientId}/contacts:
    get:
      tags:
        - Patient Contacts
      summary: List patient contacts
      description: Get all contacts for a patient
      operationId: listPatientContacts
      parameters:
        - $ref: '#/components/parameters/PatientId'
      responses:
        '200':
          description: List of patient contacts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientContactListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Patient Contacts
      summary: Create patient contact
      description: Add a new contact for a patient
      operationId: createPatientContact
      parameters:
        - $ref: '#/components/parameters/PatientId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatientContactCreate'
      responses:
        '201':
          description: Contact created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientContactResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ==========================================================================
  # MEDICATION ENDPOINTS
  # ==========================================================================
  /patients/{patientId}/medications:
    get:
      tags:
        - Medications
      summary: List patient medications
      description: Get all medications for a patient with optional filtering
      operationId: listPatientMedications
      parameters:
        - $ref: '#/components/parameters/PatientId'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/MedicationStatus'
        - name: is_hospice_related
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: List of medications
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MedicationListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Medications
      summary: Create medication
      description: Add a new medication for a patient
      operationId: createMedication
      parameters:
        - $ref: '#/components/parameters/PatientId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MedicationCreate'
      responses:
        '201':
          description: Medication created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MedicationResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /patients/{patientId}/medications/{medicationId}/discontinue:
    post:
      tags:
        - Medications
      summary: Discontinue medication
      description: Discontinue a medication with reason
      operationId: discontinueMedication
      parameters:
        - $ref: '#/components/parameters/PatientId'
        - $ref: '#/components/parameters/MedicationId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - reason
              properties:
                reason:
                  type: string
                  description: Reason for discontinuation
      responses:
        '200':
          description: Medication discontinued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MedicationResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /patients/{patientId}/medications/{medicationId}/hold:
    post:
      tags:
        - Medications
      summary: Hold medication
      description: Temporarily hold a medication
      operationId: holdMedication
      parameters:
        - $ref: '#/components/parameters/PatientId'
        - $ref: '#/components/parameters/MedicationId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - reason
              properties:
                reason:
                  type: string
                hold_until:
                  type: string
                  format: date
      responses:
        '200':
          description: Medication held
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MedicationResponse'

  /patients/{patientId}/medications/{medicationId}/resume:
    post:
      tags:
        - Medications
      summary: Resume medication
      description: Resume a held medication
      operationId: resumeMedication
      parameters:
        - $ref: '#/components/parameters/PatientId'
        - $ref: '#/components/parameters/MedicationId'
      responses:
        '200':
          description: Medication resumed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MedicationResponse'

  # ==========================================================================
  # MAR ENDPOINTS
  # ==========================================================================
  /patients/{patientId}/mar:
    get:
      tags:
        - MAR
      summary: Get patient MAR
      description: Get Medication Administration Record entries for a patient
      operationId: getPatientMAR
      parameters:
        - $ref: '#/components/parameters/PatientId'
        - name: start_date
          in: query
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          schema:
            type: string
            format: date
        - name: medication_id
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: MAR entries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MARListResponse'

    post:
      tags:
        - MAR
      summary: Create MAR entry
      description: Record a medication administration
      operationId: createMAREntry
      parameters:
        - $ref: '#/components/parameters/PatientId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MARCreate'
      responses:
        '201':
          description: MAR entry created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MARResponse'

  # ==========================================================================
  # ENCOUNTER ENDPOINTS
  # ==========================================================================
  /encounters:
    get:
      tags:
        - Encounters
      summary: List encounters
      description: Get all encounters with optional filtering
      operationId: listEncounters
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: patient_id
          in: query
          schema:
            type: integer
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/EncounterStatus'
        - name: encounter_type
          in: query
          schema:
            $ref: '#/components/schemas/EncounterType'
      responses:
        '200':
          description: List of encounters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EncounterListResponse'

    post:
      tags:
        - Encounters
      summary: Create encounter
      description: Create a new clinical encounter
      operationId: createEncounter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EncounterCreate'
      responses:
        '201':
          description: Encounter created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EncounterResponse'

  /encounters/{encounterId}:
    get:
      tags:
        - Encounters
      summary: Get encounter
      description: Get a single encounter by ID
      operationId: getEncounter
      parameters:
        - $ref: '#/components/parameters/EncounterId'
      responses:
        '200':
          description: Encounter details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EncounterResponse'

    patch:
      tags:
        - Encounters
      summary: Update encounter
      description: Update an existing encounter
      operationId: updateEncounter
      parameters:
        - $ref: '#/components/parameters/EncounterId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EncounterUpdate'
      responses:
        '200':
          description: Encounter updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EncounterResponse'

    delete:
      tags:
        - Encounters
      summary: Delete encounter
      description: Soft delete an encounter
      operationId: deleteEncounter
      parameters:
        - $ref: '#/components/parameters/EncounterId'
      responses:
        '200':
          description: Encounter deleted

  /encounters/{encounterId}/sign:
    post:
      tags:
        - Encounters
      summary: Sign encounter
      description: Apply electronic signature to encounter (21 CFR Part 11 compliant)
      operationId: signEncounter
      parameters:
        - $ref: '#/components/parameters/EncounterId'
      responses:
        '200':
          description: Encounter signed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EncounterResponse'

  /encounters/{encounterId}/cosign:
    post:
      tags:
        - Encounters
      summary: Co-sign encounter
      description: Apply co-signature to encounter
      operationId: cosignEncounter
      parameters:
        - $ref: '#/components/parameters/EncounterId'
      responses:
        '200':
          description: Encounter co-signed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EncounterResponse'

  /encounters/{encounterId}/addendum:
    post:
      tags:
        - Encounters
      summary: Add addendum
      description: Add an addendum to a signed encounter
      operationId: addEncounterAddendum
      parameters:
        - $ref: '#/components/parameters/EncounterId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                  description: Addendum text
      responses:
        '200':
          description: Addendum added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EncounterResponse'

  # ==========================================================================
  # CERTIFICATION ENDPOINTS
  # ==========================================================================
  /patients/{patientId}/certifications:
    get:
      tags:
        - Certifications
      summary: List patient certifications
      description: Get all Medicare certifications for a patient
      operationId: listPatientCertifications
      parameters:
        - $ref: '#/components/parameters/PatientId'
      responses:
        '200':
          description: List of certifications
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CertificationListResponse'

    post:
      tags:
        - Certifications
      summary: Create certification
      description: Create a new Medicare certification period
      operationId: createCertification
      parameters:
        - $ref: '#/components/parameters/PatientId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CertificationCreate'
      responses:
        '201':
          description: Certification created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CertificationResponse'

  /certifications/due:
    get:
      tags:
        - Certifications
      summary: Get certifications due
      description: Get certifications due within the next 30 days
      operationId: getCertificationsDue
      responses:
        '200':
          description: Certifications due
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CertificationListResponse'

  /certifications/overdue:
    get:
      tags:
        - Certifications
      summary: Get overdue certifications
      description: Get certifications past their end date
      operationId: getCertificationsOverdue
      responses:
        '200':
          description: Overdue certifications
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CertificationListResponse'

  /certifications/{certificationId}/sign:
    post:
      tags:
        - Certifications
      summary: Sign certification
      description: Apply physician signature to certification
      operationId: signCertification
      parameters:
        - name: certificationId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Certification signed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CertificationResponse'

  # ==========================================================================
  # VITAL SIGNS ENDPOINTS
  # ==========================================================================
  /patients/{patientId}/vital-signs:
    get:
      tags:
        - Vital Signs
      summary: List patient vital signs
      description: Get vital signs history for a patient
      operationId: listPatientVitalSigns
      parameters:
        - $ref: '#/components/parameters/PatientId'
        - name: start_date
          in: query
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: List of vital signs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VitalSignsListResponse'

    post:
      tags:
        - Vital Signs
      summary: Record vital signs
      description: Record new vital signs for a patient
      operationId: createVitalSigns
      parameters:
        - $ref: '#/components/parameters/PatientId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VitalSignsCreate'
      responses:
        '201':
          description: Vital signs recorded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VitalSignsResponse'

  # ==========================================================================
  # PAIN ASSESSMENT ENDPOINTS
  # ==========================================================================
  /patients/{patientId}/pain:
    get:
      tags:
        - Pain
      summary: Get patient pain assessments
      description: Get all pain assessments for a patient
      operationId: getPatientPainAssessments
      parameters:
        - $ref: '#/components/parameters/PatientId'
      responses:
        '200':
          description: Pain assessments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PainAssessmentListResponse'

    post:
      tags:
        - Pain
      summary: Create pain assessment
      description: Record a new pain assessment
      operationId: createPainAssessment
      parameters:
        - $ref: '#/components/parameters/PatientId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PainAssessmentCreate'
      responses:
        '201':
          description: Pain assessment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PainAssessmentResponse'

  /detailed-pain-assessment:
    get:
      tags:
        - Detailed Pain Assessment
      summary: List detailed pain assessments
      description: Get all comprehensive pain assessments
      operationId: listDetailedPainAssessments
      parameters:
        - name: patient_id
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Detailed pain assessments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetailedPainAssessmentListResponse'

    post:
      tags:
        - Detailed Pain Assessment
      summary: Create detailed pain assessment
      description: Create a comprehensive pain assessment
      operationId: createDetailedPainAssessment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DetailedPainAssessmentCreate'
      responses:
        '201':
          description: Assessment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetailedPainAssessmentResponse'

  # ==========================================================================
  # HOPE ASSESSMENT ENDPOINTS
  # ==========================================================================
  /hope-assessment:
    get:
      tags:
        - HOPE Assessment
      summary: List HOPE assessments
      description: Get all Hospice Outcome and Patient Evaluation assessments
      operationId: listHopeAssessments
      parameters:
        - name: patient_id
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: HOPE assessments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HopeAssessmentListResponse'

    post:
      tags:
        - HOPE Assessment
      summary: Create HOPE assessment
      description: Create a new HOPE assessment
      operationId: createHopeAssessment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HopeAssessmentCreate'
      responses:
        '201':
          description: Assessment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HopeAssessmentResponse'

  # ==========================================================================
  # CARE PLAN ENDPOINTS
  # ==========================================================================
  /care-plan:
    get:
      tags:
        - Care Plans
      summary: List care plans
      description: Get all care plans
      operationId: listCarePlans
      parameters:
        - name: patient_id
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Care plans
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CarePlanListResponse'

    post:
      tags:
        - Care Plans
      summary: Create care plan
      description: Create a new care plan
      operationId: createCarePlan
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CarePlanCreate'
      responses:
        '201':
          description: Care plan created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CarePlanResponse'

  # ==========================================================================
  # BILLING ENDPOINTS
  # ==========================================================================
  /billing/claims:
    get:
      tags:
        - Billing
      summary: List claims
      description: Get all billing claims with filtering
      operationId: listClaims
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: status
          in: query
          schema:
            type: string
            enum: [DRAFT, SUBMITTED, ACCEPTED, REJECTED, PAID, DENIED]
        - name: patient_id
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: List of claims
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClaimListResponse'

    post:
      tags:
        - Billing
      summary: Create claim
      description: Create a new billing claim
      operationId: createClaim
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClaimCreate'
      responses:
        '201':
          description: Claim created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClaimResponse'

  /billing/claims/{claimId}/submit:
    post:
      tags:
        - Billing
      summary: Submit claim
      description: Submit a claim to the clearinghouse
      operationId: submitClaim
      parameters:
        - name: claimId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Claim submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClaimResponse'

  # ==========================================================================
  # DENIAL MANAGEMENT ENDPOINTS
  # ==========================================================================
  /denials:
    get:
      tags:
        - Denial Management
      summary: List denials
      description: Get all claim denials
      operationId: listDenials
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: status
          in: query
          schema:
            type: string
            enum: [OPEN, IN_PROGRESS, APPEALED, RESOLVED, WRITTEN_OFF]
      responses:
        '200':
          description: List of denials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DenialListResponse'

    post:
      tags:
        - Denial Management
      summary: Create denial
      description: Record a new claim denial
      operationId: createDenial
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DenialCreate'
      responses:
        '201':
          description: Denial created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DenialResponse'

  /denials/{denialId}/appeal:
    post:
      tags:
        - Denial Management
      summary: File appeal
      description: File an appeal for a denial
      operationId: fileAppeal
      parameters:
        - name: denialId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppealCreate'
      responses:
        '200':
          description: Appeal filed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DenialResponse'

  # ==========================================================================
  # DENIAL CODES ENDPOINTS
  # ==========================================================================
  /denial-codes:
    get:
      tags:
        - Denial Management
      summary: List denial codes
      description: Get CARC/RARC denial code library
      operationId: listDenialCodes
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [CARC, RARC]
        - name: search
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Denial codes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DenialCodeListResponse'

  # ==========================================================================
  # ERA ENDPOINTS
  # ==========================================================================
  /era:
    get:
      tags:
        - ERA
      summary: List ERAs
      description: Get all Electronic Remittance Advices
      operationId: listERAs
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: List of ERAs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ERAListResponse'

  /era/upload:
    post:
      tags:
        - ERA
      summary: Upload ERA file
      description: Upload and process an EDI 835 file
      operationId: uploadERA
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '201':
          description: ERA processed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ERAResponse'

  # ==========================================================================
  # ELIGIBILITY ENDPOINTS
  # ==========================================================================
  /eligibility/verify:
    post:
      tags:
        - Eligibility
      summary: Verify eligibility
      description: Verify patient insurance eligibility
      operationId: verifyEligibility
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EligibilityRequest'
      responses:
        '200':
          description: Eligibility response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EligibilityResponse'

  # ==========================================================================
  # RBAC ENDPOINTS
  # ==========================================================================
  /rbac/roles:
    get:
      tags:
        - RBAC
      summary: List roles
      description: Get all available roles
      operationId: listRoles
      responses:
        '200':
          description: List of roles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleListResponse'

  /rbac/permissions:
    get:
      tags:
        - RBAC
      summary: List permissions
      description: Get all available permissions
      operationId: listPermissions
      responses:
        '200':
          description: List of permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PermissionListResponse'

  /rbac/my-permissions:
    get:
      tags:
        - RBAC
      summary: Get my permissions
      description: Get permissions for the current user
      operationId: getMyPermissions
      responses:
        '200':
          description: Current user's permissions
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  data:
                    type: object
                    properties:
                      role:
                        type: string
                      permissions:
                        type: array
                        items:
                          type: string

  /rbac/users/{userId}/role:
    post:
      tags:
        - RBAC
      summary: Assign role
      description: Assign a role to a user
      operationId: assignUserRole
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role
              properties:
                role:
                  type: string
      responses:
        '200':
          description: Role assigned
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                  message:
                    type: string

    delete:
      tags:
        - RBAC
      summary: Remove role
      description: Remove a role from a user
      operationId: removeUserRole
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Role removed

  # ==========================================================================
  # AUDIT ENDPOINTS
  # ==========================================================================
  /audit/logs:
    get:
      tags:
        - Audit
      summary: List audit logs
      description: Get audit logs with filtering (admin only)
      operationId: listAuditLogs
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: user_id
          in: query
          schema:
            type: string
        - name: action
          in: query
          schema:
            type: string
        - name: resource_type
          in: query
          schema:
            type: string
        - name: start_date
          in: query
          schema:
            type: string
            format: date-time
        - name: end_date
          in: query
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Audit logs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogListResponse'

  # ==========================================================================
  # STAFF ENDPOINTS
  # ==========================================================================
  /staff:
    get:
      tags:
        - Staff
      summary: List staff
      description: Get all staff members
      operationId: listStaff
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: role
          in: query
          schema:
            type: string
        - name: department
          in: query
          schema:
            type: string
      responses:
        '200':
          description: List of staff
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StaffListResponse'

    post:
      tags:
        - Staff
      summary: Create staff
      description: Create a new staff member
      operationId: createStaff
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StaffCreate'
      responses:
        '201':
          description: Staff created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StaffResponse'

  # ==========================================================================
  # SCHEDULING ENDPOINTS
  # ==========================================================================
  /scheduling:
    get:
      tags:
        - Scheduling
      summary: List schedules
      description: Get all schedules
      operationId: listSchedules
      parameters:
        - name: staff_id
          in: query
          schema:
            type: string
        - name: patient_id
          in: query
          schema:
            type: integer
        - name: start_date
          in: query
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Schedules
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScheduleListResponse'

    post:
      tags:
        - Scheduling
      summary: Create schedule
      description: Create a new schedule entry
      operationId: createSchedule
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScheduleCreate'
      responses:
        '201':
          description: Schedule created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScheduleResponse'

  /scheduling/conflicts:
    get:
      tags:
        - Scheduling
      summary: Get scheduling conflicts
      description: Identify scheduling conflicts
      operationId: getSchedulingConflicts
      parameters:
        - name: date
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Scheduling conflicts
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                  data:
                    type: array
                    items:
                      type: object

  # ==========================================================================
  # DATA EXPORT ENDPOINTS
  # ==========================================================================
  /data-export:
    post:
      tags:
        - Data Export
      summary: Export data
      description: Export data in various formats (CSV, JSON, XML, Excel)
      operationId: exportData
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DataExportRequest'
      responses:
        '200':
          description: Export file
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
            application/json:
              schema:
                type: object
            text/csv:
              schema:
                type: string
            application/xml:
              schema:
                type: string

  # ==========================================================================
  # ELECTRONIC SIGNATURE ENDPOINTS
  # ==========================================================================
  /electronic-signatures:
    get:
      tags:
        - Electronic Signatures
      summary: List electronic signatures
      description: Get electronic signatures with filtering
      operationId: listElectronicSignatures
      parameters:
        - name: document_type
          in: query
          schema:
            type: string
        - name: signer_id
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Electronic signatures
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ElectronicSignatureListResponse'

    post:
      tags:
        - Electronic Signatures
      summary: Create electronic signature
      description: Create a 21 CFR Part 11 compliant electronic signature
      operationId: createElectronicSignature
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ElectronicSignatureCreate'
      responses:
        '201':
          description: Signature created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ElectronicSignatureResponse'

  /electronic-signatures/{signatureId}/verify:
    get:
      tags:
        - Electronic Signatures
      summary: Verify signature
      description: Verify the integrity of an electronic signature
      operationId: verifyElectronicSignature
      parameters:
        - name: signatureId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Verification result
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                  data:
                    type: object
                    properties:
                      valid:
                        type: boolean
                      signature_hash:
                        type: string
                      verified_at:
                        type: string
                        format: date-time

  # ==========================================================================
  # ADMIN SETTINGS ENDPOINTS
  # ==========================================================================
  /admin-settings:
    get:
      tags:
        - Admin Settings
      summary: Get system settings
      description: Get all system configuration settings
      operationId: getSystemSettings
      responses:
        '200':
          description: System settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminSettingsResponse'

    put:
      tags:
        - Admin Settings
      summary: Update system settings
      description: Update system configuration settings
      operationId: updateSystemSettings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminSettingsUpdate'
      responses:
        '200':
          description: Settings updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminSettingsResponse'

  # ==========================================================================
  # SOCKET.IO ENDPOINTS
  # ==========================================================================
  /socket.io/health:
    get:
      tags:
        - Socket.IO
      summary: Socket.IO health check
      description: Check Socket.IO server status
      operationId: getSocketIOHealth
      security: []
      responses:
        '200':
          description: Socket.IO status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  connections:
                    type: integer
                  namespaces:
                    type: array
                    items:
                      type: string

# ==========================================================================
# COMPONENTS
# ==========================================================================
components:
  securitySchemes:
    CookieAuth:
      type: apiKey
      in: cookie
      name: better-auth.session_token
      description: Session cookie set after successful authentication
    CSRFToken:
      type: apiKey
      in: header
      name: x-csrf-token
      description: CSRF token for state-changing requests

  parameters:
    PatientId:
      name: patientId
      in: path
      required: true
      description: Patient ID
      schema:
        type: integer

    MedicationId:
      name: medicationId
      in: path
      required: true
      description: Medication ID
      schema:
        type: integer

    EncounterId:
      name: encounterId
      in: path
      required: true
      description: Encounter ID
      schema:
        type: integer

    PageParam:
      name: page
      in: query
      description: Page number for pagination
      schema:
        type: integer
        default: 1
        minimum: 1

    LimitParam:
      name: limit
      in: query
      description: Number of items per page
      schema:
        type: integer
        default: 20
        minimum: 1
        maximum: 100

    SearchParam:
      name: search
      in: query
      description: Search term
      schema:
        type: string

  responses:
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            status: 401
            message: Unauthorized

    Forbidden:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            status: 403
            message: Access denied. Insufficient permissions.

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            status: 404
            message: Resource not found

    ValidationError:
      description: Validation failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'

    RateLimited:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            status: 429
            message: Too many requests. Please try again later.

  schemas:
    # ==========================================================================
    # COMMON SCHEMAS
    # ==========================================================================
    Error:
      type: object
      properties:
        status:
          type: integer
        message:
          type: string
        error:
          type: string
          description: Detailed error (development only)

    ValidationError:
      type: object
      properties:
        status:
          type: integer
          example: 400
        message:
          type: string
          example: Validation failed
        errors:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
              msg:
                type: string
              path:
                type: string
              location:
                type: string

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer

    Signature:
      type: object
      description: 21 CFR Part 11 compliant electronic signature
      properties:
        signedBy:
          type: string
          description: User ID
        signedByName:
          type: string
        signedAt:
          type: string
          format: date-time
        signatureType:
          type: string
          enum: [ELECTRONIC, VERBAL, WRITTEN, ATTESTATION]
        signatureHash:
          type: string
          description: SHA-256 hash (64 characters)
          pattern: '^[a-f0-9]{64}$'
        ipAddress:
          type: string
        userAgent:
          type: string
        meaning:
          type: string
        credentials:
          type: string

    # ==========================================================================
    # HEALTH SCHEMAS
    # ==========================================================================
    HealthCheck:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        services:
          type: object
          properties:
            database:
              type: object
              properties:
                status:
                  type: string
            redis:
              type: object
              properties:
                status:
                  type: string
                latencyMs:
                  type: integer

    RedisHealthCheck:
      type: object
      properties:
        status:
          type: string
        latencyMs:
          type: integer
        version:
          type: string
        usedMemory:
          type: string
        timestamp:
          type: string
          format: date-time

    # ==========================================================================
    # AUTH SCHEMAS
    # ==========================================================================
    SignUpRequest:
      type: object
      required:
        - email
        - password
        - firstName
        - lastName
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 12
        firstName:
          type: string
        lastName:
          type: string

    SignInRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    ChangePasswordRequest:
      type: object
      required:
        - currentPassword
        - newPassword
      properties:
        currentPassword:
          type: string
        newPassword:
          type: string
          minLength: 12

    AuthResponse:
      type: object
      properties:
        status:
          type: integer
        message:
          type: string
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/UserProfile'

    UserProfile:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        role:
          type: string
        permissions:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time

    PasswordPolicy:
      type: object
      properties:
        minLength:
          type: integer
        requireUppercase:
          type: boolean
        requireLowercase:
          type: boolean
        requireNumbers:
          type: boolean
        requireSpecialChars:
          type: boolean
        preventPasswordReuse:
          type: integer

    PasswordStrengthResult:
      type: object
      properties:
        valid:
          type: boolean
        score:
          type: integer
        feedback:
          type: array
          items:
            type: string

    # ==========================================================================
    # PATIENT SCHEMAS
    # ==========================================================================
    Patient:
      type: object
      properties:
        id:
          type: integer
        firstName:
          type: string
        lastName:
          type: string
        middleName:
          type: string
        dateOfBirth:
          type: string
          format: date
        gender:
          type: string
          enum: [MALE, FEMALE, OTHER, UNKNOWN]
        ssn:
          type: string
        mrn:
          type: string
        status:
          type: string
          enum: [ACTIVE, DISCHARGED, DECEASED, PENDING]
        admissionDate:
          type: string
          format: date
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PatientCreate:
      type: object
      required:
        - firstName
        - lastName
        - dateOfBirth
      properties:
        firstName:
          type: string
        lastName:
          type: string
        middleName:
          type: string
        dateOfBirth:
          type: string
          format: date
        gender:
          type: string
          enum: [MALE, FEMALE, OTHER, UNKNOWN]
        ssn:
          type: string
        admissionDate:
          type: string
          format: date

    PatientUpdate:
      type: object
      properties:
        firstName:
          type: string
        lastName:
          type: string
        middleName:
          type: string
        dateOfBirth:
          type: string
          format: date
        gender:
          type: string
        status:
          type: string

    PatientResponse:
      type: object
      properties:
        status:
          type: integer
        message:
          type: string
        data:
          $ref: '#/components/schemas/Patient'

    PatientListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/Patient'
        pagination:
          $ref: '#/components/schemas/Pagination'

    # ==========================================================================
    # PATIENT CONTACT SCHEMAS
    # ==========================================================================
    PatientContact:
      type: object
      properties:
        id:
          type: integer
        patient_id:
          type: integer
        contact_type:
          type: string
          enum: [EMERGENCY, FAMILY, POWER_OF_ATTORNEY, CAREGIVER, OTHER]
        relationship:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        phone:
          type: string
        email:
          type: string
        address:
          type: string
        isPrimary:
          type: boolean
        createdAt:
          type: string
          format: date-time

    PatientContactCreate:
      type: object
      required:
        - contact_type
        - firstName
        - lastName
      properties:
        contact_type:
          type: string
        relationship:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        phone:
          type: string
        email:
          type: string
        address:
          type: string
        isPrimary:
          type: boolean

    PatientContactResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          $ref: '#/components/schemas/PatientContact'

    PatientContactListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/PatientContact'

    # ==========================================================================
    # MEDICATION SCHEMAS
    # ==========================================================================
    MedicationStatus:
      type: string
      enum:
        - ACTIVE
        - DISCONTINUED
        - COMPLETED
        - HELD
        - ON_HOLD

    ControlledSchedule:
      type: string
      enum:
        - SCHEDULE_II
        - SCHEDULE_III
        - SCHEDULE_IV
        - SCHEDULE_V

    Medication:
      type: object
      properties:
        id:
          type: integer
        patient_id:
          type: integer
        medication_name:
          type: string
        generic_name:
          type: string
        medication_status:
          $ref: '#/components/schemas/MedicationStatus'
        medication_route:
          type: string
        dosage:
          type: string
        frequency:
          type: string
        instructions:
          type: string
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        discontinued_date:
          type: string
          format: date
        discontinuation_reason:
          type: string
        controlled_schedule:
          $ref: '#/components/schemas/ControlledSchedule'
        is_hospice_related:
          type: boolean
        prescriber_id:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    MedicationCreate:
      type: object
      required:
        - medication_name
        - start_date
      properties:
        medication_name:
          type: string
        generic_name:
          type: string
        medication_route:
          type: string
        dosage:
          type: string
        frequency:
          type: string
        instructions:
          type: string
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        controlled_schedule:
          $ref: '#/components/schemas/ControlledSchedule'
        is_hospice_related:
          type: boolean
          default: true
        prescriber_id:
          type: string

    MedicationResponse:
      type: object
      properties:
        status:
          type: integer
        message:
          type: string
        data:
          $ref: '#/components/schemas/Medication'

    MedicationListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/Medication'
        count:
          type: integer

    # ==========================================================================
    # MAR SCHEMAS
    # ==========================================================================
    MARStatus:
      type: string
      enum:
        - GIVEN
        - NOT_GIVEN
        - REFUSED
        - HELD
        - LATE
        - MISSED

    MAREntry:
      type: object
      properties:
        id:
          type: integer
        patient_id:
          type: integer
        medication_id:
          type: integer
        scheduled_time:
          type: string
          format: date-time
        actual_time:
          type: string
          format: date-time
        mar_status:
          $ref: '#/components/schemas/MARStatus'
        dosage_given:
          type: string
        route_used:
          type: string
        administered_by_id:
          type: string
        administered_by_name:
          type: string
        reason_not_given:
          type: string
        patient_response:
          type: string
        createdAt:
          type: string
          format: date-time

    MARCreate:
      type: object
      required:
        - medication_id
        - scheduled_time
        - mar_status
      properties:
        medication_id:
          type: integer
        scheduled_time:
          type: string
          format: date-time
        actual_time:
          type: string
          format: date-time
        mar_status:
          $ref: '#/components/schemas/MARStatus'
        dosage_given:
          type: string
        route_used:
          type: string
        administered_by_name:
          type: string
        reason_not_given:
          type: string
        patient_response:
          type: string

    MARResponse:
      type: object
      properties:
        status:
          type: integer
        message:
          type: string
        data:
          $ref: '#/components/schemas/MAREntry'

    MARListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/MAREntry'
        count:
          type: integer

    # ==========================================================================
    # ENCOUNTER SCHEMAS
    # ==========================================================================
    EncounterStatus:
      type: string
      enum:
        - DRAFT
        - IN_PROGRESS
        - COMPLETED
        - SIGNED
        - COSIGNED
        - AMENDED

    EncounterType:
      type: string
      enum:
        - ADMISSION
        - ROUTINE_VISIT
        - PRN_VISIT
        - PHONE_CALL
        - DISCHARGE
        - RECERTIFICATION
        - IDG
        - BEREAVEMENT

    Encounter:
      type: object
      properties:
        id:
          type: integer
        patient_id:
          type: integer
        encounter_type:
          $ref: '#/components/schemas/EncounterType'
        encounter_status:
          $ref: '#/components/schemas/EncounterStatus'
        encounter_date:
          type: string
          format: date-time
        duration_minutes:
          type: integer
        chief_complaint:
          type: string
        clinical_notes:
          type: string
        assessment:
          type: string
        plan:
          type: string
        clinician_id:
          type: string
        clinician_name:
          type: string
        signature:
          $ref: '#/components/schemas/Signature'
        cosignature:
          $ref: '#/components/schemas/Signature'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    EncounterCreate:
      type: object
      required:
        - patient_id
        - encounter_type
        - encounter_date
      properties:
        patient_id:
          type: integer
        encounter_type:
          $ref: '#/components/schemas/EncounterType'
        encounter_date:
          type: string
          format: date-time
        duration_minutes:
          type: integer
        chief_complaint:
          type: string
        clinical_notes:
          type: string
        assessment:
          type: string
        plan:
          type: string

    EncounterUpdate:
      type: object
      properties:
        encounter_type:
          $ref: '#/components/schemas/EncounterType'
        duration_minutes:
          type: integer
        chief_complaint:
          type: string
        clinical_notes:
          type: string
        assessment:
          type: string
        plan:
          type: string

    EncounterResponse:
      type: object
      properties:
        status:
          type: integer
        message:
          type: string
        data:
          $ref: '#/components/schemas/Encounter'

    EncounterListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/Encounter'
        pagination:
          $ref: '#/components/schemas/Pagination'

    # ==========================================================================
    # CERTIFICATION SCHEMAS
    # ==========================================================================
    CertificationPeriod:
      type: string
      enum:
        - INITIAL_90
        - SUBSEQUENT_90
        - SUBSEQUENT_60

    CertificationStatus:
      type: string
      enum:
        - PENDING
        - ACTIVE
        - COMPLETED
        - EXPIRED
        - REVOKED

    Certification:
      type: object
      properties:
        id:
          type: integer
        patient_id:
          type: integer
        certification_period:
          $ref: '#/components/schemas/CertificationPeriod'
        certification_status:
          $ref: '#/components/schemas/CertificationStatus'
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        terminal_illness_narrative:
          type: string
        clinical_progression:
          type: string
        decline_indicators:
          type: string
        physician_signature:
          $ref: '#/components/schemas/Signature'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CertificationCreate:
      type: object
      required:
        - certification_period
        - start_date
        - end_date
        - terminal_illness_narrative
      properties:
        certification_period:
          $ref: '#/components/schemas/CertificationPeriod'
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        terminal_illness_narrative:
          type: string
        clinical_progression:
          type: string
        decline_indicators:
          type: string

    CertificationResponse:
      type: object
      properties:
        status:
          type: integer
        message:
          type: string
        data:
          $ref: '#/components/schemas/Certification'

    CertificationListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/Certification'
        count:
          type: integer

    # ==========================================================================
    # VITAL SIGNS SCHEMAS
    # ==========================================================================
    VitalSigns:
      type: object
      properties:
        id:
          type: integer
        patient_id:
          type: integer
        recorded_at:
          type: string
          format: date-time
        temperature:
          type: number
        temperature_unit:
          type: string
          enum: [F, C]
        pulse:
          type: integer
        respiration:
          type: integer
        blood_pressure_systolic:
          type: integer
        blood_pressure_diastolic:
          type: integer
        oxygen_saturation:
          type: integer
        weight:
          type: number
        weight_unit:
          type: string
          enum: [LBS, KG]
        pain_level:
          type: integer
          minimum: 0
          maximum: 10
        notes:
          type: string
        recorded_by_id:
          type: string
        createdAt:
          type: string
          format: date-time

    VitalSignsCreate:
      type: object
      required:
        - recorded_at
      properties:
        recorded_at:
          type: string
          format: date-time
        temperature:
          type: number
        temperature_unit:
          type: string
        pulse:
          type: integer
        respiration:
          type: integer
        blood_pressure_systolic:
          type: integer
        blood_pressure_diastolic:
          type: integer
        oxygen_saturation:
          type: integer
        weight:
          type: number
        weight_unit:
          type: string
        pain_level:
          type: integer
        notes:
          type: string

    VitalSignsResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          $ref: '#/components/schemas/VitalSigns'

    VitalSignsListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/VitalSigns'

    # ==========================================================================
    # PAIN ASSESSMENT SCHEMAS
    # ==========================================================================
    PainAssessment:
      type: object
      properties:
        id:
          type: integer
        patient_id:
          type: integer
        assessment_date:
          type: string
          format: date-time
        pain_level:
          type: integer
          minimum: 0
          maximum: 10
        pain_location:
          type: string
        pain_character:
          type: string
        pain_duration:
          type: string
        pain_frequency:
          type: string
        relieved_by:
          type: string
        worsened_by:
          type: string
        notes:
          type: string
        createdAt:
          type: string
          format: date-time

    PainAssessmentCreate:
      type: object
      required:
        - pain_level
      properties:
        pain_level:
          type: integer
        pain_location:
          type: string
        pain_character:
          type: string
        pain_duration:
          type: string
        pain_frequency:
          type: string
        relieved_by:
          type: string
        worsened_by:
          type: string
        notes:
          type: string

    PainAssessmentResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          $ref: '#/components/schemas/PainAssessment'

    PainAssessmentListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/PainAssessment'

    DetailedPainAssessmentCreate:
      type: object
      required:
        - patient_id
      properties:
        patient_id:
          type: integer
        pain_level:
          type: integer
        location:
          type: string
        character:
          type: string
        onset:
          type: string
        duration:
          type: string
        frequency:
          type: string
        aggravating_factors:
          type: array
          items:
            type: string
        relieving_factors:
          type: array
          items:
            type: string
        impact_on_function:
          type: string
        current_treatment:
          type: string
        treatment_effectiveness:
          type: string

    DetailedPainAssessmentResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: object

    DetailedPainAssessmentListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            type: object

    # ==========================================================================
    # HOPE ASSESSMENT SCHEMAS
    # ==========================================================================
    HopeAssessmentCreate:
      type: object
      required:
        - patient_id
        - assessment_date
      properties:
        patient_id:
          type: integer
        assessment_date:
          type: string
          format: date
        assessment_type:
          type: string
          enum: [ADMISSION, ROUTINE, DISCHARGE, TRANSFER]
        functional_status:
          type: object
        symptom_assessment:
          type: object
        psychosocial_assessment:
          type: object

    HopeAssessmentResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: object

    HopeAssessmentListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            type: object

    # ==========================================================================
    # CARE PLAN SCHEMAS
    # ==========================================================================
    CarePlanCreate:
      type: object
      required:
        - patient_id
      properties:
        patient_id:
          type: integer
        goals:
          type: array
          items:
            type: object
            properties:
              goal:
                type: string
              target_date:
                type: string
                format: date
              status:
                type: string
        interventions:
          type: array
          items:
            type: object
            properties:
              intervention:
                type: string
              frequency:
                type: string
              responsible_party:
                type: string

    CarePlanResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: object

    CarePlanListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            type: object

    # ==========================================================================
    # BILLING SCHEMAS
    # ==========================================================================
    Claim:
      type: object
      properties:
        id:
          type: integer
        patient_id:
          type: integer
        claim_number:
          type: string
        status:
          type: string
        service_date_from:
          type: string
          format: date
        service_date_to:
          type: string
          format: date
        total_amount:
          type: number
        paid_amount:
          type: number
        payer_id:
          type: integer
        submitted_date:
          type: string
          format: date
        createdAt:
          type: string
          format: date-time

    ClaimCreate:
      type: object
      required:
        - patient_id
        - service_date_from
        - service_date_to
      properties:
        patient_id:
          type: integer
        service_date_from:
          type: string
          format: date
        service_date_to:
          type: string
          format: date
        payer_id:
          type: integer
        diagnosis_codes:
          type: array
          items:
            type: string
        service_lines:
          type: array
          items:
            type: object

    ClaimResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          $ref: '#/components/schemas/Claim'

    ClaimListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/Claim'
        pagination:
          $ref: '#/components/schemas/Pagination'

    # ==========================================================================
    # DENIAL SCHEMAS
    # ==========================================================================
    Denial:
      type: object
      properties:
        id:
          type: integer
        claim_id:
          type: integer
        denial_date:
          type: string
          format: date
        denial_reason:
          type: string
        carc_code:
          type: string
        rarc_code:
          type: string
        status:
          type: string
        appeal_deadline:
          type: string
          format: date
        amount_denied:
          type: number
        createdAt:
          type: string
          format: date-time

    DenialCreate:
      type: object
      required:
        - claim_id
        - denial_reason
      properties:
        claim_id:
          type: integer
        denial_date:
          type: string
          format: date
        denial_reason:
          type: string
        carc_code:
          type: string
        rarc_code:
          type: string
        amount_denied:
          type: number

    AppealCreate:
      type: object
      required:
        - appeal_reason
      properties:
        appeal_reason:
          type: string
        supporting_documentation:
          type: string
        appeal_date:
          type: string
          format: date

    DenialResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          $ref: '#/components/schemas/Denial'

    DenialListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/Denial'
        pagination:
          $ref: '#/components/schemas/Pagination'

    DenialCodeListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            type: object
            properties:
              code:
                type: string
              type:
                type: string
              description:
                type: string

    # ==========================================================================
    # ERA SCHEMAS
    # ==========================================================================
    ERA:
      type: object
      properties:
        id:
          type: integer
        file_name:
          type: string
        received_date:
          type: string
          format: date
        payer_name:
          type: string
        check_number:
          type: string
        total_amount:
          type: number
        status:
          type: string
        createdAt:
          type: string
          format: date-time

    ERAResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          $ref: '#/components/schemas/ERA'

    ERAListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/ERA'
        pagination:
          $ref: '#/components/schemas/Pagination'

    # ==========================================================================
    # ELIGIBILITY SCHEMAS
    # ==========================================================================
    EligibilityRequest:
      type: object
      required:
        - patient_id
        - payer_id
      properties:
        patient_id:
          type: integer
        payer_id:
          type: integer
        service_date:
          type: string
          format: date

    EligibilityResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: object
          properties:
            eligible:
              type: boolean
            coverage_start:
              type: string
              format: date
            coverage_end:
              type: string
              format: date
            benefits:
              type: object

    # ==========================================================================
    # RBAC SCHEMAS
    # ==========================================================================
    Role:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        permissions:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time

    RoleListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/Role'

    PermissionListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              name:
                type: string
              description:
                type: string

    # ==========================================================================
    # AUDIT SCHEMAS
    # ==========================================================================
    AuditLog:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: string
        user_email:
          type: string
        action:
          type: string
        resource_type:
          type: string
        resource_id:
          type: string
        ip_address:
          type: string
        user_agent:
          type: string
        request_method:
          type: string
        request_path:
          type: string
        response_status:
          type: integer
        duration_ms:
          type: integer
        timestamp:
          type: string
          format: date-time

    AuditLogListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/AuditLog'
        pagination:
          $ref: '#/components/schemas/Pagination'

    # ==========================================================================
    # STAFF SCHEMAS
    # ==========================================================================
    Staff:
      type: object
      properties:
        id:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
        phone:
          type: string
        role:
          type: string
        department:
          type: string
        credentials:
          type: string
        npi:
          type: string
        status:
          type: string
        hireDate:
          type: string
          format: date
        createdAt:
          type: string
          format: date-time

    StaffCreate:
      type: object
      required:
        - firstName
        - lastName
        - email
        - role
      properties:
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
        phone:
          type: string
        role:
          type: string
        department:
          type: string
        credentials:
          type: string
        npi:
          type: string
        hireDate:
          type: string
          format: date

    StaffResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          $ref: '#/components/schemas/Staff'

    StaffListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/Staff'
        pagination:
          $ref: '#/components/schemas/Pagination'

    # ==========================================================================
    # SCHEDULING SCHEMAS
    # ==========================================================================
    Schedule:
      type: object
      properties:
        id:
          type: integer
        staff_id:
          type: string
        patient_id:
          type: integer
        schedule_date:
          type: string
          format: date
        start_time:
          type: string
        end_time:
          type: string
        visit_type:
          type: string
        status:
          type: string
        notes:
          type: string
        createdAt:
          type: string
          format: date-time

    ScheduleCreate:
      type: object
      required:
        - staff_id
        - patient_id
        - schedule_date
        - start_time
        - end_time
      properties:
        staff_id:
          type: string
        patient_id:
          type: integer
        schedule_date:
          type: string
          format: date
        start_time:
          type: string
        end_time:
          type: string
        visit_type:
          type: string
        notes:
          type: string

    ScheduleResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          $ref: '#/components/schemas/Schedule'

    ScheduleListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/Schedule'

    # ==========================================================================
    # DATA EXPORT SCHEMAS
    # ==========================================================================
    DataExportRequest:
      type: object
      required:
        - export_type
        - format
      properties:
        export_type:
          type: string
          enum: [PATIENTS, ENCOUNTERS, MEDICATIONS, CLAIMS, AUDIT_LOGS]
        format:
          type: string
          enum: [CSV, JSON, XML, EXCEL]
        filters:
          type: object
          properties:
            start_date:
              type: string
              format: date
            end_date:
              type: string
              format: date
            patient_id:
              type: integer

    # ==========================================================================
    # ELECTRONIC SIGNATURE SCHEMAS
    # ==========================================================================
    ElectronicSignature:
      type: object
      properties:
        id:
          type: integer
        document_type:
          type: string
        document_id:
          type: integer
        signer_id:
          type: string
        signer_name:
          type: string
        signer_credentials:
          type: string
        signature_type:
          type: string
        signature_hash:
          type: string
        meaning:
          type: string
        ip_address:
          type: string
        user_agent:
          type: string
        signed_at:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    ElectronicSignatureCreate:
      type: object
      required:
        - document_type
        - document_id
        - meaning
      properties:
        document_type:
          type: string
        document_id:
          type: integer
        meaning:
          type: string
        signature_type:
          type: string
          enum: [ELECTRONIC, VERBAL, ATTESTATION]

    ElectronicSignatureResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          $ref: '#/components/schemas/ElectronicSignature'

    ElectronicSignatureListResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          type: array
          items:
            $ref: '#/components/schemas/ElectronicSignature'

    # ==========================================================================
    # ADMIN SETTINGS SCHEMAS
    # ==========================================================================
    AdminSettings:
      type: object
      properties:
        id:
          type: integer
        organization_name:
          type: string
        npi:
          type: string
        address:
          type: object
        clearinghouse_settings:
          type: object
        billing_settings:
          type: object
        notification_settings:
          type: object
        security_settings:
          type: object
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    AdminSettingsUpdate:
      type: object
      properties:
        organization_name:
          type: string
        npi:
          type: string
        address:
          type: object
        clearinghouse_settings:
          type: object
        billing_settings:
          type: object
        notification_settings:
          type: object
        security_settings:
          type: object

    AdminSettingsResponse:
      type: object
      properties:
        status:
          type: integer
        data:
          $ref: '#/components/schemas/AdminSettings'
