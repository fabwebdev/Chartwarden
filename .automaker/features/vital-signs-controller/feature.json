{
  "id": "vital-signs-controller",
  "category": "API",
  "title": "Vital Signs CRUD Controller",
  "description": "Implement Comprehensive Vital Signs Management System with CRUD Operations and Clinical Safeguards\n\nCreate a production-ready backend controller to manage patient vital signs data with full CRUD functionality, clinical validation, audit trails, and access controls.\n\nCore Functionality:\n- POST /api/patients/{patientId}/vital-signs - Create new vital signs record\n  - Accept: temperature (°F/°C), systolic/diastolic BP (mmHg), heart rate (bpm), respiratory rate (breaths/min), oxygen saturation (%)\n  - Return created record with generated ID and timestamps\n  \n- GET /api/patients/{patientId}/vital-signs - Retrieve vital signs with filtering\n  - Query parameters: dateFrom, dateTo, limit, offset, sort order\n  - Support pagination with metadata (total count, page info)\n  \n- GET /api/vital-signs/{recordId} - Retrieve specific vital signs record\n  - Include full record details and audit history\n  \n- PUT /api/vital-signs/{recordId} - Full record update\n- PATCH /api/vital-signs/{recordId} - Partial record update\n  - Support updating individual fields without affecting others\n  \n- DELETE /api/vital-signs/{recordId} - Soft delete with audit trail\n  - Implement soft delete (mark as deleted) rather than hard delete for compliance\n\nValidation Requirements:\n- Temperature: 95-106°F (35-41°C) - flag critical values outside 96.8-100.4°F\n- Blood Pressure: Systolic 70-200 mmHg, Diastolic 40-130 mmHg\n- Heart Rate: 40-200 bpm - flag outside 60-100 bpm resting range\n- Respiratory Rate: 8-40 breaths/min - flag outside 12-20 range\n- Oxygen Saturation: 70-100% - flag below 95%\n- Reject requests with invalid or out-of-range values\n- Support both imperial and metric units with automatic conversion\n- Validate timestamp is not in the future\n\nSecurity & Authorization:\n- Verify user authentication on all endpoints\n- Check role-based permissions (nurse, doctor, admin roles)\n- Ensure users can only access patients they're authorized to view\n- Validate patient exists before creating vital signs\n- Prevent unauthorized modification or deletion\n\nData Model:\n- Record ID (UUID or auto-increment)\n- Patient ID (foreign key)\n- Recorded timestamp (when vitals were taken)\n- Created timestamp and created by user ID\n- Last modified timestamp and modified by user ID\n- Deleted flag and deleted timestamp for soft deletes\n- Individual vital sign measurements with units\n- Notes/comments field (optional)\n\nAudit & Logging:\n- Log all create, update, delete operations with user ID and timestamp\n- Store previous values on updates for change history\n- Include IP address and session information in audit log\n- Ensure audit logs are immutable and stored separately\n\nError Handling:\n- 400 Bad Request - Invalid input, validation failures\n- 401 Unauthorized - Missing or invalid authentication\n- 403 Forbidden - Insufficient permissions\n- 404 Not Found - Patient or record doesn't exist\n- 409 Conflict - Concurrent update conflict\n- 422 Unprocessable Entity - Semantic validation errors\n- 500 Internal Server Error - System failures\n- Return detailed error messages with field-level validation feedback\n\nConcurrency & Data Integrity:\n- Implement optimistic locking using version numbers or timestamps\n- Return 409 Conflict if record was modified since client retrieved it\n- Use database transactions for multi-step operations\n- Handle race conditions on simultaneous updates\n\nTesting Requirements:\n- Unit tests for all CRUD operations with mocked dependencies\n- Validation tests for all vital signs ranges and edge cases\n- Authorization tests verifying access control rules\n- Error handling tests for each error scenario\n- Concurrency tests for simultaneous updates\n- Integration tests with actual database\n- Test data fixtures for consistent test scenarios\n- Achieve minimum 80% code coverage\n\nDocumentation:\n- OpenAPI/Swagger specification for all endpoints\n- Request/response schema definitions with examples\n- Authentication and authorization requirements\n- Rate limiting information if applicable\n- Example cURL commands or SDK usage\n- Error response catalog with resolution steps\n\nPerformance Considerations:\n- Index patient_id and recorded_timestamp for query performance\n- Implement database connection pooling\n- Consider caching frequently accessed patient records\n- Set reasonable pagination limits (default 50, max 200 records)\n- Optimize query performance for date range filtering\n\nCompliance & Best Practices:\n- Follow HIPAA guidelines for protected health information\n- Implement request rate limiting to prevent abuse\n- Use prepared statements to prevent SQL injection\n- Sanitize all inputs before processing\n- Consider FHIR Observation resource standard for interoperability\n- Support timezone-aware timestamps (store in UTC)\n\nEdge Cases:\n- Partial updates where only some fields are modified\n- Null or missing values for optional measurements\n- Unit conversion between imperial/metric systems\n- Records with future timestamps (reject)\n- Extremely old records (validate against patient birth date if available)\n- Duplicate submissions within short time windows\n- Very large bulk retrieval requests\n- Updates to already deleted records\n- Patient record deleted while vital signs exist",
  "status": "backlog",
  "priority": 1,
  "complexity": "moderate",
  "dependencies": [
    "vital-signs-schema",
    "casl-authorization"
  ],
  "createdAt": "2025-12-31T05:55:26.241Z",
  "updatedAt": "2025-12-31T05:55:26.241Z",
  "skipTests": false,
  "model": "opus",
  "thinkingLevel": "none",
  "imagePaths": [],
  "textFilePaths": [],
  "branchName": "main",
  "planningMode": "skip",
  "requirePlanApproval": false
}