{
  "id": "nursing-note-controller",
  "category": "API",
  "title": "Nursing Note CRUD Controller",
  "description": "Implement Nursing Note Management REST API Controller\n\nBuild a secure, production-ready RESTful API controller for managing nursing notes in a healthcare application, ensuring HIPAA compliance, data integrity, and comprehensive audit trails.\n\nCore Endpoints:\n- POST /api/nursing-notes - Create new nursing note\n- GET /api/nursing-notes - List nursing notes with filtering and pagination\n- GET /api/nursing-notes/:id - Retrieve single nursing note by ID\n- PUT /api/nursing-notes/:id - Update existing nursing note\n- DELETE /api/nursing-notes/:id - Remove nursing note (implement soft delete for compliance)\n\nData Validation:\n- Required fields: patientId, nurseId, noteContent, timestamp, noteType (assessment/progress/discharge)\n- Validate patientId and nurseId exist in system\n- Enforce maximum note content length (e.g., 10,000 characters)\n- Validate timestamp is not in future\n- Sanitize all text inputs to prevent XSS and SQL injection\n- Implement request DTOs/schemas with strict type checking\n\nSecurity & Authorization:\n- Require authentication token for all endpoints\n- Role-based access: nurses can create/read/update own notes; supervisors/admins have full access\n- Prevent nurses from modifying notes older than configurable threshold (e.g., 24 hours) without supervisor approval\n- Implement field-level permissions (e.g., certain fields may be admin-only)\n- Validate user has access to specific patient records before allowing operations\n\nQuery Capabilities:\n- Filter by: patientId, nurseId, dateRange (startDate, endDate), noteType\n- Sort by: timestamp (desc/asc), lastModified\n- Pagination: pageSize (default 20, max 100), pageNumber\n- Return total count and pagination metadata\n\nAudit & Compliance:\n- Log all CRUD operations with: userId, action, timestamp, affected noteId, IP address\n- Track version history for updates (consider separate audit table)\n- Record soft deletes with deletedAt timestamp and deletedBy userId\n- Ensure audit logs are immutable and stored securely\n\nError Handling:\n- 200 OK - Successful retrieval/update\n- 201 Created - Successful creation with Location header\n- 204 No Content - Successful deletion\n- 400 Bad Request - Validation errors with detailed field-level messages\n- 401 Unauthorized - Missing or invalid authentication\n- 403 Forbidden - Insufficient permissions\n- 404 Not Found - Note or referenced entity doesn't exist\n- 409 Conflict - Concurrent modification detected (use optimistic locking)\n- 422 Unprocessable Entity - Business rule violations\n- 500 Internal Server Error - Unexpected failures with error tracking\n\nEdge Cases & Business Rules:\n- Concurrent updates: implement optimistic locking using version/updatedAt field\n- Prevent deletion of notes referenced in other clinical records\n- Handle time zone differences correctly (store in UTC, return in user's timezone)\n- Implement addendum functionality instead of direct edits for notes older than threshold\n- Validate patient admission status (can't add notes for discharged patients without special permission)\n- Handle batch operations gracefully if multiple notes fail partial validation\n- Implement rate limiting to prevent abuse\n\nTesting Requirements:\n- Unit tests for each controller method (success cases, validation failures, authorization failures)\n- Test authentication/authorization middleware integration\n- Test concurrent modification scenarios\n- Test pagination edge cases (empty results, single page, boundary conditions)\n- Test input sanitization effectiveness\n- Integration tests with database transactions\n- Test audit log creation for all operations\n\nDependencies & Prerequisites:\n- NursingNote database model with fields: id, patientId, nurseId, noteContent, noteType, timestamp, createdAt, updatedAt, deletedAt, version\n- AuditLog database model for tracking changes\n- Authentication middleware providing user identity and roles\n- Authorization service for permission checks\n- Validation framework (e.g., class-validator, Joi, Zod)\n- Database ORM with transaction support\n- Logging service for audit trails\n\nPerformance Considerations:\n- Index database fields used in filtering (patientId, nurseId, timestamp)\n- Implement query result caching for frequently accessed notes\n- Consider read replicas for heavy query loads\n- Set connection pooling limits appropriately\n\nDocumentation:\n- OpenAPI/Swagger specification for all endpoints\n- Include request/response examples\n- Document required permissions for each endpoint\n- Provide error response format examples",
  "status": "completed",
  "priority": 1,
  "complexity": "moderate",
  "dependencies": [
    "nursing-note-schema",
    "casl-authorization"
  ],
  "createdAt": "2025-12-31T05:55:26.242Z",
  "updatedAt": "2026-01-01T06:22:45.322Z",
  "skipTests": false,
  "model": "opus",
  "thinkingLevel": "none",
  "imagePaths": [],
  "textFilePaths": [],
  "branchName": "main",
  "planningMode": "skip",
  "requirePlanApproval": false,
  "startedAt": "2026-01-01T06:21:30.979Z"
}