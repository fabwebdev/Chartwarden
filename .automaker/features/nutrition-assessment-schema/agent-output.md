
ðŸ”§ Tool: TodoWrite
Input: {
  "todos": [
    {
      "content": "Explore existing database schema patterns in the codebase",
      "status": "in_progress",
      "activeForm": "Exploring existing database schema patterns"
    },
    {
      "content": "Design nutrition assessment database schema",
      "status": "pending",
      "activeForm": "Designing nutrition assessment database schema"
    },
    {
      "content": "Implement nutrition assessment schema file",
      "status": "pending",
      "activeForm": "Implementing nutrition assessment schema file"
    },
    {
      "content": "Create database migration for nutrition tables",
      "status": "pending",
      "activeForm": "Creating database migration for nutrition tables"
    },
    {
      "content": "Register schema in index file",
      "status": "pending",
      "activeForm": "Registering schema in index file"
    },
    {
      "content": "Create Playwright verification test",
      "status": "pending",
      "activeForm": "Creating Playwright verification test"
    },
    {
      "content": "Run verification and clean up test file",
      "status": "pending",
      "activeForm": "Running verification and cleaning up test file"
    }
  ]
}

Let me explore the existing database schema patterns in the codebase.

ðŸ”§ Tool: Glob
Input: {
  "pattern": "services/api/src/db/schemas/*.js"
}

ðŸ”§ Tool: Read
Input: {
  "file_path": "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/db/schemas/index.js"
}

I see there are already existing nutrition-related schema files. Let me read them to understand the current state and determine what needs to be enhanced.

ðŸ”§ Tool: Read
Input: {
  "file_path": "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/db/schemas/nutritionAssessment.schema.js"
}

ðŸ”§ Tool: Read
Input: {
  "file_path": "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/db/schemas/nutritionProblemsType.schema.js"
}

ðŸ”§ Tool: Read
Input: {
  "file_path": "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/db/schemas/nutritionTemplate.schema.js"
}

Now let me look at a more comprehensive schema example to understand the patterns used in this codebase.

ðŸ”§ Tool: Read
Input: {
  "file_path": "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/db/schemas/vitalSign.schema.js"
}

ðŸ”§ Tool: Read
Input: {
  "file_path": "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/db/schemas/patient.schema.js"
}

ðŸ”§ Tool: Glob
Input: {
  "pattern": "services/api/database/migrations/drizzle/*.sql"
}

Excellent. Now I have a good understanding of the codebase patterns. Let me check an existing migration file to understand the migration format.

ðŸ”§ Tool: Read
Input: {
  "file_path": "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/database/migrations/drizzle/0040_body_systems_assessments.sql"
}

Now I have a clear understanding of the patterns used in this codebase. Let me update my todo list and start designing the comprehensive nutrition assessment schema.

ðŸ”§ Tool: TodoWrite
Input: {
  "todos": [
    {
      "content": "Explore existing database schema patterns in the codebase",
      "status": "completed",
      "activeForm": "Exploring existing database schema patterns"
    },
    {
      "content": "Design nutrition assessment database schema",
      "status": "in_progress",
      "activeForm": "Designing nutrition assessment database schema"
    },
    {
      "content": "Implement enhanced nutrition assessment schema file",
      "status": "pending",
      "activeForm": "Implementing enhanced nutrition assessment schema file"
    },
    {
      "content": "Create database migration for nutrition tables",
      "status": "pending",
      "activeForm": "Creating database migration for nutrition tables"
    },
    {
      "content": "Register new schemas in index file",
      "status": "pending",
      "activeForm": "Registering new schemas in index file"
    },
    {
      "content": "Create Playwright verification test",
      "status": "pending",
      "activeForm": "Creating Playwright verification test"
    },
    {
      "content": "Run verification and clean up test file",
      "status": "pending",
      "activeForm": "Running verification and cleaning up test file"
    }
  ]
}

Based on my exploration, I see that:
1. The existing `nutritionAssessment.schema.js` is very basic - it only has patient_id, nutrition_problems_type_ids (comma-separated), nutrition_template_ids (comma-separated), and comments
2. There's also a `nutrition_problems_type` and `nutrition_template` table for lookup values
3. The codebase uses comprehensive schemas like `vital_signs` and body system assessment schemas with proper documentation, indexes, and structured data

I need to create a comprehensive nutrition assessment system. Let me create the enhanced schema files:

ðŸ”§ Tool: Write
Input: {
  "file_path": "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/db/schemas/nutritionDietaryRestriction.schema.js",
  "content": "import { pgTable, bigint, varchar, text, timestamp, boolean, index } from 'drizzle-orm/pg-core';\nimport { patients } from './patient.schema.js';\n\n/**\n * Nutrition Dietary Restrictions Schema\n * Comprehensive tracking of patient dietary restrictions including allergies,\n * intolerances, and medical restrictions for hospice care.\n *\n * Supports:\n * - Food allergies (IgE-mediated reactions)\n * - Food intolerances (non-allergic adverse reactions)\n * - Medical diet restrictions (diabetes, renal, cardiac, etc.)\n * - Cultural/religious dietary requirements\n * - Temporary vs. permanent restrictions\n * - Severity levels and reaction history\n */\nexport const nutrition_dietary_restrictions = pgTable('nutrition_dietary_restrictions', {\n  id: bigint('id', { mode: 'number' }).primaryKey().generatedByDefaultAsIdentity(),\n\n  // Patient association\n  patient_id: bigint('patient_id', { mode: 'number' }).notNull().references(() => patients.id),\n\n  // =========================================\n  // RESTRICTION IDENTIFICATION\n  // =========================================\n  restriction_type: varchar('restriction_type', { length: 50 }).notNull(), // ALLERGY, INTOLERANCE, MEDICAL, RELIGIOUS, CULTURAL, PREFERENCE, OTHER\n  restriction_category: varchar('restriction_category', { length: 100 }), // FOOD, ADDITIVE, PRESERVATIVE, DYE, MEDICATION_INTERACTION\n\n  // Food/substance details\n  food_item: varchar('food_item', { length: 255 }).notNull(), // Specific food or substance\n  food_group: varchar('food_group', { length: 100 }), // DAIRY, GLUTEN, NUTS, SHELLFISH, SOY, EGG, FISH, etc.\n  allergen_code: varchar('allergen_code', { length: 50 }), // Standard allergen codes if applicable\n\n  // =========================================\n  // SEVERITY AND REACTION DETAILS\n  // =========================================\n  severity: varchar('severity', { length: 50 }), // MILD, MODERATE, SEVERE, LIFE_THREATENING\n  reaction_type: varchar('reaction_type', { length: 255 }), // ANAPHYLAXIS, HIVES, GI_DISTRESS, RESPIRATORY, etc.\n  reaction_description: text('reaction_description'),\n  onset_time: varchar('onset_time', { length: 100 }), // IMMEDIATE, DELAYED, VARIABLE\n  last_reaction_date: timestamp('last_reaction_date'),\n\n  // =========================================\n  // TEMPORAL STATUS\n  // =========================================\n  is_permanent: boolean('is_permanent').default(true),\n  is_active: boolean('is_active').default(true),\n  effective_date: timestamp('effective_date').defaultNow(),\n  expiration_date: timestamp('expiration_date'), // For temporary restrictions\n  review_date: timestamp('review_date'), // When to reassess\n\n  // =========================================\n  // MEDICAL CONTEXT\n  // =========================================\n  diagnosed_by: varchar('diagnosed_by', { length: 255 }), // Provider who confirmed\n  diagnosis_date: timestamp('diagnosis_date'),\n  verification_method: varchar('verification_method', { length: 100 }), // SKIN_TEST, BLOOD_TEST, ELIMINATION_DIET, PATIENT_REPORT, FAMILY_REPORT\n  medical_condition_related: varchar('medical_condition_related', { length: 255 }), // Related diagnosis (e.g., Celiac, PKU)\n  icd10_code: varchar('icd10_code', { length: 20 }), // Associated ICD-10 code\n\n  // =========================================\n  // MANAGEMENT\n  // =========================================\n  avoidance_instructions: text('avoidance_instructions'),\n  cross_contamination_risk: boolean('cross_contamination_risk').default(false),\n  safe_alternatives: text('safe_alternatives'),\n  emergency_treatment: text('emergency_treatment'), // E.g., EpiPen instructions\n  epipen_available: boolean('epipen_available').default(false),\n  epipen_location: varchar('epipen_location', { length: 255 }),\n\n  // =========================================\n  // NOTIFICATION FLAGS\n  // =========================================\n  notify_on_admission: boolean('notify_on_admission').default(true),\n  notify_dietary: boolean('notify_dietary').default(true),\n  notify_pharmacy: boolean('notify_pharmacy').default(false),\n  display_on_chart: boolean('display_on_chart').default(true),\n\n  // =========================================\n  // DOCUMENTATION\n  // =========================================\n  source_of_information: varchar('source_of_information', { length: 100 }), // PATIENT, FAMILY, MEDICAL_RECORD, PROVIDER\n  verified: boolean('verified').default(false),\n  verified_by_id: bigint('verified_by_id', { mode: 'number' }),\n  verified_date: timestamp('verified_date'),\n  notes: text('notes'),\n\n  // =========================================\n  // AUDIT FIELDS\n  // =========================================\n  created_by_id: bigint('created_by_id', { mode: 'number' }),\n  updated_by_id: bigint('updated_by_id', { mode: 'number' }),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n}, (table) => ({\n  patientIdx: index('idx_nutrition_dietary_restrictions_patient_id').on(table.patient_id),\n  typeIdx: index('idx_nutrition_dietary_restrictions_type').on(table.restriction_type),\n  foodGroupIdx: index('idx_nutrition_dietary_restrictions_food_group').on(table.food_group),\n  activeIdx: index('idx_nutrition_dietary_restrictions_active').on(table.is_active),\n  severityIdx: index('idx_nutrition_dietary_restrictions_severity').on(table.severity),\n  patientActiveIdx: index('idx_nutrition_dietary_restrictions_patient_active').on(table.patient_id, table.is_active),\n}));\n\n// Restriction types\nexport const RESTRICTION_TYPES = {\n  ALLERGY: 'ALLERGY',\n  INTOLERANCE: 'INTOLERANCE',\n  MEDICAL: 'MEDICAL',\n  RELIGIOUS: 'RELIGIOUS',\n  CULTURAL: 'CULTURAL',\n  PREFERENCE: 'PREFERENCE',\n  OTHER: 'OTHER'\n};\n\n// Food groups for common allergens\nexport const FOOD_GROUPS = {\n  DAIRY: 'DAIRY',\n  GLUTEN: 'GLUTEN',\n  WHEAT: 'WHEAT',\n  TREE_NUTS: 'TREE_NUTS',\n  PEANUTS: 'PEANUTS',\n  SHELLFISH: 'SHELLFISH',\n  FISH: 'FISH',\n  SOY: 'SOY',\n  EGG: 'EGG',\n  SESAME: 'SESAME',\n  SULFITES: 'SULFITES',\n  CORN: 'CORN',\n  NIGHTSHADES: 'NIGHTSHADES',\n  CITRUS: 'CITRUS',\n  LEGUMES: 'LEGUMES',\n  RED_MEAT: 'RED_MEAT',\n  POULTRY: 'POULTRY',\n  PORK: 'PORK',\n  ALCOHOL: 'ALCOHOL',\n  CAFFEINE: 'CAFFEINE',\n  OTHER: 'OTHER'\n};\n\n// Severity levels\nexport const RESTRICTION_SEVERITY = {\n  MILD: 'MILD',\n  MODERATE: 'MODERATE',\n  SEVERE: 'SEVERE',\n  LIFE_THREATENING: 'LIFE_THREATENING'\n};\n\n// Reaction types\nexport const REACTION_TYPES = {\n  ANAPHYLAXIS: 'ANAPHYLAXIS',\n  HIVES: 'HIVES',\n  ANGIOEDEMA: 'ANGIOEDEMA',\n  GI_DISTRESS: 'GI_DISTRESS',\n  RESPIRATORY: 'RESPIRATORY',\n  SKIN_RASH: 'SKIN_RASH',\n  ORAL_ALLERGY: 'ORAL_ALLERGY',\n  MIGRAINE: 'MIGRAINE',\n  BLOATING: 'BLOATING',\n  DIARRHEA: 'DIARRHEA',\n  NAUSEA: 'NAUSEA',\n  VOMITING: 'VOMITING',\n  OTHER: 'OTHER'\n};\n"
}

ðŸ”§ Tool: Write
Input: {
  "file_path": "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/db/schemas/nutritionFoodPreference.schema.js",
  "content": "import { pgTable, bigint, varchar, text, timestamp, boolean, integer, index } from 'drizzle-orm/pg-core';\nimport { patients } from './patient.schema.js';\n\n/**\n * Nutrition Food Preferences Schema\n * Tracks patient food preferences including likes, dislikes, cultural/religious\n * requirements, and meal-related preferences for hospice nutrition care.\n *\n * Supports:\n * - Food likes and dislikes\n * - Cultural and religious dietary requirements\n * - Texture and temperature preferences\n * - Meal timing and portion preferences\n * - Evolving preferences over time\n */\nexport const nutrition_food_preferences = pgTable('nutrition_food_preferences', {\n  id: bigint('id', { mode: 'number' }).primaryKey().generatedByDefaultAsIdentity(),\n\n  // Patient association\n  patient_id: bigint('patient_id', { mode: 'number' }).notNull().references(() => patients.id),\n\n  // =========================================\n  // PREFERENCE TYPE AND FOOD ITEM\n  // =========================================\n  preference_type: varchar('preference_type', { length: 50 }).notNull(), // LIKE, DISLIKE, RELIGIOUS, CULTURAL, TEXTURE, TEMPERATURE\n  preference_category: varchar('preference_category', { length: 100 }), // FOOD, BEVERAGE, SEASONING, PREPARATION_METHOD\n\n  food_item: varchar('food_item', { length: 255 }),\n  food_group: varchar('food_group', { length: 100 }),\n  description: text('description'),\n\n  // =========================================\n  // PREFERENCE STRENGTH\n  // =========================================\n  preference_strength: varchar('preference_strength', { length: 50 }), // STRONG, MODERATE, MILD\n  priority_level: integer('priority_level').default(1), // 1-5, where 5 is highest priority\n  is_mandatory: boolean('is_mandatory').default(false), // True for religious/medical requirements\n\n  // =========================================\n  // CULTURAL/RELIGIOUS REQUIREMENTS\n  // =========================================\n  cultural_background: varchar('cultural_background', { length: 255 }),\n  religious_requirement: varchar('religious_requirement', { length: 255 }), // KOSHER, HALAL, VEGETARIAN_HINDU, etc.\n  dietary_philosophy: varchar('dietary_philosophy', { length: 100 }), // VEGETARIAN, VEGAN, PESCATARIAN, etc.\n  fasting_requirements: text('fasting_requirements'),\n  special_occasions: text('special_occasions'), // Holidays, observances that affect diet\n\n  // =========================================\n  // TEXTURE PREFERENCES\n  // =========================================\n  texture_preference: varchar('texture_preference', { length: 100 }), // REGULAR, SOFT, MECHANICAL_SOFT, PUREED, LIQUID\n  texture_modifications: text('texture_modifications'),\n  dysphagia_diet_level: varchar('dysphagia_diet_level', { length: 100 }), // IDDSI levels if applicable\n  chewing_ability: varchar('chewing_ability', { length: 100 }), // NORMAL, IMPAIRED, SEVERELY_IMPAIRED\n  swallowing_concerns: text('swallowing_concerns'),\n\n  // =========================================\n  // TEMPERATURE PREFERENCES\n  // =========================================\n  temperature_preference: varchar('temperature_preference', { length: 50 }), // HOT, WARM, ROOM_TEMP, COLD, FROZEN\n  specific_temperature_notes: text('specific_temperature_notes'),\n\n  // =========================================\n  // SEASONING AND FLAVOR\n  // =========================================\n  seasoning_preference: varchar('seasoning_preference', { length: 100 }), // BLAND, LIGHTLY_SEASONED, WELL_SEASONED, SPICY\n  salt_preference: varchar('salt_preference', { length: 50 }), // NONE, LOW, NORMAL, HIGH\n  sugar_preference: varchar('sugar_preference', { length: 50 }), // NONE, LOW, NORMAL, HIGH\n  spice_tolerance: varchar('spice_tolerance', { length: 50 }), // NONE, MILD, MEDIUM, HOT\n  flavor_preferences: text('flavor_preferences'), // Free text for specific flavor notes\n\n  // =========================================\n  // MEAL PREFERENCES\n  // =========================================\n  preferred_meal_times: text('preferred_meal_times'), // JSON or free text\n  snack_preferences: text('snack_preferences'),\n  beverage_preferences: text('beverage_preferences'),\n  portion_size_preference: varchar('portion_size_preference', { length: 50 }), // SMALL, REGULAR, LARGE\n  eating_frequency: varchar('eating_frequency', { length: 100 }), // 3_MEALS, SMALL_FREQUENT, GRAZING\n\n  // =========================================\n  // PREPARATION METHOD\n  // =========================================\n  preferred_cooking_methods: text('preferred_cooking_methods'), // BAKED, FRIED, GRILLED, STEAMED, RAW, etc.\n  avoided_cooking_methods: text('avoided_cooking_methods'),\n  preparation_notes: text('preparation_notes'),\n\n  // =========================================\n  // APPETITE CONTEXT\n  // =========================================\n  appetite_notes: text('appetite_notes'),\n  comfort_foods: text('comfort_foods'),\n  aversions_during_illness: text('aversions_during_illness'),\n  preferences_when_nauseous: text('preferences_when_nauseous'),\n\n  // =========================================\n  // TEMPORAL STATUS\n  // =========================================\n  is_active: boolean('is_active').default(true),\n  effective_date: timestamp('effective_date').defaultNow(),\n  last_reviewed_date: timestamp('last_reviewed_date'),\n  preference_changed_date: timestamp('preference_changed_date'),\n  change_reason: text('change_reason'), // Why preference changed\n\n  // =========================================\n  // SOURCE\n  // =========================================\n  source_of_information: varchar('source_of_information', { length: 100 }), // PATIENT, FAMILY, CAREGIVER, PRIOR_RECORD\n  reported_by: varchar('reported_by', { length: 255 }),\n  notes: text('notes'),\n\n  // =========================================\n  // AUDIT FIELDS\n  // =========================================\n  created_by_id: bigint('created_by_id', { mode: 'number' }),\n  updated_by_id: bigint('updated_by_id', { mode: 'number' }),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n}, (table) => ({\n  patientIdx: index('idx_nutrition_food_preferences_patient_id').on(table.patient_id),\n  typeIdx: index('idx_nutrition_food_preferences_type').on(table.preference_type),\n  activeIdx: index('idx_nutrition_food_preferences_active').on(table.is_active),\n  patientActiveIdx: index('idx_nutrition_food_preferences_patient_active').on(table.patient_id, table.is_active),\n  religiousIdx: index('idx_nutrition_food_preferences_religious').on(table.religious_requirement),\n}));\n\n// Preference types\nexport const PREFERENCE_TYPES = {\n  LIKE: 'LIKE',\n  DISLIKE: 'DISLIKE',\n  RELIGIOUS: 'RELIGIOUS',\n  CULTURAL: 'CULTURAL',\n  TEXTURE: 'TEXTURE',\n  TEMPERATURE: 'TEMPERATURE',\n  SEASONING: 'SEASONING',\n  OTHER: 'OTHER'\n};\n\n// Texture preferences based on IDDSI framework\nexport const TEXTURE_PREFERENCES = {\n  REGULAR: 'REGULAR',\n  EASY_TO_CHEW: 'EASY_TO_CHEW',\n  SOFT_AND_BITE_SIZED: 'SOFT_AND_BITE_SIZED',\n  MINCED_AND_MOIST: 'MINCED_AND_MOIST',\n  PUREED: 'PUREED',\n  LIQUIDIZED: 'LIQUIDIZED'\n};\n\n// IDDSI levels for dysphagia diets\nexport const IDDSI_LEVELS = {\n  LEVEL_7_REGULAR: 'LEVEL_7_REGULAR',\n  LEVEL_6_SOFT_BITE_SIZED: 'LEVEL_6_SOFT_BITE_SIZED',\n  LEVEL_5_MINCED_MOIST: 'LEVEL_5_MINCED_MOIST',\n  LEVEL_4_PUREED: 'LEVEL_4_PUREED',\n  LEVEL_3_LIQUIDIZED: 'LEVEL_3_LIQUIDIZED',\n  LEVEL_2_MILDLY_THICK: 'LEVEL_2_MILDLY_THICK',\n  LEVEL_1_SLIGHTLY_THICK: 'LEVEL_1_SLIGHTLY_THICK',\n  LEVEL_0_THIN: 'LEVEL_0_THIN'\n};\n\n// Religious dietary requirements\nexport const RELIGIOUS_REQUIREMENTS = {\n  KOSHER: 'KOSHER',\n  HALAL: 'HALAL',\n  HINDU_VEGETARIAN: 'HINDU_VEGETARIAN',\n  BUDDHIST: 'BUDDHIST',\n  JAIN: 'JAIN',\n  SEVENTH_DAY_ADVENTIST: 'SEVENTH_DAY_ADVENTIST',\n  RASTAFARIAN: 'RASTAFARIAN',\n  CATHOLIC_FASTING: 'CATHOLIC_FASTING',\n  ORTHODOX_FASTING: 'ORTHODOX_FASTING',\n  OTHER: 'OTHER'\n};\n\n// Dietary philosophies\nexport const DIETARY_PHILOSOPHIES = {\n  OMNIVORE: 'OMNIVORE',\n  VEGETARIAN: 'VEGETARIAN',\n  LACTO_VEGETARIAN: 'LACTO_VEGETARIAN',\n  OVO_VEGETARIAN: 'OVO_VEGETARIAN',\n  LACTO_OVO_VEGETARIAN: 'LACTO_OVO_VEGETARIAN',\n  PESCATARIAN: 'PESCATARIAN',\n  VEGAN: 'VEGAN',\n  RAW_VEGAN: 'RAW_VEGAN',\n  FLEXITARIAN: 'FLEXITARIAN',\n  PALEO: 'PALEO',\n  KETO: 'KETO',\n  MEDITERRANEAN: 'MEDITERRANEAN',\n  OTHER: 'OTHER'\n};\n\n// Portion sizes\nexport const PORTION_SIZES = {\n  VERY_SMALL: 'VERY_SMALL',\n  SMALL: 'SMALL',\n  REGULAR: 'REGULAR',\n  LARGE: 'LARGE',\n  VERY_LARGE: 'VERY_LARGE'\n};\n"
}

ðŸ”§ Tool: Write
Input: {
  "file_path": "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/db/schemas/nutritionIntakeRecord.schema.js",
  "content": "import { pgTable, bigint, varchar, text, timestamp, boolean, decimal, integer, index } from 'drizzle-orm/pg-core';\nimport { patients } from './patient.schema.js';\n\n/**\n * Nutrition Intake Record Schema\n * Comprehensive tracking of patient nutritional intake including meals, portions,\n * macronutrients, micronutrients, and hydration for hospice care.\n *\n * Supports:\n * - Individual meal/snack logging\n * - Bulk intake recording for shift summaries\n * - Macronutrient and calorie tracking\n * - Fluid intake monitoring\n * - Appetite and tolerance assessment\n * - Feeding assistance documentation\n */\nexport const nutrition_intake_records = pgTable('nutrition_intake_records', {\n  id: bigint('id', { mode: 'number' }).primaryKey().generatedByDefaultAsIdentity(),\n\n  // Patient association\n  patient_id: bigint('patient_id', { mode: 'number' }).notNull().references(() => patients.id),\n  encounter_id: bigint('encounter_id', { mode: 'number' }),\n  note_id: bigint('note_id', { mode: 'number' }),\n\n  // =========================================\n  // MEAL/INTAKE IDENTIFICATION\n  // =========================================\n  intake_datetime: timestamp('intake_datetime').defaultNow().notNull(),\n  meal_type: varchar('meal_type', { length: 50 }).notNull(), // BREAKFAST, LUNCH, DINNER, SNACK, SUPPLEMENT, TUBE_FEEDING, IV_NUTRITION\n  intake_category: varchar('intake_category', { length: 50 }), // ORAL, ENTERAL, PARENTERAL\n\n  // =========================================\n  // FOOD/BEVERAGE DETAILS\n  // =========================================\n  food_description: text('food_description'),\n  beverage_description: text('beverage_description'),\n  food_items_json: text('food_items_json'), // JSON array of detailed food items\n\n  // =========================================\n  // PORTION CONSUMPTION\n  // =========================================\n  portion_offered: varchar('portion_offered', { length: 50 }), // FULL, HALF, QUARTER, SMALL\n  portion_consumed_percent: integer('portion_consumed_percent'), // 0-100%\n  portion_consumed_description: varchar('portion_consumed_description', { length: 100 }), // ALL, MOST, HALF, LITTLE, NONE, REFUSED\n  solid_food_consumed_percent: integer('solid_food_consumed_percent'),\n  liquid_consumed_percent: integer('liquid_consumed_percent'),\n\n  // =========================================\n  // CALORIC AND MACRONUTRIENT INTAKE\n  // =========================================\n  calories_estimated: decimal('calories_estimated', { precision: 7, scale: 2 }),\n  calories_unit: varchar('calories_unit', { length: 10 }).default('kcal'),\n\n  protein_grams: decimal('protein_grams', { precision: 6, scale: 2 }),\n  carbohydrates_grams: decimal('carbohydrates_grams', { precision: 6, scale: 2 }),\n  fat_grams: decimal('fat_grams', { precision: 6, scale: 2 }),\n  fiber_grams: decimal('fiber_grams', { precision: 5, scale: 2 }),\n  sugar_grams: decimal('sugar_grams', { precision: 6, scale: 2 }),\n  saturated_fat_grams: decimal('saturated_fat_grams', { precision: 5, scale: 2 }),\n  sodium_mg: decimal('sodium_mg', { precision: 7, scale: 2 }),\n  cholesterol_mg: decimal('cholesterol_mg', { precision: 6, scale: 2 }),\n\n  // =========================================\n  // FLUID INTAKE\n  // =========================================\n  fluid_intake_ml: decimal('fluid_intake_ml', { precision: 7, scale: 2 }),\n  fluid_intake_oz: decimal('fluid_intake_oz', { precision: 6, scale: 2 }),\n  fluid_type: varchar('fluid_type', { length: 255 }), // WATER, JUICE, MILK, COFFEE, TEA, THICKENED, etc.\n  fluid_consistency: varchar('fluid_consistency', { length: 100 }), // THIN, NECTAR_THICK, HONEY_THICK, PUDDING_THICK\n  ice_chips: boolean('ice_chips').default(false),\n  ice_chips_amount: varchar('ice_chips_amount', { length: 50 }),\n\n  // =========================================\n  // APPETITE ASSESSMENT\n  // =========================================\n  appetite_level: varchar('appetite_level', { length: 50 }), // EXCELLENT, GOOD, FAIR, POOR, NONE\n  appetite_compared_to_normal: varchar('appetite_compared_to_normal', { length: 50 }), // INCREASED, NORMAL, DECREASED, SEVERELY_DECREASED\n  hunger_reported: boolean('hunger_reported'),\n  hunger_cues_observed: text('hunger_cues_observed'),\n\n  // =========================================\n  // TOLERANCE AND SYMPTOMS\n  // =========================================\n  tolerated_well: boolean('tolerated_well').default(true),\n  nausea_present: boolean('nausea_present').default(false),\n  nausea_severity: varchar('nausea_severity', { length: 50 }),\n  vomiting: boolean('vomiting').default(false),\n  vomiting_amount: varchar('vomiting_amount', { length: 100 }),\n  abdominal_discomfort: boolean('abdominal_discomfort').default(false),\n  bloating: boolean('bloating').default(false),\n  reflux: boolean('reflux').default(false),\n  dysphagia_symptoms: boolean('dysphagia_symptoms').default(false),\n  choking_episode: boolean('choking_episode').default(false),\n  aspiration_concern: boolean('aspiration_concern').default(false),\n  taste_changes: varchar('taste_changes', { length: 255 }),\n  mouth_sores: boolean('mouth_sores').default(false),\n  dry_mouth: boolean('dry_mouth').default(false),\n  early_satiety: boolean('early_satiety').default(false),\n  tolerance_notes: text('tolerance_notes'),\n\n  // =========================================\n  // EATING ENVIRONMENT AND CONTEXT\n  // =========================================\n  eating_location: varchar('eating_location', { length: 100 }), // BED, CHAIR, DINING_ROOM, etc.\n  eating_position: varchar('eating_position', { length: 100 }), // UPRIGHT, SEMI_RECLINED, etc.\n  feeding_method: varchar('feeding_method', { length: 100 }), // SELF, ASSISTED, TOTAL_ASSISTANCE, TUBE, IV\n  assistance_level: varchar('assistance_level', { length: 50 }), // INDEPENDENT, SETUP, SUPERVISION, LIMITED, EXTENSIVE, TOTAL\n  adaptive_equipment_used: text('adaptive_equipment_used'),\n\n  // =========================================\n  // TUBE FEEDING DETAILS (if applicable)\n  // =========================================\n  tube_feeding_formula: varchar('tube_feeding_formula', { length: 255 }),\n  tube_feeding_rate: decimal('tube_feeding_rate', { precision: 6, scale: 2 }), // mL/hr\n  tube_feeding_method: varchar('tube_feeding_method', { length: 50 }), // CONTINUOUS, BOLUS, CYCLIC\n  tube_type: varchar('tube_type', { length: 100 }), // NG, NJ, PEG, PEJ, G-TUBE, J-TUBE\n  tube_feeding_residual: decimal('tube_feeding_residual', { precision: 6, scale: 2 }), // mL\n  residual_action_taken: varchar('residual_action_taken', { length: 255 }),\n  tube_feeding_notes: text('tube_feeding_notes'),\n\n  // =========================================\n  // PARENTERAL NUTRITION (if applicable)\n  // =========================================\n  tpn_formula: varchar('tpn_formula', { length: 255 }),\n  tpn_rate: decimal('tpn_rate', { precision: 6, scale: 2 }), // mL/hr\n  tpn_additives: text('tpn_additives'),\n  lipid_infusion: boolean('lipid_infusion').default(false),\n  lipid_rate: decimal('lipid_rate', { precision: 6, scale: 2 }),\n  parenteral_notes: text('parenteral_notes'),\n\n  // =========================================\n  // ORAL SUPPLEMENTS\n  // =========================================\n  supplement_taken: boolean('supplement_taken').default(false),\n  supplement_name: varchar('supplement_name', { length: 255 }),\n  supplement_amount: varchar('supplement_amount', { length: 100 }),\n  supplement_calories: decimal('supplement_calories', { precision: 6, scale: 2 }),\n  supplement_protein: decimal('supplement_protein', { precision: 5, scale: 2 }),\n  supplement_notes: text('supplement_notes'),\n\n  // =========================================\n  // MEAL REFUSAL\n  // =========================================\n  meal_refused: boolean('meal_refused').default(false),\n  refusal_reason: varchar('refusal_reason', { length: 255 }), // NOT_HUNGRY, NAUSEA, PAIN, FATIGUE, DEPRESSION, DISLIKE, OTHER\n  refusal_details: text('refusal_details'),\n  intervention_attempted: boolean('intervention_attempted').default(false),\n  intervention_description: text('intervention_description'),\n  intervention_outcome: varchar('intervention_outcome', { length: 100 }),\n\n  // =========================================\n  // TIMING\n  // =========================================\n  meal_duration_minutes: integer('meal_duration_minutes'),\n  time_offered: timestamp('time_offered'),\n  time_completed: timestamp('time_completed'),\n\n  // =========================================\n  // DOCUMENTATION\n  // =========================================\n  documented_by_id: bigint('documented_by_id', { mode: 'number' }),\n  is_shift_summary: boolean('is_shift_summary').default(false), // True if aggregate for shift\n  shift_period: varchar('shift_period', { length: 50 }), // DAY, EVENING, NIGHT\n  notes: text('notes'),\n\n  // =========================================\n  // SIGNATURE AND COMPLIANCE\n  // =========================================\n  signature_id: bigint('signature_id', { mode: 'number' }),\n  signed_at: timestamp('signed_at'),\n  signed_by_id: bigint('signed_by_id', { mode: 'number' }),\n\n  // Amendment tracking\n  amended: boolean('amended').default(false),\n  amendment_reason: text('amendment_reason'),\n  amended_at: timestamp('amended_at'),\n  amended_by_id: bigint('amended_by_id', { mode: 'number' }),\n\n  // =========================================\n  // AUDIT FIELDS\n  // =========================================\n  created_by_id: bigint('created_by_id', { mode: 'number' }),\n  updated_by_id: bigint('updated_by_id', { mode: 'number' }),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n}, (table) => ({\n  patientIdx: index('idx_nutrition_intake_records_patient_id').on(table.patient_id),\n  intakeDatetimeIdx: index('idx_nutrition_intake_records_datetime').on(table.intake_datetime),\n  mealTypeIdx: index('idx_nutrition_intake_records_meal_type').on(table.meal_type),\n  patientDateIdx: index('idx_nutrition_intake_records_patient_date').on(table.patient_id, table.intake_datetime),\n  encounterIdx: index('idx_nutrition_intake_records_encounter').on(table.encounter_id),\n  refusedIdx: index('idx_nutrition_intake_records_refused').on(table.meal_refused),\n}));\n\n// Meal types\nexport const MEAL_TYPES = {\n  BREAKFAST: 'BREAKFAST',\n  AM_SNACK: 'AM_SNACK',\n  LUNCH: 'LUNCH',\n  PM_SNACK: 'PM_SNACK',\n  DINNER: 'DINNER',\n  HS_SNACK: 'HS_SNACK',\n  SUPPLEMENT: 'SUPPLEMENT',\n  TUBE_FEEDING: 'TUBE_FEEDING',\n  IV_NUTRITION: 'IV_NUTRITION',\n  OTHER: 'OTHER'\n};\n\n// Intake categories\nexport const INTAKE_CATEGORIES = {\n  ORAL: 'ORAL',\n  ENTERAL: 'ENTERAL',\n  PARENTERAL: 'PARENTERAL',\n  COMBINATION: 'COMBINATION'\n};\n\n// Portion consumed descriptions\nexport const PORTION_CONSUMED = {\n  ALL: 'ALL',\n  MOST: 'MOST',\n  THREE_QUARTERS: 'THREE_QUARTERS',\n  HALF: 'HALF',\n  QUARTER: 'QUARTER',\n  LITTLE: 'LITTLE',\n  NONE: 'NONE',\n  REFUSED: 'REFUSED'\n};\n\n// Appetite levels\nexport const APPETITE_LEVELS = {\n  EXCELLENT: 'EXCELLENT',\n  GOOD: 'GOOD',\n  FAIR: 'FAIR',\n  POOR: 'POOR',\n  NONE: 'NONE'\n};\n\n// Assistance levels (based on MDS/FIM)\nexport const ASSISTANCE_LEVELS = {\n  INDEPENDENT: 'INDEPENDENT',\n  SETUP_ONLY: 'SETUP_ONLY',\n  SUPERVISION: 'SUPERVISION',\n  LIMITED_ASSISTANCE: 'LIMITED_ASSISTANCE',\n  EXTENSIVE_ASSISTANCE: 'EXTENSIVE_ASSISTANCE',\n  TOTAL_DEPENDENCE: 'TOTAL_DEPENDENCE'\n};\n\n// Fluid consistencies (IDDSI)\nexport const FLUID_CONSISTENCIES = {\n  THIN: 'THIN',\n  SLIGHTLY_THICK: 'SLIGHTLY_THICK',\n  MILDLY_THICK: 'MILDLY_THICK',\n  MODERATELY_THICK: 'MODERATELY_THICK',\n  EXTREMELY_THICK: 'EXTREMELY_THICK'\n};\n\n// Tube types\nexport const TUBE_TYPES = {\n  NASOGASTRIC: 'NASOGASTRIC',\n  NASOJEJUNAL: 'NASOJEJUNAL',\n  PEG: 'PEG',\n  PEJ: 'PEJ',\n  G_TUBE: 'G_TUBE',\n  J_TUBE: 'J_TUBE',\n  GASTROJEJUNOSTOMY: 'GASTROJEJUNOSTOMY'\n};\n\n// Refusal reasons\nexport const REFUSAL_REASONS = {\n  NOT_HUNGRY: 'NOT_HUNGRY',\n  NAUSEA: 'NAUSEA',\n  PAIN: 'PAIN',\n  FATIGUE: 'FATIGUE',\n  DEPRESSION: 'DEPRESSION',\n  DISLIKE_FOOD: 'DISLIKE_FOOD',\n  DIFFICULTY_SWALLOWING: 'DIFFICULTY_SWALLOWING',\n  MOUTH_PROBLEMS: 'MOUTH_PROBLEMS',\n  TOO_FULL: 'TOO_FULL',\n  SLEEPING: 'SLEEPING',\n  END_OF_LIFE_CHOICE: 'END_OF_LIFE_CHOICE',\n  OTHER: 'OTHER'\n};\n"
}

ðŸ”§ Tool: Write
Input: {
  "file_path": "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/src/db/schemas/nutritionStatus.schema.js",
  "content": "import { pgTable, bigint, varchar, text, timestamp, boolean, decimal, integer, index } from 'drizzle-orm/pg-core';\nimport { patients } from './patient.schema.js';\n\n/**\n * Nutrition Status Schema\n * Comprehensive tracking of patient nutritional status including anthropometric\n * measurements, laboratory values, risk assessments, and overall nutritional indicators.\n *\n * Supports:\n * - BMI and weight tracking with history\n * - Malnutrition screening and assessment\n * - Laboratory nutritional markers\n * - Nutritional risk scoring (MNA, MUST, SGA)\n * - Deficiency tracking\n * - Goal setting and progress monitoring\n */\nexport const nutrition_status = pgTable('nutrition_status', {\n  id: bigint('id', { mode: 'number' }).primaryKey().generatedByDefaultAsIdentity(),\n\n  // Patient and encounter associations\n  patient_id: bigint('patient_id', { mode: 'number' }).notNull().references(() => patients.id),\n  encounter_id: bigint('encounter_id', { mode: 'number' }),\n  note_id: bigint('note_id', { mode: 'number' }),\n\n  // =========================================\n  // ASSESSMENT METADATA\n  // =========================================\n  assessment_date: timestamp('assessment_date').defaultNow().notNull(),\n  assessment_type: varchar('assessment_type', { length: 50 }), // INITIAL, ROUTINE, CHANGE_IN_CONDITION, REASSESSMENT\n  assessed_by_id: bigint('assessed_by_id', { mode: 'number' }),\n\n  // =========================================\n  // OVERALL NUTRITIONAL STATUS\n  // =========================================\n  overall_status: varchar('overall_status', { length: 50 }), // WELL_NOURISHED, AT_RISK, MILDLY_MALNOURISHED, MODERATELY_MALNOURISHED, SEVERELY_MALNOURISHED\n  nutritional_diagnosis: text('nutritional_diagnosis'),\n  etiology: text('etiology'),\n  signs_symptoms: text('signs_symptoms'),\n\n  // =========================================\n  // ANTHROPOMETRIC MEASUREMENTS\n  // =========================================\n  // Height\n  height_cm: decimal('height_cm', { precision: 6, scale: 2 }),\n  height_inches: decimal('height_inches', { precision: 5, scale: 2 }),\n  height_source: varchar('height_source', { length: 100 }), // MEASURED, REPORTED, ESTIMATED, KNEE_HEIGHT, ARM_SPAN\n\n  // Current weight\n  weight_kg: decimal('weight_kg', { precision: 6, scale: 2 }),\n  weight_lbs: decimal('weight_lbs', { precision: 6, scale: 2 }),\n  weight_source: varchar('weight_source', { length: 100 }), // SCALE, BED_SCALE, CHAIR_SCALE, ESTIMATED, REPORTED\n  weight_date: timestamp('weight_date'),\n\n  // BMI\n  bmi: decimal('bmi', { precision: 5, scale: 2 }),\n  bmi_category: varchar('bmi_category', { length: 50 }), // UNDERWEIGHT, NORMAL, OVERWEIGHT, OBESE_I, OBESE_II, OBESE_III\n\n  // Ideal body weight\n  ideal_body_weight_kg: decimal('ideal_body_weight_kg', { precision: 6, scale: 2 }),\n  percent_ideal_body_weight: decimal('percent_ideal_body_weight', { precision: 5, scale: 2 }),\n\n  // Usual body weight\n  usual_body_weight_kg: decimal('usual_body_weight_kg', { precision: 6, scale: 2 }),\n  percent_usual_body_weight: decimal('percent_usual_body_weight', { precision: 5, scale: 2 }),\n\n  // =========================================\n  // WEIGHT CHANGE HISTORY\n  // =========================================\n  weight_change_1_week_kg: decimal('weight_change_1_week_kg', { precision: 5, scale: 2 }),\n  weight_change_1_week_percent: decimal('weight_change_1_week_percent', { precision: 5, scale: 2 }),\n  weight_change_1_month_kg: decimal('weight_change_1_month_kg', { precision: 5, scale: 2 }),\n  weight_change_1_month_percent: decimal('weight_change_1_month_percent', { precision: 5, scale: 2 }),\n  weight_change_3_month_kg: decimal('weight_change_3_month_kg', { precision: 6, scale: 2 }),\n  weight_change_3_month_percent: decimal('weight_change_3_month_percent', { precision: 5, scale: 2 }),\n  weight_change_6_month_kg: decimal('weight_change_6_month_kg', { precision: 6, scale: 2 }),\n  weight_change_6_month_percent: decimal('weight_change_6_month_percent', { precision: 5, scale: 2 }),\n  weight_trend: varchar('weight_trend', { length: 50 }), // STABLE, INCREASING, DECREASING, FLUCTUATING\n  weight_loss_intentional: boolean('weight_loss_intentional'),\n  weight_history_notes: text('weight_history_notes'),\n\n  // =========================================\n  // ADDITIONAL ANTHROPOMETRICS\n  // =========================================\n  waist_circumference_cm: decimal('waist_circumference_cm', { precision: 5, scale: 2 }),\n  hip_circumference_cm: decimal('hip_circumference_cm', { precision: 5, scale: 2 }),\n  waist_hip_ratio: decimal('waist_hip_ratio', { precision: 4, scale: 2 }),\n  mid_arm_circumference_cm: decimal('mid_arm_circumference_cm', { precision: 5, scale: 2 }),\n  calf_circumference_cm: decimal('calf_circumference_cm', { precision: 5, scale: 2 }),\n  triceps_skinfold_mm: decimal('triceps_skinfold_mm', { precision: 4, scale: 2 }),\n  body_fat_percentage: decimal('body_fat_percentage', { precision: 5, scale: 2 }),\n\n  // =========================================\n  // MALNUTRITION SCREENING TOOLS\n  // =========================================\n  // Mini Nutritional Assessment (MNA)\n  mna_screening_score: integer('mna_screening_score'),\n  mna_assessment_score: integer('mna_assessment_score'),\n  mna_total_score: decimal('mna_total_score', { precision: 4, scale: 1 }),\n  mna_category: varchar('mna_category', { length: 50 }), // NORMAL, AT_RISK, MALNOURISHED\n\n  // MUST (Malnutrition Universal Screening Tool)\n  must_bmi_score: integer('must_bmi_score'),\n  must_weight_loss_score: integer('must_weight_loss_score'),\n  must_acute_disease_score: integer('must_acute_disease_score'),\n  must_total_score: integer('must_total_score'),\n  must_risk_category: varchar('must_risk_category', { length: 50 }), // LOW, MEDIUM, HIGH\n\n  // SGA (Subjective Global Assessment)\n  sga_rating: varchar('sga_rating', { length: 50 }), // SGA_A, SGA_B, SGA_C\n  sga_weight_change: varchar('sga_weight_change', { length: 50 }),\n  sga_dietary_intake: varchar('sga_dietary_intake', { length: 50 }),\n  sga_gi_symptoms: varchar('sga_gi_symptoms', { length: 50 }),\n  sga_functional_capacity: varchar('sga_functional_capacity', { length: 50 }),\n  sga_physical_exam: varchar('sga_physical_exam', { length: 50 }),\n\n  // =========================================\n  // LABORATORY VALUES\n  // =========================================\n  albumin_g_dl: decimal('albumin_g_dl', { precision: 4, scale: 2 }),\n  albumin_date: timestamp('albumin_date'),\n  prealbumin_mg_dl: decimal('prealbumin_mg_dl', { precision: 5, scale: 2 }),\n  prealbumin_date: timestamp('prealbumin_date'),\n  transferrin_mg_dl: decimal('transferrin_mg_dl', { precision: 5, scale: 1 }),\n  total_protein_g_dl: decimal('total_protein_g_dl', { precision: 4, scale: 2 }),\n  total_lymphocyte_count: decimal('total_lymphocyte_count', { precision: 6, scale: 1 }),\n  hemoglobin_g_dl: decimal('hemoglobin_g_dl', { precision: 4, scale: 1 }),\n  hematocrit_percent: decimal('hematocrit_percent', { precision: 4, scale: 1 }),\n  cholesterol_mg_dl: integer('cholesterol_mg_dl'),\n  triglycerides_mg_dl: integer('triglycerides_mg_dl'),\n  blood_glucose_fasting: integer('blood_glucose_fasting'),\n  hba1c: decimal('hba1c', { precision: 4, scale: 1 }),\n  bun: decimal('bun', { precision: 5, scale: 1 }),\n  creatinine: decimal('creatinine', { precision: 4, scale: 2 }),\n  sodium: integer('sodium'),\n  potassium: decimal('potassium', { precision: 4, scale: 2 }),\n  phosphorus: decimal('phosphorus', { precision: 4, scale: 2 }),\n  magnesium: decimal('magnesium', { precision: 4, scale: 2 }),\n  calcium: decimal('calcium', { precision: 4, scale: 2 }),\n  labs_date: timestamp('labs_date'),\n  lab_notes: text('lab_notes'),\n\n  // =========================================\n  // VITAMIN/MINERAL DEFICIENCIES\n  // =========================================\n  vitamin_deficiencies_json: text('vitamin_deficiencies_json'), // JSON array of deficiencies\n  vitamin_d_level: decimal('vitamin_d_level', { precision: 5, scale: 1 }),\n  vitamin_b12_level: decimal('vitamin_b12_level', { precision: 6, scale: 0 }),\n  folate_level: decimal('folate_level', { precision: 5, scale: 1 }),\n  iron_level: decimal('iron_level', { precision: 5, scale: 0 }),\n  ferritin_level: decimal('ferritin_level', { precision: 6, scale: 1 }),\n  zinc_level: decimal('zinc_level', { precision: 5, scale: 1 }),\n  deficiency_notes: text('deficiency_notes'),\n\n  // =========================================\n  // HYDRATION STATUS\n  // =========================================\n  hydration_status: varchar('hydration_status', { length: 50 }), // WELL_HYDRATED, MILDLY_DEHYDRATED, MODERATELY_DEHYDRATED, SEVERELY_DEHYDRATED\n  dehydration_signs: text('dehydration_signs'), // JSON or comma-separated\n  skin_turgor: varchar('skin_turgor', { length: 50 }),\n  mucous_membranes: varchar('mucous_membranes', { length: 50 }),\n  urine_output: varchar('urine_output', { length: 50 }),\n  fluid_restriction: boolean('fluid_restriction').default(false),\n  fluid_restriction_amount_ml: integer('fluid_restriction_amount_ml'),\n  hydration_notes: text('hydration_notes'),\n\n  // =========================================\n  // PHYSICAL SIGNS OF MALNUTRITION\n  // =========================================\n  muscle_wasting: boolean('muscle_wasting').default(false),\n  muscle_wasting_location: text('muscle_wasting_location'),\n  subcutaneous_fat_loss: boolean('subcutaneous_fat_loss').default(false),\n  fat_loss_location: text('fat_loss_location'),\n  edema_nutritional: boolean('edema_nutritional').default(false),\n  edema_location: text('edema_location'),\n  ascites: boolean('ascites').default(false),\n  hair_changes: boolean('hair_changes').default(false),\n  hair_changes_description: text('hair_changes_description'),\n  nail_changes: boolean('nail_changes').default(false),\n  nail_changes_description: text('nail_changes_description'),\n  skin_changes: boolean('skin_changes').default(false),\n  skin_changes_description: text('skin_changes_description'),\n  oral_changes: boolean('oral_changes').default(false),\n  oral_changes_description: text('oral_changes_description'),\n  physical_exam_notes: text('physical_exam_notes'),\n\n  // =========================================\n  // FUNCTIONAL STATUS\n  // =========================================\n  functional_status: varchar('functional_status', { length: 50 }), // INDEPENDENT, MODIFIED_INDEPENDENT, REQUIRES_ASSISTANCE, DEPENDENT\n  handgrip_strength_kg: decimal('handgrip_strength_kg', { precision: 5, scale: 2 }),\n  handgrip_side: varchar('handgrip_side', { length: 10 }), // LEFT, RIGHT\n  activity_level: varchar('activity_level', { length: 50 }), // BEDRIDDEN, BEDFAST, CHAIR_FAST, AMBULATORY\n  energy_level: varchar('energy_level', { length: 50 }), // HIGH, NORMAL, LOW, VERY_LOW\n  fatigue_level: varchar('fatigue_level', { length: 50 }),\n  functional_notes: text('functional_notes'),\n\n  // =========================================\n  // NUTRITIONAL REQUIREMENTS\n  // =========================================\n  estimated_calorie_needs: integer('estimated_calorie_needs'),\n  calorie_calculation_method: varchar('calorie_calculation_method', { length: 100 }), // MIFFLIN_ST_JEOR, HARRIS_BENEDICT, PENN_STATE, INDIRECT_CALORIMETRY\n  activity_factor: decimal('activity_factor', { precision: 3, scale: 2 }),\n  stress_factor: decimal('stress_factor', { precision: 3, scale: 2 }),\n  estimated_protein_needs_g: decimal('estimated_protein_needs_g', { precision: 5, scale: 1 }),\n  protein_needs_g_per_kg: decimal('protein_needs_g_per_kg', { precision: 3, scale: 2 }),\n  estimated_fluid_needs_ml: integer('estimated_fluid_needs_ml'),\n  requirements_notes: text('requirements_notes'),\n\n  // =========================================\n  // NUTRITION GOALS\n  // =========================================\n  nutrition_goals: text('nutrition_goals'), // JSON or text\n  weight_goal: varchar('weight_goal', { length: 50 }), // MAINTAIN, GAIN, LOSE, COMFORT_CARE\n  weight_goal_target_kg: decimal('weight_goal_target_kg', { precision: 6, scale: 2 }),\n  intake_goal: varchar('intake_goal', { length: 255 }),\n  hydration_goal: varchar('hydration_goal', { length: 255 }),\n  goal_timeframe: varchar('goal_timeframe', { length: 100 }),\n  goal_progress: varchar('goal_progress', { length: 50 }), // ON_TRACK, PARTIALLY_MET, NOT_MET\n  goal_notes: text('goal_notes'),\n\n  // =========================================\n  // INTERVENTIONS\n  // =========================================\n  interventions_json: text('interventions_json'), // JSON array of current interventions\n  diet_order: varchar('diet_order', { length: 255 }),\n  diet_texture: varchar('diet_texture', { length: 100 }),\n  fluid_consistency: varchar('fluid_consistency', { length: 100 }),\n  supplements_ordered: text('supplements_ordered'),\n  tube_feeding_ordered: boolean('tube_feeding_ordered').default(false),\n  tpn_ordered: boolean('tpn_ordered').default(false),\n  speech_therapy_referral: boolean('speech_therapy_referral').default(false),\n  registered_dietitian_referral: boolean('registered_dietitian_referral').default(false),\n  intervention_notes: text('intervention_notes'),\n\n  // =========================================\n  // HOSPICE-SPECIFIC CONSIDERATIONS\n  // =========================================\n  comfort_care_focus: boolean('comfort_care_focus').default(false),\n  artificial_nutrition_discussed: boolean('artificial_nutrition_discussed'),\n  artificial_nutrition_decision: varchar('artificial_nutrition_decision', { length: 50 }), // CONTINUE, WITHHOLD, WITHDRAW, NOT_DISCUSSED\n  patient_family_goals: text('patient_family_goals'),\n  quality_of_life_priority: text('quality_of_life_priority'),\n  hospice_nutrition_notes: text('hospice_nutrition_notes'),\n\n  // =========================================\n  // CLINICAL NOTES AND SUMMARY\n  // =========================================\n  clinical_notes: text('clinical_notes'),\n  assessment_summary: text('assessment_summary'),\n  recommendations: text('recommendations'),\n  follow_up_plan: text('follow_up_plan'),\n  next_assessment_date: timestamp('next_assessment_date'),\n  provider_notified: boolean('provider_notified').default(false),\n  provider_notified_reason: text('provider_notified_reason'),\n\n  // =========================================\n  // SIGNATURE AND COMPLIANCE\n  // =========================================\n  signature_id: bigint('signature_id', { mode: 'number' }),\n  signed_at: timestamp('signed_at'),\n  signed_by_id: bigint('signed_by_id', { mode: 'number' }),\n\n  // Amendment tracking\n  amended: boolean('amended').default(false),\n  amendment_reason: text('amendment_reason'),\n  amended_at: timestamp('amended_at'),\n  amended_by_id: bigint('amended_by_id', { mode: 'number' }),\n\n  // =========================================\n  // AUDIT FIELDS\n  // =========================================\n  created_by_id: bigint('created_by_id', { mode: 'number' }),\n  updated_by_id: bigint('updated_by_id', { mode: 'number' }),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n}, (table) => ({\n  patientIdx: index('idx_nutrition_status_patient_id').on(table.patient_id),\n  assessmentDateIdx: index('idx_nutrition_status_assessment_date').on(table.assessment_date),\n  patientDateIdx: index('idx_nutrition_status_patient_date').on(table.patient_id, table.assessment_date),\n  overallStatusIdx: index('idx_nutrition_status_overall').on(table.overall_status),\n  bmiIdx: index('idx_nutrition_status_bmi').on(table.bmi),\n  mnaIdx: index('idx_nutrition_status_mna').on(table.mna_category),\n  mustIdx: index('idx_nutrition_status_must').on(table.must_risk_category),\n}));\n\n// Overall nutritional status categories\nexport const NUTRITIONAL_STATUS = {\n  WELL_NOURISHED: 'WELL_NOURISHED',\n  AT_RISK: 'AT_RISK',\n  MILDLY_MALNOURISHED: 'MILDLY_MALNOURISHED',\n  MODERATELY_MALNOURISHED: 'MODERATELY_MALNOURISHED',\n  SEVERELY_MALNOURISHED: 'SEVERELY_MALNOURISHED'\n};\n\n// BMI categories\nexport const BMI_CATEGORIES = {\n  SEVERE_UNDERWEIGHT: { label: 'Severe Underweight', min: 0, max: 16 },\n  UNDERWEIGHT: { label: 'Underweight', min: 16, max: 18.5 },\n  NORMAL: { label: 'Normal', min: 18.5, max: 25 },\n  OVERWEIGHT: { label: 'Overweight', min: 25, max: 30 },\n  OBESE_CLASS_I: { label: 'Obese Class I', min: 30, max: 35 },\n  OBESE_CLASS_II: { label: 'Obese Class II', min: 35, max: 40 },\n  OBESE_CLASS_III: { label: 'Obese Class III', min: 40, max: Infinity }\n};\n\n// MNA categories\nexport const MNA_CATEGORIES = {\n  NORMAL: { label: 'Normal nutritional status', min: 24, max: 30 },\n  AT_RISK: { label: 'At risk of malnutrition', min: 17, max: 23.5 },\n  MALNOURISHED: { label: 'Malnourished', min: 0, max: 17 }\n};\n\n// MUST risk categories\nexport const MUST_RISK_CATEGORIES = {\n  LOW: { label: 'Low Risk', score: 0 },\n  MEDIUM: { label: 'Medium Risk', score: 1 },\n  HIGH: { label: 'High Risk', minScore: 2 }\n};\n\n// SGA ratings\nexport const SGA_RATINGS = {\n  SGA_A: 'Well nourished',\n  SGA_B: 'Moderately malnourished or suspected of being malnourished',\n  SGA_C: 'Severely malnourished'\n};\n\n// Hydration status\nexport const HYDRATION_STATUS = {\n  WELL_HYDRATED: 'WELL_HYDRATED',\n  MILDLY_DEHYDRATED: 'MILDLY_DEHYDRATED',\n  MODERATELY_DEHYDRATED: 'MODERATELY_DEHYDRATED',\n  SEVERELY_DEHYDRATED: 'SEVERELY_DEHYDRATED'\n};\n\n// Weight trends\nexport const WEIGHT_TRENDS = {\n  STABLE: 'STABLE',\n  INCREASING: 'INCREASING',\n  DECREASING: 'DECREASING',\n  FLUCTUATING: 'FLUCTUATING'\n};\n\n// Activity levels\nexport const ACTIVITY_LEVELS = {\n  BEDRIDDEN: 'BEDRIDDEN',\n  BEDFAST: 'BEDFAST',\n  CHAIR_FAST: 'CHAIR_FAST',\n  AMBULATORY_WITH_ASSISTANCE: 'AMBULATORY_WITH_ASSISTANCE',\n  AMBULATORY: 'AMBULATORY'\n};\n\n// Weight goals for hospice\nexport const WEIGHT_GOALS = {\n  MAINTAIN: 'MAINTAIN',\n  GAIN: 'GAIN',\n  LOSE: 'LOSE',\n  COMFORT_CARE: 'COMFORT_CARE'\n};\n\n// Calorie calculation methods\nexport const CALORIE_CALCULATION_METHODS = {\n  MIFFLIN_ST_JEOR: 'MIFFLIN_ST_JEOR',\n  HARRIS_BENEDICT: 'HARRIS_BENEDICT',\n  PENN_STATE: 'PENN_STATE',\n  INDIRECT_CALORIMETRY: 'INDIRECT_CALORIMETRY',\n  ESTIMATED: 'ESTIMATED'\n};\n\n// Normal laboratory ranges for nutritional markers\nexport const NUTRITIONAL_LAB_RANGES = {\n  albumin: { low: 3.4, high: 5.4, unit: 'g/dL', critical_low: 2.0 },\n  prealbumin: { low: 15, high: 36, unit: 'mg/dL', critical_low: 10 },\n  transferrin: { low: 200, high: 400, unit: 'mg/dL' },\n  total_protein: { low: 6.0, high: 8.3, unit: 'g/dL' },\n  vitamin_d: { low: 30, high: 100, unit: 'ng/mL', deficient: 20 },\n  vitamin_b12: { low: 200, high: 900, unit: 'pg/mL', deficient: 200 },\n  folate: { low: 2.7, high: 17, unit: 'ng/mL' },\n  ferritin: { low: 12, high: 300, unit: 'ng/mL' }\n};\n"
}

ðŸ”§ Tool: TodoWrite
Input: {
  "todos": [
    {
      "content": "Explore existing database schema patterns in the codebase",
      "status": "completed",
      "activeForm": "Exploring existing database schema patterns"
    },
    {
      "content": "Design nutrition assessment database schema",
      "status": "completed",
      "activeForm": "Designing nutrition assessment database schema"
    },
    {
      "content": "Implement enhanced nutrition assessment schema file",
      "status": "completed",
      "activeForm": "Implementing enhanced nutrition assessment schema file"
    },
    {
      "content": "Create database migration for nutrition tables",
      "status": "in_progress",
      "activeForm": "Creating database migration for nutrition tables"
    },
    {
      "content": "Register new schemas in index file",
      "status": "pending",
      "activeForm": "Registering new schemas in index file"
    },
    {
      "content": "Create Playwright verification test",
      "status": "pending",
      "activeForm": "Creating Playwright verification test"
    },
    {
      "content": "Run verification and clean up test file",
      "status": "pending",
      "activeForm": "Running verification and cleaning up test file"
    }
  ]
}

Now let me create the database migration file for the nutrition tables.

ðŸ”§ Tool: Write
Input: {
  "file_path": "/Users/fabrice/Sites/chartwarden/Chartwarden/services/api/database/migrations/drizzle/0043_nutrition_assessment_system.sql",
  "content": "-- Migration: Comprehensive Nutrition Assessment System\n-- Description: Creates tables for dietary restrictions, food preferences,\n-- nutritional intake tracking, and overall nutritional status for hospice patients.\n\n-- =========================================\n-- NUTRITION DIETARY RESTRICTIONS\n-- =========================================\n-- Tracks patient food allergies, intolerances, medical restrictions,\n-- and cultural/religious dietary requirements\nCREATE TABLE IF NOT EXISTS \"nutrition_dietary_restrictions\" (\n  \"id\" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,\n  \"patient_id\" BIGINT NOT NULL REFERENCES \"patients\"(\"id\"),\n\n  -- Restriction identification\n  \"restriction_type\" VARCHAR(50) NOT NULL,\n  \"restriction_category\" VARCHAR(100),\n  \"food_item\" VARCHAR(255) NOT NULL,\n  \"food_group\" VARCHAR(100),\n  \"allergen_code\" VARCHAR(50),\n\n  -- Severity and reaction details\n  \"severity\" VARCHAR(50),\n  \"reaction_type\" VARCHAR(255),\n  \"reaction_description\" TEXT,\n  \"onset_time\" VARCHAR(100),\n  \"last_reaction_date\" TIMESTAMP,\n\n  -- Temporal status\n  \"is_permanent\" BOOLEAN DEFAULT TRUE,\n  \"is_active\" BOOLEAN DEFAULT TRUE,\n  \"effective_date\" TIMESTAMP DEFAULT NOW(),\n  \"expiration_date\" TIMESTAMP,\n  \"review_date\" TIMESTAMP,\n\n  -- Medical context\n  \"diagnosed_by\" VARCHAR(255),\n  \"diagnosis_date\" TIMESTAMP,\n  \"verification_method\" VARCHAR(100),\n  \"medical_condition_related\" VARCHAR(255),\n  \"icd10_code\" VARCHAR(20),\n\n  -- Management\n  \"avoidance_instructions\" TEXT,\n  \"cross_contamination_risk\" BOOLEAN DEFAULT FALSE,\n  \"safe_alternatives\" TEXT,\n  \"emergency_treatment\" TEXT,\n  \"epipen_available\" BOOLEAN DEFAULT FALSE,\n  \"epipen_location\" VARCHAR(255),\n\n  -- Notification flags\n  \"notify_on_admission\" BOOLEAN DEFAULT TRUE,\n  \"notify_dietary\" BOOLEAN DEFAULT TRUE,\n  \"notify_pharmacy\" BOOLEAN DEFAULT FALSE,\n  \"display_on_chart\" BOOLEAN DEFAULT TRUE,\n\n  -- Documentation\n  \"source_of_information\" VARCHAR(100),\n  \"verified\" BOOLEAN DEFAULT FALSE,\n  \"verified_by_id\" BIGINT,\n  \"verified_date\" TIMESTAMP,\n  \"notes\" TEXT,\n\n  -- Audit fields\n  \"created_by_id\" BIGINT,\n  \"updated_by_id\" BIGINT,\n  \"created_at\" TIMESTAMP DEFAULT NOW() NOT NULL,\n  \"updated_at\" TIMESTAMP DEFAULT NOW() NOT NULL\n);\n\n-- Indexes for nutrition_dietary_restrictions\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_dietary_restrictions_patient_id\" ON \"nutrition_dietary_restrictions\" (\"patient_id\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_dietary_restrictions_type\" ON \"nutrition_dietary_restrictions\" (\"restriction_type\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_dietary_restrictions_food_group\" ON \"nutrition_dietary_restrictions\" (\"food_group\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_dietary_restrictions_active\" ON \"nutrition_dietary_restrictions\" (\"is_active\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_dietary_restrictions_severity\" ON \"nutrition_dietary_restrictions\" (\"severity\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_dietary_restrictions_patient_active\" ON \"nutrition_dietary_restrictions\" (\"patient_id\", \"is_active\");\n\n\n-- =========================================\n-- NUTRITION FOOD PREFERENCES\n-- =========================================\n-- Tracks patient food likes, dislikes, cultural/religious requirements,\n-- and meal-related preferences\nCREATE TABLE IF NOT EXISTS \"nutrition_food_preferences\" (\n  \"id\" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,\n  \"patient_id\" BIGINT NOT NULL REFERENCES \"patients\"(\"id\"),\n\n  -- Preference type and food item\n  \"preference_type\" VARCHAR(50) NOT NULL,\n  \"preference_category\" VARCHAR(100),\n  \"food_item\" VARCHAR(255),\n  \"food_group\" VARCHAR(100),\n  \"description\" TEXT,\n\n  -- Preference strength\n  \"preference_strength\" VARCHAR(50),\n  \"priority_level\" INTEGER DEFAULT 1,\n  \"is_mandatory\" BOOLEAN DEFAULT FALSE,\n\n  -- Cultural/religious requirements\n  \"cultural_background\" VARCHAR(255),\n  \"religious_requirement\" VARCHAR(255),\n  \"dietary_philosophy\" VARCHAR(100),\n  \"fasting_requirements\" TEXT,\n  \"special_occasions\" TEXT,\n\n  -- Texture preferences\n  \"texture_preference\" VARCHAR(100),\n  \"texture_modifications\" TEXT,\n  \"dysphagia_diet_level\" VARCHAR(100),\n  \"chewing_ability\" VARCHAR(100),\n  \"swallowing_concerns\" TEXT,\n\n  -- Temperature preferences\n  \"temperature_preference\" VARCHAR(50),\n  \"specific_temperature_notes\" TEXT,\n\n  -- Seasoning and flavor\n  \"seasoning_preference\" VARCHAR(100),\n  \"salt_preference\" VARCHAR(50),\n  \"sugar_preference\" VARCHAR(50),\n  \"spice_tolerance\" VARCHAR(50),\n  \"flavor_preferences\" TEXT,\n\n  -- Meal preferences\n  \"preferred_meal_times\" TEXT,\n  \"snack_preferences\" TEXT,\n  \"beverage_preferences\" TEXT,\n  \"portion_size_preference\" VARCHAR(50),\n  \"eating_frequency\" VARCHAR(100),\n\n  -- Preparation method\n  \"preferred_cooking_methods\" TEXT,\n  \"avoided_cooking_methods\" TEXT,\n  \"preparation_notes\" TEXT,\n\n  -- Appetite context\n  \"appetite_notes\" TEXT,\n  \"comfort_foods\" TEXT,\n  \"aversions_during_illness\" TEXT,\n  \"preferences_when_nauseous\" TEXT,\n\n  -- Temporal status\n  \"is_active\" BOOLEAN DEFAULT TRUE,\n  \"effective_date\" TIMESTAMP DEFAULT NOW(),\n  \"last_reviewed_date\" TIMESTAMP,\n  \"preference_changed_date\" TIMESTAMP,\n  \"change_reason\" TEXT,\n\n  -- Source\n  \"source_of_information\" VARCHAR(100),\n  \"reported_by\" VARCHAR(255),\n  \"notes\" TEXT,\n\n  -- Audit fields\n  \"created_by_id\" BIGINT,\n  \"updated_by_id\" BIGINT,\n  \"created_at\" TIMESTAMP DEFAULT NOW() NOT NULL,\n  \"updated_at\" TIMESTAMP DEFAULT NOW() NOT NULL\n);\n\n-- Indexes for nutrition_food_preferences\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_food_preferences_patient_id\" ON \"nutrition_food_preferences\" (\"patient_id\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_food_preferences_type\" ON \"nutrition_food_preferences\" (\"preference_type\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_food_preferences_active\" ON \"nutrition_food_preferences\" (\"is_active\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_food_preferences_patient_active\" ON \"nutrition_food_preferences\" (\"patient_id\", \"is_active\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_food_preferences_religious\" ON \"nutrition_food_preferences\" (\"religious_requirement\");\n\n\n-- =========================================\n-- NUTRITION INTAKE RECORDS\n-- =========================================\n-- Comprehensive tracking of patient nutritional intake including meals,\n-- portions, macronutrients, and hydration\nCREATE TABLE IF NOT EXISTS \"nutrition_intake_records\" (\n  \"id\" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,\n  \"patient_id\" BIGINT NOT NULL REFERENCES \"patients\"(\"id\"),\n  \"encounter_id\" BIGINT,\n  \"note_id\" BIGINT,\n\n  -- Meal/intake identification\n  \"intake_datetime\" TIMESTAMP DEFAULT NOW() NOT NULL,\n  \"meal_type\" VARCHAR(50) NOT NULL,\n  \"intake_category\" VARCHAR(50),\n\n  -- Food/beverage details\n  \"food_description\" TEXT,\n  \"beverage_description\" TEXT,\n  \"food_items_json\" TEXT,\n\n  -- Portion consumption\n  \"portion_offered\" VARCHAR(50),\n  \"portion_consumed_percent\" INTEGER,\n  \"portion_consumed_description\" VARCHAR(100),\n  \"solid_food_consumed_percent\" INTEGER,\n  \"liquid_consumed_percent\" INTEGER,\n\n  -- Caloric and macronutrient intake\n  \"calories_estimated\" DECIMAL(7,2),\n  \"calories_unit\" VARCHAR(10) DEFAULT 'kcal',\n  \"protein_grams\" DECIMAL(6,2),\n  \"carbohydrates_grams\" DECIMAL(6,2),\n  \"fat_grams\" DECIMAL(6,2),\n  \"fiber_grams\" DECIMAL(5,2),\n  \"sugar_grams\" DECIMAL(6,2),\n  \"saturated_fat_grams\" DECIMAL(5,2),\n  \"sodium_mg\" DECIMAL(7,2),\n  \"cholesterol_mg\" DECIMAL(6,2),\n\n  -- Fluid intake\n  \"fluid_intake_ml\" DECIMAL(7,2),\n  \"fluid_intake_oz\" DECIMAL(6,2),\n  \"fluid_type\" VARCHAR(255),\n  \"fluid_consistency\" VARCHAR(100),\n  \"ice_chips\" BOOLEAN DEFAULT FALSE,\n  \"ice_chips_amount\" VARCHAR(50),\n\n  -- Appetite assessment\n  \"appetite_level\" VARCHAR(50),\n  \"appetite_compared_to_normal\" VARCHAR(50),\n  \"hunger_reported\" BOOLEAN,\n  \"hunger_cues_observed\" TEXT,\n\n  -- Tolerance and symptoms\n  \"tolerated_well\" BOOLEAN DEFAULT TRUE,\n  \"nausea_present\" BOOLEAN DEFAULT FALSE,\n  \"nausea_severity\" VARCHAR(50),\n  \"vomiting\" BOOLEAN DEFAULT FALSE,\n  \"vomiting_amount\" VARCHAR(100),\n  \"abdominal_discomfort\" BOOLEAN DEFAULT FALSE,\n  \"bloating\" BOOLEAN DEFAULT FALSE,\n  \"reflux\" BOOLEAN DEFAULT FALSE,\n  \"dysphagia_symptoms\" BOOLEAN DEFAULT FALSE,\n  \"choking_episode\" BOOLEAN DEFAULT FALSE,\n  \"aspiration_concern\" BOOLEAN DEFAULT FALSE,\n  \"taste_changes\" VARCHAR(255),\n  \"mouth_sores\" BOOLEAN DEFAULT FALSE,\n  \"dry_mouth\" BOOLEAN DEFAULT FALSE,\n  \"early_satiety\" BOOLEAN DEFAULT FALSE,\n  \"tolerance_notes\" TEXT,\n\n  -- Eating environment and context\n  \"eating_location\" VARCHAR(100),\n  \"eating_position\" VARCHAR(100),\n  \"feeding_method\" VARCHAR(100),\n  \"assistance_level\" VARCHAR(50),\n  \"adaptive_equipment_used\" TEXT,\n\n  -- Tube feeding details\n  \"tube_feeding_formula\" VARCHAR(255),\n  \"tube_feeding_rate\" DECIMAL(6,2),\n  \"tube_feeding_method\" VARCHAR(50),\n  \"tube_type\" VARCHAR(100),\n  \"tube_feeding_residual\" DECIMAL(6,2),\n  \"residual_action_taken\" VARCHAR(255),\n  \"tube_feeding_notes\" TEXT,\n\n  -- Parenteral nutrition\n  \"tpn_formula\" VARCHAR(255),\n  \"tpn_rate\" DECIMAL(6,2),\n  \"tpn_additives\" TEXT,\n  \"lipid_infusion\" BOOLEAN DEFAULT FALSE,\n  \"lipid_rate\" DECIMAL(6,2),\n  \"parenteral_notes\" TEXT,\n\n  -- Oral supplements\n  \"supplement_taken\" BOOLEAN DEFAULT FALSE,\n  \"supplement_name\" VARCHAR(255),\n  \"supplement_amount\" VARCHAR(100),\n  \"supplement_calories\" DECIMAL(6,2),\n  \"supplement_protein\" DECIMAL(5,2),\n  \"supplement_notes\" TEXT,\n\n  -- Meal refusal\n  \"meal_refused\" BOOLEAN DEFAULT FALSE,\n  \"refusal_reason\" VARCHAR(255),\n  \"refusal_details\" TEXT,\n  \"intervention_attempted\" BOOLEAN DEFAULT FALSE,\n  \"intervention_description\" TEXT,\n  \"intervention_outcome\" VARCHAR(100),\n\n  -- Timing\n  \"meal_duration_minutes\" INTEGER,\n  \"time_offered\" TIMESTAMP,\n  \"time_completed\" TIMESTAMP,\n\n  -- Documentation\n  \"documented_by_id\" BIGINT,\n  \"is_shift_summary\" BOOLEAN DEFAULT FALSE,\n  \"shift_period\" VARCHAR(50),\n  \"notes\" TEXT,\n\n  -- Signature and compliance\n  \"signature_id\" BIGINT,\n  \"signed_at\" TIMESTAMP,\n  \"signed_by_id\" BIGINT,\n\n  -- Amendment tracking\n  \"amended\" BOOLEAN DEFAULT FALSE,\n  \"amendment_reason\" TEXT,\n  \"amended_at\" TIMESTAMP,\n  \"amended_by_id\" BIGINT,\n\n  -- Audit fields\n  \"created_by_id\" BIGINT,\n  \"updated_by_id\" BIGINT,\n  \"created_at\" TIMESTAMP DEFAULT NOW() NOT NULL,\n  \"updated_at\" TIMESTAMP DEFAULT NOW() NOT NULL\n);\n\n-- Indexes for nutrition_intake_records\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_intake_records_patient_id\" ON \"nutrition_intake_records\" (\"patient_id\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_intake_records_datetime\" ON \"nutrition_intake_records\" (\"intake_datetime\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_intake_records_meal_type\" ON \"nutrition_intake_records\" (\"meal_type\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_intake_records_patient_date\" ON \"nutrition_intake_records\" (\"patient_id\", \"intake_datetime\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_intake_records_encounter\" ON \"nutrition_intake_records\" (\"encounter_id\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_intake_records_refused\" ON \"nutrition_intake_records\" (\"meal_refused\");\n\n\n-- =========================================\n-- NUTRITION STATUS\n-- =========================================\n-- Comprehensive tracking of patient nutritional status including anthropometrics,\n-- laboratory values, risk assessments, and overall nutritional indicators\nCREATE TABLE IF NOT EXISTS \"nutrition_status\" (\n  \"id\" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,\n  \"patient_id\" BIGINT NOT NULL REFERENCES \"patients\"(\"id\"),\n  \"encounter_id\" BIGINT,\n  \"note_id\" BIGINT,\n\n  -- Assessment metadata\n  \"assessment_date\" TIMESTAMP DEFAULT NOW() NOT NULL,\n  \"assessment_type\" VARCHAR(50),\n  \"assessed_by_id\" BIGINT,\n\n  -- Overall nutritional status\n  \"overall_status\" VARCHAR(50),\n  \"nutritional_diagnosis\" TEXT,\n  \"etiology\" TEXT,\n  \"signs_symptoms\" TEXT,\n\n  -- Anthropometric measurements - Height\n  \"height_cm\" DECIMAL(6,2),\n  \"height_inches\" DECIMAL(5,2),\n  \"height_source\" VARCHAR(100),\n\n  -- Current weight\n  \"weight_kg\" DECIMAL(6,2),\n  \"weight_lbs\" DECIMAL(6,2),\n  \"weight_source\" VARCHAR(100),\n  \"weight_date\" TIMESTAMP,\n\n  -- BMI\n  \"bmi\" DECIMAL(5,2),\n  \"bmi_category\" VARCHAR(50),\n\n  -- Ideal and usual body weight\n  \"ideal_body_weight_kg\" DECIMAL(6,2),\n  \"percent_ideal_body_weight\" DECIMAL(5,2),\n  \"usual_body_weight_kg\" DECIMAL(6,2),\n  \"percent_usual_body_weight\" DECIMAL(5,2),\n\n  -- Weight change history\n  \"weight_change_1_week_kg\" DECIMAL(5,2),\n  \"weight_change_1_week_percent\" DECIMAL(5,2),\n  \"weight_change_1_month_kg\" DECIMAL(5,2),\n  \"weight_change_1_month_percent\" DECIMAL(5,2),\n  \"weight_change_3_month_kg\" DECIMAL(6,2),\n  \"weight_change_3_month_percent\" DECIMAL(5,2),\n  \"weight_change_6_month_kg\" DECIMAL(6,2),\n  \"weight_change_6_month_percent\" DECIMAL(5,2),\n  \"weight_trend\" VARCHAR(50),\n  \"weight_loss_intentional\" BOOLEAN,\n  \"weight_history_notes\" TEXT,\n\n  -- Additional anthropometrics\n  \"waist_circumference_cm\" DECIMAL(5,2),\n  \"hip_circumference_cm\" DECIMAL(5,2),\n  \"waist_hip_ratio\" DECIMAL(4,2),\n  \"mid_arm_circumference_cm\" DECIMAL(5,2),\n  \"calf_circumference_cm\" DECIMAL(5,2),\n  \"triceps_skinfold_mm\" DECIMAL(4,2),\n  \"body_fat_percentage\" DECIMAL(5,2),\n\n  -- MNA (Mini Nutritional Assessment)\n  \"mna_screening_score\" INTEGER,\n  \"mna_assessment_score\" INTEGER,\n  \"mna_total_score\" DECIMAL(4,1),\n  \"mna_category\" VARCHAR(50),\n\n  -- MUST (Malnutrition Universal Screening Tool)\n  \"must_bmi_score\" INTEGER,\n  \"must_weight_loss_score\" INTEGER,\n  \"must_acute_disease_score\" INTEGER,\n  \"must_total_score\" INTEGER,\n  \"must_risk_category\" VARCHAR(50),\n\n  -- SGA (Subjective Global Assessment)\n  \"sga_rating\" VARCHAR(50),\n  \"sga_weight_change\" VARCHAR(50),\n  \"sga_dietary_intake\" VARCHAR(50),\n  \"sga_gi_symptoms\" VARCHAR(50),\n  \"sga_functional_capacity\" VARCHAR(50),\n  \"sga_physical_exam\" VARCHAR(50),\n\n  -- Laboratory values\n  \"albumin_g_dl\" DECIMAL(4,2),\n  \"albumin_date\" TIMESTAMP,\n  \"prealbumin_mg_dl\" DECIMAL(5,2),\n  \"prealbumin_date\" TIMESTAMP,\n  \"transferrin_mg_dl\" DECIMAL(5,1),\n  \"total_protein_g_dl\" DECIMAL(4,2),\n  \"total_lymphocyte_count\" DECIMAL(6,1),\n  \"hemoglobin_g_dl\" DECIMAL(4,1),\n  \"hematocrit_percent\" DECIMAL(4,1),\n  \"cholesterol_mg_dl\" INTEGER,\n  \"triglycerides_mg_dl\" INTEGER,\n  \"blood_glucose_fasting\" INTEGER,\n  \"hba1c\" DECIMAL(4,1),\n  \"bun\" DECIMAL(5,1),\n  \"creatinine\" DECIMAL(4,2),\n  \"sodium\" INTEGER,\n  \"potassium\" DECIMAL(4,2),\n  \"phosphorus\" DECIMAL(4,2),\n  \"magnesium\" DECIMAL(4,2),\n  \"calcium\" DECIMAL(4,2),\n  \"labs_date\" TIMESTAMP,\n  \"lab_notes\" TEXT,\n\n  -- Vitamin/mineral deficiencies\n  \"vitamin_deficiencies_json\" TEXT,\n  \"vitamin_d_level\" DECIMAL(5,1),\n  \"vitamin_b12_level\" DECIMAL(6,0),\n  \"folate_level\" DECIMAL(5,1),\n  \"iron_level\" DECIMAL(5,0),\n  \"ferritin_level\" DECIMAL(6,1),\n  \"zinc_level\" DECIMAL(5,1),\n  \"deficiency_notes\" TEXT,\n\n  -- Hydration status\n  \"hydration_status\" VARCHAR(50),\n  \"dehydration_signs\" TEXT,\n  \"skin_turgor\" VARCHAR(50),\n  \"mucous_membranes\" VARCHAR(50),\n  \"urine_output\" VARCHAR(50),\n  \"fluid_restriction\" BOOLEAN DEFAULT FALSE,\n  \"fluid_restriction_amount_ml\" INTEGER,\n  \"hydration_notes\" TEXT,\n\n  -- Physical signs of malnutrition\n  \"muscle_wasting\" BOOLEAN DEFAULT FALSE,\n  \"muscle_wasting_location\" TEXT,\n  \"subcutaneous_fat_loss\" BOOLEAN DEFAULT FALSE,\n  \"fat_loss_location\" TEXT,\n  \"edema_nutritional\" BOOLEAN DEFAULT FALSE,\n  \"edema_location\" TEXT,\n  \"ascites\" BOOLEAN DEFAULT FALSE,\n  \"hair_changes\" BOOLEAN DEFAULT FALSE,\n  \"hair_changes_description\" TEXT,\n  \"nail_changes\" BOOLEAN DEFAULT FALSE,\n  \"nail_changes_description\" TEXT,\n  \"skin_changes\" BOOLEAN DEFAULT FALSE,\n  \"skin_changes_description\" TEXT,\n  \"oral_changes\" BOOLEAN DEFAULT FALSE,\n  \"oral_changes_description\" TEXT,\n  \"physical_exam_notes\" TEXT,\n\n  -- Functional status\n  \"functional_status\" VARCHAR(50),\n  \"handgrip_strength_kg\" DECIMAL(5,2),\n  \"handgrip_side\" VARCHAR(10),\n  \"activity_level\" VARCHAR(50),\n  \"energy_level\" VARCHAR(50),\n  \"fatigue_level\" VARCHAR(50),\n  \"functional_notes\" TEXT,\n\n  -- Nutritional requirements\n  \"estimated_calorie_needs\" INTEGER,\n  \"calorie_calculation_method\" VARCHAR(100),\n  \"activity_factor\" DECIMAL(3,2),\n  \"stress_factor\" DECIMAL(3,2),\n  \"estimated_protein_needs_g\" DECIMAL(5,1),\n  \"protein_needs_g_per_kg\" DECIMAL(3,2),\n  \"estimated_fluid_needs_ml\" INTEGER,\n  \"requirements_notes\" TEXT,\n\n  -- Nutrition goals\n  \"nutrition_goals\" TEXT,\n  \"weight_goal\" VARCHAR(50),\n  \"weight_goal_target_kg\" DECIMAL(6,2),\n  \"intake_goal\" VARCHAR(255),\n  \"hydration_goal\" VARCHAR(255),\n  \"goal_timeframe\" VARCHAR(100),\n  \"goal_progress\" VARCHAR(50),\n  \"goal_notes\" TEXT,\n\n  -- Interventions\n  \"interventions_json\" TEXT,\n  \"diet_order\" VARCHAR(255),\n  \"diet_texture\" VARCHAR(100),\n  \"fluid_consistency\" VARCHAR(100),\n  \"supplements_ordered\" TEXT,\n  \"tube_feeding_ordered\" BOOLEAN DEFAULT FALSE,\n  \"tpn_ordered\" BOOLEAN DEFAULT FALSE,\n  \"speech_therapy_referral\" BOOLEAN DEFAULT FALSE,\n  \"registered_dietitian_referral\" BOOLEAN DEFAULT FALSE,\n  \"intervention_notes\" TEXT,\n\n  -- Hospice-specific considerations\n  \"comfort_care_focus\" BOOLEAN DEFAULT FALSE,\n  \"artificial_nutrition_discussed\" BOOLEAN,\n  \"artificial_nutrition_decision\" VARCHAR(50),\n  \"patient_family_goals\" TEXT,\n  \"quality_of_life_priority\" TEXT,\n  \"hospice_nutrition_notes\" TEXT,\n\n  -- Clinical notes and summary\n  \"clinical_notes\" TEXT,\n  \"assessment_summary\" TEXT,\n  \"recommendations\" TEXT,\n  \"follow_up_plan\" TEXT,\n  \"next_assessment_date\" TIMESTAMP,\n  \"provider_notified\" BOOLEAN DEFAULT FALSE,\n  \"provider_notified_reason\" TEXT,\n\n  -- Signature and compliance\n  \"signature_id\" BIGINT,\n  \"signed_at\" TIMESTAMP,\n  \"signed_by_id\" BIGINT,\n\n  -- Amendment tracking\n  \"amended\" BOOLEAN DEFAULT FALSE,\n  \"amendment_reason\" TEXT,\n  \"amended_at\" TIMESTAMP,\n  \"amended_by_id\" BIGINT,\n\n  -- Audit fields\n  \"created_by_id\" BIGINT,\n  \"updated_by_id\" BIGINT,\n  \"created_at\" TIMESTAMP DEFAULT NOW() NOT NULL,\n  \"updated_at\" TIMESTAMP DEFAULT NOW() NOT NULL\n);\n\n-- Indexes for nutrition_status\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_status_patient_id\" ON \"nutrition_status\" (\"patient_id\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_status_assessment_date\" ON \"nutrition_status\" (\"assessment_date\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_status_patient_date\" ON \"nutrition_status\" (\"patient_id\", \"assessment_date\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_status_overall\" ON \"nutrition_status\" (\"overall_status\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_status_bmi\" ON \"nutrition_status\" (\"bmi\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_status_mna\" ON \"nutrition_status\" (\"mna_category\");\nCREATE INDEX IF NOT EXISTS \"idx_nutrition_status_must\" ON \"nutrition_status\" (\"must_risk_category\");\n"
}

You've hit your limit Â· resets 4pm (America/Los_Angeles)