{
  "id": "patient-controller",
  "category": "API",
  "title": "Patient CRUD Controller",
  "description": "Patient Records CRUD Controller with Role-Based Authorization\n\nBuild a secure, production-ready RESTful API controller for managing patient medical records with comprehensive CRUD operations, role-based access control, and HIPAA-compliant audit logging.\n\nCore Endpoints:\n- POST /api/patients - Create new patient record with validated fields (name, DOB, contact info, medical history)\n- GET /api/patients/:id - Retrieve single patient record by ID\n- GET /api/patients - List/search patients with pagination (limit, offset), filtering (name, DOB, status), and sorting\n- PUT /PATCH /api/patients/:id - Update existing patient record (full or partial update)\n- DELETE /api/patients/:id - Remove patient record (implement soft delete with deleted_at timestamp)\n\nAuthorization & Security:\n- Implement middleware to authenticate requests via JWT/session tokens\n- Define role hierarchy: patient (own records only), doctor (read/update assigned patients), nurse (read assigned patients), admin (full access)\n- Enforce authorization checks before data access in each endpoint\n- Add rate limiting to prevent abuse (e.g., 100 requests per 15 minutes per user)\n- Sanitize inputs to prevent SQL injection and XSS attacks\n\nData Validation:\n- Validate required fields: firstName, lastName, dateOfBirth, contactInfo\n- Enforce business rules: DOB must be in the past, phone/email format validation\n- Validate against patient schema using validation library (e.g., Joi, Yup, Zod)\n- Return 400 Bad Request with detailed field-level error messages for invalid input\n\nConcurrency & Data Integrity:\n- Implement optimistic locking using version field or updated_at timestamp\n- Return 409 Conflict when concurrent update detected\n- Use database transactions for operations affecting multiple tables\n\nAudit & Compliance:\n- Log all CUD operations (create, update, delete) with: timestamp, user ID, action type, affected record ID, changed fields\n- Store audit logs in separate audit_log table\n- Include IP address and user agent in audit entries\n- Ensure audit logs are immutable and retained per regulatory requirements\n\nError Handling:\n- 200 OK - Successful GET/PUT/PATCH\n- 201 Created - Successful POST with Location header\n- 204 No Content - Successful DELETE\n- 400 Bad Request - Validation errors with detailed messages\n- 401 Unauthorized - Missing or invalid authentication\n- 403 Forbidden - Authenticated but insufficient permissions\n- 404 Not Found - Patient record doesn't exist\n- 409 Conflict - Concurrent modification or duplicate patient\n- 500 Internal Server Error - Unexpected failures with logged stack trace\n\nEdge Cases & Special Scenarios:\n- Accessing deleted/soft-deleted records (return 404, allow admin to view)\n- Duplicate patient prevention using unique constraints on SSN/medical record number\n- Orphaned references when deleting patients with appointments/prescriptions (prevent deletion or cascade)\n- Bulk operations timeout handling\n- Partial search results when user has limited access scope\n- Pagination edge cases (requesting page beyond total count)\n- Empty search results vs permission denied (don't leak information)\n\nTesting Requirements:\n- Unit tests for each CRUD operation with valid inputs\n- Authorization tests for each role attempting each operation\n- Validation tests for invalid/missing/malformed inputs\n- Concurrency tests simulating simultaneous updates\n- Edge case tests for non-existent records, soft-deleted records, duplicate creation\n- Integration tests with test database\n- Achieve minimum 80% code coverage\n\nDependencies & Prerequisites:\n- Database schema with patients table and audit_log table\n- Authentication system providing user identity and roles\n- Input validation library configured\n- Logging framework configured\n- ORM or database client configured\n\nSuccess Criteria:\n- All endpoints functional and returning correct status codes\n- Authorization properly blocks unauthorized access\n- All validation rules enforced\n- Audit logs captured for all modifications\n- Tests passing with adequate coverage\n- API documentation generated (Swagger/OpenAPI)",
  "status": "backlog",
  "priority": 1,
  "complexity": "moderate",
  "dependencies": [
    "patient-schema",
    "casl-authorization",
    "audit-logging-service"
  ],
  "createdAt": "2025-12-31T05:55:26.239Z",
  "updatedAt": "2025-12-31T05:55:26.239Z",
  "skipTests": false,
  "model": "opus",
  "thinkingLevel": "none",
  "imagePaths": [],
  "textFilePaths": [],
  "branchName": "main",
  "planningMode": "skip",
  "requirePlanApproval": false
}