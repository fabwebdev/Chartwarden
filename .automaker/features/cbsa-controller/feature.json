{
  "id": "cbsa-controller",
  "category": "API",
  "title": "CBSA Lookup Controller",
  "description": "Implement Controller for CBSA Code Lookups and Geographic Code Queries\n\nCreate API endpoints for querying Core Based Statistical Area (CBSA) codes and related geographic metadata.\n\nTechnical Implementation:\n- API Endpoints:\n  - GET /api/cbsa/:code - Retrieve CBSA details by code\n  - GET /api/cbsa/search?query={text} - Search CBSAs by name/region\n  - GET /api/geographic/codes?type={type}&fips={code} - Query related geographic codes (county, metro, state)\n  - GET /api/cbsa/:code/counties - List counties within a CBSA\n\n- Controller Structure (RESTful pattern):\n  - CBSAController with async route handlers\n  - Input validation middleware (validate code format, required params)\n  - Response formatting with consistent JSON structure\n\n- Data Layer:\n  - CBSAService for business logic separation\n  - Repository pattern for database queries\n  - Support for FIPS codes, metropolitan/micropolitan distinction\n\n- Database:\n  - CBSA reference table (code, name, type, population, land_area)\n  - Geographic hierarchy relationships (CBSA -> counties -> states)\n  - Indexed queries on code and name fields for performance\n\n- Validation:\n  - CBSA code format validation (5-digit numeric)\n  - FIPS code validation based on type\n  - Query parameter sanitization to prevent injection\n\n- Response Structure:\n```json\n{\n  \"code\": \"12345\",\n  \"name\": \"Metro Area Name\",\n  \"type\": \"metropolitan|micropolitan\",\n  \"population\": 1000000,\n  \"counties\": [...],\n  \"state\": {...}\n}\n```\n\nError Handling:\n- 404 for invalid/non-existent codes\n- 400 for malformed requests\n- Rate limiting on search endpoints\n\nPerformance:\n- Cache frequently accessed CBSA data (Redis/in-memory, 1-hour TTL)\n- Optimize joins for geographic hierarchy queries\n- Implement pagination for search results (limit 50 per page)\n\nTesting:\n- Unit tests for controller methods\n- Integration tests with test CBSA dataset\n- Edge cases: invalid codes, boundary searches, empty results",
  "status": "completed",
  "priority": 1,
  "complexity": "simple",
  "dependencies": [
    "cbsa-service"
  ],
  "createdAt": "2025-12-31T05:55:26.259Z",
  "updatedAt": "2026-01-02T21:57:49.156Z",
  "branchName": "main",
  "startedAt": "2026-01-02T21:56:36.666Z",
  "skipTests": false,
  "model": "sonnet",
  "thinkingLevel": "medium",
  "imagePaths": [],
  "textFilePaths": [],
  "planningMode": "skip",
  "requirePlanApproval": false
}