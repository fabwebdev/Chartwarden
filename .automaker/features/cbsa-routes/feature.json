{
  "id": "cbsa-routes",
  "category": "API",
  "title": "CBSA API Routes",
  "description": "Create REST API Routes for CBSA Lookups with Autocomplete Support\n\nImplement RESTful API endpoints for Core-Based Statistical Area (CBSA) data with real-time autocomplete functionality.\n\nTechnical Implementation:\n- API Endpoints:\n  - GET /api/cbsa/search?q={query}&limit={limit} - Autocomplete search\n  - GET /api/cbsa/:code - Get CBSA details by code\n  - GET /api/cbsa - List all CBSAs with pagination\n- Database: \n  - CBSA table with indexed columns: code (primary), name, state, population, metropolitan_type\n  - Add GIN/full-text index on name field for fast prefix matching\n  - Consider materialized view for frequently accessed aggregations\n- Query Optimization:\n  - Use ILIKE/trigram matching for fuzzy search (PostgreSQL pg_trgm extension)\n  - Implement query result limit (default 10, max 50 for autocomplete)\n  - Add database query timeout (500ms)\n- Response Format:\n  ```json\n  {\n    \"results\": [\n      {\n        \"code\": \"12345\",\n        \"name\": \"City-State Metro Area\",\n        \"state\": \"ST\",\n        \"type\": \"Metropolitan\",\n        \"population\": 1000000\n      }\n    ],\n    \"total\": 150,\n    \"page\": 1\n  }\n  ```\n\nBackend Architecture:\n- CbsaController with search, getById, list methods\n- CbsaService for business logic and data transformation\n- CbsaRepository for database queries with prepared statements\n- Input validation middleware (sanitize query, validate limit range)\n\nPerformance & Caching:\n- Redis cache for popular searches (LRU, 1-hour TTL)\n- Cache key: `cbsa:search:{query}:{limit}`\n- Response compression (gzip) for list endpoints\n- Debounce autocomplete requests client-side (200ms)\n\nSecurity:\n- Rate limiting: 100 requests/minute per IP for search endpoint\n- SQL injection prevention via parameterized queries\n- Input sanitization (strip special characters from search queries)\n\nEdge Cases:\n- Empty query handling (return empty array or top N results)\n- No results found (404 vs 200 with empty array)\n- Partial name matches (handle abbreviations, alternate spellings)\n- Special characters in CBSA names (St. Louis, Dallas-Fort Worth)",
  "status": "verified",
  "priority": 1,
  "complexity": "simple",
  "dependencies": [
    "cbsa-controller"
  ],
  "createdAt": "2025-12-31T05:55:26.259Z",
  "updatedAt": "2026-01-02T21:58:56.675Z",
  "branchName": "main",
  "startedAt": "2026-01-02T21:56:58.288Z",
  "skipTests": false,
  "model": "sonnet",
  "thinkingLevel": "medium",
  "imagePaths": [],
  "textFilePaths": [],
  "planningMode": "skip",
  "requirePlanApproval": false
}