{
  "id": "staff-controller",
  "category": "API",
  "title": "Staff CRUD Controller",
  "description": "Implement Comprehensive Staff Profile and Credential Management System\n\nBuild a robust backend controller system for managing staff profiles with integrated credential lifecycle tracking, enabling administrators to maintain compliance with certification requirements and proactively manage credential renewals.\n\nCore Functionality:\n\nStaff Profile Management:\n- CRUD operations for staff profiles (create, read, update, delete, list)\n- Profile fields: name, employee ID, department, position, contact information, hire date, status\n- Soft delete support to maintain historical records\n- Bulk import/export capabilities for staff data\n- Search and filter by name, department, employee ID, or status\n- Pagination for staff lists (configurable page size)\n\nCredential Tracking System:\n- Support multiple credential types per staff member (certifications, licenses, qualifications, training)\n- Capture credential details: type, issuing authority, issue date, expiration date, credential number, renewal status\n- Track credential states: active, expiring soon, expired, revoked, pending renewal\n- Maintain complete credential history with versioning (initial issue, renewals, updates, revocations)\n- Support credentials with and without expiration dates\n- Link or store credential documentation (PDF certificates, scanned licenses)\n- Validate credential data integrity (expiration after issue date, required fields by credential type)\n\nAlert and Notification System:\n- Automated detection of credentials expiring within configurable timeframes (30, 60, 90 days)\n- Flag expired credentials and staff members with missing required credentials\n- Generate reports of expiring credentials grouped by timeframe\n- Support for querying staff by credential status (expired, expiring, current)\n\nAuthorization and Security:\n- Role-based access control: admin (full access), manager (read + update assigned staff), viewer (read-only)\n- Validate user permissions before any modification operations\n- Prevent unauthorized access to sensitive credential documentation\n- Secure file upload validation for credential attachments\n\nAudit and Compliance:\n- Complete audit trail logging all credential modifications (who, what, when)\n- Track creation, updates, deletions, and status changes\n- Immutable audit log entries\n- Queryable audit history by staff member, date range, or user\n\nTechnical Implementation:\n\nDatabase Design:\n- Staff table: id, employee_id (unique), name, department, position, email, phone, hire_date, status, created_at, updated_at, deleted_at\n- Credentials table: id, staff_id (FK), credential_type, issuing_authority, issue_date, expiration_date, credential_number, status, notes, created_at, updated_at\n- Credential_history table: id, credential_id (FK), change_type, previous_values, new_values, changed_by, changed_at\n- Credential_documents table: id, credential_id (FK), file_name, file_path, file_type, uploaded_by, uploaded_at\n- Audit_log table: id, staff_id (FK), credential_id (FK), action, user_id, changes, timestamp\n- Proper indexes on foreign keys, search fields, and date ranges\n- Constraints for data integrity (non-null required fields, date validations)\n\nAPI Endpoints:\n- POST /api/staff - Create staff profile\n- GET /api/staff - List all staff (with filters, pagination)\n- GET /api/staff/:id - Get specific staff profile with credentials\n- PUT /api/staff/:id - Update staff profile\n- DELETE /api/staff/:id - Soft delete staff profile\n- POST /api/staff/:id/credentials - Add credential to staff\n- PUT /api/credentials/:id - Update credential\n- DELETE /api/credentials/:id - Revoke/remove credential\n- GET /api/credentials/expiring - Get credentials expiring soon\n- GET /api/credentials/expired - Get expired credentials\n- GET /api/staff/missing-credentials - Get staff missing required credentials\n- POST /api/credentials/:id/documents - Upload credential documentation\n- GET /api/staff/:id/audit-log - Get audit history for staff member\n\nValidation Rules:\n- Expiration date must be after issue date\n- Employee ID must be unique across active staff\n- Required credentials based on position/department\n- File upload restrictions (type, size limits)\n- Email format validation\n- Date format consistency\n\nError Handling:\n- 400 Bad Request: validation failures with detailed field errors\n- 401 Unauthorized: missing or invalid authentication\n- 403 Forbidden: insufficient permissions\n- 404 Not Found: staff or credential not found\n- 409 Conflict: duplicate employee ID or credential\n- 500 Internal Server Error: unexpected failures with error logging\n\nTesting Requirements:\n- Unit tests for all controller methods (CRUD operations, validations, authorization)\n- Integration tests for database operations and relationships\n- Test credential lifecycle scenarios (create, renew, expire, revoke)\n- Test authorization rules for different user roles\n- Test edge cases: boundary dates, missing optional fields, concurrent updates\n- Test pagination and filtering logic\n- Test file upload validation and storage\n- Achieve minimum 80% code coverage\n\nPerformance Considerations:\n- Eager/lazy loading strategies for credentials and related data\n- Database query optimization with appropriate indexes\n- Efficient date range queries for expiration tracking\n- Caching strategy for frequently accessed data (staff lists, credential types)\n- Batch operations for bulk updates\n\nSuccess Criteria:\n- All CRUD operations functional with proper validation\n- Credential tracking captures full lifecycle with history\n- Expiration alerts accurately identify credentials within specified timeframes\n- Authorization prevents unauthorized access or modifications\n- Audit log captures all changes with complete context\n- API responses include clear error messages and appropriate status codes\n- All tests pass with adequate coverage\n- Documentation includes API reference and data models",
  "status": "verified",
  "priority": 1,
  "complexity": "moderate",
  "dependencies": [
    "staff-schema",
    "casl-authorization"
  ],
  "createdAt": "2025-12-31T05:55:26.249Z",
  "updatedAt": "2026-01-01T06:47:23.294Z",
  "skipTests": false,
  "model": "opus",
  "thinkingLevel": "none",
  "imagePaths": [],
  "textFilePaths": [],
  "branchName": "main",
  "planningMode": "skip",
  "requirePlanApproval": false,
  "startedAt": "2026-01-01T06:29:21.412Z"
}