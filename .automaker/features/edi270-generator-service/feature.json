{
  "id": "edi270-generator-service",
  "category": "Service",
  "title": "EDI 270 Generator Service",
  "description": "Implement EDI 270 Healthcare Eligibility Inquiry Transaction Generator\n\nBuild a HIPAA-compliant system to generate X12 270 (Healthcare Eligibility/Benefit Inquiry) transaction files for healthcare clearinghouse submission.\n\nTechnical Implementation:\n\n**Core Architecture:**\n- EDI270Generator class with builder pattern for transaction construction\n- SegmentFactory for creating individual EDI segments with validation\n- ControlNumberManager for generating unique ISA/GS/ST control numbers (sequential, persisted)\n- EDI270Validator implementing HIPAA 5010 validation rules\n- TransactionSerializer for converting object model to EDI string format\n\n**Data Model:**\n```\nTransaction270 {\n  interchangeControlHeader: ISASegment\n  functionalGroupHeader: GSSegment\n  transactionSetHeader: STSegment\n  beginningOfHierarchicalTransaction: BHTSegment\n  hierarchicalLoops: HLLoop[]\n  transactionSetTrailer: SESegment\n  functionalGroupTrailer: GESegment\n  interchangeControlTrailer: IEASegment\n}\n\nHLLoop {\n  hierarchicalLevel: HLSegment\n  eligibilityInquiry: EQSegment[]\n  names: NM1Segment[]\n  addresses: N3/N4Segment[]\n  demographics: DMGSegment\n  references: REFSegment[]\n  dates: DTPSegment[]\n  relationships: INSSegment\n  healthCareDiagnosis: HISegment[]\n  children: HLLoop[]\n}\n```\n\n**EDI Format Configuration:**\n- Segment terminator: `~` (configurable)\n- Element separator: `*` (configurable)\n- Sub-element separator: `:` (configurable)\n- Repetition separator: `^` (5010 requirement)\n- Default to no line breaks (continuous string), optional line breaks per segment\n\n**API Endpoints:**\n- POST /api/edi/270/generate - Generate single 270 transaction\n- POST /api/edi/270/batch - Generate batch file with multiple transactions\n- GET /api/edi/270/validate - Validate transaction structure without generating\n- GET /api/edi/270/:id - Retrieve previously generated transaction\n\n**Validation Engine:**\n- Schema validator for required/conditional segments per HIPAA 5010 IG\n- Field-level validators (data type, length, format)\n- Relationship validators (HL parent-child relationships, loop nesting)\n- Trading partner profile support for custom requirements\n- Pre-generation validation pipeline returning detailed error reports\n\n**Control Number Management:**\n- Database table: edi_control_numbers (interchange_number, group_number, transaction_number, created_at)\n- Atomic increment operations with locking to prevent duplicates\n- Configurable starting values and rollover thresholds (999999999 max per X12 standard)\n- Per-sender/receiver tracking for multi-tenant support\n\n**File Generation:**\n- Stream-based writing for large batch files to manage memory\n- Output to configurable storage (filesystem, S3, SFTP for clearinghouse direct submission)\n- Filename convention: EDI270_{SenderID}_{ReceiverID}_{Timestamp}_{ControlNumber}.txt\n- Character encoding: ASCII (X12 requirement)\n\n**Segment Implementation Details:**\n\nISA Segment:\n- ISA05/ISA06: Sender qualifier/ID (configured per trading partner)\n- ISA07/ISA08: Receiver qualifier/ID (clearinghouse credentials)\n- ISA09: Interchange date (YYMMDD)\n- ISA10: Interchange time (HHMM)\n- ISA11: Repetition separator (^)\n- ISA12: Version number (00501 for 5010)\n- ISA15: Usage indicator (P=Production, T=Test)\n\nHL Loop Structure:\n- Level 1: Information Source (Payer) - HL01=1, HL03=20\n- Level 2: Information Receiver (Provider) - HL01=2, HL02=1, HL03=21\n- Level 3: Subscriber - HL01=3, HL02=2, HL03=22\n- Level 4: Dependent (if applicable) - HL01=4, HL02=3, HL03=23\n\nEQ Segment (Service Type Codes):\n- Support common codes: 30 (Health Benefit Plan Coverage), 1 (Medical Care), 35 (Dental Care), 47 (Hospital), etc.\n- Allow multiple EQ segments for different service types in single inquiry\n\n**Data Transformation Layer:**\n- InputMapper to convert application models to EDI segments\n- Support for multiple input formats (JSON, XML, database records)\n- Field sanitization: remove special chars, truncate to max lengths, uppercase where required\n- Date normalization to D8 (CCYYMMDD) format\n\n**Error Handling:**\n- ValidationException with segment-level error details and line numbers\n- Required field missing: fail transaction generation\n- Optional field invalid: log warning, omit segment\n- Batch processing: continue on individual transaction errors, return summary report\n\n**Logging & Audit:**\n- Transaction log table: edi_270_transactions (id, control_number, sender_id, receiver_id, patient_id, status, created_at, file_path)\n- Structured logging: transaction ID, segment counts, validation results, generation time\n- HIPAA compliance: redact PHI in logs, log only metadata\n- Audit trail for regulatory review\n\n**Testing Strategy:**\n- Unit tests for each segment generator with 5010 spec compliance\n- Integration tests with sample clearinghouse 270/271 response pairs\n- Trading partner validation files for real-world scenarios\n- Edge case test suite covering all validation rules\n\n**Performance Optimization:**\n- Object pooling for segment instances in batch processing\n- StringBuilder for segment concatenation (avoid string immutability overhead)\n- Batch size limits (recommend 5000 transactions per file max)\n- Async file writing to prevent blocking\n\n**Security & Compliance:**\n- Encrypt files at rest (AES-256)\n- TLS for transmission to clearinghouses\n- Access control: only authorized users can generate transactions\n- PHI handling per HIPAA Security Rule\n- Retain generated files per trading partner agreement (typically 7 years)\n\n**Edge Cases Handled:**\n- Missing middle name/suffix: omit name segments (NM104/NM106)\n- Invalid date formats: reject transaction with specific error\n- Multiple dependents: create separate HL loops under subscriber\n- Special characters: replace/remove per X12 character set (basic ASCII only)\n- Address > 55 chars: truncate with warning\n- No service type specified: default to 30 (Health Benefit Plan Coverage)\n- Null/empty NPI: require for providers (validation error)\n- Invalid member ID format: validate against payer-specific rules\n- Date ranges: validate end date > start date for DTP segments\n\n**Configuration Management:**\n- Trading partner profiles: ISA/GS identifiers, validation rules, segment requirements\n- Environment-based settings (test vs production clearinghouse endpoints)\n- Feature flags for payer-specific customizations\n\n**Dependencies:**\n- X12 parsing library (e.g., bots, EDI.Net, or custom parser)\n- Validation rule engine\n- Database for control number persistence\n- Cloud storage SDK for file output\n- Logging framework with PHI redaction\n\n**Deliverables:**\n- EDI270Generator service class\n- Validation rule configuration\n- API endpoints with OpenAPI documentation\n- Database migration for control numbers and transaction log\n- Unit and integration test suite\n- Trading partner configuration template\n- Sample 270 files for testing",
  "status": "completed",
  "priority": 1,
  "complexity": "moderate",
  "dependencies": [
    "eligibility-schema"
  ],
  "createdAt": "2025-12-31T05:55:26.253Z",
  "updatedAt": "2026-01-02T15:43:24.150Z",
  "branchName": "main",
  "startedAt": "2026-01-02T15:41:13.429Z",
  "completedAt": "2025-12-31T14:52:02.000Z",
  "skipTests": false,
  "model": "opus",
  "thinkingLevel": "ultrathink",
  "imagePaths": [],
  "textFilePaths": [],
  "planningMode": "full",
  "requirePlanApproval": false
}